var _cp_preloaded_files = _cp_preloaded_files || new Object();
// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/skin.js  D:\WebSites\tmpCincopaAppsV2\_cms/fpskins/mediaelement/1/skin.js   
_cp_preloaded_files["http://rtcdn.cincopa.com/fpskins/mediaelement/1/skin.js"] = true;
if(typeof zeSkins.mediaelement=="undefined"){zeSkins.mediaelement=function(){var self=this;var clickedfirsttime=true;var isChanged=false;this.go=null;this.isready=0;this.isMobile=false;this.isIpad=false;if(/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)==true||((/iPad|iPhone|iPod/.test(navigator.platform)||(navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1))&&!window.MSStream)){this.isMobile=true}if(/iPad/i.test(navigator.userAgent)==true||((/iPad/.test(navigator.platform)||(navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1))&&!window.MSStream)){this.isIpad=true}this.isIOS=(/iPad|iPhone|iPod/.test(navigator.platform)||(navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1))&&!window.MSStream;function _trace(msg){if(cincopa.trace){cincopa.trace("SKIN: "+msg)}}this.arg_groups={basic:{name:"Basic",desc:"Basic settings for the gallery"},advanced:{name:"Advanced",desc:"Advanced settings for the gallery"},appearance:{name:"Player Appearance",desc:"Player Apearance"},controls:{name:"Player Control",desc:"Controls settings for the gallery"},mail:{name:"Lead generator",desc:"Mail server integration"},branded:{name:"Player Brand",desc:"Branded logo settings for the gallery",sub:["watermark","logo","roll"]},advertising:{name:"Advertising",desc:"Advertising settings for the gallery"},hidden:{name:"",desc:""}};this.arg_map={folder_name:{group:"basic",type:"text",name:"Gallery Name",desc:"Gallery Name"},widget_max_width:{group:"basic",type:"dim",name:"Video Player Max Width",desc:"The video player is fully responsive and by default will automatically fill the max width of container where embedded. Use this field if you want to override the default and define your own video width."},autostart:{group:"basic",type:"list",name:"Auto Start Mode",values:{"false":"Off",desktop_only:"Desktop Only","true":"All Devices (Mobile Autoplay On mute)"},desc:"In Auto Start mode, your video starts playing automatically when the page is loadeddata, so the user doesn't have to click on the 'Play' button. Auto Start is turned OFF by default"},playlist_show:{group:"advanced",type:"bool",name:"Show Playlist",desc:"By default this player comes with a playlist. To deactive the playlist change the toggle button to 'Off' "},css_main:{group:"advanced",type:"css",name:"Player CSS code",desc:"Open CSS Editor to directy edit Video Player CSS code"},controlbar_autohide:{group:"advanced",type:"bool",name:"Show Control Bar",desc:"By default when player is not active the player control bar is hidden. To show control bar when player is not active change the toggle button to 'On' "},facebook_mode:{group:"advanced",type:"bool",name:"Facebook mode",desc:"In Auto Start mode, your video starts playing automatically in silent mode when user scrolls over the player. Use the toggle to turn it 'On'."},always_on_top:{group:"advanced",type:"bool",name:"Player Always on top",desc:"With Always on top video player users will have a floating fully customizable window with playing video inside while they scroll over the content on page. Use the toggle to turn it 'On'."},always_on_top_size:{group:"advanced",type:"size",name:"Always on Top Window Size",desc:'Define the size of "Always on top" floating window',enableExp:"param.always_on_top == 'true'"},always_on_top_height_by_ratio:{group:"advanced",type:"bool",name:"Calculate Always on Top Window Height by ratio",desc:"Calculate Always on Top Window Height by ratio",enableExp:"param.always_on_top == 'true'"},always_on_top_top:{group:"advanced",type:"num",name:"Floating Window Margin Top",desc:"Define the margin size of floating window from top of the screen.",enableExp:"param.always_on_top == 'true'"},always_on_top_right:{group:"advanced",type:"num",name:"Floating Window Margin Right",desc:"Define the margin size of floating window from right of the screen.",enableExp:"param.always_on_top == 'true'"},always_on_top_mobile:{group:"hidden",type:"bool",name:"",desc:""},prev_button:{group:"controls",type:"bool",name:"Show Previous Button",desc:'By changing the toggle button to "Off" the "Previous" button won\'t be visible in the player control.'},play_button:{group:"controls",type:"bool",name:"Show Play / Pause Button",desc:'By changing the toggle button to "Off" the "Play/Pause" button won\'t be visible in the player control.'},next_button:{group:"controls",type:"bool",name:"Show Next Button",desc:'By changing the toggle button to "Off" the "Next" button won\'t be visible in the player control.'},fullscreen_button:{group:"controls",type:"bool",name:"Show FullScreen Button",desc:'By changing the toggle button to "Off" the "Full Screen" button won\'t be visible in the player control.'},gear_button:{group:"controls",type:"bool",name:"Gear ",desc:"Gear button(on/off).",enableExp:"param.css_version == '1.1'"},versions:{group:"controls",type:"list",name:"Versions",values:{on:"On",off:"Off"},desc:"Versions",enableExp:"param.css_version == '1.1'"},shuffle_button:{group:"controls",type:"bool",name:"Show Shuffle Button",desc:'By changing the toggle button to "On" a "Shuffle" button will become visible in the player control.'},playlist_button:{group:"controls",type:"bool",name:"Show Playlist Button",desc:'By changing the toggle button to "On" a "PlayList" button will become visible in the player control.',enableExp:"param.playlist_show == 'true'"},loop_button:{group:"controls",type:"bool",name:"Play Video in Loop Mode",desc:"In Loop mode when your video player reaches last video in playlist it will automatically move to the first video. To activate 'Loop' mode use the toggle to turn it 'On'."},download_button:{group:"controls",type:"bool",name:"Show Video Download Button",desc:'By changing the toggle button to "Off" the "Download" button won\'t be visible in the player.'},shuffle:{group:"controls",type:"bool",name:"Start on Shuffle Mode",desc:"Shuffle mode means player will switch between video from the playlist randomly. To active \"Shuffle\" mode change the toggle button to 'On'."},share:{group:"controls",type:"bool",name:"Share button",desc:"Use share buttons to grab your visitors attention and increase sharing across devices."},forceNativeVideo:{group:"controls",type:"bool",name:"Mobile Native Player",desc:'By changing the toggle button to "On" mobile devices will display their own native player instead of Cincopa player design.',enableExp:"param.subtitle == 'false'"},inline_plist:{group:"controls",type:"bool",name:"Playlist active/inactive",desc:"By changing the toogle button to 'On' 'PlayList' will be visible without clicking the 'PlayList Button'",enableExp:"param.playlist_show == 'true'"},volume_slider:{group:"controls",type:"bool",name:"Show Volume Button",desc:'By changing the toggle button to "Off" the volume button will get hidden in the player control.'},timeControl:{group:"controls",type:"bool",name:"Show time control",desc:'By changing the toggle button to "On" the time control indicating video length and time progress will become visible in the player control.'},seekingBar:{group:"controls",type:"bool",name:"Show Progress Indication Bar",desc:'By changing the toggle button to "Off" the progress indication bar will get hidden in the player control.'},storyboard:{group:"controls",type:"list",values:{off:"No Preview Thumbnails",small:"Small Size View",medium:"Medium Size View"},name:"Progress Indication Bar Thumbnails",desc:"Progress indication bar thumbnails are visible when hovering over the progress indication bar. They can come in 2 sizes, small and medium"},subtitle:{group:"controls",type:"bool",name:"Subtitle",desc:"Subtitle on/off"},chapter:{group:"controls",type:"bool",name:"Chapters",desc:"Chapters on/off",enableExp:"param.css_version == '1.1'"},chapter_on:{group:"controls",type:"bool",name:"Show chapters on load",desc:"Show chapters on load",enableExp:"param.chapter == 'true'"},speed:{group:"controls",type:"bool",name:"Speed",desc:"Speed on/off"},hide_controls:{group:"controls",type:"bool",name:"Hide all controls",desc:'By changing the toggle button to "On" player controls won\'t be visible in the player.'},volume_level:{group:"advanced",type:"num",name:"Volume Control",desc:"Define the player default Volume"},items_shuffle:{group:"advanced",type:"bool",name:"Shuffle items",desc:"Shuffle items before rendering"},watermark_position:{group:"branded/watermark",type:"list",values:{no:"I don't need watermark",top_left:"top left",top_right:"top right",bottom_left:"bottom left",bottom_right:"bottom right"},name:"Watermark",desc:"Choose watermark placement over the player. If you don't need watermark leave the default \"I don't need watermark\". "},watermark:{group:"branded/watermark",type:"text",name:"Watermark URL",desc:"Type in the watermark file direct URL (to make sure your player works on both http and https start the url with // for example //www.yoursite.com/logo.png).",enableExp:"param.watermark_position != 'no'"},watermark_link:{group:"branded/watermark",type:"text",name:"Watermark Click URL",desc:"Type in the click URL (target site URL when clicking the watermark).",enableExp:"param.watermark_position != 'no'"},watermark_on_off:{group:"hidden",type:"bool",name:"",desc:""},prepostroll:{group:"branded/roll",type:"bool",name:"Pre/Post Roll Video",desc:"Manually insert video ads and pre/post roll sponsered content"},prerollAssetID:{group:"branded/roll",type:"assetid",name:"Pre roll video",desc:"Type the assets ID you want to stream before the video",enableExp:"param.prepostroll == 'true'"},postrollAssetID:{group:"branded/roll",type:"assetid",name:"Post roll video",desc:"Type the assets ID you want to stream after the video",enableExp:"param.prepostroll == 'true'"},rollFrequency:{group:"branded/roll",type:"list",values:{on_each:"on every video",on_first:"only on first video",on_first_last:"preroll on first video and postroll on last"},name:"Roll frequency",desc:"Choose how to handle roll in playlist"},new_page:{group:"branded/watermark",type:"bool",name:"Open URL in new tab",desc:"Open link in current tab or new tab.",enableExp:"param.watermark_position != 'no' || param.player_watermark_on_off == 'true'"},html_overlay:{group:"mail",type:"overlay",name:"Overlay Type",desc:"Add an overlay form to collect email and other user information following the first or last video. Choose HTML to create your own form or URL to link it to your own form.",enableExp:"param.mail_service != 'none'"},vast:{group:"advertising",type:"text",name:"Vast XML",desc:"Vast XML"},vast_useFlash:{group:"advertising",type:"bool",name:"Use flash player",desc:"Force player to work with flash",enableExp:"param.vast != ''"},allow_change_about_cincopa_text:{group:"misc",type:"text",name:"Right-Click Text",desc:"The text users will see on Right-Click."},allow_change_about_cincopa_url:{group:"misc",type:"text",name:"Right-Click URL",desc:"Type in the Right-Click URL (target site URL when click on 'Right-Click Text'"},right_click_download:{group:"misc",type:"bool",name:"Allow download on Right Click menu",desc:"Allow download on Right Click menu"},right_click_size:{group:"misc",type:"list",values:{original:"Original files",web:"Web version"},name:"Download Size",desc:"Allow user to download individual files from your gallery. * Photos resized to 600x450, videos in mp4 format, audio in mp3 fromat or choose original size of uploaded item",enableExp:"param.right_click == 'download' || param.right_click_download == 'true'"},right_click_copy_embed:{group:"hidden",type:"bool",name:"",desc:""},enable_hls:{group:"hidden",type:"bool",name:"Enable hls",desc:""},fast_start:{group:"hidden",type:"bool",name:"Enable hls",desc:""},iphone_inline_video:{group:"hidden",type:"bool",name:"Enable iphone inline video",desc:""},subtitle_list:{group:"hidden",type:"text",name:"Default subtitle list",desc:""},hide_poster_when_autostart:{group:"hidden",type:"bool",name:"Hide poster in autpstart mode",desc:""},hls_max_buffer_length:{group:"hidden",type:"text",name:"Max buffer length",desc:""},hls_max_fast_start_buffer_length:{group:"hidden",type:"text",name:"Max fast start buffer length",desc:""},};this.arg_defaults={autoPlayNextTrack:true,url_changer:false,forceNativeFullScreen:false,widget_max_width:"",playlist_show:true,autostart:true,facebook_mode:false,always_on_top:false,always_on_top_size_w:300,always_on_top_size_h:150,always_on_top_height_by_ratio:false,always_on_top_top:100,always_on_top_right:100,always_on_top_float:"right",always_on_top_mobile:false,group_by:"off",per_page:0,pagination_type:"prev_next",group_video_tag:"",controlbar_fullscreen:true,controlbar_autohide:true,hide_controls:false,prev_button:true,play_button:true,next_button:true,loop_button:false,shuffle_button:false,download_button:false,playlist_button:true,inline_plist:false,controls_order:"prevtrack,playpause,nexttrack,loop,shuffle,playlist,progress,time,volume,fullscreen,logo,player_logo,chromecast_logo",fullscreen_button:true,forceNativeVideo:true,volume_slider:true,seekingBar:true,storyboard:"off",subtitle:true,chapter:false,chapter_on:true,speed:false,shuffle:false,gear_button:false,versions:"on",share:false,volume_level:80,items_shuffle:false,watermark_on_off:false,watermark:"",watermark_position:"no",watermark_size:20,watermark_link_enable:true,player_watermark:"",player_watermark_on_off:false,player_watermark_link_enable:true,player_watermark_new_page:true,new_page:true,html_overlay_type:"none",html_overlay_show:"before_first",html_overlay_skip:true,html_overlay_fields:"only_email",override_poster:true,vast:"",vast_useFlash:false,prerollAssetID:"",postrollAssetID:"",prepostroll:false,rollFrequency:"on_each",right_click:"true",allow_change_about_cincopa_text:"Powered by Cincopa",allow_change_about_cincopa_url:"//www.cincopa.com",right_click_download:false,right_click_copy_embed:true,right_click_size:"original",enable_hls:true,fast_start:true,iphone_inline_video:true,subtitle_list:"*",hide_poster_when_autostart:true,hls_max_buffer_length:60,hls_max_fast_start_buffer_length:60,vastpreroll:"on_each",tags_order:"order_tags",cincopaTV:false,audio_support:false,audio_jump:true,keyboardShoutcart:false,anchor_videos:"with_hash",smoothvideochange:true};this.init=function(go){this.go=go;this.arg_groups=this.go.merge_json(this.arg_groups,this.go.arg_misc_group);this.arg_map=this.go.merge_json(this.arg_map,this.go.arg_misc);this.go.loadArgs();this.go.loadSkinCSS("css/mediaelementplayer.css");this.go.loadSkinCSS("css/mep-feature-playlist.css");this.go.loadSkinCSS("css/ze-flexslider.css");var jss=["js/zequery-1.9.1.min.js","js/cast_sender.js","js/zequery.cookie.js","js/ze-mediaelement-and-player.min.js","js/mep-feature-playlist.js","js/zequery-mediaelement-universal.js","js/zequery.flexslider.js","js/nativeLanguages.js","js/mep-feature-ads.js","js/mep-feature-ads-vast.js","js/hls.min.js","js/kaleidoscope.js"];this.go.loadSkinJSSequence(jss,function(){zeQuery.noConflict();if(self.go.args.iframe){if(parent.zeQuery){parent.zeQuery.noConflict()}}self.isready++;if(self.isready==2){self.start()}});this.loadItems()};this.loadItems=function(){var ofsWidth=400;if(document.getElementById(this.go.loaderParams._object)){ofsWidth=document.getElementById(this.go.loaderParams._object).offsetWidth}var load_thumb=this.go.namedSize(ofsWidth,0);load_thumb=load_thumb==="xlarge"?load_thumb:"large";var load_content=load_thumb;this.load_thumb=load_thumb;this.load_content=load_content;load_content="original,v:mp4_hd,a:mp3,p:"+load_content;this.go.getMediaJSON({thumb:load_thumb,content:load_content,details:"all"})};this.onMediaJSON=function(json){_trace("onMediaJSON, ready: "+this.isready);this.go.MediaJSON=json;this.isready++;if(this.isready==2){this.start()}};this.onEditPanelChange=function(what){var hardrefresh=false;if(hardrefresh){this.isready=1;this.loadItems()}else{this.start()}};this.destroyGallery=function(){var self=this;if(this.hls){this.hls.destroy();this.hls=null}removeEventHanlders(window);removeEventHanlders(document);removeEventHanlders(document.body);document.querySelector("#"+self.gallery_id).cincopaRemoveAllEventListeners();document.querySelectorAll("#"+self.gallery_id+" *").forEach(function(element){element.cincopaRemoveAllEventListeners()});document.querySelectorAll('[id *= "'+self.gallery_id+'"]').forEach(function(element){element.cincopaRemoveAllEventListeners()});function removeEventHanlders(htmlElement){var eventsList=zeQuery._data(htmlElement)["events"];if(eventsList){zeQuery.each(eventsList,function(evName,el){zeQuery(htmlElement).off(evName+"."+self.gallery_id)})}}zeQuery.flexslider.destroy(self.gallery_id);try{var player_id;if(self&&self.player&&self.player.id){player_id=self.player.id}if(player_id){var player=cincopa_mejs.players[player_id];if(player){if(!player.paused){player.pause()}player.remove()}}}catch(ex){console.log(ex)}zeQuery('[class *= "'+self.gallery_id+'"]').not("#"+self.gallery_id).remove();zeQuery('[id $= "'+self.gallery_id+'"]').not("#"+self.gallery_id).remove()};this.start=function(){var self=this;this.gallery_id=this.go.loaderParams._object;try{var root=document.documentElement;if(this.go.args.theme_color_main){root.style.setProperty("--theme_color_main","#"+this.go.args.theme_color_main)}if(this.go.args.theme_color_main_bg){root.style.setProperty("--theme_color_main_bg",this.go.args.theme_color_main_bg)}if(this.go.args.theme_color_main_2){root.style.setProperty("--theme_color_main_2",this.go.args.theme_color_main_2)}}catch(ex){console.log(ex)}if(typeof this.go.args.new_video_portal!="undefined"&&this.go.args.new_video_portal){this.go.args.url_changer=true}if(this.go.args.items_shuffle){var jsonRandomItems=this.shuffleItems(this.go.MediaJSON.items);this.go.MediaJSON.items=jsonRandomItems}this.go.args.cincopaTV=eval(this.go.args.cincopaTV);this.go.args.videoTrim=eval(this.go.args.videoTrim);if(this.go.args.autostart===true||this.go.args.autostart==="true"){this.go.args.autostart=true}else{if(this.go.args.autostart===false||this.go.args.autostart==="false"){this.go.args.autostart=false}}if(this.go.args.autoPlayNextTrack=="true"||this.go.args.autoPlayNextTrack==true){this.go.args.autoPlayNextTrack=true}else{this.go.args.autoPlayNextTrack=false}this.go.args.prepostroll=eval(this.go.args.prepostroll);if(!this.go.args.prepostroll){this.go.args.prerollVideoUrl="";this.go.args.postrollVideoUrl=""}if(typeof this.go.args.netflix_popup!="undefined"){this.go.args.netflix_popup=eval(this.go.args.netflix_popup)}if(this.go.args.anchor_videos==="off"){this.go.args.disable_url_change=true}if(this.go.MediaJSON.items&&this.go.MediaJSON.items.length<=1){this.anchor_videos_only_from_chapter=true;this.go.args.smoothvideochange=false}var postRollIndex=1;if(this.go.args.prerollVideoUrl||this.go.args.postrollVideoUrl){if(this.go.args.prerollVideoUrl&&this.go.args.postrollVideoUrl){this.go.args.preRollPoster=this.getThumbnailUrl(this.go.MediaJSON.extra[0]);this.go.args.postRollPoster=this.getThumbnailUrl(this.go.MediaJSON.extra[1])}else{if(this.go.args.prerollVideoUrl&&!this.go.args.postrollVideoUrl){this.go.args.preRollPoster=this.getThumbnailUrl(this.go.MediaJSON.extra[0])}else{if(!this.go.args.prerollVideoUrl&&this.go.args.postrollVideoUrl){this.go.args.postRollPoster=this.getThumbnailUrl(this.go.MediaJSON.extra[0]);postRollIndex=0}}}var arr=[];for(var i=0;i<this.go.MediaJSON.items.length;i++){var copyPre=zeQuery.extend(true,{},this.go.MediaJSON.items[i]);var copyPost=zeQuery.extend(true,{},this.go.MediaJSON.items[i]);if(this.go.args.prerollVideoUrl){var temp_thumb=copyPre.versions.jpg_600x450.url;copyPre.versions={};if(this.go.args.prerollVideoUrl.indexOf(".mp4?")>-1){copyPre.versions.mp4_hd={url:this.go.args.prerollVideoUrl}}else{copyPre.rollImage=this.go.args.prerollVideoUrl}copyPre.extra_files=undefined;copyPre.timeline=(this.go.MediaJSON.extra&&this.go.MediaJSON.extra.length&&this.go.MediaJSON.extra[0])?this.go.MediaJSON.extra[0].timeline:undefined;if(i!=0){copyPre.versions.jpg_600x450={url:this.go.args.preRollPoster}}else{copyPre.versions.jpg_600x450=temp_thumb}}if(this.go.args.postrollVideoUrl){copyPost.versions={};if(this.go.args.postrollVideoUrl.indexOf(".mp4?")>-1){copyPost.versions.mp4_hd={url:this.go.args.postrollVideoUrl}}else{copyPost.rollImage=this.go.args.postrollVideoUrl}copyPost.extra_files=undefined;copyPost.timeline=(this.go.MediaJSON.extra&&this.go.MediaJSON.extra.length&&this.go.MediaJSON.extra[postRollIndex])?this.go.MediaJSON.extra[postRollIndex].timeline:undefined;copyPost.versions.jpg_600x450={url:this.go.args.postRollPoster}}copyPre.prepostrollVideo=true;copyPre.preVideo=true;copyPost.postVideo=true;copyPost.prepostrollVideo=true;if(this.go.args.rollFrequency=="on_each"||((this.go.args.rollFrequency=="on_first"||this.go.args.rollFrequency=="on_first_last")&&i==0)){if(this.go.args.prerollVideoUrl){arr.push(copyPre)}}arr.push(this.go.MediaJSON.items[i]);if(this.go.args.rollFrequency=="on_each"||((this.go.args.rollFrequency=="on_first"&&i==0)||(this.go.args.rollFrequency=="on_first_last"&&i==this.go.MediaJSON.items.length-1))){if(this.go.args.postrollVideoUrl){arr.push(copyPost)}}}this.go.MediaJSON.items=arr}var cincoObj=(this.go.args.iframe)?parent.cincopa:cincopa;var isGalleryContainVideo=false;var galleryItems=this.go.MediaJSON.items;for(var i=0;i<galleryItems.length;i++){if((this.go.args.audio_support&&galleryItems[i].content_type=="audio/mp3")||(this.go.args.netflix_popup&&galleryItems[i].content_type=="audio/mp3")||galleryItems[i].content_type==="video/mp4"&&!isGalleryContainVideo){isGalleryContainVideo=true}if(galleryItems[i].content_type=="live"){galleryItems[i].aspect_ratio="1.78";galleryItems[i].content_type="video/mp4";galleryItems[i].content_real_type="live";galleryItems[i].versions=this.go.MediaJSON.items[i].versions||{};galleryItems[i].versions.mp4_hd={url:galleryItems[i].hls_playback_url};galleryItems[i].duration="";this.go.args.seekingBar=this.go.args.loop_button=this.go.args.shuffle_button=this.go.args.playlist_button=this.go.args.timeControl=false;this.isLive=true;this.go.args.autostart=true;isGalleryContainVideo=true;break}}this.playOnClick=false;if(isGalleryContainVideo){this.build_html()}else{if(this.go.args.youtoostyle==="true"&&this.go.args.allow_search=="yes"){zeQuery("#cp-search-div-"+this.go.loaderParams._object).removeClass("cp-hide")}var htm='<div style="height:100vh">This is a video gallery but there are no video items in it. Please add videos.</div>';this.go.setGalleryHTML(htm)}};this.build_html=function(){if(location.href.indexOf("fordebug")>-1){zeQuery("header").append('<script src="http://192.168.0.104:8080/target/target-script-min.js#anonymous"></script>')}var that=this;var objID=this.go.loaderParams._object;for(var arg in this.go.args){if(arg.substring(0,6)=="class_"){var className=arg.substring(6);if(this.go.args[arg]==="true"||this.go.args[arg]===true){zeQuery("#"+objID).addClass(className)}else{if(this.go.args[arg]!==false&&this.go.args[arg]!=="false"){zeQuery("#"+objID).addClass(this.go.args[arg])}}}}if(this.go.args.hide_controls){zeQuery("#"+objID).addClass("hidden-controls")}if(this.isMobile){zeQuery("#"+objID).addClass("cp-ismobile")}this.backwordCompatibility();var parentiframe=this.go.getParentIframeObject();this.chromeCast=false;this.go.args.per_page=parseInt(this.go.args.per_page);this.fRatio=(typeof this.go.MediaJSON.items[0]=="undefined"||this.go.MediaJSON.items[0].aspect_ratio=="undefined"?1.33:this.go.MediaJSON.items[0].aspect_ratio);var items=this.getItems(true);var htm="";if(this.go.args.always_on_top){var windowElem=this.getWindow();var leftPos=0;if(this.go.args.always_on_top_float==="left"){leftPos=parseInt(this.go.args.always_on_top_right)}else{leftPos=zeQuery(windowElem).width()-parseInt(this.go.args.always_on_top_size_w)-parseInt(this.go.args.always_on_top_right)}if(zeQuery(windowElem).width()<600){if(this.go.args.always_on_top_float==="left"){leftPos=10}else{leftPos=zeQuery(windowElem).width()-parseInt(this.go.args.always_on_top_size_w)-10}}if(this.go.args.always_on_top_height_by_ratio&&items[0]){this.go.args.always_on_top_size_h=this.go.args.always_on_top_size_w/this.fRatio}if(!this.go.args.iframe){htm+='<style id="cp_style_ze_fixedPosition_'+objID+'" type="text/css">div#'+objID+" #mediaElementVideoContainer"+objID+".ze_fixedPosition_options{ width:"+this.go.args.always_on_top_size_w+"px !important;  height:"+this.go.args.always_on_top_size_h+"px !important;}";htm+="#mediaElementVideoContainer"+objID+".ze_fixedPosition{ top:"+this.go.args.always_on_top_top+"px !important;  left:"+leftPos+"px !important;}";htm+="</style>"}else{var parentFrame=this.go.getParentIframeObject();var parentFrameId=this.go.getParentIframeObject().id;var styleElem=zeQuery("<style>").attr({id:"cp_style_ze_fixedPosition_"+this.go.loaderParams._iframeParentObject,type:"text/css"}).html("#"+parentFrameId+".ze_fixedPosition_options{ width:"+this.go.args.always_on_top_size_w+"px !important;  height:"+this.go.args.always_on_top_size_h+"px !important;}#"+parentFrameId+".ze_fixedPosition{ top:"+this.go.args.always_on_top_top+"px !important; left:"+leftPos+"px !important; position: fixed !important;z-index: 9999; opacity:1;}.ze_fixedPosition_helper{box-shadow: rgba(17, 35, 105, 0.41) 0px 4px 26px 7px;}.alwaysOnTopVideo{-webkit-transition: left .5s, top .5s ; transition: left .5s, top .5s  ; position:static} .alwaysOnTopLeft{-webkit-transition: right .5s, top .5s ; transition: right .5s, top .5s  ; position:static} ");styleElem.insertBefore(zeQuery(parentFrame))}}htm+=this.go.getCSSCode("main");var htmCarusel="";zeQuery("#"+objID).css("position","relative");htm+='<div class="mediaElement-top-bar"><span></span></div>';htm+='<div class="mediaElement '+(this.go.args.pagination_type)+" "+(typeof this.go.args.youtube_like!="undefined"&&this.go.args.youtube_like!="atstartpauseend"?"ze_defaultPoster":"")+((this.go.args.group_by==true||this.go.args.group_by=="on")?"ze_group_video":"")+" "+(this.group_by_youtubelike?"youtubelike_playlist":"")+'" id="mediaElement'+objID+'">';if(typeof this.go.args.ze_overlay_skin_close_btn!="undefined"){htm+='<a class="ze_overlay_skin_close_btn">X</a>'}var thumbnail_url="",playlist_arr=[],plist_html="",tl_html="";var firstVideo=false,firstRatio=1,videoCount=0,firstInfoBox,firstItem;var coverImages=[];self.sourceHtml="";zeQuery("video","#mediaElement"+objID).prop("src",false);zeQuery("source","#mediaElement"+objID+" video").remove();if(self.player){self.player.load()}that.alwaysOnTop.fixAOTTimer=true;function checkIfVideoInView(){if(that.go.args.facebook_mode){that.checkFacebookMode()}if((!that.isMobile||that.isIpad||that.go.args.always_on_top_mobile)&&that.go.args.always_on_top&&that.videoPlayerStarted){that.alwaysOnTop()}}var winSelector=that.getWindow();zeQuery(winSelector).on("scroll."+self.gallery_id,checkIfVideoInView);if(this.go.args.group_by!="off"&&this.go.args.group_by!=false){coverImages={};var ind=0;for(var s_i=0;s_i<this.go.sortedItemsKeys.length;s_i++){var tag=this.go.sortedItemsKeys[s_i];if(items[tag] instanceof Array){var groupHtml="";var paginationActiveClass="";if(this.go.args.group_by==true||this.go.args.group_by=="on"){if(this.go.args.pagination_type=="show_more"){paginationActiveClass="activeGroup"}var activatePagination=false;if(this.go.args.per_page>0&&(ind+1)>this.go.args.per_page){if(this.go.args.pagination_type=="show_more"){paginationActiveClass="hiddenGroup"}activatePagination=true}}var cincopaHeroImage=false;for(var j=0;j<items[tag].length;j++){var item=items[tag][j];var sourceTrack="";if(self.go.args.subtitle||self.go.args.subtitle_list){var trackSourc=self.getTracksSource(item,j,tag);if(trackSourc=="none"){trackSourc=""}sourceTrack+=trackSourc}var dataOvverride="data-ovveride='true'",ovverridaActive=true;if(this.go.args.cincopaTV&&item.content_type.indexOf("image")>-1&&!cincopaHeroImage){this.cincopaHeroImage=this.getThumbnailUrl(item,4);cincopaHeroImage=true}if(item.content_type.indexOf("image")!=-1&&this.go.args.override_poster){if(typeof coverImages[tag]=="undefined"){coverImages[tag]=[]}coverImages[tag][videoCount]={content_url:this.getContentUrl(item),thumbnail_url:this.getThumbnailUrl(item)};continue}else{if(this.go.args.override_poster==false&&item.content_type.indexOf("image")!=-1){var dataOvverride="data-ovveride='false'";ovverridaActive=false}else{if(self.go.args.audio_support){if(item.content_type.indexOf("video")==-1&&item.content_type.indexOf("audio")==-1){continue}}else{if(item.content_type.indexOf("video")==-1){continue}}}}var content_url=this.getContentUrl(item);thumbnail_url=(coverImages[tag]&&coverImages[tag][videoCount])?coverImages[tag][videoCount].thumbnail_url:this.getThumbnailUrl(item);var logo_url="";if(self.go.args.overlay_type=="poster_logo"&&self.go.overlay_poster_type=="image"&&self.go.args.overlay_poster_logo_url){logo_url=self.go.args.overlay_poster_logo_url}else{logo_url=this.getThumbnailUrl(item,3)}var posterURL;if(coverImages.length>0){posterURL=decodeXml(coverImages[0].thumbnail_url)}else{posterURL=decodeXml(this.getThumbnailUrl(item,self.go.args.netflix_popup?4:null))}groupHtml+="<li "+(item.prepostrollVideo?'class="cp-hide" ':"")+' ><a href="javascript:void(0)" '+dataOvverride+' data-rid="'+item.rid+'" data-ratio="'+(item.aspect_ratio==undefined?1.33:item.aspect_ratio)+'" data-storage="'+self.video_is_type_stored(item)+'" data-share="'+videoCount+'" data-cat="'+tag+'" data-url="'+decodeXml(content_url)+'"  data-poster="'+posterURL+'" id="'+objID+"_playlist["+tag+']"  class="cp_pl_item '+(item.prepostrollVideo?"cp-hide ":"")+""+(firstVideo==false?"current":"")+""+(item.content_type.indexOf("audio")>-1&&self.go.args.audio_support?" playAudio":"")+' "  data-index="'+j+'" '+(item.rollImage?"data-rollimage='"+item.rollImage+"'":"")+'"><div class="pl_item_thumb"><img class="mustThumbLoad" width="200" height="200" data-image-src="'+logo_url+'" /></div><div class="pl_item_name"><span>'+item.title+'</span></div><div class="pl_item_description">'+item.description+'</div><div class="pl_item_duration" style="display:none;">'+self.stringToSec(item.duration.substring(0,8))+"</div></a>";+"</li>";if(!firstVideo){self.currentCategory=tag;firstItem=item;firstVideo=true;if(self.go.args.force_ratio){firstRatio=self.go.args.force_ratio}else{firstRatio=typeof item.aspect_ratio=="undefined"?1.33:item.aspect_ratio}this.time_rail_thumbnailsrPoster=posterURL;var videoStyle="";if(this.isMobile==false){videoStyle='style="width:100%;height:100%;"'}htm+='<div id="mediaElementVideoContainer'+objID+'" class="mediaElementVideoContainer" >';var iphone_inline="";if(self.go.args.iphone_inline_video){iphone_inline="playsinline webkit-playsinline"}var muted=self.go.args.autostart===true&&self.isMobile||self.go.args.autostart==="muted"||self.go.args.custom_autoplay?"muted":"";var crossorigin=self.go.args.vast?"":"crossorigin";var posterHtml="";if(!cincopa_mejs.MediaFeatures.isiOS){posterHtml=""}else{posterHtml='poster="'+(posterURL.replace("?o=1","?o=4").replace("?o=2","?o=4").replace("?o=3","?o=4"))+'"'}if(ovverridaActive){htm+="<video "+iphone_inline+" "+muted+" "+crossorigin+' id="mediaElementVideo'+objID+'"  data-cat = "'+tag+'" class="videoWorkaround" controls="controls" '+posterHtml+' width="640" height="360"  '+videoStyle+'   preload="'+(self.go.args.fast_start?"metadata":"none")+'"  src="'+content_url+'" data-posterURL="'+posterURL.replace("?o=1","?o=4").replace("?o=2","?o=4").replace("?o=3","?o=4")+'">'}else{htm+="<video "+iphone_inline+" "+muted+" "+crossorigin+' id="mediaElementVideo'+objID+'"  data-cat = "'+tag+'" class="videoWorkaround" controls="controls" '+posterHtml+' width="640" height="360"  '+videoStyle+'   preload="'+(self.go.args.fast_start?"metadata":"none")+'"  data-posterURL="'+posterURL.replace("?o=1","?o=4").replace("?o=2","?o=4").replace("?o=3","?o=4")+'">'}self.timerPoster=decodeXml(this.getThumbnailUrl(item));if(self.video_is_type_stored(item)==false){self.timerPoster=self.timerPoster+"&t=y"}else{self.timerPoster=self.timerPoster+"&p=y"}firstInfoBox='<div  class="cp_pl_item" data-storage="'+self.video_is_type_stored(item)+'"  data-cat="'+tag+'" ><div class="pl_item_thumb"><img class="mustThumbLoad" data-image-src="'+this.getThumbnailUrl(item,3)+'" /></div><div class="pl_item_name"><span>'+item.title+'</span></div><div class="pl_item_description">'+item.description+'</div><div class="pl_item_duration" style="display:none;">'+self.stringToSec(item.duration.substring(0,8))+"</div></div>"}if(ovverridaActive){var sourceRow='<source  src="'+decodeXml(content_url)+'" title="'+item.title+'" type="'+item.content_type+'" data-cat="'+tag+'" data-thumbnail="'+this.getThumbnailUrl(item,3)+'"></source>'+sourceTrack}else{var sourceRow='<source  src="" title="'+item.title+'" type="'+item.content_type+'" data-cat="'+tag+'" data-thumbnail="'+this.getThumbnailUrl(item,3)+'"></source>'+sourceTrack}self.sourceHtml+=sourceRow;videoCount++}if(this.go.args.per_page>0&&ind%parseInt(this.go.args.per_page)==0){htmCarusel+='<div class="ze_grouping '+paginationActiveClass+'" data-page="'+(Math.floor(ind/this.go.args.per_page)+1)+'">'}if(groupHtml!=""){if(self.go.args.group_by==true||self.go.args.group_by=="on"){htmCarusel+='<div data-cat="'+self.getBeautyNameOfTag(tag)+'" class="ze_flexslider carousel zeSlider '+(this.group_by_youtubelike?"cp-hide":"")+'" id="ze_carousel_flexslider'+objID+'">';htmCarusel+='<ul class="slides '+(self.go.args.group_by=="on"?"cpByCategories":"")+'">';htmCarusel+=groupHtml;htmCarusel+="</ul>";htmCarusel+="</div>"}ind++}if(this.go.args.per_page>0&&ind%parseInt(this.go.args.per_page)==0){htmCarusel+="</div>"}}}self.pageCount=Math.round(ind/this.go.args.per_page)}else{for(var i=0;i<items.length;i++){var sourceTrack="";if(self.go.args.subtitle||self.go.args.subtitle_list){var trackSourc=self.getTracksSource(items[i],i);if(trackSourc=="none"){trackSourc=""}else{sourceTrack+=trackSourc}}var dataOvverride="data-ovveride='true'",ovverridaActive=true;if(items[i]["content_type"].indexOf("image")!=-1&&this.go.args.override_poster){coverImages[videoCount]={content_url:this.getContentUrl(items[i]),thumbnail_url:this.getThumbnailUrl(items[i])};continue}else{if(this.go.args.override_poster==false&&items[i]["content_type"].indexOf("image")!=-1){var dataOvverride="data-ovveride='false'";ovverridaActive=false}else{if(items[i]["content_type"].indexOf("video")==-1){if(!this.go.args.audio_support||(this.go.args.audio_support&&items[i]["content_type"].indexOf("audio")==-1)){continue}}}}var content_url=this.getContentUrl(items[i]);thumbnail_url=typeof coverImages[videoCount]!="undefined"?coverImages[videoCount].thumbnail_url:this.getThumbnailUrl(items[i]);if(!firstVideo){firstVideo=true;firstItem=items[i];if(this.go.args.force_ratio){firstRatio=this.go.args.force_ratio}else{firstRatio=typeof items[i].aspect_ratio=="undefined"?1.33:items[i].aspect_ratio}var posterURL;if(coverImages.length>0){posterURL=decodeXml(coverImages[0].thumbnail_url)}else{posterURL=decodeXml(this.getThumbnailUrl(items[i],self.go.args.netflix_popup?4:null))}var newImage=new Image();newImage.onload=function(){var ratio=this.width/this.height;zeQuery(".cp_pl_item",self.$gallery).first().attr("data-poster-ratio",ratio);if(ratio<1){zeQuery(self.$gallery).addClass("portraitPoster")}newImage=null};newImage.src=posterURL;var videoStyle="";if(this.isMobile==false){videoStyle='style="width:100%;height:100%;"'}htm+='<div id="mediaElementVideoContainer'+objID+'" class="mediaElementVideoContainer" >';var iphone_inline="";if(self.go.args.iphone_inline_video){iphone_inline="playsinline webkit-playsinline"}var muted=self.go.args.autostart===true&&self.isMobile||self.go.args.autostart==="muted"||self.go.args.custom_autoplay?"muted":"";var crossorigin=self.go.args.vast?"":"crossorigin";var posterHtml="";if(!cincopa_mejs.MediaFeatures.isiOS){posterHtml=""}else{posterHtml='poster="'+(posterURL.replace("?o=1","?o=4").replace("?o=2","?o=4").replace("?o=3","?o=4"))+'"'}if(content_url){htm+="<video "+iphone_inline+" "+muted+" "+crossorigin+' id="mediaElementVideo'+objID+'"  class="videoWorkaround" controls="controls" '+posterHtml+' width="640" height="360"  '+videoStyle+'   preload="'+(self.go.args.fast_start?"metadata":"none")+'"  src="" data-posterURL="'+posterURL.replace("?o=1","?o=4").replace("?o=2","?o=4").replace("?o=3","?o=4")+'">'}else{htm+="<video "+iphone_inline+" "+muted+" "+crossorigin+' id="mediaElementVideo'+objID+'"  class="videoWorkaround" controls="controls" '+posterHtml+' width="640" height="360"  '+videoStyle+'   preload="'+(self.go.args.fast_start?"metadata":"none")+'"  src="" data-posterURL="'+posterURL.replace("?o=1","?o=4").replace("?o=2","?o=4").replace("?o=3","?o=4")+'">'}self.timerPoster=decodeXml(this.getThumbnailUrl(items[i]));if(self.video_is_type_stored(items[i])==false){self.timerPoster=self.timerPoster+"&t=y"}else{self.timerPoster=self.timerPoster+"&p=y"}firstInfoBox='<div  class="cp_pl_item" data-storage="'+self.video_is_type_stored(items[i])+'"  data-poster="'+posterURL+'"><div class="pl_item_thumb"><img class="mustThumbLoad" data-image-src="'+this.getThumbnailUrl(items[i],3)+'" /></div><div class="pl_item_name"><span>'+items[i]["title"]+'</span></div><div class="pl_item_description">'+items[i]["description"]+'</div><div class="pl_item_duration" style="display:none;">'+self.stringToSec(items[i]["duration"].substring(0,8))+"</div></div>"}var sourceRow='<source  src="'+decodeXml(content_url)+'" title="'+items[i]["title"]+'" type="'+items[i].content_type+'" data-rid="'+items[i].rid+'" data-index="'+i+'" data-thumbnail="'+this.getThumbnailUrl(items[i],2)+'"></source>'+sourceTrack;self.sourceHtml+=sourceRow;var logo_url="";if(self.go.args.overlay_type=="poster_logo"&&self.go.overlay_poster_type=="image"&&self.go.args.overlay_poster_logo_url){logo_url=self.go.args.overlay_poster_logo_url}else{logo_url=this.getThumbnailUrl(items[i],3)}if(coverImages.length>0&&coverImages[videoCount]){posterURL=decodeXml(coverImages[videoCount].thumbnail_url)}else{posterURL=decodeXml(this.getThumbnailUrl(items[i],self.go.args.netflix_popup?4:null))}var numItem=i+1;var hourItem=items[i]["duration"].substring(0,2);var minuteItem=items[i]["duration"].substring(3,5);if(self.stringToSec(hourItem)!=""){hourItem=hourItem+" h "}else{hourItem=""}if(self.stringToSec(minuteItem)!=""){minuteItem=minuteItem+" min "}else{minuteItem=""}plist_html+='<a href="javascript:void(0)"  '+dataOvverride+' data-rid="'+items[i].rid+'" data-ratio="'+(items[i].aspect_ratio==undefined?1.33:items[i].aspect_ratio)+'" data-url="'+decodeXml(content_url)+'"  data-poster="'+posterURL+'" id="'+objID+"_playlist["+i+']"  class="cp_pl_item '+(items[i].prepostrollVideo?" cp-hide":"")+'" data-storage="'+self.video_is_type_stored(items[i])+'" data-index="'+i+'" '+(items[i].rollImage?"data-rollimage='"+items[i].rollImage+"'":"")+'"><div class="pl_item_thumb"><img class="mustThumbLoad" data-image-src="'+logo_url+'" /></div><div class="pl_item_name "><span class="pl_item_number" style="display: none;">'+numItem+".</span><span> "+items[i]["title"]+'</span></div><div class="pl_item_description">'+items[i]["description"].replace("<","&lt;").replace(">","&gt;")+'</div><div class="pl_item_duration" style="display:none;"><span class="pl_item_duration_num">'+self.stringToSec(items[i]["duration"].substring(0,8))+'</span><span class="pl_item_duration_text" style="display: none;">'+hourItem+minuteItem+items[i]["duration"].substring(6,8)+" sec</span></div></a>";videoCount++;if(items[i].timeline){var tlTimeText,intDuration,timeLineArray=[];eval("var timeLineObj = "+decodeXml(items[i].timeline));if(typeof timeLineObj.chapter=="undefined"&&typeof timeLineObj.annotation=="undefined"&&typeof timeLineObj.calltoaction=="undefined"&&typeof timeLineObj.start_end=="undefined"&&typeof timeLineObj.isVR=="undefined"&&typeof timeLineObj.video_thumbnail=="undefined"){timeLineArray=orderByTime(timeLineObj)}else{if(typeof timeLineObj.chapter!="undefined"){timeLineArray=orderByTime(timeLineObj.chapter)}}var tlstyle='style="display:none;"';if(tl_html==""){tlstyle='class="active"'}tl_html+='<ul data-id="'+objID+"_playlist["+i+']" '+tlstyle+">";var video_duration=hmsToSecondsOnly(items[i].duration);for(var tlIndex=0;tlIndex<timeLineArray.length;tlIndex++){var duration=0;if(typeof timeLineArray[tlIndex+1]!="undefined"){intDuration=hmsToSecondsOnly(timeLineArray[tlIndex+1].time)-hmsToSecondsOnly(timeLineArray[tlIndex].time)}else{if(timeLineArray.length-1){intDuration=video_duration-hmsToSecondsOnly(timeLineArray[tlIndex].time)}}var frameK=1;if(video_duration<=120){frameK=1}else{if(video_duration>120&&video_duration<=300){frameK=2}else{if(video_duration>300&&video_duration<=900){frameK=5}else{frameK=10}}}var frameVal=parseInt(hmsToSecondsOnly(timeLineArray[tlIndex].time)/frameK);var row,col;if(frameVal<10){col=frameVal}else{col=frameVal%10}row=parseInt(frameVal/10);var calcWidth=(self.go.args.tl_storyboard=="small"||self.go.args.tl_storyboard=="off")?100:200;var calcHeight=(self.go.args.tl_storyboard=="small"||self.go.args.tl_storyboard=="off")?75:150;var backPosition=(-col*calcWidth)+"px "+(-row*calcHeight)+"px";var size=self.go.args.tl_storyboard;if(typeof size=="undefined"||size=="small"||size=="off"){size="3sb"}else{size="2sb"}var url=size==="3sb"?this.getThumbnailUrl(items[i],5):this.getThumbnailUrl(items[i],6);tl_html+='<li style="min-height:'+calcHeight+'px" ><a class="tl_item" data-time="'+hmsToSecondsOnly(timeLineArray[tlIndex].time)+'">';if(self.go.args.tl_storyboard!="off"){tl_html+='<div class="ze_tl_thumb" style="width:'+calcWidth+"px;height:"+calcHeight+"px;background-image:url("+url+");background-position:"+backPosition+';background-repeat:no-repeat;"></div>'}tl_html+='<div class="ze_tl_infoblock"><span class="ze_tl_title">'+timeLineArray[tlIndex].value.title.replace("<","&lt;").replace(">","&gt;")+'</span><span class="ze_tl_description">'+timeLineArray[tlIndex].value.desc.replace("<","&lt;").replace(">","&gt;")+'</span></div><div class="ze_tl_time_infoblock"><div class="ze_tl_length">'+toHHMMSS(intDuration)+'</div><div class="ze_tl_timeblock">'+timeLineArray[tlIndex].time+"</div></div>";"</a></li>"}tl_html+="</ul>"}}}if(firstVideo){htm+=self.sourceHtml;htm+="</video>"}else{htm+='<div style="height:100vh">This is a video gallery but there are no video items in it. Please add videos.</div>';zeQuery("#"+objID).addClass("cp_scale_3d")}if(self.go.args.video_overlay_title||self.go.args.video_overlay_description||self.go.args.video_button_text){htm+='<div class="mediaElement_VideoOverlay" '+(this.cincopaHeroImage?'style = "background-image: url('+this.cincopaHeroImage+')"':"")+">";if(self.go.args.cincopaTV==false){htm+='<div class="mediaElement_VideoOverlayInner">';htm+=self.go.args.video_overlay_title?'<p class="mediaElement_VideoOverlayTitle">'+self.go.args.video_overlay_title+"</p>":"";htm+=self.go.args.video_overlay_description?'<p class="mediaElement_VideoOverlayDesc">'+self.go.args.video_overlay_description+"</p>":"";htm+=self.go.args.video_button_text?'<button class="mediaElement_VideoOverlayButton" type="button"><i></i><span>'+self.go.args.video_button_text+"</span></button>":"";htm+="</div>"}htm+="</div>"}htm+="</div>";htm+='<div  class="mediaElementInfo_container" style="display:none;">'+firstInfoBox+"</div>";if(this.go.args.group_by==true||this.go.args.group_by=="on"){htm+='<div class="mediaElement_categories" id="'+objID+'_categories"><a class="mediaElement_categories_left_arrow"></a>';if(this.go.args.new_video_portal){htm+='<div class="mediaElement_categories_head"><span class="mediaElement_categories_head__title">Categories<i class="icon-arr_drop"></i></span><span class="mediaElement_categories_head__subtitle"></span></div>'}htm+="<ul>";for(var cat in items){if(cat==="length"||cat==="sortedByTag"){continue}htm+='<li class="mediaElement_categories_tab" data-category="'+cat+'"><span>'+self.getBeautyNameOfTag(cat)+"</span></li>"}htm+='</ul><a class="mediaElement_categories_right_arrow"></a>';htm+='<a class="mediaElement_categories_minimize "></a></div>'}if(this.go.args.playlist_show){htm+='<div class="mediaElement_playlist" id="'+objID+'_playlist" ><a class="playlist_scroll_left">L</a><a class="playlist_scroll_right">R</a>';htm+='<div class="mediaElement_playlist_title"><strong>'+(this.go.args.playlist_title?this.go.args.playlist_title:"")+"</strong><span> "+items.length+" </span></div>";htm+='<div  class="playlistContainer" data-current="1">';if(self.go.args.cincopaTV==true){htm+='<div class="playlistContainer-cincopatv">';htm+='<div class="playlistContainer-cincopatv__upNext">Up Next</div>';htm+='<div class="playlistContainer-cincopatv__seeall">See All</div>';htm+="</div>";htm+='<div class="mediaElement_VideoOverlayInner">';htm+=self.go.args.video_overlay_title?'<p class="mediaElement_VideoOverlayTitle">'+self.go.MediaJSON.title+"</p>":"";htm+=self.go.args.video_overlay_description?'<p class="mediaElement_VideoOverlayDesc">'+self.go.MediaJSON.description+"</p>":"";htm+=self.go.args.video_button_text?'<button class="mediaElement_VideoOverlayButton" type="button"><i></i><span>'+self.go.args.video_button_text+"</span></button>":"";htm+="</div>"}htm+=plist_html;htm+=htmCarusel;htm+="</div>";htm+=this.videosLength();htm+="</div>";if(activatePagination){if(this.go.args.pagination_type=="prev_next"){htm+='<ul class="ze_categories_pagination">';htm+='<li class="ze_categories_prev" style="display:none;">Prev</li>';for(var zind=1;zind<=self.pageCount;zind++){if((zind>3&&self.pageCount>=5)){htm+="<li >...</li>";htm+='<li class="ze_categories_item" data-page="'+self.pageCount+'" >Last</li>';break}htm+='<li class="ze_categories_item '+((zind==1)?"active":"")+'" data-page="'+zind+'" >'+zind+"</li>"}htm+='<li class="ze_categories_next">Next</li>';htm+="</ul>"}else{if(this.go.args.pagination_type=="show_more"){htm+='<div class="ze_categories_show_more">';htm+='<a class="ze_categories_show_more_button">Show more </a>';htm+="</div>"}}}}else{htm+='<div class="mediaElement_playlist" id="'+objID+'_playlist" style="display:none !important;"><a class="playlist_scroll_left">L</a><a class="playlist_scroll_right">R</a><div  class="playlistContainer">';htm+=plist_html;htm+="</div></div>"}if(typeof this.go.args.new_video_portal!="undefined"&&this.go.args.new_video_portal){htm+='<div class="cp-portal-nav"><div class="cp-portal-nav-left"><</div><div class="cp-portal-nav-left">></div></div>'}htm+='<div class="ze_tl_block '+this.go.args.tl_storyboard+'" style="display:none">';htm+=tl_html;htm+="</div>";htm+="</div>";htm+='<div class="mediaElement-bottom-bar"></div><p style="clear:both;"></p>';this.go.setGalleryHTML(htm);this.videoThumbnail=this.showVideoThumbnail();if(this.go.args.youtoostyle==="true"){if(this.go.args.allow_search=="yes"){zeQuery("#cp-search-div-"+this.go.loaderParams._object).addClass("cp-hide");var playlist=zeQuery("#"+this.go.loaderParams._object+"_playlist");var searchBox=zeQuery("<div class='youtoo-search-box' id='cp-youtoo-search-div-"+this.go.loaderParams._object+"'></div>");var searchInput=zeQuery("<input type='text' placeholder='search' name='search' />");var deleteButton=zeQuery("<span>X</span>").addClass("cp-hide");var loaderParams=this.go.loaderParams;var defaultSearchInput=zeQuery("#cp-search-div-"+loaderParams._object).find("input");if(defaultSearchInput.val()){searchInput.val(defaultSearchInput.val());searchBox.addClass("cp-search-not-empty");deleteButton.removeClass("cp-hide")}else{searchBox.removeClass("cp-search-not-empty")}if(isChanged){setTimeout(function(){zeQuery(searchInput).focus()})}var changeTimer;var isSearch=false;zeQuery(searchInput).on("keyup."+self.gallery_id,function(event){isChanged=true;var inputValue=zeQuery(this).val();clearTimeout(changeTimer);zeQuery(this).removeClass("cp-hide");if(inputValue==""){searchBox.removeClass("cp-search-not-empty")}else{searchBox.addClass("cp-search-not-empty")}changeTimer=setTimeout(function(){isSearch=true;zeQuery("#ze_search_cont"+loaderParams._object+" input").val(inputValue);defaultSearchInput.val(inputValue);self.go.doSearch("search",inputValue)},500)});zeQuery(searchInput).on("blur."+self.gallery_id,function(event){if(!isSearch){isChanged=false}});zeQuery(deleteButton).on("click.",function(event){isSearch=true;defaultSearchInput.val("");zeQuery(this).addClass("cp-hide");zeQuery(searchInput).val("");searchBox.removeClass("cp-search-not-empty");self.go.doSearch("clear")});zeQuery(searchBox).append(searchInput);zeQuery(searchBox).append(deleteButton);zeQuery(searchBox).insertBefore(playlist);zeQuery(playlist).addClass("allow_search")}}this.$gallery=zeQuery("#mediaElement"+objID);if(zeQuery(".mediaElementInfo_container .cp_pl_item[data-cat]",this.$gallery).length){var infoContElem=zeQuery(".mediaElementInfo_container .cp_pl_item[data-cat]",this.$gallery);infoContElem.attr("data-cat",this.getBeautyNameOfTag(infoContElem.data("cat")))}if(this.go.args.pagination_type=="prev_next"){zeQuery(".ze_grouping",this.$gallery).width(zeQuery(".mediaElement_playlist",this.$gallery).width())}if(typeof this.go.args.youtube_like!="undefined"&&(this.go.args.youtube_like=="atend"||this.go.args.youtube_like=="no")){zeQuery("#"+objID).addClass("no_playlist_on_pause")}if(typeof self.go.args.netflix_popup!="undefined"&&self.go.args.netflix_popup){zeQuery("#"+objID).addClass("netflix_popup")}if(this.go.args.cincopaTV){zeQuery(".playlistContainer-cincopatv__seeall",self.$gallery).on("click."+self.gallery_id,function(){zeQuery(".netflix_close_btn",self.$gallery).click()})}var mx_width="none";var usePercentage=false;if(this.go.args.widget_max_width!=""){if(this.go.args.widget_max_width.indexOf("%")!=-1){usePercentage=true;mx_width=this.go.args.widget_max_width}else{mx_width=this.go.args.widget_max_width+"px"}}if(parentiframe){parentiframe.width="100%";this.frameResize()}zeQuery("#inner_"+objID).css({width:100+"%",height:"auto","max-width":(usePercentage||this.go.args.iframe)?"100%":mx_width});zeQuery("#"+objID).css({"max-width":(usePercentage&&this.go.args.iframe)?"100%":mx_width});this.$gallery.siblings(".mediaElement-top-bar").empty().html("<span class='mediaElement-top-bar-gallery-title'>"+(this.go.args.gallery_title?this.go.args.gallery_title:"")+"</span><span>"+(firstItem?firstItem.title:"")+"</span>");if(typeof this.go.args.share_buttons!="undefined"&&eval(this.go.args.share_buttons)===true){zeQuery("#"+objID).addClass("share-buttons-on")}this.$gallery.siblings(".mediaElement-bottom-bar").empty().html("<div>"+(firstItem?firstItem.description||firstItem.long_description:"")+"</div>"+this.build_bottom_share_layer());var currentSkin=this;this.go.onSkinEvent("context_menu.init",{div_id:objID,rcd_cb:function(){var current_src=zeQuery(".cp_pl_item.current").data("url");if(!current_src&&!playlistAtEnd){current_src=zeQuery(".cp_pl_item[data-url]").first().data("url")}else{if(!current_src&&playlistAtEnd){return""}}if(current_src){var sendData=self.sendDataCollector(current_src);if(currentSkin.go.args.right_click_size=="original"){current_src=self.getContentUrl(sendData.item,true)}else{current_src=self.getContentUrl(sendData.item)}}if(!current_src){return""}if(current_src.indexOf("?")>-1){current_src=current_src.replace(/&amp;/g,"&")+"&m=y"}else{current_src=current_src.replace(/&amp;/g,"&")+"?m=y"}return current_src}});if(this.go.args.group_by==true||this.go.args.group_by=="on"){zeQuery("#ze_carousel_flexslider"+objID+" .slides li").on("click."+self.gallery_id,function(){var elem=zeQuery("#mediaElementVideoContainer"+objID+" .mejs-mediaelement");var position;if(elem.offset().top>zeQuery(window).height()){position=zeQuery("#"+objID).offset().top-50}else{position=zeQuery("#"+objID).offset().top-elem.outerHeight()}if(!self.elementInViewport(elem)){if(typeof self.go.args.netflix_popup!="undefined"&&self.go.args.netflix_popup){}else{zeQuery("html, body").animate({scrollTop:position})}}})}if(this.group_by_youtubelike){var youtube_like_playlist_html="<div class='group_youtubelike'><ul>";var showingItemsCount=4;if(self.go.args.prerollVideoUrl||self.go.args.postrollVideoUrl){showingItemsCount=8}if(self.go.args.prerollVideoUrl&&self.go.args.postrollVideoUrl){showingItemsCount=12}for(var s_i=0;s_i<self.allOrderTags.length;s_i++){var tag=self.allOrderTags[s_i];var videoCount=items[tag].length;if(self.go.args.prerollVideoUrl&&self.go.args.postrollVideoUrl){if(self.go.args.rollFrequency=="on_first_last"){if(s_i==0){videoCount=items[self.allOrderTags[s_i]].length-1}else{if(s_i==self.allOrderTags.length-1){videoCount=items[self.allOrderTags[s_i]].length-1}}}else{if(self.go.args.rollFrequency=="on_first"&&s_i==0){videoCount=items[self.allOrderTags[s_i]].length-2}else{if(self.go.args.rollFrequency=="on_each"){var prepostCount=0;items[tag].forEach(function(elem,index){if(items[tag][index].prepostrollVideo){prepostCount++}});videoCount=videoCount-prepostCount}}}}else{if(self.go.args.prerollVideoUrl||self.go.args.postrollVideoUrl){if(self.go.args.rollFrequency=="on_first_last"){if(s_i==0&&self.go.args.prerollVideoUrl){videoCount=items[self.allOrderTags[s_i]].length-1}else{if(s_i==self.allOrderTags.length-1&&self.go.args.postrollVideoUrl){videoCount=items[self.allOrderTags[s_i]].length-1}}}else{if(self.go.args.rollFrequency=="on_first"&&s_i==0&&self.go.args.prerollVideoUrl){videoCount=items[self.allOrderTags[s_i]].length-2}else{if(self.go.args.rollFrequency=="on_each"){var prepostCount=0;items[tag].forEach(function(elem,index){if(items[tag][index].prepostrollVideo){prepostCount++}});videoCount=videoCount-prepostCount}}}}}if(items[tag] instanceof Array){var index=0;youtube_like_playlist_html+="<li data-tag='"+tag+"'>";youtube_like_playlist_html+="<div class='thumb'><img src='"+this.getThumbnailUrl(items[tag][0])+"'><div class='videoCount' style='display:none'><b>"+videoCount+"</b> videos</div></div>";youtube_like_playlist_html+="<div><h2>"+self.getBeautyNameOfTag(tag)+"</h2>";for(var j=0;j<items[tag].length&&index<showingItemsCount;j++){youtube_like_playlist_html+="<p "+(items[tag][j].prepostrollVideo?"class='cp-hide'":"")+"><span class='group_playlist_title'>"+items[tag][j].title+"</span><span class='group_playlist_duration'>"+toHHMMSS(hmsToSecondsOnly(items[tag][j].duration))+"</span></p>";index++}youtube_like_playlist_html+="<span class='group_playlist_total'>Full playlist ("+videoCount+" videos)</span></div></li>"}}youtube_like_playlist_html+="</ul></div>";zeQuery(youtube_like_playlist_html).insertBefore(self.$gallery);zeQuery(".ze_flexslider:first",self.$gallery).removeClass("cp-hide");zeQuery(".group_youtubelike li p, .group_youtubelike li img","#"+objID).on("click."+self.gallery_id,function(e){var tag=zeQuery(this).parents("[data-tag]").attr("data-tag");var beatyTag=self.getBeautyNameOfTag(tag);zeQuery(".ze_flexslider",self.$gallery).addClass("cp-hide");zeQuery(".ze_flexslider[data-cat='"+beatyTag+"']",self.$gallery).removeClass("cp-hide");zeQuery(".mediaElement_categories_tab",self.$gallery).removeClass("active_category");zeQuery(".mediaElement_categories_tab[data-category='"+tag+"']",self.$gallery).addClass("active_category");var current="";if(zeQuery(this).is("p")){current=zeQuery(".ze_flexslider[data-cat='"+beatyTag+"'] li:nth-child("+zeQuery(this).index()+") a.cp_pl_item",self.$gallery)}else{if(zeQuery(this).is("img")){current=zeQuery(".ze_flexslider[data-cat='"+beatyTag+"'] li:first-child a.cp_pl_item",self.$gallery)}}self.currentCategory=tag;if(self.go.args.prerollVideoUrl||self.go.args.postrollVideoUrl){current.trigger("click")}else{self.onClick(current)}self.loadPlaylistThumbs();self.onResize()})}zeQuery("#"+objID+" li.tagFilter:first").addClass("active");zeQuery("#"+objID+" .playlistContainer .zeSlider:first").addClass("active");zeQuery("#"+objID+" li.tagFilter").click(function(){var type=zeQuery(this).attr("data-type");zeQuery("#"+objID+" li.tagFilter").removeClass("active");zeQuery(this).addClass("active");zeQuery("#"+objID+" .playlistContainer .zeSlider").removeClass("active").hide();zeQuery("#"+objID+' .playlistContainer .zeSlider[data-cat="'+type+'"]').addClass("active").show();var currElem=zeQuery("#"+objID+" .playlistContainer .zeSlider.active .slides:first .cp_pl_item:first")});zeQuery(this.$gallery).on("click."+self.gallery_id,".mediaElement_playlist a.cp_pl_item",function(){if(self.go.args.prerollVideoUrl){if(!zeQuery(".mediaElement_playlist",self.$gallery).hasClass("preVideo")&&!zeQuery(this).hasClass("current")){zeQuery(".mediaElement_playlist",self.$gallery).addClass("preVideo")}}if(self.go.args.prerollVideoUrl||self.go.args.postrollVideoUrl){self.go.preRollIndex=zeQuery(this).attr("data-index")}if(self.group_by_youtubelike){zeQuery("#"+objID+" .playlistContainer .ze_flexslider").addClass("cp-hide");zeQuery(this).closest(".playlistContainer .ze_flexslider").removeClass("cp-hide")}zeQuery("#"+objID+" .share-layer").hide();zeQuery("#"+objID+" .mejs-controls").removeClass("cp-hide");zeQuery("#"+objID+" .mejs-overlay-button").show();var currentUrl=zeQuery(this).data("url");if(!zeQuery(this).hasClass("current")){var data_cat="",data_cat_value;if(zeQuery(this).attr("data-cat")){data_cat_value=zeQuery(this).attr("data-cat");data_cat='data-cat="'+self.getBeautyNameOfTag(data_cat_value)+'"'}var infoHtml='<div class="cp_pl_item" '+data_cat+" >"+zeQuery(this).html()+"</div>";var downloadPlaceholder;if(zeQuery(".mediaElementInfo_container.mediaElement_video_info .cp_download_placeholder",self.$gallery).length){downloadPlaceholder=zeQuery(".mediaElementInfo_container.mediaElement_video_info .cp_download_placeholder",self.$gallery);downloadPlaceholder.html("")}zeQuery(".mediaElementInfo_container",self.$gallery).html(infoHtml);if(downloadPlaceholder){zeQuery(".mediaElementInfo_container",self.$gallery).prepend(downloadPlaceholder)}if(typeof self.go.args.url_changer!="undefined"&&self.go.args.url_changer&&data_cat_value){zeQuery(".mediaElement_categories_head__subtitle",self.$gallery).html(self.getBeautyNameOfTag(data_cat_value));if(data_cat_value=="no-tag"){self.setHash("cat","")}else{self.setHash("cat",data_cat_value)}}self.onResize()}self.currentCategory=zeQuery(this).attr("data-cat");self.onClick(this);if(self.go.args.prerollVideoUrl){self.go.preRollCategory=self.currentCategory;zeQuery(".mediaElement_playlist").removeClass("preVideo");var infoHtml='<div class="cp_pl_item cp_pl_item_show" >'+zeQuery(this).html()+"</div>";zeQuery(".mediaElementInfo_container",self.$gallery).html(infoHtml)}});zeQuery(".mediaElement_playlist a.playlist_scroll_left",this.$gallery).on("click."+self.gallery_id,function(){var pos=Math.max(zeQuery(".playlistContainer",this.$gallery).scrollLeft()-600,0);zeQuery(".playlistContainer",this.$gallery).animate({scrollLeft:pos},350)});zeQuery(".mediaElement_playlist a.playlist_scroll_right",this.$gallery).on("click."+self.gallery_id,function(){var pos=Math.max(zeQuery(".playlistContainer",this.$gallery).scrollLeft()+600,0);zeQuery(".playlistContainer",this.$gallery).animate({scrollLeft:pos},350)});zeQuery(".mediaElement_categories li.mediaElement_categories_tab",this.$gallery).on("click."+self.gallery_id,function(){zeQuery(this).siblings("li").removeClass("active_category");zeQuery(this).addClass("active_category");var tab=zeQuery(this).attr("data-category");var $currentElem;zeQuery(".playlistContainer>div",this.$gallery).each(function(){var compareString=self.getBeautyNameOfTag(tab);if(zeQuery(this).attr("data-cat")===compareString){zeQuery(this).removeClass("cp-hide");$currentElem=zeQuery(this)}else{zeQuery(this).addClass("cp-hide")}});if(typeof self.go.args.url_changer!="undefined"&&self.go.args.url_changer){zeQuery(".mediaElement_categories_head__subtitle",self.$gallery).html(self.getBeautyNameOfTag(tab));if(tab=="no-tag"){self.setHash("cat","")}else{self.setHash("cat",tab)}}that.loadPlaylistThumbs();if($currentElem&&$currentElem.data("flexslider")){$currentElem.data("flexslider").doMath();$currentElem.data("flexslider").resize()}});zeQuery(".cp-portal-nav > div",this.$gallery).on("click."+self.gallery_id,function(){var active_category=zeQuery(".mediaElement_categories_tab.active_category",self.$gallery);var next=active_category.next().length?active_category.next():zeQuery(".mediaElement_categories_tab",self.$gallery).first();var prev=active_category.prev().length?active_category.prev():zeQuery(".mediaElement_categories_tab",self.$gallery).last();if(zeQuery(this).hasClass("cp-portal-nav-left")&&prev.length){prev[0].click()}else{if(next.length){next[0].click()}}});zeQuery(".mediaElement_categories .mediaElement_categories_left_arrow",this.$gallery).on("click."+self.gallery_id,function(){var scrollingElem=zeQuery(".mediaElement_categories ul",this.$gallery);var pos=Math.max(scrollingElem.scrollLeft()-80,0);scrollingElem.animate({scrollLeft:pos},350)});zeQuery(".mediaElement_categories .mediaElement_categories_right_arrow",this.$gallery).on("click."+self.gallery_id,function(){var scrollingElem=zeQuery(".mediaElement_categories ul",this.$gallery);var pos=Math.min(scrollingElem.scrollLeft()+80,scrollingElem.width());scrollingElem.animate({scrollLeft:pos},350)});zeQuery(".mediaElement_categories .mediaElement_categories_minimize",this.$gallery).on("click."+self.gallery_id,function(){zeQuery(this).closest(".mediaElement_categories").toggleClass("mediaElement_categories_minimized");zeQuery(".mediaElement_playlist",this.$gallery).toggleClass("mediaElement_playlist_minimized")});if(typeof self.go.args.url_changer!="undefined"&&self.go.args.url_changer){openPortalCorrectTab();if("onhashchange" in window){window.onhashchange=function(e){openPortalCorrectTab()}}if(isHistorySupported()){window.cincopaAddEventListener("popstate",function(event){if(event.state&&event.state.vportal){self.runFromHashTag()}})}function openPortalCorrectTab(){var cat=getUrlVars()["cat"];if(cat){zeQuery('.mediaElement_categories_tab[data-category="'+decodeURIComponent(cat)+'"]',self.$gallery).trigger("click")}else{zeQuery(".mediaElement_categories_tab",self.$gallery).first().trigger("click")}}zeQuery(".mediaElement_categories .mediaElement_categories_head",this.$gallery).on("click."+self.gallery_id,function(){zeQuery(this).next("ul").slideToggle()})}else{if(zeQuery(".mediaElement_categories",this.$gallery).is(":visible")){setTimeout(function(){zeQuery(".mediaElement_categories li.mediaElement_categories_tab",this.$gallery).first().trigger("click")},200)}}this.go.onSkinEvent("skin.load");if(this.go.args.prerollVideoUrl||this.go.args.postrollVideoUrl){this.go.preRollIndex=0;this.go.preRollCategory=this.currentCategory}zeQuery(".ze_overlay_skin_close_btn."+self.gallery_id,this.$gallery).on("click."+self.gallery_id,function(){zeQuery("#"+objID).fadeOut(function(){self.player.remove();zeQuery(this).remove()})});if(firstVideo){self.videoCount=videoCount;this.startMediaElement(firstRatio,self.getVideoCount(items))}zeQuery(document).on("click."+self.gallery_id,"#"+objID+" .mejs-overlay-play",function(){zeQuery(".mejs-overlay-play",self.$gallery).hide();zeQuery(".mejs-overlay-loading",self.$gallery).parent().show()});if(this.go.args.pagination_type=="prev_next"){zeQuery(document).on("click."+self.gallery_id,"#"+objID+" .ze_categories_next",function(){var currentPage=parseInt(zeQuery(".playlistContainer",self.$gallery).attr("data-current"));var nextPage=currentPage+1;self.recreatePagination(nextPage);self.animateToPage(nextPage,currentPage);zeQuery(".activeGroup .ze_flexslider",self.$gallery).each(function(){zeQuery(this).data("flexslider").resize()})});zeQuery(document).on("click."+self.gallery_id,"#"+objID+" .ze_categories_prev",function(){var currentPage=parseInt(zeQuery(".playlistContainer",self.$gallery).attr("data-current"));var prevPage=currentPage-1;self.recreatePagination(prevPage);self.animateToPage(prevPage,currentPage);zeQuery(".activeGroup .ze_flexslider",self.$gallery).each(function(){zeQuery(this).data("flexslider").resize()})});zeQuery(document).on("click."+self.gallery_id,"#"+objID+" .ze_categories_pagination li[data-page]",function(){var currentPage=parseInt(zeQuery(".playlistContainer",self.$gallery).attr("data-current"));var gotoPage=parseInt(zeQuery(this).attr("data-page"));self.recreatePagination(gotoPage);self.animateToPage(gotoPage,currentPage);zeQuery(".activeGroup .ze_flexslider",self.$gallery).each(function(){zeQuery(this).data("flexslider").resize()})})}else{if(this.go.args.pagination_type=="show_more"){zeQuery(document).on("click."+self.gallery_id,"#"+objID+" .ze_categories_show_more_button",function(){zeQuery(".hiddenGroup:first",self.$gallery).removeClass("hiddenGroup").addClass("activeGroup");if(zeQuery(".hiddenGroup",self.$gallery).length==0){zeQuery(this).hide()}zeQuery(".activeGroup .ze_flexslider",self.$gallery).each(function(){zeQuery(this).data("flexslider").resize()})})}}if(this.go.args.group_by==true||this.go.args.group_by=="on"){zeQuery("#"+objID+" .mediaElement_playlist .cp_pl_item:first").clone().addClass("cloned").css({position:"absolute",visibility:"hidden",display:"table"}).prependTo("#"+objID+" .mediaElement_playlist");setTimeout(function(){self.activateCarousel()},0)}zeQuery(".mediaElement_VideoOverlayButton",this.$gallery).on("click."+self.gallery_id,function(){var lead_gen_form_exist=zeQuery("#ze_htmloverlay_placeholder_"+objID+":visible",self.$gallery).length>0;if(zeQuery(".cp_pl_item.current",self.$gallery).length){zeQuery(".cp_pl_item.current",self.$gallery).trigger("click")}else{zeQuery(".playlistContainer .cp_pl_item:first",self.$gallery).first().trigger("click")}self.onResize();if(lead_gen_form_exist){self.player.pause()}});var hashtag=self.getHashtag();if(hashtag){var objID=self.go.loaderParams._object;var galFId=decodeURIComponent(self.go.loaderParams._fid);hashtag=hashtag.replace("linkshare/"+galFId+"/","").replace("linkshare/"+objID+"/","");hashtag=parseInt(hashtag)-1;zeQuery("#"+objID+" a.cp_pl_item:eq("+hashtag+")")[0].click();if(!self.isVisible(zeQuery(".cp_pl_item.current",self.$gallery))){zeQuery(".mediaElement_playlist",self.$gallery).animate({scrollLeft:zeQuery(".cp_pl_item.current",self.$gallery).outerWidth(true)*zeQuery(".cp_pl_item.current",self.$gallery).index()},500)}}};this.getVideoCount=function(items){var videoCount=0;if(this.go.args.group_by!="off"&&this.go.args.group_by!=false){for(var s_i=0;s_i<this.go.sortedItemsKeys.length;s_i++){var tag=this.go.sortedItemsKeys[s_i];if(items[tag] instanceof Array){for(var j=0;j<items[tag].length;j++){if(items.prepostrollVideo==true){videoCount++}}}}}else{for(var i=0;i<items.length;i++){if(items.prepostrollVideo==true){videoCount++}}}return videoCount};this.backwordCompatibility=function(){if(this.go.args.facebook_mode){this.go.args.autostart=false}if(this.go.args.allow_lightbox!=="no"){if(typeof this.go.args.allow_lightbox_autostart!="undefined"){this.go.args.autostart=eval(this.go.args.allow_lightbox_autostart)}else{this.go.args.autostart=true}}if(this.go.args.group_by=="true"||this.go.args.group_by=="false"){this.go.args.group_by=eval(this.go.args.group_by)}if(this.go.args.group_by=="playlist"){this.go.args.group_by=true;this.group_by_youtubelike=true;this.go.args.per_page=0}if(typeof this.go.args.tl_storyboard=="undefined"){this.tl_storyboard=false;this.go.args.tl_storyboard="off"}else{this.tl_storyboard=true}if(this.go.args.watermark_position==="no"||!this.go.args.watermark){this.go.args.watermark_on_off=false}else{this.go.args.watermark_on_off=true}};this.detectVideoThumbnail=function(item){if(!item){return}var tL;if(item.timeline){try{tL=JSON.parse(item.timeline)}catch(ex){}}return((tL&&tL.video_thumbnail)?true:false)},this.showVideoThumbnail=function(){var that=this;var item=this.go.MediaJSON.items[0];if(!item){return}var tL;if(item.timeline){try{tL=JSON.parse(item.timeline)}catch(ex){}}var start,end;if(tL&&tL.video_thumbnail){if(typeof tL.video_thumbnail.start!=="undefined"){start=tL.video_thumbnail.start}if(typeof tL.video_thumbnail.end!=="undefined"){end=tL.video_thumbnail.end}}if(typeof start==="undefined"||typeof end==="undefined"){return}zeQuery(".mejs-poster",this.$gallery).find(".mejs-poster-video").remove();zeQuery(".mejs-poster",this.$gallery).find(".unmute-button").remove();var $video=zeQuery("<video preload='metadata'>");$video.addClass("mejs-poster-video");var $videoElem=$video.get(0);$videoElem.muted=true;$videoElem.controls=false;$video.css({position:"absolute",top:0,left:0,});var $posterOverlay=zeQuery("<div>");$posterOverlay.addClass("mejs-poster-video");$posterOverlay.css({position:"absolute",top:"0",left:"0",width:"100%",height:"100%",background:"#000"});var dataURI="";dataURI=this.masterM3u8DataUri(this.createM3u8Arr(item));if(dataURI&&is_ie()==11&&(/(Windows 8.1|Windows NT 6.3)/.test(navigator.appVersion)||/(Windows 10.0|Windows NT 10.0)/.test(navigator.appVersion))){dataURI=cincopa.getPlaylistUrl(item.rid)}if(this.isHlsSupported()&&dataURI){var hlsOptions={maxMaxBufferLength:(this.go.args.fast_start?parseInt(this.go.args.hls_max_fast_start_buffer_length):parseInt(this.go.args.hls_max_buffer_length)),autoStartLoad:false};var hls=new Hls(hlsOptions);hls.loadSource(dataURI);hls.attachMedia($videoElem);hls.on(Hls.Events.MANIFEST_PARSED,function(){var videoLevel=that.getVideoLevel({item:item},hls);hls.loadLevel=videoLevel;hls.startLoad(start);$videoElem.play()})}else{if(this.go.args.enable_hls&&dataURI&&that.isNativeHls()){$videoElem.src=dataURI}else{$videoElem.src=this.getContentUrl(item)}var played=false;$videoElem.cincopaAddEventListener("loadedmetadata",function(){if(!played){this.currentTime=start;this.setAttribute("playsinline",true);this.play();played=true}})}$videoElem.cincopaAddEventListener("timeupdate",function(){if(this.currentTime<start){this.currentTime=start}if(this.currentTime>end){this.currentTime=start}});if(item.duration&&end>hmsToSecondsOnly(item.duration)){$videoElem.cincopaAddEventListener("ended",function(){this.currentTime=start;this.play()})}var $unmuteBtn=zeQuery("<div>").addClass("unmute-button");$unmuteBtn.html("<div class='unmute-button-speaker'><span></span></div>");$unmuteBtn.css({background:"rgba(0,0,0,.2)"});$unmuteBtn.on("click."+self.gallery_id,function(){that.player.$media[0].play()});return{$video:$video,$unmuteBtn:$unmuteBtn}};this.getThumbnailUrl=function(item,size){var defaultSize=3;if(this.load_thumb==="small"){defaultSize=1}else{if(this.load_thumb==="medium"){defaultSize=2}else{if(this.load_thumb==="large"){defaultSize=3}else{if(this.load_thumb==="xlarge"){defaultSize=4}}}}var sbgenerated=false;size=size||defaultSize;var thumbnail="";if(item.versions){if(size===1&&item.versions.jpg_100x75&&item.versions.jpg_100x75.url){thumbnail=item.versions.jpg_100x75.url}else{if(size===2&&item.versions.jpg_200x150&&item.versions.jpg_200x150.url){thumbnail=item.versions.jpg_200x150.url}else{if(size===3&&item.versions.jpg_600x450&&item.versions.jpg_600x450.url){thumbnail=item.versions.jpg_600x450.url}else{if(size===4&&item.versions.jpg_1200x900&&item.versions.jpg_1200x900.url){thumbnail=item.versions.jpg_1200x900.url}else{if(size===5&&item.versions.jpg_sb_100x75&&item.versions.jpg_sb_100x75.url){thumbnail=item.versions.jpg_sb_100x75.url;sbgenerated=true}else{if(size===6&&item.versions.jpg_sb_200x150&&item.versions.jpg_sb_200x150.url){thumbnail=item.versions.jpg_sb_200x150.url;sbgenerated=true}else{thumbnail=item.versions.jpg_600x450?item.versions.jpg_600x450.url:""}}}}}}}if(!thumbnail){thumbnail=item.thumbnail_url}if((size==5||size==6)&&!sbgenerated){return""}return thumbnail};this.getContentUrl=function(item,original){var url="";if(item.versions&&item.versions.mp4_hd&&item.versions.mp4_hd.url){url=item.versions.mp4_hd.url}if((!url&&item.versions&&item.versions.original&&item.versions.original.url)||original){url=item.versions.original.url}if(!url){url=item.content_url}if(this.isHlsSupported()&&item.content_real_type=="live"&&item.hls_playback_url){url=item.hls_playback_url}if(!this.isHlsSupported()&&this.isNativeHls()||item.content_type.indexOf("audio")>-1){var keyName=this.inBetween(url,"key=","&");if(keyName){url=url.replace("key="+keyName,"?key=AAAAAAA=")}}return url};this.getItems=function(resort){if(this.go.args.group_by==true||this.go.args.group_by=="on"&&typeof this.go.MediaJSON.items.sortedByTag=="undefined"){if(!this.go.sortedItems||resort){this.go.sortedItems=this.sortByTag(this.go.MediaJSON.items)}return this.go.sortedItems}return this.go.MediaJSON.items};this.getWindow=function(){var winSelector;if(this.go.args.iframe){winSelector=parent.window}else{winSelector=window}if(!!navigator.userAgent.match(" Safari/")&&!navigator.userAgent.match(" Chrom")&&!!navigator.userAgent.match(" Version/5.")){winSelector=window}return winSelector};this.findCurrentSubtitle=function(index,tag){var items=this.getItems();var objID=this.go.loaderParams._object;var extraFileType,extraFileCat;var noneLi=zeQuery("#mediaElementVideoContainer"+objID+' .mejs-controls .mejs-captions-button .mejs-captions-selector input[value="none"]').parent("li");var tracksLi=zeQuery("#mediaElementVideoContainer"+objID+" .mejs-controls .mejs-captions-button .mejs-captions-selector li").not(noneLi);tracksLi.hide().removeClass("track-current");var captionsExist=false;var extraFiles;if(tag&&items[tag]&&items[tag][index]){extraFiles=items[tag][index].extra_files}else{if(items[index]){extraFiles=items[index].extra_files}}if(extraFiles){for(var extraInd=0;extraInd<extraFiles.length;extraInd++){if(extraFiles[extraInd].type.toLowerCase().indexOf("subtitle")>-1){captionsExist=true;break}}}if(!captionsExist){zeQuery("#mediaElementVideoContainer"+objID+" .mejs-captions-button").addClass("cp-hide");return}tracksLi.each(function(i){extraFileType=zeQuery(this).find("input").val();extraFileCat=zeQuery(this).find("a.cp_pl_item").data("cat");var splitArray=extraFileType.split("_");var type=splitArray[0];if(self.go.args.group_by!="off"&&self.go.args.group_by!=false){if(extraFileType==type+"_"+tag.replace(/ /g,"_")+"_"+index){zeQuery(this).show().addClass("track-current");zeQuery(this).attr("data-type",type)}}else{if(extraFileType==type+"_"+index){zeQuery(this).show().addClass("track-current");zeQuery(this).attr("data-type",type)}}if(!zeQuery("#mediaElementVideoContainer"+objID+" .track-current").length){zeQuery("#mediaElementVideoContainer"+objID+" .mejs-captions-button").addClass("cp-hide")}else{zeQuery("#mediaElementVideoContainer"+objID+" .mejs-captions-button").removeClass("cp-hide")}})};this.getTracksSource=function(item,index,tag){var tracksHtml="";var subtitle_list=this.go.args.subtitle_list?this.go.args.subtitle_list.split(","):[];var existing_langs=[];var _zeNativeLanguagesArray=get_zeNativeLanguagesArray();if(item&&typeof item.extra_files!="undefined"){var extraFiles=item.extra_files;var extraFileType,extraFileUrl;var thumbnailUrl=this.getThumbnailUrl(item);var counterExtra=0,fileNativeLang;for(var extraInd=0;extraInd<extraFiles.length;extraInd++){var startPos=thumbnailUrl.lastIndexOf("/")+1;var endPos=thumbnailUrl.indexOf("?");var thisFileName=item.filename;var extraFileId=encodeURI(extraFiles[extraInd].id);extraFileType=extraFiles[extraInd].type.toLowerCase();fileNativeLang=extraFileType;extraFileUrl=extraFiles[extraInd].url;if(extraFileType.indexOf("subtitle-")>-1){for(var i=0;i<_zeNativeLanguagesArray.length;i++){var langCode=_zeNativeLanguagesArray[i].code;var nativeName=_zeNativeLanguagesArray[i].nativeName;var origCode=extraFiles[extraInd].type.split("-");if(typeof(origCode[1])!="undefined"&&origCode[1].toLowerCase()==langCode){fileNativeLang=nativeName}}existing_langs.push(origCode[1]);this.srtToVtt(extraFileUrl,self.go.args.group_by!="off"&&self.go.args.group_by!=false?extraFileType+"_"+tag.replace(/ /g,"_")+"_"+index:extraFileType+"_"+index);if(self.go.args.group_by!="off"&&self.go.args.group_by!=false){tracksHtml+='<track kind="captions" data-index="'+index+'"  data-type="'+extraFileType+'" data-rid="'+item.rid+'" data-src="'+extraFileUrl+'" srclang="'+extraFileType+"_"+tag.replace(/ /g,"_")+"_"+index+'" label="'+fileNativeLang+'"/>'}else{tracksHtml+='<track kind="captions"  data-index="'+index+'" data-type="'+extraFileType+'" data-rid="'+item.rid+'" data-src="'+extraFileUrl+'" srclang="'+extraFileType+"_"+index+'" label="'+fileNativeLang+'"/>'}counterExtra++}}this.subtitleFromList="";if(subtitle_list.length&&existing_langs.length){for(var l=0;l<subtitle_list.length;l++){if(existing_langs.indexOf(subtitle_list[l])>-1&&subtitle_list[l]!="*"){this.subtitleFromList=subtitle_list[l];break}}if(!this.subtitleFromList&&subtitle_list.indexOf("*")>-1){this.subtitleFromList=existing_langs[0]}}return tracksHtml}else{return"none"}};this.srtToVtt=function(url,index){if(this.isIOS!=true){return true}function toVTT(utf8str){return utf8str.replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").concat("\r\n\r\n")}var _that=this;zeQuery.ajax({url:url,success:function(res){var vttString="WEBVTT FILE\r\n\r\n";var text=vttString.concat(toVTT(res));var blob=new Blob([text],{type:"text/vtt"});var url=URL.createObjectURL(blob);zeQuery("track[srclang='"+index+"']",_that.$gallery).attr("src",url)}})};this.checkFacebookMode=function(){var objID=this.go.loaderParams._object;var isInView=false;if(!this.go.args.iframe){isInView=this.isScrolledIntoView("#mediaElementVideoContainer"+objID)}else{var parentObj=zeQuery(this.go.getParentIframeObject());isInView=this.isScrolledIntoView(parentObj,false,false,true,objID)}if(isInView){this.player.$media[0].play()["catch"](function(err){_trace(err+"Video Playing error")});if(!this.checkFacebookMode.secondCall){this.player.setMuted(true);this.checkFacebookMode.secondCall=true}}else{this.player.$media[0].pause()}};this.alwaysOnTop=function(){var objID=this.go.loaderParams._object;var that=this;if(!that.go.args.iframe){var inViewSelector="#mediaElementVideoContainer"+objID;if(zeQuery("#mediaElementVideoContainer"+objID).hasClass("ze_fixedPosition")){if(zeQuery("#mediaElement"+objID+" .ze_fixedPosition_helper").length){inViewSelector="#mediaElement"+objID+" .ze_fixedPosition_helper"}}var inViewContainer=zeQuery("#mediaElementVideoContainer"+objID);if(zeQuery("#mediaElement"+objID+" .ze_fixedPosition_helper").length>0&&that.isScrolledIntoView(inViewSelector,true,true)){inViewContainer.addClass("ze_fixedPosition_hide");inViewContainer.removeClass("ze_fixedPosition_options");that.playerIsFloating=false;zeQuery("#mediaElement"+objID+" .ze_fixedPosition_helper").height(0).remove();zeQuery("#mediaElementVideoContainer"+objID+" .alwaysOnTop-close").remove();inViewContainer.removeClass("ze_fixedPosition");inViewContainer.removeClass("ze_opasityHelper");inViewContainer.removeClass("ze_fixedPosition_hide");zeQuery("#mediaElementVideoContainer"+objID).removeClass("cp-hide");zeQuery("#mediaElementVideoContainer"+objID).fadeIn(1);that.onResize();setTimeout(function(){zeQuery(window).trigger("resize")},0);setTimeout(function(){zeQuery(".mediaElementVideoContainer .mejs-controls").resize();that.alwaysOnTop.fixAOTTimer=true},500)}else{if(zeQuery("#mediaElement"+objID+" .ze_fixedPosition_helper").length==0&&(zeQuery(that.getWindow()).scrollTop()>zeQuery(inViewSelector).offset().top)&&!that.isScrolledIntoView(inViewSelector,true,true)&&that.alwaysOnTop.fixAOTTimer){var getVideoHeight=zeQuery("#mediaElementVideoContainer"+objID).height();var st="<style id='ze_fixedPosition_helper_style_"+objID+"'>#mediaElement"+objID+" .mediaElementVideoContainer.ze_fixedPosition_helper{height:"+getVideoHeight+"px !important}</style>";zeQuery("#ze_fixedPosition_helper_style_"+objID).remove();zeQuery("#mediaElement"+objID).prepend('<div class="mediaElementVideoContainer ze_fixedPosition_helper" style="height:'+getVideoHeight+'px"></div>');zeQuery("#mediaElement"+objID).prepend(st);var closeBtnClass=that.go.args.always_on_top_float==="left"?"alwaysOnTop-close alwaysOnTop-close-left":"alwaysOnTop-close";var closeBtn=zeQuery('<div class="'+closeBtnClass+'"></div>');zeQuery("#mediaElementVideoContainer"+objID).append(closeBtn);inViewContainer.addClass("ze_fixedPosition_options");that.playerIsFloating=true;that.onResize();inViewContainer.addClass("ze_fixedPosition ze_opasityHelper");that.alwaysOnTop.fixAOTTimer=false;setTimeout(function(){that.adjustControls();zeQuery(".mediaElementVideoContainer .mejs-controls").resize()},520);closeBtn.on("click."+self.gallery_id,function(){zeQuery("#mediaElementVideoContainer"+objID).find("video").get(0).pause();zeQuery("#mediaElementVideoContainer"+objID).fadeOut(500,function(){zeQuery(this).addClass("cp-hide")})})}}}else{var parentObj=zeQuery(that.go.getParentIframeObject());if(!parentObj.hasClass("alwaysOnTopVideo")){var offset=parentObj.offset();var h=parentObj.height();parentObj.css("left",offset.left+"px");parentObj.css("top",-h/2+"px");var transitionClassName=that.go.args.always_on_top_float==="left"?"alwaysOnTopVideo alwaysOnTopLeft":"alwaysOnTopVideo";parentObj.addClass(transitionClassName);zeQuery("#"+objID).addClass(transitionClassName)}var inViewSelector=parentObj;if(parentObj.hasClass("ze_fixedPosition")){if(parentObj.siblings(".ze_fixedPosition_helper").length){inViewSelector=parentObj.siblings(".ze_fixedPosition_helper")}}var inViewContainer=parentObj;if(parentObj.siblings(".ze_fixedPosition_helper").length>0&&that.isScrolledIntoView(inViewSelector,true,true)){inViewContainer.removeClass("ze_fixedPosition_options");that.playerIsFloating=false;parentObj.siblings(".ze_fixedPosition_helper").height(0).remove();zeQuery("#mediaElementVideoContainer"+objID+" .alwaysOnTop-close").remove();inViewContainer.removeClass("ze_fixedPosition");parentObj.removeClass("cp-hide");parentObj.fadeIn(1);that.onResize(true);setTimeout(function(){that.adjustControls();that.resizePlayer();zeQuery(".mediaElementVideoContainer .mejs-controls").resize();that.alwaysOnTop.fixAOTTimer=true},500)}else{if(parentObj.siblings(".ze_fixedPosition_helper").length==0&&(zeQuery(that.getWindow()).scrollTop()>zeQuery(inViewSelector,parent.document).offset().top)&&!that.isScrolledIntoView(inViewSelector,true,true)&&that.alwaysOnTop.fixAOTTimer){var getVideoHeight=zeQuery("#mediaElementVideoContainer"+objID).height();var st="<style id='ze_fixedPosition_helper_style_"+that.go.loaderParams._iframeParentObject+"'>div#"+that.go.loaderParams._iframeParentObject+" .ze_fixedPosition_helper{height:"+getVideoHeight+"px !important}</style>";parentObj.siblings("#ze_fixedPosition_helper_style_"+that.go.loaderParams._iframeParentObject).remove();parentObj.after('<div class="mediaElementVideoContainer ze_fixedPosition_helper" style="height:'+getVideoHeight+'px"></div>');parentObj.before(st);var closeBtnClass=that.go.args.always_on_top_float==="left"?"alwaysOnTop-close alwaysOnTop-close-left":"alwaysOnTop-close";var closeBtn=zeQuery('<div class="'+closeBtnClass+'"></div>');zeQuery("#mediaElementVideoContainer"+objID).append(closeBtn);inViewContainer.addClass("ze_fixedPosition_options");inViewContainer.addClass("ze_fixedPosition");that.playerIsFloating=true;that.onResize(true);that.alwaysOnTop.fixAOTTimer=false;setTimeout(function(){that.adjustControls();that.resizePlayer();zeQuery(".mediaElementVideoContainer .mejs-controls").resize()},520);closeBtn.on("click."+self.gallery_id,function(){zeQuery("#mediaElementVideoContainer"+objID).find("video").get(0).pause();parentObj.fadeOut(500,function(){parentObj.addClass("cp-hide")})})}}}};this.resizeAlwaysOnTop=function(){var objID=this.go.loaderParams._object;var winElem=this.getWindow();var transitionClassName=this.go.args.always_on_top_float==="left"?"alwaysOnTopVideo alwaysOnTopLeft":"alwaysOnTopVideo";if(!this.go.args.iframe){var offset=zeQuery("#mediaElementVideoContainer"+objID).offset();var h=zeQuery("#mediaElementVideoContainer"+objID).height();zeQuery("#mediaElementVideoContainer"+objID).css("left",offset.left+"px");zeQuery("#mediaElementVideoContainer"+objID).css("top",-h/2+"px");zeQuery("#"+objID).addClass(transitionClassName)}else{var ifr=this.go.getParentIframeObject();var offset=zeQuery(ifr).offset();var h=zeQuery(ifr).height();zeQuery(ifr).css("left",offset.left+"px");zeQuery(ifr).css("top",-h/2+"px");zeQuery(ifr).addClass(transitionClassName);zeQuery("#"+objID).addClass(transitionClassName)}var leftPos=0;if(this.go.args.always_on_top_float==="left"){leftPos=parseInt(this.go.args.always_on_top_right)}else{leftPos=zeQuery(winElem).width()-parseInt(this.go.args.always_on_top_size_w)-parseInt(this.go.args.always_on_top_right)}if(zeQuery(winElem).width()<600){if(this.go.args.always_on_top_float==="left"){leftPos=10}else{leftPos=zeQuery(winElem).width()-parseInt(this.go.args.always_on_top_size_w)-10}}if(this.go.args.always_on_top_height_by_ratio){this.go.args.always_on_top_size_h=this.go.args.always_on_top_size_w/this.fRatio}var stInner="div#"+objID+" #mediaElementVideoContainer"+objID+".ze_fixedPosition_options{ width:"+this.go.args.always_on_top_size_w+"px !important; height:"+this.go.args.always_on_top_size_h+"px !important;}";stInner+="#mediaElementVideoContainer"+objID+".ze_fixedPosition{ top:"+this.go.args.always_on_top_top+"px !important;  left:"+leftPos+"px !important;}";if(!this.go.args.iframe){var stInner="div#"+objID+" #mediaElementVideoContainer"+objID+".ze_fixedPosition_options{ width:"+this.go.args.always_on_top_size_w+"px !important; height:"+this.go.args.always_on_top_size_h+"px !important;}";stInner+="#mediaElementVideoContainer"+objID+".ze_fixedPosition{ top:"+this.go.args.always_on_top_top+"px !important;  left:"+leftPos+"px !important;}";zeQuery("style#cp_style_ze_fixedPosition_"+objID).html(stInner)}else{var parentFrame=this.go.getParentIframeObject();var parentFrameId=this.go.getParentIframeObject().id;var stInner="#"+parentFrameId+".ze_fixedPosition_options{ width:"+this.go.args.always_on_top_size_w+"px !important; height:"+this.go.args.always_on_top_size_h+"px !important;}";stInner+="#"+parentFrameId+".ze_fixedPosition{ top:"+this.go.args.always_on_top_top+"px !important;  left:"+leftPos+"px !important; position: fixed !important;z-index: 9999; opacity:1;}";stInner+=".ze_fixedPosition_helper{box-shadow: rgba(17, 35, 105, 0.41) 0px 4px 26px 7px;}";stInner+=".alwaysOnTopVideo{-webkit-transition: left .5s, top .5s ; transition: left .5s, top .5s  ; position:static} ";stInner+=".alwaysOnTopLeft{-webkit-transition: right .5s, top .5s ; transition: right .5s, top .5s  ; position:static} ";zeQuery(parentFrame).siblings("style#cp_style_ze_fixedPosition_"+this.go.loaderParams._iframeParentObject).html(stInner)}};this.isScrolledIntoView=function(elem,partial,half,parentWin,objId){var el=zeQuery(elem);if(el.length==0){return false}var winSelector=this.getWindow();var docViewTop=zeQuery(winSelector).scrollTop();var docViewBottom=docViewTop+winSelector.innerHeight;var elemTop=el.offset().top;var elemBottom=elemTop+(half?el.height()/2:el.height());elemBottom=parentWin?elemBottom-(el.height()-zeQuery("#mediaElementVideoContainer"+objId).height()):elemBottom;if(typeof partial=="undefined"||partial==false){return((elemBottom<=docViewBottom)&&(elemTop>=docViewTop))}else{return((elemBottom<=docViewBottom&&elemBottom>=docViewTop)||(elemTop>=docViewTop&&elemTop<=docViewBottom))}};this.recreatePagination=function(index){var htm='<li class="ze_categories_prev" >Prev</li>';var startPoint=index-2;if(startPoint<=2){startPoint=1}var endPoint=startPoint+4;if(startPoint>1){htm+='<li class="ze_categories_item" data-page="1" >First</li>';htm+='<li class="" >...</li>'}for(var zind=startPoint;zind<=endPoint;zind++){if(zind>self.pageCount){break}htm+='<li class="ze_categories_item" data-page="'+zind+'" >'+zind+"</li>";if(zind==endPoint&&zind<self.pageCount){htm+='<li class="" >...</li>';htm+='<li class="ze_categories_item" data-page="'+self.pageCount+'" >Last</li>'}}htm+='<li class="ze_categories_next">Next</li>';zeQuery(".ze_categories_pagination",self.$gallery).html(htm);if(index==1){zeQuery(".ze_categories_pagination .ze_categories_prev",self.$gallery).hide()}if(index==self.pageCount){zeQuery(".ze_categories_pagination .ze_categories_next",self.$gallery).hide()}zeQuery(".playlistContainer",self.$gallery).attr("data-current",index)};this.animateToPage=function(index,currentIndex){var animationInPx=Math.abs(index-currentIndex)*zeQuery(".ze_grouping",self.$gallery).width();if(index>currentIndex){zeQuery(".playlistContainer",self.$gallery).animate({left:"-="+animationInPx})}else{zeQuery(".playlistContainer",self.$gallery).animate({left:"+="+animationInPx})}zeQuery(".ze_categories_pagination li[data-page]",self.$gallery).removeClass("active");zeQuery('.ze_categories_pagination li[data-page="'+index+'"]',self.$gallery).addClass("active")};this.activateCarousel=function(){var thumb_w=parseInt(zeQuery(".mediaElement_playlist .cp_pl_item.cloned",this.$gallery).outerWidth(true));zeQuery(".mediaElement_playlist .cp_pl_item.cloned",this.$gallery).remove();zeQuery(".ze_flexslider  ul.slides",this.$gallery).each(function(){if(zeQuery(this).find("li").length==1){zeQuery(this).parents(".ze_flexslider").removeClass("zeSlider").addClass("zeOneSlider")}});var counter=0;if(this.group_by_youtubelike||this.go.args.new_video_portal){return false}zeQuery(".ze_flexslider.zeSlider",this.$gallery).flexslider({animation:"slide",controlNav:false,prevText:"",nextText:"",animationLoop:false,itemWidth:thumb_w,itemMargin:self.go.args.playlist_item_margin?parseInt(self.go.args.playlist_item_margin):5,move:1,pausePlay:false,slideshow:false,keyboard:this.go.args.cincopaTV?false:true,touch:self.go.args.disableSliderTouch?false:true,start:function(){counter++;if(counter==zeQuery(".ze_flexslider",self.$gallery).length){zeQuery(window).trigger("resize")}self.loadPlaylistThumbs();self.onResize()},galleryId:self.gallery_id});zeQuery(".ze_flexslider.zeOneSlider",this.$gallery).flexslider({animation:"fade",controlNav:false,prevText:"",nextText:"",animationLoop:false,itemWidth:thumb_w,directionNav:false,itemMargin:self.go.args.playlist_item_margin?parseInt(self.go.args.playlist_item_margin):5,move:1,pausePlay:false,slideshow:false,touch:self.go.args.disableSliderTouch?false:true,keyboard:this.go.args.cincopaTV?false:true,start:function(){counter++;if(counter==zeQuery(".ze_flexslider",self.$gallery).length){zeQuery(window).trigger("resize")}zeQuery(".ze_flexslider.zeOneSlider",this.$gallery).find("ul.slides").css("transform","none");self.loadPlaylistThumbs();self.onResize()},after:function(slider){self.go.onSkinEvent("slider."+slider.direction)},galleryId:self.gallery_id})};this.frameResize=function(){if(this.go.args.allow_lightbox!="no"){return false}var objID=this.go.loaderParams._object;var h=document.getElementById(objID).offsetHeight+"px";var parentiframe=this.go.getParentIframeObject();if(parseInt(h)!=0){parentiframe.height=h}objID=self.go.loaderParams._object;if(zeQuery("#"+objID).width()<640&&this.isMobile){zeQuery("#"+objID).addClass("ze_mobileLayout")}else{zeQuery("#"+objID).removeClass("ze_mobileLayout")}};this.onClick=function(el,url,cat,track,notPlay,hideposter){zeQuery(".netflix_popup_current_title",self.$gallery).remove();zeQuery(".netflix_popup_audio_item",self.$gallery).remove();zeQuery(".mejs-controls-audio-helper",self.$gallery).remove();var audio=self.sendDataCollector(zeQuery(el).attr("data-url"));if(audio.item.content_type.indexOf("audio")>-1&&self.go.args.audio_support){zeQuery(".mediaElementVideoContainer",self.$gallery).addClass("isAudio");var audioBlock='                <div class="mejs-controls-audio-helper" ></div>                <div class="netflix_popup_audio_item" >                <div class="audio--header">                <div class="audio--image">                    <img src="'+audio.item.thumbnail_url+'"/>                </div>                <div class="audio--info"><span class="audio--title">'+audio.item.title+'</span>                <span class="audio--data">'+self.getDate(audio.item.modified)+'</span>                <div class="cp_download_placeholder cp-hide"></div>                <div class="audio--descroption">                <p><strong>Description</strong></p>                <p>'+audio.item.description+'</p>                </div>                </div>                </div>                <div class="audio--transcript_notes">                <div class="transcript_notes--chooser">                <span class="notes active">Notes</span>                <span class="transcripts cp-hide">Transcripts</span>                </div>                <p class="transcript_notes--text"></p>                <p class="transcript_transcripts--text cp-hide"></p>                </div>                </div>                ';zeQuery(".mejs-controls",self.$gallery).after(audioBlock);var transcriptText;if(audio.item.extra_files&&audio.item.extra_files.length>0){if(!self.SubtitlesTexts){self.SubtitlesTexts={}}if(self.SubtitlesTexts[audio.item.rid]){transcriptText=self.SubtitlesTexts[audio.item.rid].text||"";setTransciptionText(transcriptText)}else{self.SubtitlesTexts[audio.item.rid]={url:"",text:"",};zeQuery.each(audio.item.extra_files,function(i,el){if(el.type.indexOf("subtitle")>-1){self.SubtitlesTexts[audio.item.rid].url=el.url;return false}});if(self.SubtitlesTexts[audio.item.rid].url!=""){zeQuery.ajax({url:self.SubtitlesTexts[audio.item.rid].url,success:function(res){try{self.SubtitlesTexts[audio.item.rid].text=PF_SRT.parse(res);if(zeQuery(".cp_pl_item.current",self.$gallery).data("rid")==audio.item.rid){setTransciptionText(self.SubtitlesTexts[audio.item.rid].text)}}catch(ex){_trace("PARSE SRT ERROR "+ex)}},})}}}function setTransciptionText(text){if(text){zeQuery(".transcript_transcripts--text",self.$gallery).html("<pre>"+text+"</pre>");zeQuery(".transcript_notes--chooser .transcripts").removeClass("cp-hide")}}if(!audio.item.long_description){zeQuery(".transcript_notes--text",self.$gallery).html('<p class="transcript_notes--noNotes"> No Notes </p>')}else{zeQuery(".transcript_notes--text",self.$gallery).html(audio.item.long_description)}if((self.SubtitlesTexts&&!self.SubtitlesTexts[audio.item.rid])||(self.SubtitlesTexts&&self.SubtitlesTexts[audio.item.rid]&&!self.SubtitlesTexts[audio.item.rid].text)){zeQuery(".transcript_transcripts--text",self.$gallery).addClass("cp-hide")}zeQuery(".transcript_notes--chooser span",self.$gallery).on("click."+self.gallery_id,function(e){if(zeQuery(this).hasClass("active")){return}zeQuery(".transcript_notes--chooser span",self.$gallery).removeClass("active");zeQuery(this).addClass("active");if(zeQuery(this).hasClass("notes")){zeQuery(".transcript_notes--text",self.$gallery).removeClass("cp-hide");zeQuery(".transcript_transcripts--text",self.$gallery).addClass("cp-hide")}else{zeQuery(".transcript_notes--text",self.$gallery).addClass("cp-hide");zeQuery(".transcript_transcripts--text",self.$gallery).removeClass("cp-hide")}})}else{var video=self.sendDataCollector(zeQuery(el).attr("data-url"));zeQuery(".mediaElementVideoContainer",self.$gallery).removeClass("isAudio");zeQuery(".mejs-container",self.$gallery).append('<span class="netflix_popup_current_title">'+video.item.title+"</span>")}if(!zeQuery(el).hasClass("pause")){var videoContainer=zeQuery(".mejs-mediaelement",self.$gallery);videoContainer.addClass("fading")}if(el.length==0){return}if(!clickedfirsttime){zeQuery(".ze_overlay_close_btn").trigger("click")}clickedfirsttime=false;var objID=self.go.loaderParams._object;zeQuery("#"+objID).removeClass("ze-changing-video");setTimeout(function(){zeQuery("#"+objID).addClass("ze-changing-video")},0);var lead_gen_form_exist=zeQuery("#ze_htmloverlay_placeholder_"+objID+":visible",self.$gallery).length>0;if(lead_gen_form_exist){notPlay=true}else{if(zeQuery("#"+objID+".cp_form_opened").length){notPlay=true}}var items=self.getItems();var sourceTrack="",dataTag="",item,elIndex;var dataOvverride=true;if(zeQuery(el).data("ovveride")==false&&zeQuery(el).hasClass("current")){return false}zeQuery("#mediaElementVideoContainer"+objID+" .imageHelper").remove();if(zeQuery("#mediaElementVideoContainer"+objID+" .mejs-container").length){zeQuery("#mediaElementVideoContainer"+objID+" .mejs-inner").show()}else{zeQuery(self.player.node).show()}if(track=="next"||track=="prev"){if(self.go.args.group_by!="off"&&self.go.args.group_by!=false){elIndex=zeQuery('div.ze_flexslider[data-cat="'+cat+'"] a.cp_pl_item[data-url="'+url+'"][data-cat="'+cat+'"]',self.$gallery).data("index")}else{elIndex=zeQuery(el).index()}}else{elIndex=zeQuery(el).data("index")}if(self.go.args.subtitle||self.go.args.subtitle_list){if(this.go.args.group_by!="off"&&this.go.args.group_by!=false){dataTag=zeQuery(el).data("cat");if(typeof item!="undefined"){item=items.player[elIndex];sourceTrack+=self.getTracksSource(item,elIndex,dataTag)}}else{if(typeof item!="undefined"){item=items[elIndex];sourceTrack+=self.getTracksSource(item,elIndex)}}self.findCurrentSubtitle(elIndex,dataTag)}if(!self.checkIsCasting()||!self.currentCastMedia()){if(zeQuery(el).hasClass("current")&&!self.player.media.paused){self.player.$media[0].pause();return false}else{if(zeQuery(el).hasClass("current")){self.player.$media[0].play()["catch"](function(err){_trace(err+"Video Playing error");if(err&&err.code===20){return}var videoElement=self.player.$media[0];videoElement.muted=true;videoElement.play();if(zeQuery(".mediaElementVideoContainer",self.$gallery).hasClass("isAudio")){videoElement.muted=false;videoElement.pause()}else{var unmuteBtn=zeQuery("<div>").addClass("unmute-button");unmuteBtn.html("<div class='unmute-button-speaker'><span></span></div><span>"+(self.isMobile?"Tap for sound":"Click for sound")+"</span>");unmuteBtn.on("click."+self.gallery_id,function(){if(videoElement.muted){videoElement.muted=false}unmuteBtn.remove()});zeQuery(".mejs-layers",self.$gallery).append(unmuteBtn)}});if(notPlay){self.player.pause()}return false}}}else{if(document.createEvent){var event=document.createEvent("HTMLEvents");event.initEvent("onclickforcast",true,true);event.eventName="onclickforcast";event.el=el;event.url=url;event.track=track;if(self.go.args.netflix_popup){if(zeQuery("#"+objID+".netflix_popup").hasClass("netflix_popup_opened")){zeQuery("video",self.$gallery)[0].dispatchEvent(event)}}else{zeQuery("video",self.$gallery)[0].dispatchEvent(event)}}}var mejsID=zeQuery(".mediaElementVideoContainer",self.$gallery).attr("id");try{delete cincopa_mejs.players[mejsID]}catch(ex){}var prevCurrent=zeQuery(".cp_pl_item.current[data-url]",self.$gallery).attr("data-url");if(prevCurrent){var sendingData=self.sendDataCollector(prevCurrent);if(!self.videoEnded&&self.playing&&!self.advertising){var sendingPauseData=self.sendDataCollector(prevCurrent);sendingPauseData.second=~~self.player.$media[0].currentTime;self.go.onSkinEvent("video.pause",sendingPauseData)}if(!self.advertising){zeQuery("#mediaElementVideoContainer"+objID+" video").attr("data-playingVideoSize",null);self.go.onSkinEvent("video.unload",sendingData)}self.playing=false;self.loaded=false;self.unload=false;self.canSendPlay=true}zeQuery("a.cp_pl_item",self.$gallery).removeClass("current").removeClass("pause");if(typeof url!="undefined"){var getPlaylistObject;if(self.go.args.group_by==true||self.go.args.group_by!="off"){if(typeof cat=="undefined"){cat=self.currentCategory}else{self.currentCategory=cat}getPlaylistObject=zeQuery('.playlistContainer a.cp_pl_item[data-url="'+url+'"][data-cat="'+cat+'"]',self.$gallery);var carouselSlide=getPlaylistObject.parents(".ze_flexslider.carousel").data("flexslider");if(carouselSlide&&!self.isVisible(getPlaylistObject,"horizontal")){carouselSlide.flexAnimate(getPlaylistObject.parent().index())}if(self.group_by_youtubelike){zeQuery(".playlistContainer .ze_flexslider",self.$gallery).addClass("cp-hide");getPlaylistObject.closest(".ze_flexslider").removeClass("cp-hide");self.loadPlaylistThumbs();self.onResize()}zeQuery(".mediaElement_categories_tab",self.$gallery).removeClass("active_category");zeQuery(".mediaElement_categories_tab[data-category='"+cat+"']",self.$gallery).addClass("active_category")}else{getPlaylistObject=zeQuery('.playlistContainer a.cp_pl_item[data-url="'+url+'"]',self.$gallery).last()}var carousel=getPlaylistObject.parents(".carousel");if(self.go.args.pagination_type=="prev_next"){var page=parseInt(carousel.parent().attr("data-page"));zeQuery('.ze_categories_pagination  li[data-page="'+page+'"]',self.$gallery).click()}getPlaylistObject.addClass("current");var poster_src=getPlaylistObject.attr("data-poster");video_src=url;var data_cat="",data_cat_value;if(zeQuery(getPlaylistObject).attr("data-cat")){data_cat_value=zeQuery(getPlaylistObject).attr("data-cat");data_cat='data-cat="'+self.getBeautyNameOfTag(data_cat_value)+'"'}var infoHtml='<div class="cp_pl_item" '+data_cat+" >"+zeQuery(getPlaylistObject).html()+"</div>";zeQuery(".mediaElementInfo_container",self.$gallery).html(infoHtml);if(typeof self.go.args.url_changer!="undefined"&&self.go.args.url_changer&&data_cat_value){zeQuery(".mediaElement_categories_head__subtitle",self.$gallery).html(self.getBeautyNameOfTag(data_cat_value));if(data_cat_value=="no-tag"){self.setHash("cat","")}else{self.setHash("cat",data_cat_value)}}if(!self.isVisible(getPlaylistObject)){zeQuery(".mediaElement_playlist",self.$gallery).animate({scrollLeft:getPlaylistObject.outerWidth(true)*getPlaylistObject.index()},500)}}else{if(self.go.args.group_by==true||self.go.args.group_by=="on"){zeQuery(".mejs-playlist li.current",self.$gallery).removeClass("current");var getCorrectPlaylistElem=zeQuery('.mejs-playlist li[data-cat="'+self.currentCategory+'"]',self.$gallery).eq(zeQuery(el).parent().index());zeQuery(".mejs-playlist li.current",self.$gallery).removeClass("current");getCorrectPlaylistElem.addClass("current")}else{zeQuery(".mejs-playlist li.current",self.$gallery).removeClass("current");zeQuery(".mejs-playlist li",self.$gallery).eq(zeQuery(el).index()).addClass("current")}zeQuery(el).addClass("current");var video_src=zeQuery(el).attr("data-url");poster_src=zeQuery(el).attr("data-poster");dataOvverride=zeQuery(el).data("ovveride")||(zeQuery(el).attr("data-ovveride")=="true"?true:false)}zeQuery("#mediaElementVideoContainer"+objID).removeClass("first-item-playing");zeQuery("#mediaElementVideoContainer"+objID).removeClass("last-item-playing");setTimeout(function(){if(zeQuery(".mejs-playlist li.current",self.$gallery).index()===0){zeQuery("#mediaElementVideoContainer"+objID).addClass("first-item-playing")}else{if(zeQuery(".mejs-playlist li.current",self.$gallery).index()===zeQuery(".mejs-playlist li",self.$gallery).length-1){zeQuery("#mediaElementVideoContainer"+objID).addClass("last-item-playing")}}if(zeQuery(".mejs-playlist li.current",self.$gallery).index()%2===0){self.$gallery.removeClass("mejs-playing-item-even").addClass("mejs-playing-item-odd")}else{self.$gallery.removeClass("mejs-playing-item-odd").addClass("mejs-playing-item-even")}},10);zeQuery(".mejs-time-float",self.$gallery).hide();var timelineThumbPreview=zeQuery("#mediaElementVideoContainer"+objID+" .time-rail-thumbnails .thumbImage.preview");timelineThumbPreview.addClass("thumbnails-loading-text");timelineThumbPreview.css("background","#000000").text("Processing...");if(this.go.args.override_poster&&poster_src){poster_src=poster_src.replace("&p=y","").replace("&t=y","")}else{poster_src=video_src}if(zeQuery(".cp_pl_item.current",self.$gallery).attr("data-storage")=="false"){self.timerPoster=poster_src+"&t=y"}else{self.timerPoster=poster_src+"&p=y"}var currentElementId=zeQuery(".cp_pl_item.current",self.$gallery).attr("id");zeQuery(".ze_tl_block ul",self.$gallery).hide().removeClass("active");zeQuery('.ze_tl_block ul[data-id="'+currentElementId+'"]',self.$gallery).show().addClass("active");self.playOnClick=true;var tmpD=self.sendDataCollector(video_src);self.$gallery.siblings(".mediaElement-top-bar").empty().html("<span class='mediaElement-top-bar-gallery-title'>"+(self.go.args.gallery_title?self.go.args.gallery_title:"")+"</span><span>"+tmpD.item.title+"</span>");self.$gallery.siblings(".mediaElement-bottom-bar").empty().html("<div>"+(tmpD.item.description||tmpD.item.long_description)+"</div>"+self.build_bottom_share_layer());if(document.createEvent){var event=document.createEvent("HTMLEvents");event.initEvent("onclickevent",true,true);event.eventName="onclickevent";if(self.go.args.netflix_popup){if(zeQuery("#"+objID+".netflix_popup").hasClass("netflix_popup_opened")){zeQuery("video",self.$gallery)[0].dispatchEvent(event)}}else{zeQuery("video",self.$gallery)[0].dispatchEvent(event)}}if(self.player.media.pluginType=="native"&&dataOvverride){var sendData=self.sendDataCollector(video_src);if((!zeQuery.isEmptyObject(sendData.item.versions)||sendData.item.content_real_type=="live")){self.playHLS(zeQuery("#mediaElementVideo"+objID).get(0),sendData,notPlay?false:true)}else{self.go.onSkinEvent("video.load",sendData);self.player.setSrc(video_src)}var content_url=self.getContentUrl(sendData.item);zeQuery("#mediaElementVideoContainer"+objID+" video").data("currentplayingvideourl",content_url);var trackLength=zeQuery("#mediaElementVideoContainer"+objID+" video track").length;if((self.go.args.subtitle||self.go.args.subtitle_list)&&trackLength>0){self.player.setTrack("none");zeQuery("#mediaElementVideoContainer"+objID+' .mejs-controls .mejs-captions-button .mejs-captions-selector li input[value="none"]').prop("checked",true)}if(!hideposter){zeQuery("video",self.$gallery).attr("poster",poster_src)}else{zeQuery("video",self.$gallery).attr("poster","")}if(!zeQuery(".cp_pl_item.current",self.$gallery).data("poster-ratio")){var newImage=new Image();newImage.onload=function(){var ratio=this.width/this.height;zeQuery(".cp_pl_item.current",self.$gallery).attr("data-poster-ratio",ratio);if(ratio<1){zeQuery(self.$gallery).addClass("portraitPoster")}newImage=null};newImage.src=poster_src}else{if(zeQuery(".cp_pl_item.current",self.$gallery).data("poster-ratio")<1){zeQuery(self.$gallery).addClass("portraitPoster")}else{zeQuery(self.$gallery).removeClass("portraitPoster")}}if(self.checkIsCasting()){return false}self.player.load();self.canSendPlay=true;if(!notPlay&&!self.go.args.preventAutoPlayNextTrack){setTimeout(function(){if(self.player.media.currentSrc){self.player.$media[0].play()["catch"](function(err){_trace(err+"Video Playing error")})}},500)}else{zeQuery(".cp-hidecontrols",self.$gallery).removeClass("cp-hidecontrols");zeQuery(".mejs-overlay-play",self.$gallery).removeClass("cp-hide").show()}}else{if(self.player.media.pluginType=="native"){self.player.pause();if(zeQuery("#mediaElementVideoContainer"+objID+" .mejs-container").length){zeQuery("#mediaElementVideoContainer"+objID+" .mejs-container").prepend('<img class="imageHelper" src="'+video_src+'" style="max-width: 100%; max-height: 100%;  width: auto; height: auto;"/>');zeQuery(self.player.node).parents(".mejs-inner").hide()}else{zeQuery("#mediaElementVideoContainer"+objID).prepend('<img class="imageHelper" src="'+video_src+'" style="max-width: 100%; max-height: 100%;  width: auto; height: auto;"/>');zeQuery(self.player.node).hide()}}else{self.player.remove();var newVideoHtml='<video crossorigin id="mediaElementVideo'+objID+'"  class="videoWorkaround" controls="controls" poster="'+poster_src+'" width="640" height="360"  style="height:100%;width:100%" preload="'+(self.go.args.fast_start?"metadata":"none")+'"  src="'+video_src+'" >';newVideoHtml+=self.sourceHtml;newVideoHtml+="</video>";zeQuery(".mediaElementVideoContainer",self.$gallery).html(newVideoHtml);self.startMediaElement(self.v_ratio,self.getVideoCount(items))}}};this.elementInViewport=function(elem){var $window=zeQuery(window);var docViewTop=$window.scrollTop();var docViewBottom=docViewTop+$window.height();var elemTop=elem.offset().top;var elemBottom=elemTop+elem.height();return((elemBottom<=docViewBottom)&&(elemTop>=docViewTop))};this.isVisible=function(elem,type){if(zeQuery(elem).length==0){return false}var pos=zeQuery(elem).position(),wX=zeQuery(".mediaElement_playlist",self.$gallery).position().left,wY=zeQuery(".mediaElement_playlist",self.$gallery).position().top,wH=zeQuery(".mediaElement_playlist",self.$gallery).height(),wW=zeQuery(".mediaElement_playlist",self.$gallery).width()-50,oH=zeQuery(elem).height(),oW=zeQuery(elem).width();if(type=="horizontal"){if(((pos.left<=wX&&pos.left+oW>wX)||(pos.left>=wX&&pos.left<=wX+wW))){return true}else{return false}}else{if(((pos.left<=wX&&pos.left+oW>wX)||(pos.left>=wX&&pos.left<=wX+wW))&&((pos.top<=wY&&pos.top+oH>wY)||(pos.top>=wY&&pos.top<=wY+wH))){return true}else{return false}}};this.onResize=function(disableFrameResize){var that=this;var objID=this.go.loaderParams._object;if(zeQuery("#"+objID).width()<640&&this.isMobile){zeQuery("#"+objID).addClass("ze_mobileLayout")}else{zeQuery("#"+objID).removeClass("ze_mobileLayout")}var className="";switch(true){case (zeQuery("#"+objID).width()<=1000):className="gwS";break;case (zeQuery("#"+objID).width()>1000):className="gwL";break}switch(true){case (zeQuery("#"+objID).width()<768):className="gsmobile";break;case (zeQuery("#"+objID).width()>=768&&zeQuery("#"+objID).width()<=1024):className="gstablet";break}zeQuery("#"+objID).removeClass("gwS gwL");zeQuery("#"+objID).removeClass("gsmobile");zeQuery("#"+objID).removeClass("gstablet");zeQuery("#"+objID).addClass(className);if(!zeQuery('.mediaElementVideoContainer:not(".ze_fixedPosition_helper")',self.$gallery).is(":visible")){return}zeQuery("#"+objID+" .vSizeWorkaround").remove();var w1=parseInt(zeQuery('.mediaElementVideoContainer:not(".ze_fixedPosition_helper")',self.$gallery).width());var h1=Math.ceil(w1/that.v_ratio);if(that.go.args.always_on_top&&that.playerIsFloating&&that.go.args.always_on_top_size_h<h1){h1=that.go.args.always_on_top_size_h}var setPercent=false;if(that.go.args.cincopaTV==true){if(that.go.args.cincopaTV==true&&!zeQuery(".netflix_popup").hasClass("gsmobile")){w1=w1*0.7;h1=h1*0.7}zeQuery("#"+objID).append('<style class="vSizeWorkaround">                div#'+objID+".netflix_popup[class*=status-]:not(.cp-fullscreen-entered) .mejs-container,div#"+objID+".netflix_popup.gsmobile[class*=status-]:not(.cp-fullscreen-entered) .mejs-container,div#"+objID+".netflix_popup.gstablet[class*=status-]:not(.cp-fullscreen-entered) .mejs-container{width:"+(setPercent?"100%":w1+"px")+" !important;height:"+h1+"px !important;}                div#"+objID+".netflix_popup:not(.cp-fullscreen-entered) .netflix_extra_container {width:"+(setPercent?"100%":w1+"px")+" !important;}                </style>")}if(typeof that.go.args.netflix_popup!="undefined"&&that.go.args.netflix_popup===true&&that.go.args.cincopaTV==false){var wnd=self.getWindow(),nh1;if(wnd.innerHeight>wnd.innerWidth){nh1=Math.min(h1,zeQuery(".mejs-container",self.$gallery).height());w1=nh1*parseFloat(zeQuery(".cp_pl_item.current",self.$gallery).data("ratio"))}else{nh1=wnd.innerHeight-zeQuery(".netflix_popup_current_title").height()-parseInt(zeQuery(".mediaElementVideoContainer").css("padding-top"));if(nh1<0){nh1=wnd.innerHeight*0.95}else{nh1=Math.min(nh1,wnd.innerHeight*0.95)}w1=nh1*parseFloat(zeQuery(".cp_pl_item.current",self.$gallery).data("ratio"));if(w1>wnd.innerWidth){nh1=Math.min(h1,zeQuery(".mejs-container",self.$gallery).height());w1=nh1*parseFloat(zeQuery(".cp_pl_item.current",self.$gallery).data("ratio"))}h1=nh1}if(zeQuery(".mediaElementVideoContainer",self.$gallery).width()<w1){setPercent=true}}else{if(typeof that.go.args.allow_lightbox!="undefined"&&that.go.args.allow_lightbox!=="no"&&zeQuery(self.$gallery).closest(".cp_lightbox_wrap").is(":visible")){var wnd=self.getWindow(),nh1;var heightForCompare;var widthForCompare;if(that.go.args.allow_lightbox_fullscreen){heightForCompare=wnd.innerHeight;widthForCompare=wnd.innerWidth}else{heightForCompare=zeQuery(self.$gallery).closest(".cp_lightbox_wrap").outerHeight();widthForCompare=zeQuery(self.$gallery).closest(".cp_lightbox_wrap").outerWidth()}if(heightForCompare>widthForCompare){nh1=Math.min(h1,zeQuery(".mejs-container",self.$gallery).height());w1=nh1*parseFloat(zeQuery(".cp_pl_item.current",self.$gallery).data("ratio"))}else{nh1=heightForCompare;if(nh1<0){nh1=heightForCompare*0.95}else{nh1=Math.min(nh1,heightForCompare*0.95)}w1=nh1*parseFloat(zeQuery(".cp_pl_item.current",self.$gallery).data("ratio"));if(w1>widthForCompare){nh1=Math.min(h1,zeQuery(".mejs-container",self.$gallery).height());w1=nh1*parseFloat(zeQuery(".cp_pl_item.current",self.$gallery).data("ratio"))}h1=Math.min(nh1,h1)}if(zeQuery(".mediaElementVideoContainer",self.$gallery).width()<w1){setPercent=true}}}if(!zeQuery("#"+objID+" .mejs-container").hasClass("mejs-container-fullscreen")){try{if(typeof that.go.args.netflix_popup!="undefined"&&that.go.args.netflix_popup===true){zeQuery("#"+objID).append('<style class="vSizeWorkaround">														div#'+objID+".netflix_popup[class*=status-]:not(.cp-fullscreen-entered) .mejs-container,div#"+objID+".netflix_popup.gsmobile[class*=status-]:not(.cp-fullscreen-entered) .mejs-container,div#"+objID+".netflix_popup.gstablet[class*=status-]:not(.cp-fullscreen-entered) .mejs-container{width:"+(setPercent?"100%":w1+"px")+" !important;height:"+h1+"px !important;}														div#"+objID+".netflix_popup:not(.cp-fullscreen-entered) .netflix_extra_container {width:"+(setPercent?"100%":w1+"px")+" !important;}													</style>")}that.player.setPlayerSize(w1,h1)}catch(ex){}try{that.player.media.setVideoSize(w1,h1)}catch(ex){}zeQuery(".mediaElementInfo_container .cp_pl_item",self.$gallery).css("height",h1)}if(that.go.args.iframe&&!disableFrameResize){that.frameResize()}that.resizePlayer();if(this.go.args.pagination_type=="prev_next"){zeQuery(".ze_grouping",this.$gallery).width(zeQuery(".mediaElement_playlist",this.$gallery).width())}var controlsH=zeQuery(".mejs-container .mejs-controls",this.$gallery).height()+5;if(zeQuery("#"+objID).width()<1000){zeQuery(".mejs-container .mejs-logo-button",this.$gallery).css({width:this.go.args.watermark_size+"%",height:"auto","max-width":"100%",bottom:controlsH+"px","max-width":"200px"})}else{zeQuery(".mejs-container .mejs-logo-button",this.$gallery).css({width:this.go.args.watermark_size+"%",height:"auto","max-width":"100%",bottom:controlsH+"px","max-width":"200px"})}if(this.go.args.always_on_top){this.resizeAlwaysOnTop()}this.loadPlaylistThumbs();zeQuery(".ze_flexslider",this.$gallery).each(function(){var w=zeQuery(this).width();var itemMargin=parseInt(zeQuery(this).find("ul.slides>li").first().css("margin-right"));var itemsW=zeQuery(this).find("ul.slides>li").first().width()+itemMargin;var itemCount=zeQuery(this).find("ul.slides>li").length;if((itemCount*itemsW)-itemMargin>w){zeQuery(this).removeClass("ze_flexslider_hide_arrows")}else{zeQuery(this).addClass("ze_flexslider_hide_arrows")}});if(zeQuery(".playlistContainer",this.$gallery).get(0)&&zeQuery(".mediaElement_playlist",this.$gallery).get(0)){if(zeQuery(".mediaElement_playlist",this.$gallery).get(0).scrollWidth<zeQuery(".playlistContainer",this.$gallery).get(0).scrollWidth){zeQuery(".mediaElement_playlist",this.$gallery).addClass("mediaElement_playlist_with_scroll")}else{zeQuery(".mediaElement_playlist",this.$gallery).removeClass("mediaElement_playlist_with_scroll")}}if(this.go.args.course_progress){setTimeout(function(){that.playlistHeight(true)},200)}var controlsHeight=zeQuery(".mejs-controls",this.$gallery).height();zeQuery(".mejs-controls-audio-helper",self.$gallery).css("height",controlsHeight);zeQuery("#"+objID+" .mejs-container video").trigger("resizeComplete."+self.gallery_id)};this.loadPlaylistThumbs=function(){zeQuery(".mustThumbLoad",this.$gallery).each(function(){if(!zeQuery(this).hasClass("mustThumbLoad")){return true}if(zeQuery(this).is(":visible")){var src=zeQuery(this).attr("data-image-src");zeQuery(this).attr("src",src).on("load."+self.gallery_id,function(){var ratio=this.naturalWidth/this.naturalHeight;if(ratio<1){zeQuery(this).addClass("cp-image-portrait")}else{zeQuery(this).addClass("cp-image-landscape")}});zeQuery(this).attr("src",zeQuery(this).attr("data-image-src"));zeQuery(this).removeClass("mustThumbLoad")}})};this.getBeautyNameOfTag=function(tag){var group_video_tag=this.go.args.group_video_tag||"";var beauty=tag;var splitted=group_video_tag.split(",");for(var i=0;i<splitted.length;i++){if(splitted[i].split("(")[0]===tag&&splitted[i].split("(")[1]){beauty=splitted[i].split("(")[1].replace(")","");break}}if(beauty===tag&&beauty==="no-tag"){beauty="untagged"}return beauty};this.resizeForm=function(){var that=this;var objID=this.go.loaderParams._object;var overlay_div=zeQuery("#"+objID+".cp_form_opened #ze_htmloverlay_placeholder_"+objID+" .ze_overlay_container_div_content");if(!overlay_div.get(0)){return}var w1=parseInt(zeQuery('.mediaElementVideoContainer:not(".ze_fixedPosition_helper")',self.$gallery).width());var h1=Math.ceil(w1/that.v_ratio);if(that.go.args.always_on_top&&that.playerIsFloating&&that.go.args.always_on_top_size_h<h1){h1=that.go.args.always_on_top_size_h}h1=Math.max(overlay_div.get(0).scrollHeight,h1);if(!zeQuery("#"+objID+" .mejs-container").hasClass("mejs-container-fullscreen")){try{that.player.setPlayerSize(w1,h1);that.player.setPlayerSize(w1,h1)}catch(ex){}try{that.player.media.setVideoSize(w1,h1)}catch(ex){}zeQuery(".mediaElementInfo_container .cp_pl_item",self.$gallery).css("height",h1)}};this.startMediaElement=function(firstRatio,length){var objID=this.go.loaderParams._object;var that=this;var mediaElement_futures=[];if(that.go.args.linertvhelper){mediaElement_futures.push("linertvhelper")}mediaElement_futures.push("playlistfeature");mediaElement_futures.push("eventscontrol");if(that.go.args.vast){mediaElement_futures.push("vast")}var order_buttons=that.go.args.controls_order.split(",");order_buttons.push("airplay_logo");for(var i=0;i<order_buttons.length;i++){order_buttons[i]=order_buttons[i].trim();if(order_buttons[i]=="prevtrack"){if(that.go.args.prev_button&&length>1){mediaElement_futures.push("prevtrack")}}else{if(order_buttons[i]=="playpause"){if(that.go.args.play_button){mediaElement_futures.push("playpause")}}else{if(order_buttons[i]=="nexttrack"){if(that.go.args.next_button&&length>1){mediaElement_futures.push("nexttrack")}}else{if(order_buttons[i]=="loop"){if(that.go.args.loop_button){mediaElement_futures.push("loopbutton")}}else{if(order_buttons[i]=="shuffle"){if(that.go.args.shuffle_button){mediaElement_futures.push("shuffle")}}else{if(order_buttons[i]=="playlist"){if(that.go.args.playlist_button&&that.go.args.playlist_show){mediaElement_futures.push("playlist")}}else{if(order_buttons[i]=="progress"){if(that.go.args.seekingBar){mediaElement_futures.push("progress")}}else{if(order_buttons[i]=="time"){if(that.go.args.timeControl){mediaElement_futures.push("current","duration")}}else{if(order_buttons[i]=="volume"){if(that.go.args.volume_slider){mediaElement_futures.push("volume")}}else{if(order_buttons[i]=="fullscreen"){if(that.go.args.fullscreen_button){mediaElement_futures.push("fullscreen")}}else{if(order_buttons[i]=="logo"){if(that.go.args.watermark_on_off){mediaElement_futures.push("logo")}}else{if(order_buttons[i]=="player_logo"){if(that.go.args.player_watermark!=""&&eval(that.go.args.player_watermark_on_off)){mediaElement_futures.push("player_logo")}}else{if(order_buttons[i]=="chromecast_logo"){mediaElement_futures.push("chromecast_logo")}else{if(order_buttons[i]=="airplay_logo"){mediaElement_futures.push("airplay_logo")}}}}}}}}}}}}}}}if(that.isLive){mediaElement_futures.push("liveButton")}if(that.go.args.audio_jump){mediaElement_futures.push("audio_jump")}mediaElement_futures.push("annotation");if(that.go.args.css_version=="1.1"){if(that.go.args.chapter){mediaElement_futures.push("chapter")}if(that.go.args.gear_button){mediaElement_futures.push("gear")}if(that.go.args.download_button){mediaElement_futures.push("download")}}else{if(that.go.args.speed){mediaElement_futures.push("speed")}}if(that.go.args.storyboard!="off"){mediaElement_futures.push("storyboard")}if(that.go.args.videoTrim){mediaElement_futures.push("videotrim")}if(that.go.args.subtitle||that.go.args.subtitle_list){mediaElement_futures.push("trackshelper");mediaElement_futures.push("tracks");mediaElement_futures.push("captions_size")}if(that.go.args.transcript_search==true||that.go.args.transcript_search=="true"){mediaElement_futures.push("transcript_search")}if(false&&that.go.args.upnext){mediaElement_futures.push("upnext")}var w=parseInt(zeQuery(".mediaElementVideoContainer",self.$gallery).width());var h=parseInt(zeQuery(".mediaElementVideoContainer",self.$gallery).width()/firstRatio);that.v_ratio=firstRatio;var resizeTimer;var winSelector=that.getWindow();var screenHeight=winSelector.innerHeight;if(h>screenHeight*80/100&&firstRatio<1){that.v_ratio=16/9;h=parseInt(w/that.v_ratio);if(that.videoCount==1&&!that.go.args.netflix_popup&&!that.go.args.cincopaTV){h=screenHeight*0.8;w=parseInt(h*firstRatio);zeQuery(".mediaElementVideoContainer",self.$gallery).css("max-width",w);zeQuery(".mediaElementVideoContainer",self.$gallery).addClass("singlePortraitVideo");that.v_ratio=w/h}}var forceNativeControls=true;var playlistAtEnd=false;if(typeof that.go.args.youtube_like!="undefined"){if(that.go.args.youtube_like!="no"&&that.isIOS==true){forceNativeControls=false}if(that.go.args.youtube_like!="no"){playlistAtEnd=true}}if(this.go.args.html_overlay_type!="none"||!this.go.args.forceNativeVideo||this.go.args.subtitle||this.go.args.subtitle_list||this.useMailService||this.annotationExists()){forceNativeControls=false}var mode="";if(this.go.args.vast_useFlash==true){mode="auto_plugin"}else{mode="auto"}mediaElement_futures.push("controlscontrol");mediaElement_futures.push("adjustplayerfontsize");if(this.go.args.newMobileControls==true||this.go.args.newMobileControls=="true"&&!self.isLive){mediaElement_futures.push("mobilevideocontrols")}if(this.go.args.smoothvideochange){mediaElement_futures.push("smoothvideochange")}mediaElement_futures.push("cp_media_helper");mediaElement_futures.push("videodecrypt");mediaElement_futures.push("fullScreenCotrols");if(this.go.args.videoMenu==true||this.go.args.videoMenu=="true"){mediaElement_futures.push("videoMenu")}var mediaElement_options={enablePluginSmoothing:true,enablePseudoStreaming:true,pluginPath:that.go.skinPath+"js/",pauseOtherPlayers:that.go.args.pauseOtherPlayers?true:false,mode:mode,iPadUseNativeControls:forceNativeControls,iPhoneUseNativeControls:forceNativeControls,AndroidUseNativeControls:forceNativeControls,defaultVideoWidth:w,defaultVideoHeight:h,videoWidth:w,videoHeight:h,features:mediaElement_futures,alwaysShowControls:!that.go.args.controlbar_autohide,skin:that,vastAdTagUrl:that.go.args.vast,defaultSeekForwardInterval:function(media){return 5},defaultSeekBackwardInterval:function(media){return 5},shuffle:that.go.args.shuffle,playlist:(that.go.args.inline_plist&&that.go.args.playlist_show),loop:that.go.args.loop_button,playlistposition:"bottom",galleryId:objID,skinObject:that,dataCollector:"currentplayingvideourl",playlistAtEnd:playlistAtEnd,translationSelector:true,startLanguage:"en",autoRewind:false,css_version:that.go.args.css_version?that.go.args.css_version:"",logo:{text:"Watermark",watermark_text:that.go.args.watermark_text,watermark_text_position_interval:that.go.args.watermark_text_position_interval,watermark_text_color:that.go.args.watermark_text_color,watermark_text_font:that.go.args.watermark_text_font,watermark_text_size:that.go.args.watermark_text_size,watermark_text_opacity:that.go.args.watermark_text_opacity,img:that.go.args.watermark,position:that.go.args.watermark_position,link:that.go.args.watermark_link_enable===true||that.go.args.watermark_link_enable==="true"?that.go.args.watermark_link:"",new_page:that.go.args.new_page,iframe:that.go.args.iframe},player_logo:{text:"Player Watermark",img:that.go.args.player_watermark,on_off:that.go.args.player_watermark_on_off,link:that.go.args.player_watermark_link_enable===true||that.go.args.player_watermark_link_enable==="true"?that.go.args.player_watermark_link:"",new_page:that.go.args.player_watermark_new_page,iframe:that.go.args.iframe},chromecast_logo:{text:"ChromeCast",img:that.go.skinPath+"css/images/chromecast_btn.png"},floatTimeAlways:true,vastpreroll:that.go.args.vastpreroll,success:function(mediaElement,domObject,mElem){if(self.videoThumbnail){zeQuery(".mejs-poster",self.$gallery).append(self.videoThumbnail.$video);zeQuery(".mejs-poster",self.$gallery).append(self.videoThumbnail.$unmuteBtn)}if((self.go.args.forceNativeFullScreen=="true"||self.go.args.forceNativeFullScreen==true)&&self.isIOS){zeQuery(".mejs-container",self.$gallery).attr("data-forcenativefullscreen",true)}if(zeQuery(".mediaElementInfo_container",self.$gallery).length){var mediaElementInfoClone=zeQuery(".mediaElementInfo_container",self.$gallery).clone();mediaElementInfoClone.prepend('<div class="cp_download_placeholder cp-hide"></div>');mediaElementInfoClone.appendTo(zeQuery(".mediaElementVideoContainer ",self.$gallery)).addClass("mediaElement_video_info");var videoInfoStyle="div#"+objID+" .mediaElementInfo_container.mediaElement_video_info{display:none !important;}";zeQuery("#"+objID+" style").prepend(videoInfoStyle)}if(parseInt(zeQuery(".mejs-controls",self.$gallery).css("padding"))!=0){zeQuery(".mejs-controls",self.$gallery).addClass("fixControls")}zeQuery(".mejs-overlay-button",self.$gallery).addClass("mejs-overlay-button-hidden");zeQuery(".mejs-container",self.$gallery).addClass("fullVideoStyle");if(zeQuery("#mediaElement"+objID+" .playlistContainer .current").data("ovveride")==false){if(zeQuery("#mediaElementVideoContainer"+objID+" .mejs-container").length){zeQuery("#mediaElementVideoContainer"+objID+" .mejs-container").prepend('<img class="imageHelper" src="'+zeQuery("#mediaElement"+objID+" .playlistContainer .current").data("url")+'" style="max-width: 100%; max-height: 100%;  width: auto; height: auto;"/>');zeQuery(domObject).parents(".mejs-inner").hide()}else{zeQuery("#mediaElementVideoContainer"+objID).prepend('<img class="imageHelper" src="'+zeQuery("#mediaElement"+objID+" .playlistContainer .current").data("url")+'" style="max-width: 100%; max-height: 100%;  width: auto; height: auto;"/>');zeQuery(domObject).hide()}}mElem.container.bind("controlsshown",function(){mElem.container.removeClass("mejs-hovered")}).bind("controlshidden",function(){mElem.container.addClass("mejs-hovered")});if(that.go.args.share||that.go.args.download_button){var share_block=zeQuery("<div>").addClass("share-layer-wrap");if(that.go.args.share){share_block.append(zeQuery("<div>").addClass("share-button"))}zeQuery("#mediaElementVideoContainer"+objID).find(".mejs-layers").append(share_block)}zeQuery(".mejs-container",self.$gallery).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",function(){if(that.isIOS!=true){return true}if(!that.currentPlayerHeight){that.currentPlayerHeight=zeQuery("#mediaElementVideo"+objID).height()}if(that.currentPlayerHeight&&that.currentPlayerHeight<=zeQuery("#mediaElementVideo"+objID).height()){that.changeLevel();that.currentPlayerHeight=zeQuery("#mediaElementVideo"+objID).height()}});if(that.go.args.subtitle||that.go.args.subtitle_list){if(zeQuery("a.cp_pl_item.current",self.$gallery).length){that.findCurrentSubtitle(zeQuery("a.cp_pl_item.current",self.$gallery).data("index"),that.currentCategory)}else{that.findCurrentSubtitle(zeQuery("a.cp_pl_item:first",self.$gallery).data("index"),that.currentCategory)}}if(!that.go.args.subtitle){zeQuery(".mejs-captions-button",self.$gallery).addClass("mejs-captions-button-hidden")}if(self.userInteraction==true&&that.isMobile&&self.go.args.autostart!="muted"){mediaElement.muted=false}else{if(self.go.args.autostart===true&&that.isMobile||self.go.args.autostart==="muted"){var unmuteBtn=zeQuery("<div>").addClass("unmute-button");unmuteBtn.html("<div class='unmute-button-speaker'><span></span></div><span>"+(that.isMobile?"Tap for sound":"Click for sound")+"</span>");unmuteBtn.on("click."+self.gallery_id,function(){if(mediaElement.muted){mediaElement.muted=false}unmuteBtn.remove()});zeQuery(".mejs-layers",self.$gallery).append(unmuteBtn)}}that.go.playerAPI={goTo:function(index,callback){var objID=that.go.loaderParams._object;var isNumber=false;if(isNaN(index)==false){index=parseInt(index)-1;isNumber=true}if(isNumber){if(zeQuery("#"+objID+" .cp_pl_item[data-share ="+index+"]").length){zeQuery("#"+objID+" .cp_pl_item[data-share ="+index+"]")[0].click()}else{if(zeQuery("#"+objID+" .cp_pl_item[data-index ="+index+"]").length){zeQuery("#"+objID+" .cp_pl_item[data-index ="+index+"]")[0].click()}}}else{if(zeQuery("#"+objID+" .cp_pl_item[data-rid ="+index+"]").length){zeQuery("#"+objID+" .cp_pl_item[data-rid ="+index+"]")[0].click()}}if(typeof callback=="function"){if(!that.checkIsCasting()){mediaElement.cincopaAddEventListener("loadeddata",function(){callback(index)},{once:true})}else{var callbackCalled=false;that.currentCastMedia().addUpdateListener(function(e){if(!callbackCalled){callbackCalled=true;callback(index)}})}}},play:function(){if(!that.checkIsCasting()){mediaElement.play()["catch"](function(err){_trace(err+"Video Playing error")})}else{try{that.checkIsCasting()&&that.currentCastMedia()&&that.currentCastMedia().play();mediaElement.pause()}catch(ex){_trace("Video Playing error chormecast "+ex)}}},pause:function(){if(!that.checkIsCasting()){clearTimeout(that.autoStartTimeout);mediaElement.pause();delete that.autoStartTimeout}else{try{that.checkIsCasting()&&that.currentCastMedia()&&that.currentCastMedia().pause()}catch(ex){_trace("Video Playing error chormecast "+ex)}}},setCurrentTime:function(time){if(!that.checkIsCasting()){zeQuery(".mejs-poster",self.$gallery).hide();mediaElement.setCurrentTime(time)}else{try{var request=new chrome.cast.media.SeekRequest();request.currentTime=time;if(that.currentCastMedia()){that.currentCastMedia().seek(request)}}catch(ex){console.log(ex)}}},duration:function(){return mediaElement.duration},currentTime:function(){return mediaElement.currentTime},isPaused:function(){return mediaElement.paused},playlistAppend:function(item){that.go.MediaJSON.items.push(item);var content_url=that.getContentUrl(item);var posterURL=decodeXml(that.getThumbnailUrl(item,that.go.args.netflix_popup?4:null));var logo_url=that.getThumbnailUrl(item,3);var video_duration="";if(item.duration){video_duration=that.stringToSec(item.duration.substring(0,8))}var i=that.go.MediaJSON.items.length-1;var tracksSource=self.getTracksSource(item,i);if(tracksSource!="none"){zeQuery(mediaElement).append(tracksSource)}var playlistItemHtml='<a href="javascript:void(0)"                                data-ovveride="true"                                data-rid="'+item.rid+'"                                data-ratio="'+(item.aspect_ratio==undefined?1.33:item.aspect_ratio)+'"                                data-url="'+decodeXml(content_url)+'"                                data-poster="'+posterURL+'"                                id="'+that.go.loaderParams._object+"_playlist["+i+']"                                class="cp_pl_item"                                data-storage="'+that.video_is_type_stored(item)+'"                                data-index="'+i+'" ><div class="pl_item_thumb"><img class="mustThumbLoad" data-image-src="'+logo_url+'" src="'+logo_url+'" /></div><div class="pl_item_name "><span>'+item.title+'</span></div><div class="pl_item_description">'+item.description.replace("<","&lt;").replace(">","&gt;")+'</div><div class="pl_item_duration" style="display:none;">'+video_duration+"</div></a>";zeQuery(".playlistContainer",that.$gallery).append(playlistItemHtml);var playlistMejsItemHtml='<li                                    data-url="'+decodeXml(content_url)+'"                                    title="'+item.title+'"                                    data-rid="'+item.rid+'"                                    data-index="'+i+'"                                    data-thumbnail="'+logo_url+'">                                </li>';zeQuery(".mejs-playlist .mejs",that.$gallery).append(playlistMejsItemHtml);mElem.rebuildtrackshelper();mElem.rebuildtracks();setTimeout(function(){zeQuery(that.getWindow()).trigger("resize.mediaelement")},100)},playlistRemove:function(index){var objID=that.go.loaderParams._object;var playlistArray=that.go.MediaJSON.items;var isNumber=false;if(isNaN(index)==false){index=parseInt(index)-1;isNumber=true}if(isNumber){if(zeQuery("#"+objID+" track[data-index ="+index+"]").length){zeQuery("#"+objID+" track[data-index ="+index+"]").remove()}if(zeQuery("#"+objID+" .cp_pl_item[data-share ="+index+"]").length){zeQuery("#"+objID+" .cp_pl_item[data-share ="+index+"]").remove();zeQuery("#"+objID+" .mejs-playlist .mejs li[data-share ="+index+"]").remove()}else{if(zeQuery("#"+objID+" .cp_pl_item[data-index ="+index+"]").length){zeQuery("#"+objID+" .cp_pl_item[data-index ="+index+"]").remove();zeQuery("#"+objID+" .mejs-playlist .mejs li[data-index ="+index+"]").remove()}}playlistArray.splice(index,1)}else{if(zeQuery("#"+objID+" track[data-rid ="+index+"]").length){zeQuery("#"+objID+" track[data-rid ="+index+"]").remove()}if(zeQuery("#"+objID+" .cp_pl_item[data-rid ="+index+"]").length){var currentItemRid=zeQuery("#"+objID+" .cp_pl_item[data-rid ="+index+"]").data("rid");zeQuery("#"+objID+" .cp_pl_item[data-rid ="+index+"]").remove();zeQuery("#"+objID+" .mejs-playlist .mejs li[data-rid ="+index+"]").remove()}that.go.MediaJSON.items=playlistArray.filter(function(el){return el.rid!=currentItemRid})}zeQuery(".playlistContainer .cp_pl_item",that.$gallery).each(function(index,el){zeQuery(el).attr("data-index",index)});zeQuery(".mejs-playlist .mejs li",that.$gallery).each(function(index,el){zeQuery(el).attr("data-index",index)});var indexToSet=-1,currentIndex=-1;zeQuery("track",that.$gallery).each(function(index,el){if(currentIndex!=parseInt(zeQuery(el).attr("data-index"))){currentIndex=parseInt(zeQuery(el).attr("data-index"));indexToSet++}zeQuery(el).attr("data-index",indexToSet);zeQuery(el).attr("srclang",zeQuery(el).attr("data-type")+"_"+indexToSet)});mElem.rebuildtrackshelper();mElem.rebuildtracks();setTimeout(function(){zeQuery(that.getWindow()).trigger("resize.mediaelement")},100)},enterFullScreen:function(){var onfullscreenerror=function(e){that.go.playerAPI.enterFullScreen.fail=true;that.player.exitFullScreen();if(!that.go.playerAPI.enterFullScreen.click){bindClickEventForFullScreen()}};if(!that.go.playerAPI.enterFullScreen.binded){document.cincopaAddEventListener("fullscreenerror",onfullscreenerror);document.cincopaAddEventListener("mozfullscreenerror",onfullscreenerror);document.cincopaAddEventListener("webkitfullscreenerror",onfullscreenerror);that.go.playerAPI.enterFullScreen.binded=true}var bindClickEventForFullScreen=function(){zeQuery("#"+that.go.loaderParams._object).find(".mejs-overlay-button").on("click."+self.gallery_id,function(){if(that.go.playerAPI.enterFullScreen.fail){that.player.enterFullScreen()}that.go.playerAPI.enterFullScreen.click=true})};that.player.enterFullScreen()},exitFullScreen:function(){that.go.playerAPI.enterFullScreen.fail=false;if(that.isIOS){try{mediaElement.webkitExitFullscreen()}catch(ex){console.log(ex)}}else{that.player.exitFullScreen()}},isFullScreen:function(){if(that.isIOS){return mediaElement.webkitDisplayingFullscreen}return that.player.isFullScreen},playNext:function(){that.player.playNextTrack(that.player,true)},playPrev:function(){that.player.playPrevTrack(that.player)},setVolume:function(volume){volume=parseInt(volume)/100;volume=volume>1?1:volume;mediaElement.setVolume(volume)},stopVideo:function(){that.player&&that.player.$media[0].stop()},getPlayerContainer:function(){return that.player.container&&that.player.container.get(0)},getLayersContainer:function(){return that.player.layers&&that.player.layers.get(0)},getControlsContainer:function(){return that.player.controls&&that.player.controls.get(0)},getVideoElement:function(){return that.player.container&&that.player.container.find("video").get(0)},getCurrentPlayingUrl:function(){if(that.player.container&&that.player.container.find("video")){return that.player.container.find("video").data("currentplayingvideourl")||that.player.container.find("video").attr("src")}},hideControls:function(){that.player.container&&that.player.container.addClass("cp_hide_all_controls")},showControls:function(){that.player.container&&that.player.container.removeClass("cp_hide_all_controls")},addLayer:function(name,html){if(!name||!that.player.layers){return}if(that.player.layers.find("."+name+"-layer").length){return}var layer=zeQuery("<div>").addClass(name+"-layer");if(html){if(html instanceof HTMLElement){layer.html(zeQuery(html))}else{layer.html(html)}}that.player.layers&&that.player.layers.append(layer)},removeLayer:function(name){if(!name||!that.player.layers){return}that.player.layers.find("."+name+"-layer").remove()},getLayer:function(name){if(!name||!that.player.layers){return}return that.player.layers.find("."+name+"-layer").get(0)},getPlaylistItems:function(name){return zeQuery("#"+that.go.loaderParams._object).find(".playlistContainer .cp_pl_item").toArray()},toggleMute:function(command){var videoElement=that.go.playerAPI.getVideoElement();if(command==="mute"){videoElement.muted=true}else{videoElement.muted=false}},lastSubtitle:"",subtitleToggle:function(command){var controlsContainer=that.go.playerAPI.getControlsContainer();var subtitleListContainer=controlsContainer.getElementsByClassName("mejs-captions-list");if(command==="on"){if(!zeQuery(subtitleListContainer).find('input[value="none"]').is(":checked")){return false}var firstSubtitle=zeQuery(subtitleListContainer).find("input").first();if(firstSubtitle.length&&firstSubtitle.parent().attr("data-type")){firstSubtitle=firstSubtitle.parent().attr("data-type").replace("subtitle-","")}else{firstSubtitle=""}that.go.playerAPI.selectSubtitle(that.go.playerAPI.lastSubtitle||firstSubtitle)}else{if(command==="off"){that.go.playerAPI.selectSubtitle("none")}}},selectSubtitle:function(language){var controlsContainer=that.go.playerAPI.getControlsContainer();var subtitleListContainer=controlsContainer.getElementsByClassName("mejs-captions-list");var subtitleForLanguage;if(language==="none"){subtitleForLanguage=zeQuery(subtitleListContainer).find('input[value="none"]').parent()}else{subtitleForLanguage=zeQuery(subtitleListContainer).find('li[data-type = "subtitle-'+language+'"]')}if(subtitleForLanguage.length&&subtitleForLanguage.find("label").length){var selectedSubtitle=zeQuery(subtitleListContainer).find("input:checked");if(selectedSubtitle.length&&selectedSubtitle.parent().attr("data-type")){selectedSubtitle=selectedSubtitle.parent().attr("data-type").replace("subtitle-","")}else{selectedSubtitle=""}that.go.playerAPI.lastSubtitle=selectedSubtitle;subtitleForLanguage.find("label")[0].click()}},goToChapter:function(index){if(index>0){index--}var chapterEl;if(that.player.container){chapterEl=that.player.container.find(".mejs-chapters-list li").eq(index)}chapterEl.length&&chapterEl.click();if(that.checkIsCasting()&&that.currentCastMedia()&&chapterEl.length){var seconds=hmsToSecondsOnly(chapterEl.data("time"));if(that.currentCastMedia().playerState=="PLAYING"){setTimeout(function(){that.go.playerAPI.setCurrentTime(seconds)},1000)}else{var interval=setInterval(function(){if(that.currentCastMedia()&&that.currentCastMedia().playerState=="PLAYING"){that.go.playerAPI.setCurrentTime(seconds);clearInterval(interval)}},1000)}}},playCurrent:function(){var objID=that.go.loaderParams._object;if(zeQuery("#"+objID+" .cp_pl_item.current")&&zeQuery("#"+objID+" .cp_pl_item.current").data("url")&&mediaElement.src!==zeQuery("#"+objID+" .cp_pl_item.current").data("url")){mediaElement.src=zeQuery("#"+objID+" .cp_pl_item.current").data("url")}mediaElement.play()["catch"](function(err){_trace(err+"Video Playing error")})},playbackSpeed:function(speed){if(!speed){return}mediaElement.playbackRate=parseFloat(speed)}};if(that.go.args.iframe){that.frameResize()}var clickedTime=null,videoHasPlayed=false;zeQuery(".ze_tl_block  a.tl_item",self.$gallery).on("click."+self.gallery_id,function(){var tlSecond=parseInt(zeQuery(this).attr("data-time"));clickedTime=tlSecond;videoHasPlayed=false;if(self.player.media.paused){mediaElement.play()["catch"](function(err){_trace(err+"Video Playing error")})}});var videoSrc=zeQuery(".cp_pl_item[data-url]",self.$gallery).first().attr("data-url");var sendedData=that.sendDataCollector(videoSrc);that.player=mElem;if(!playlistAtEnd||that.go.args.autostart){if(!that.advertising){if(!zeQuery.isEmptyObject(sendedData.item.versions)||sendedData.item.content_real_type=="live"){if(that.videoThumbnail&&that.go.args.allow_lightbox=="no"){that.playHLS(mediaElement,sendedData,that.go.args.autostart===true||(that.go.args.autostart==="desktop_only"&&!that.isMobile)||that.go.args.autostart==="muted")}else{that.playHLS(mediaElement,sendedData,that.go.args.autostart===true||(that.go.args.autostart==="desktop_only"&&!that.isMobile)||that.go.args.autostart==="muted")}}else{that.go.onSkinEvent("video.load",sendedData)}}that.canSendPlay=true}if(that.go.args.embed_code){var embed_block='<p class="share-title">Embed</p><p class="share-link embed-link"></p>';zeQuery("#mediaElementVideoContainer"+objID).find(".share-icons").after(embed_block)}zeQuery(".ze_tl_block ul li a",self.$gallery).removeClass("selected");that.adjustControls();var oldSecValue=-1;mediaElement.cincopaAddEventListener("timeupdate",function(e){var duration=e.target.duration;if(self.advertising){return}if(self.isLive){self.setStreamStoppedTimer()}var activeTlBlock=zeQuery(".ze_tl_block ul.active",self.$gallery),ct=~~mediaElement.currentTime;var allChapters=zeQuery(".mejs-chapters-list li");allChapters.each(function(i,chapter){var time=zeQuery(chapter).data("time");time=time.split(":");var seconds=(+time[0])*60*60+(+time[1])*60+(+time[2]);if(ct===seconds){zeQuery(chapter).css("font-weight","bold")}else{zeQuery(chapter).css("font-weight","normal")}});var children=activeTlBlock.children();for(var i=children.length-1;i>=0;i--){if(zeQuery(children[i]).find("a").attr("data-time")<=ct){activeTlBlock.find("li a.selected").removeClass("selected");zeQuery(children[i]).find("a").addClass("selected");break}}var current_url=zeQuery(mediaElement).data("currentplayingvideourl")||mediaElement.src;if(!videoHasPlayed&&clickedTime!=null){self.player.setCurrentTime(clickedTime);clickedTime=null;videoHasPlayed=true}if(oldSecValue===-1&&that.seeked&&ct>0){mediaElement.play()}if(self.advertising||!that.loaded||that.seeked){return false}var labelType=mediaElement.tagName.toLowerCase();var sendData=that.sendDataCollector(current_url);if(ct!=oldSecValue&&!that.videoEnded){oldSecValue=ct;if(ct%1==0){sendData.second=ct;that.go.onSkinEvent("video.timeupdate",sendData);if(sendData.item&&sendData.item.timeline){var toct=toHHMMSS(ct);var chpt=zeQuery(".ze_tl_chapter_section[data-time='"+toct+"']",self.$gallery);if(chpt.length){sendData.chapter={second:ct,title:chpt.find(".ze_tl_chapter_title").text(),description:chpt.find(".ze_tl_chapter_description").text()};that.go.onSkinEvent("chapter.view",sendData)}}}}},false);mediaElement.cincopaAddEventListener("seeked",function(e){if(!that.loaded||that.sendPause){return}var ct=~~mediaElement.currentTime;var current_url=zeQuery(mediaElement).data("currentplayingvideourl")||mediaElement.src;var sendData=that.sendDataCollector(current_url);if(ct!=oldSecValue&&!that.videoEnded){oldSecValue=ct;if(ct%1==0){sendData.second=ct;sendData.state="seeked";that.go.onSkinEvent("video.timeupdate",sendData);that.seeked=false}}});mediaElement.cincopaAddEventListener("error",function(e){var current_url=zeQuery(mediaElement).data("currentplayingvideourl")||mediaElement.src;var sendData=that.sendDataCollector(current_url);var errData={};if(e.target.error){errData.code=e.target.error.code;switch(e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:errData.message="You aborted the video playback.";break;case e.target.error.MEDIA_ERR_NETWORK:errData.message="A network error caused the video download to fail part-way.";break;case e.target.error.MEDIA_ERR_DECODE:errData.message="The video playback was aborted due to a corruption problem or because the video used features your browser did not support.";break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:errData.message="The video could not be loaded, either because the server or network failed or because the format is not supported.";break;default:errData.message="An unknown error occurred.";break}sendData.error=errData;that.go.onSkinEvent("video.error",sendData)}});mediaElement.cincopaAddEventListener("waiting",function(){zeQuery(".mejs-overlay-loading",self.$gallery).parent().addClass("cp-hide");var current_url=zeQuery(mediaElement).data("currentplayingvideourl")||mediaElement.src;var itemIndex=zeQuery('.cp_pl_item[data-url="'+current_url+'"]',self.$gallery).attr("data-index");var prePostroll=self.getItems()[+itemIndex]?self.getItems()[+itemIndex].prepostrollVideo:false;(function(prePost){setTimeout(function(){if(!prePost){zeQuery(".mejs-overlay-loading",self.$gallery).parent().removeClass("cp-hide")}},1000)})(prePostroll)},false);mediaElement.cincopaAddEventListener("seeking",function(){zeQuery(".mejs-overlay-loading",self.$gallery).parent().addClass("cp-hide");setTimeout(function(){zeQuery(".mejs-overlay-loading",self.$gallery).parent().removeClass("cp-hide")},1000)},false);mediaElement.cincopaAddEventListener("canplay",function(e){if(!that.go.args.autostart&&typeof that.playing=="undefined"){zeQuery(".mejs-overlay-play",self.$gallery).show()}});mediaElement.cincopaAddEventListener("loadedmetadata",function(e){var duration=mediaElement.duration;var current_url=zeQuery(mediaElement).data("currentplayingvideourl")||mediaElement.src;var timePxSize=zeQuery(".mejs-time-total",self.$gallery).width()/duration;var ct=~~mediaElement.currentTime;if(self.tl_storyboard){zeQuery(".tl_section",self.$gallery).remove();zeQuery(".ze_tl_block ul.active li").each(function(){var tlTime=zeQuery(this).children("a").attr("data-time");var sectionLeft=parseInt(tlTime)*timePxSize;var sectionInfo=zeQuery(this).find(".ze_tl_infoblock").html();var tlSection='<div data-time="'+tlTime+'" class="tl_section" style="left:'+sectionLeft+'px;"><div class="tl_section_info">'+sectionInfo+"</div></div>";zeQuery("#mediaElementVideoContainer"+objID+" .mejs-controls .mejs-time-rail").prepend(tlSection)});zeQuery("#"+objID+" .mejs-time-rail .tl_section",this.$gallery).on("click."+self.gallery_id,function(){var tlSecond=parseInt(zeQuery(this).attr("data-time"));if(self.player.media.paused){mediaElement.play()["catch"](function(err){_trace(err+"Video Playing error")})}self.player.setCurrentTime(tlSecond)})}if((!that.isMobile||that.isIpad||that.go.args.always_on_top_mobile)&&that.go.args.always_on_top){that.alwaysOnTop()}zeQuery(".mejs-logo-button",that.$gallery).show();if(that.go.args.cincopaTV){zeQuery(".playlistContainer .cincopatv-showinupnext",that.$gallery).removeClass("cincopatv-showinupnext");var curreentParrent=zeQuery(".playlistContainer a.cp_pl_item.current",that.$gallery).closest("li");curreentParrent.nextAll("*:lt(3)").addClass("cincopatv-showinupnext")}});setTimeout(function(){zeQuery(that.getWindow()).trigger("resize.mediaelement")},100);if(that.go.args.controlbar_autohide&&!that.isMobile){zeQuery(".mejs-container",self.$gallery).addClass("ze-autohide")}if(that.go.args.controlbar_onload==="true"){zeQuery(".mejs-container",self.$gallery).addClass("ze-show-control-bar")}else{if(that.go.args.controlbar_onload==="false"){zeQuery(".mejs-container",self.$gallery).find(".mejs-controls").addClass("make-hidden")}}if(that.go.args.timeControl){zeQuery(".mejs-container",self.$gallery).addClass("vsbl_timecontrol")}zeQuery(".mejs-overlay-loading",self.$gallery).parent().addClass("hideLoaderFix");if(that.go.args.autostart||that.playOnClick){zeQuery(".mejs-overlay-loading",self.$gallery).parent().show();if(!that.isMobile||(that.isMobile&&that.go.args.autostart===true)){zeQuery(".mejs-overlay-play",self.$gallery).hide();if(sendedData&&sendedData.item&&sendedData.item.liveid&&sendedData.item.live_status!="started"){return}that.autoStartTimeout=setTimeout(function(){mediaElement.play()["catch"](function(err){_trace(err+"Video Playing error");var posterURL=zeQuery(mediaElement).attr("data-posterURL");if(that.go.args.autostart){mediaElement.muted=true;mediaElement.play();var unmuteBtn=zeQuery("<div>").addClass("unmute-button");unmuteBtn.html("<div class='unmute-button-speaker'><span></span></div><span>"+(that.isMobile?"Tap for sound":"Click for sound")+"</span>");unmuteBtn.on("click."+self.gallery_id,function(){if(mediaElement.muted){mediaElement.muted=false}unmuteBtn.remove()});zeQuery(".mejs-layers",self.$gallery).append(unmuteBtn)}that.go.onSkinEvent("player.failed",{player:that.player,error:err,posterURL:posterURL,errorDesc:"player.failed from me success callback"})})},400)}}that.playOnClick=false;if(that.go.args.volume_level!=""){var volume=parseInt(that.go.args.volume_level)/100;volume=volume>1?1:volume;mediaElement.setVolume(volume)}if(self.go.args.postrollVideoUrl||self.go.args.prerollVideoUrl){var custemPoster=zeQuery("<div class='mejs-logo-poster'><img src='"+self.go.args.preRollPoster+"'><div>");zeQuery(".mejs-layers",self.$gallery).append(custemPoster)}mediaElement.cincopaAddEventListener("pause",function(e){var videoContainer=zeQuery(".mejs-mediaelement",self.$gallery);videoContainer.removeClass("fading");if(that.advertising){return}if(self.isLive){clearTimeout(self.streamStoppedtimer)}zeQuery("#"+objID).removeClass("status-play").addClass("status-pause");zeQuery(" a.cp_pl_item.current",self.$gallery).addClass("pause");var current_url=zeQuery(mediaElement).data("currentplayingvideourl")||mediaElement.src;var sendData=that.sendDataCollector(current_url);var ct=~~mediaElement.currentTime;var duration=~~mediaElement.duration;sendData.second=ct;if(ct!=duration){that.go.onSkinEvent("video.pause",sendData)}that.playing=false;that.canSendPlay=true;if(!zeQuery(".mejs-chapters-button",self.$gallery).hasClass("mejs-chapters-off")){zeQuery(".mejs-layers",self.$gallery).addClass("mejs-show-chapters")}zeQuery(".mejs-container",this.$gallery).trigger("mousemove")},false);mediaElement.cincopaAddEventListener("volumechange",function(e){var volume=self.player.media.volume;if(volume>0&&!self.player.media.muted){zeQuery(".unmute-button",self.$gallery).remove()}},false);mediaElement.cincopaAddEventListener("ended",function(e){zeQuery("#"+objID).addClass("status-ended");var labelType=mediaElement.tagName.toLowerCase();if(!zeQuery(".mejs-chapters-button",self.$gallery).hasClass("mejs-chapters-off")){zeQuery(".mejs-layers",self.$gallery).addClass("mejs-show-chapters")}zeQuery(".mejs-container",this.$gallery).trigger("mousemove")},false);mediaElement.cincopaAddEventListener("loadeddata",function(e){var current_url=zeQuery(mediaElement).data("currentplayingvideourl")||mediaElement.src;var sendData=self.sendDataCollector(current_url);zeQuery(self.$gallery).removeClass("cp-portrait-asset").removeClass("cp-landscape-asset");if(sendData&&sendData.item&&sendData.item.aspect_ratio){if(+sendData.item.aspect_ratio<1){zeQuery(self.$gallery).addClass("cp-portrait-asset")}else{if(+sendData.item.aspect_ratio>=2){zeQuery(self.$gallery).addClass("cp-extra-landscape-asset")}else{zeQuery(self.$gallery).addClass("cp-landscape-asset")}}}zeQuery(".videoWorkaround",self.$gallery).removeClass("videoWorkaround")},false);mediaElement.cincopaAddEventListener("seeked",function(e){},false);mediaElement.cincopaAddEventListener("playing",function(e){zeQuery(".mejs-container",self.$gallery).removeClass("cp-afterroll-callback");var current_lang=null;if(self.go.args.subtitle||self.go.args.subtitle_list){if(zeQuery.cookie("cincopavideoTrack")){var lang=zeQuery.cookie("cincopavideoTrack").substring(0,zeQuery.cookie("cincopavideoTrack").lastIndexOf("_"));zeQuery("#"+objID+" .track-current input[type='radio']").each(function(){var cur=zeQuery(this).val();if(cur.substring(0,cur.lastIndexOf("_"))==lang){zeQuery(this).trigger("click")}});if(self.player.selectedTrack&&self.go.args.subtitle){current_lang=self.player.selectedTrack.srclang;zeQuery.cookie("cincopavideoTrack",current_lang)}}else{if(self.subtitleFromList){zeQuery("#"+objID+" .track-current input[type='radio']").each(function(){var cur=zeQuery(this).val();if(cur.indexOf("subtitle-"+self.subtitleFromList)===0){self.player.trackDisableCookie=true;zeQuery(this).trigger("click");return false}})}}}});mediaElement.cincopaAddEventListener("play",function(e){var videoContainer=zeQuery(".mejs-mediaelement",self.$gallery);if(videoContainer.hasClass("fading")){setTimeout(function(){videoContainer.removeClass("fading")},1000)}setTimeout(function(){zeQuery(".mejs-overlay-loading",self.$gallery).parent().removeClass("cp-background-overlay")},1000);zeQuery(mediaElement).css("visibility","visible");that.videoPlayerStarted=true;if(that.advertising){return}that.videoEnded=false;that.loaded=true;that.playing=true;that.seeked=false;zeQuery(".mejs-overlay-loading",self.$gallery).parent().removeClass("hideLoaderFix");zeQuery(".mejs-poster-video",self.$gallery).remove();zeQuery(".mejs-poster .unmute-button",self.$gallery).remove();zeQuery("#"+objID).removeClass("status-ended");var labelType=mediaElement.tagName.toLowerCase();if(typeof self.go.args.netflix_popup!="undefined"&&self.go.args.netflix_popup){zeQuery("#"+objID.replace("cp_lightbox_wrap_obj_","")).addClass("netflix_popup_opened");zeQuery(".mediaElement_VideoOverlay",self.$gallery).addClass("netflix_popup_opened");zeQuery("#"+objID).closest(".cp_lightbox_wrap").addClass("netflix_popup_opened");var index=zeQuery('a.cp_pl_item.current:not("cp_pl_item_clone")',self.$gallery).data("share");if(self.go.args.anchor_videos!="off"&&!self.anchor_videos_only_from_chapter){self.buildChannelHashUrl("channel",index)}if(zeQuery(".netflix_close_btn",self.$gallery).length==0){var netflixCloseBtn=zeQuery('<span class="netflix_close_btn">x</span>');zeQuery(".mediaElementVideoContainer",self.$gallery).prepend(netflixCloseBtn);netflixCloseBtn.on("click."+self.gallery_id,function(){zeQuery("#"+objID).removeClass("status-ended");zeQuery(".mediaElementVideoContainer",self.$gallery).addClass("no-transition");zeQuery(".vSizeWorkaround",self.$gallery).remove();mediaElement.pause();zeQuery(".cp_pl_item_clone",self.$gallery).remove();zeQuery("#"+objID.replace("cp_lightbox_wrap_obj_","")).removeClass("netflix_popup_opened");zeQuery(".mediaElement_VideoOverlay",self.$gallery).removeClass("netflix_popup_opened");zeQuery("#"+objID).closest(".cp_lightbox_wrap").removeClass("netflix_popup_opened");zeQuery(".mediaElementVideoContainer",self.$gallery).addClass("fadeout");setTimeout(function(){zeQuery("#"+objID).removeClass("status-play").removeClass("status-pause")},300);setTimeout(function(){zeQuery(".mediaElementVideoContainer",self.$gallery).removeClass("no-transition");zeQuery(".mediaElementVideoContainer",self.$gallery).removeClass("fadeout");zeQuery("html").removeClass("cp_overflow_hidden")},350);if(self.go.args.allow_lightbox!="no"){self.buildHash("cprtstatus",self.go.loaderParams._id+"/channel/")}else{self.buildHash("cprtstatus","")}})}}else{if(self.go.args.anchor_videos!="off"&&!self.anchor_videos_only_from_chapter){var currentPlayingItem;if(zeQuery('a.cp_pl_item.current:not("cp_pl_item_clone")',self.$gallery).length){currentPlayingItem=zeQuery('a.cp_pl_item.current:not("cp_pl_item_clone")',self.$gallery)}else{currentPlayingItem=zeQuery("a.cp_pl_item:first",self.$gallery)}if(!self.go.args.netflix_popup){index=currentPlayingItem.data("rid");self.buildChannelHashUrl("channel",index)}}zeQuery(".mediaElement_VideoOverlay",self.$gallery).remove()}zeQuery(".mejs-container.ze-autohide",self.$gallery).removeClass("ze-autohide");zeQuery(".mejs-container.ze-show-control-bar",self.$gallery).removeClass("ze-show-control-bar");zeQuery(".mejs-container.ze-mobile-hide-controls",self.$gallery).removeClass("ze-mobile-hide-controls");zeQuery("a.cp_pl_item",self.$gallery).removeClass("current").removeClass("pause");var current_url=zeQuery(mediaElement).data("currentplayingvideourl")||mediaElement.src;if(self.go.args.group_by==true||self.go.args.group_by!="off"){if(self.go.args.prerollVideoUrl){zeQuery("a.cp_pl_item",self.$gallery).filter('[data-index="'+that.go.preRollIndex+'"][data-cat="'+that.currentCategory+'"]').addClass("current")}else{zeQuery("a.cp_pl_item",self.$gallery).filter('[data-url="'+current_url+'"][data-cat="'+that.currentCategory+'"]').addClass("current")}}else{if(self.go.args.prerollVideoUrl){zeQuery("a.cp_pl_item",self.$gallery).filter('[data-index="'+that.go.preRollIndex+'"]').addClass("current")}else{zeQuery("a.cp_pl_item",self.$gallery).filter('[data-url="'+current_url+'"]').addClass("current")}}if(typeof self.go.args.netflix_popup!="undefined"&&self.go.args.netflix_popup){zeQuery("html").addClass("cp_overflow_hidden");zeQuery(window).off("keyup.netflix_popup");self.onEsc.activeListener=true;zeQuery(window).on("keyup.netflix_popup."+self.gallery_id,function(e){self.onEsc(e)});var currentVideoTitle=zeQuery("a.cp_pl_item.current",self.$gallery).find(".pl_item_name").text();var nextPlayItem=zeQuery('a.cp_pl_item.current:not("cp_pl_item_clone")',self.$gallery).parents("li").next("li").find("a.cp_pl_item");if(nextPlayItem.length==0){nextPlayItem=zeQuery("a.cp_pl_item.current",self.$gallery).parents(".ze_flexslider.carousel").next(".ze_flexslider.carousel").find("a.cp_pl_item:first")}zeQuery(".netflix_extra_container",self.$gallery).remove();if(zeQuery(".netflix_extra_container",self.$gallery).length==0){if(self.go.args.audio_support&&zeQuery(".mediaElementVideoContainer ",self.$gallery).hasClass("isAudio")){zeQuery(".netflix_popup_audio_item",self.$gallery).append(zeQuery('<div class="netflix_extra_container" />'))}else{zeQuery(".mediaElement_VideoOverlay",self.$gallery).before(zeQuery('<div class="netflix_extra_container" />'))}}if(nextPlayItem.length){var nextPlayItemClone=zeQuery('<a class="cp_pl_item cp_pl_item_clone" >').html(nextPlayItem.html());nextPlayItemClone.find(".pl_item_name").wrap('<div class="pl_item_text_info"></div>');nextPlayItemClone.find(".pl_item_description").detach().appendTo(nextPlayItemClone.find(".pl_item_text_info"));nextPlayItemClone.find("> .pl_item_name").remove();var mustThumbLoadImg=nextPlayItemClone.find("img.mustThumbLoad");if(mustThumbLoadImg.length){mustThumbLoadImg.attr("src",mustThumbLoadImg.data("image-src"))}zeQuery(".cp_pl_item_clone",self.$gallery).remove();zeQuery(".netflix_extra_container",self.$gallery).append(nextPlayItemClone);nextPlayItemClone.on("click."+self.gallery_id,function(e){nextPlayItem.click();zeQuery(".mediaElementVideoContainer",self.$gallery).animate({scrollTop:0});return false})}else{zeQuery(".cp_pl_item_clone",self.$gallery).remove();zeQuery(".netflix_extra_container",self.$gallery).remove()}}var extraFileInd=zeQuery("a.cp_pl_item.current",self.$gallery).data("index");that.findCurrentSubtitle(extraFileInd,that.currentCategory);if(zeQuery("a.cp_pl_item.current",self.$gallery).hasClass("invalid_video")){that.player.playNextTrack(that.player)}zeQuery("#"+objID).removeClass("status-pause").addClass("status-play");if(typeof self.go.args.netflix_popup!="undefined"&&self.go.args.netflix_popup){self.onResize()}zeQuery(".mejs-container",self.$gallery).find(".mejs-controls").removeClass("make-hidden");var ct=~~mediaElement.currentTime;if(self.go.args.prerollVideoUrl||self.go.args.postrollVideoUrl){if(current_url.replace("&fakelastparam=ffffff","")==self.go.args.prerollVideoUrl||current_url.replace("&fakelastparam=ffffff","")==self.go.args.postrollVideoUrl){zeQuery(".share-button",self.$gallery).addClass("cp-hide");zeQuery(".mejs-container",self.$gallery).addClass("cp-hidecontrols");zeQuery(".mejs-container",self.$gallery).addClass("prepostrollVideo")}else{zeQuery(".share-button",self.$gallery).removeClass("cp-hide");zeQuery(".mejs-container",self.$gallery).removeClass("cp-hidecontrols");zeQuery(".mejs-container",self.$gallery).removeClass("prepostrollVideo")}var rollImg=zeQuery("a.cp_pl_item.current",self.$gallery).attr("data-rollImage");if(rollImg&&ct==0){setTimeout(function(){that.player.pause()},150);self.$gallery.addClass("playingLogoVideo");zeQuery(".mejs-logo-poster img",self.$gallery).attr("src",rollImg);zeQuery(".share-button",self.$gallery).addClass("cp-hide");zeQuery(".mejs-container",self.$gallery).addClass("cp-hidecontrols");zeQuery(".mejs-overlay-play",self.$gallery).addClass("cp-hide");that.rollTimer=setTimeout(function(){clearTimeout(that.rollTimer);self.go.preRollAction="next";that.player.playNextTrack(that.player);self.go.preRollAction=false},3000)}else{self.go.preRollAction=false;setTimeout(function(){self.$gallery.removeClass("playingLogoVideo")},200);if(self.go.args.postrollVideoUrl){zeQuery(".mejs-overlay-play",self.$gallery).removeClass("cp-hide")}}}if(typeof that.hls!="undefined"&&!that.hls.hlsStarted&&!that.go.args.fast_start){var videoLevel=that.getVideoLevel(that.hls.MediaJSON,that.hls);var startTime=-1;if(that.hls.MediaJSON&&that.hls.MediaJSON.item&&that.hls.MediaJSON.item.startTime){startTime=that.hls.MediaJSON.item.startTime}that.hls.hlsStarted=true;that.hls.startLoad(startTime);that.hls.MediaJSON.version=that.hls.levelController.levels[videoLevel]}var sendData=that.sendDataCollector(current_url);sendData.second=ct;if(that.canSendPlay){that.go.onSkinEvent("video.play",sendData)}that.canSendPlay=false;self.adjustControls()},false);that.player.container.bind("controlshidden",function(){zeQuery(".mejs-chapters-button",self.$gallery).addClass("mejs-chapters-off");zeQuery(".mejs-layers",self.$gallery).removeClass("mejs-show-chapters")});var playerInstance={play:function(){mediaElement.play()["catch"](function(err){_trace(err+"Video Playing error")})},pause:function(){mediaElement.pause()},setCurrentTime:function(time){mediaElement.setCurrentTime(time)}};that.go.onSkinEvent("api.ready",playerInstance);if(cincopa_mejs.MediaFeatures.isiOS&&cincopa_mejs.MediaFeatures.hasiOSFullScreen&&typeof that.player.media.webkitEnterFullscreen==="function"){that.player.media.cincopaAddEventListener("webkitbeginfullscreen",function(){if(that.player.selectedTrack){var videoElement=that.player.media;var textTracks=videoElement.textTracks;if(videoElement.textTracks){for(var i=0;i<videoElement.textTracks.length;i++){if(videoElement.textTracks[i].language===that.player.selectedTrack.srclang){videoElement.textTracks[i].mode="showing"}else{videoElement.textTracks[i].mode="disabled"}}}}},false);that.player.media.cincopaAddEventListener("webkitendfullscreen",function(){if(that.player.selectedTrack){var videoElement=that.player.media;var textTracks=videoElement.textTracks;if(videoElement.textTracks){for(var i=0;i<videoElement.textTracks.length;i++){videoElement.textTracks[i].mode="disabled"}}}},false);return}if(self.videoThumbnail){var $el;if(zeQuery("a.cp_pl_item.current",self.$gallery).length){$el=zeQuery("a.cp_pl_item.current",self.$gallery)}else{$el=zeQuery("a.cp_pl_item:first",self.$gallery)}var extraFileInd=$el.data("index");var cat=$el.data("cat");self.findCurrentSubtitle(extraFileInd,cat)}if(that.go.args.course_progress){setTimeout(function(){that.playlistHeight(true)},200)}},error:function(err){console.log(err,"ERROR");zeQuery(".mejs-overlay-loading",that.$gallery).parent().hide();zeQuery("#mediaElementVideoContainer"+objID).find(".mejs-poster").show()}};zeQuery("#mediaElementVideo"+objID).mediaelementplayer(mediaElement_options);zeQuery(winSelector).on("resize.mediaelement."+self.gallery_id,function(){clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){that.onResize();if(!that.currentPlayerHeight){that.currentPlayerHeight=zeQuery("#mediaElementVideo"+objID).height()}if(that.currentPlayerHeight&&that.currentPlayerHeight<zeQuery("#mediaElementVideo"+objID).height()-20){that.currentPlayerHeight=zeQuery("#mediaElementVideo"+objID).height();that.changeLevel()}that.adjustControls()},100)});zeQuery(document).on("click."+self.gallery_id,".ze_overlay_close_btn",function(){if(!zeQuery(this).hasClass("ze_overlay_close_cta")){if(that.go.args.html_overlay_show!="on_25"&&that.go.args.html_overlay_show!="on_50"&&that.go.args.html_overlay_show!="on_75"&&that.go.args.html_overlay_show!="before_first"&&that.go.args.html_overlay_show.indexOf("on_at_")==-1){var lastIndex=zeQuery("#"+objID+".mediaElement_playlist .cp_pl_item:last.current").length;if(lastIndex==0){that.player.playNextTrack(that.player)}}else{that.player.$media[0].play()["catch"](function(err){_trace(err+"Video Playing error")})}}});zeQuery("#"+objID+" .share-button").on("click."+self.gallery_id,function(){var videoElem=self.player.media;var current_url=zeQuery(videoElem).data("currentplayingvideourl")||videoElem.src;var sendData=self.sendDataCollector(current_url);sendData.share_url=self.getShareUrl();self.go.onSkinEvent("share.show",sendData)});if(self.player&&self.player.captionsButton&&self.go.args.subtitle){self.player.captionsButton.on("click."+self.gallery_id,"input[type=radio]",function(){if(self.player.trackDisableCookie){self.player.trackDisableCookie=false;return}if(self.player.selectedTrack){zeQuery.cookie("cincopavideoTrack",self.player.selectedTrack.srclang)}else{zeQuery.cookie("cincopavideoTrack","none")}})}if(this.go.args.css_version){this.$gallery.addClass("css_version");this.$gallery.addClass("css_version_"+this.go.args.css_version)}if(typeof document.mozFullScreenElement!="undefined"){zeQuery(document).bind("fullscreenchange."+self.gallery_id+"  mozfullscreenchange."+self.gallery_id,function(e){var fullscreenElement=document.fullscreenElement||document.mozFullscreenElement;if(!fullscreenElement){zeQuery(".mejs-fullscreen").removeClass("mejs-fullscreen");zeQuery(".mejs-container-fullscreen").removeClass("mejs-container-fullscreen");self.onResize();setTimeout(function(){var esc=zeQuery.Event("keydown",{keyCode:27});zeQuery("body").trigger(esc)},0)}})}this.loadPlaylistThumbs();zeQuery("#mediaElementVideoContainer"+objID).addClass("first-item-playing");if(this.go.args.showPlayerArrows&&this.go.args.cincopaTV==false){var leftArrow=zeQuery("<div>").addClass("mediaElementVideoContainerLeftArrow");leftArrow.html("<i></i>");var rightArrow=zeQuery("<div>").addClass("mediaElementVideoContainerRightArrow");rightArrow.html("<i></i>");rightArrow.on("click."+self.gallery_id,function(){self.player.playNextTrack(self.player)});leftArrow.on("click."+self.gallery_id,function(){self.player.playPrevTrack(self.player)});zeQuery("#mediaElementVideoContainer"+objID).append(leftArrow);zeQuery("#mediaElementVideoContainer"+objID).append(rightArrow)}if(self.go.args.anchor_videos!="off"){_trace("Video gallery open popup from hash");self.runFromHashTag()}};this.getDate=function(string){var date=new Date(string).toDateString();date=date.split(" ");return date[1]+" "+date[2]+","+date[3]};this.prepostRollBeforePlay=function(eventName){if(this.go.preRollIndex<=0){zeQuery(".mejs-overlay-loading",this.$gallery).parent().addClass("cp-background-overlay")}};this.prepostRollCallback=function(eventName){zeQuery(".mejs-container",this.$gallery).addClass("cp-afterroll-callback");if(eventName==="prev"){if(this.go.preRollAction=="return"){return}var playlistObject;this.go.preRollAction="prev";if(this.go.preRollIndex!=1){this.go.preRollIndex--}this.go.preRollAction="return";this.player.playPrevTrack(this.player);if(this.go.args.prerollVideoUrl){this.player.playPrevTrack(this.player)}if(this.go.args.prerollVideoUrl&&this.go.args.postrollVideoUrl){this.player.playPrevTrack(this.player)}this.go.preRollAction=false;if(this.go.args.prerollVideoUrl&&this.go.args.postrollVideoUrl){this.go.preRollIndex=this.go.preRollIndex-3}else{if(this.go.args.prerollVideoUrl){this.go.preRollIndex=this.go.preRollIndex-2}if(this.go.args.postrollVideoUrl){this.go.preRollIndex=this.go.preRollIndex-1}}if(this.go.args.group_by==true||this.go.args.group_by!="off"){playlistObject=zeQuery('.playlistContainer a.cp_pl_item[data-index="'+this.go.preRollIndex+'"][data-cat="'+this.currentCategory+'"]',this.$gallery)}else{playlistObject=zeQuery('.playlistContainer a.cp_pl_item[data-index="'+this.go.preRollIndex+'"]',this.$gallery)}var infoHtml='<div class="cp_pl_item cp_pl_item_show" >'+zeQuery(playlistObject).html()+"</div>";zeQuery(".mediaElementInfo_container",this.$gallery).html(infoHtml)}else{if(eventName==="next"){var playlistObject;this.go.preRollIndex++;if(this.go.preRollCategory!==this.currentCategory){this.go.preRollIndex=0;this.go.preRollCategory=this.currentCategory}if(this.go.args.group_by==true||this.go.args.group_by!="off"){playlistObject=zeQuery('.playlistContainer a.cp_pl_item[data-index="'+this.go.preRollIndex+'"][data-cat="'+this.currentCategory+'"]',this.$gallery)}else{playlistObject=zeQuery('.playlistContainer a.cp_pl_item[data-index="'+this.go.preRollIndex+'"]',this.$gallery)}if(this.go.args.prerollVideoUrl||this.go.args.postrollVideoUrl){var infoHtml='<div class="cp_pl_item cp_pl_item_show" >'+zeQuery(playlistObject).html()+"</div>";zeQuery(".mediaElementInfo_container",this.$gallery).html(infoHtml)}if(this.go.preRollAction!="next"&&this.go.args.postrollVideoUrl){this.go.preRollAction="next";this.player.playNextTrack(this.player)}this.go.preRollAction=false}}};this.masterM3u8ContentFromAssets=function(m3u8Arr){for(var e="#EXTM3U",s=[],a=0;a<m3u8Arr.length;a++){var i=m3u8Arr[a];var url=i.url;if(!this.isHlsSupported()&&this.isNativeHls()){var keyName=this.inBetween(i.url,"key=","&");if(keyName){url=url.replace("key="+keyName,"key=AAAAAAA=")}}s.push("#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH="+i.bandwidth+",RESOLUTION="+i.resolution+",NAME="+i.display_name+"\n"+url)}return e+"\n"+s.join("\n")},this.masterM3u8DataUri=function(m3u8Arr){if(m3u8Arr.length){var e=this.masterM3u8ContentFromAssets(m3u8Arr);return"data:application/x-mpegURL;base64,"+base64Encode(e)}return false},this.isHlsSupported=function(){var supported=true;if(typeof Hls=="undefined"||!Hls.isSupported()){supported=false}if(!this.go.args.enable_hls){supported=false}if(is_ie()&&!is_ie_hls_supported()){supported=false}var isWKWebView=false;if(this.isIOS){if(window.webkit&&window.webkit.messageHandlers){isWKWebView=true}}if(isWKWebView){supported=false}var chr=function(){return !(!/Chrome/.test(navigator.userAgent)||!/Google Inc/.test(navigator.vendor))&&{version:chromeVersion()}};var chromeVersion=function(){var e=navigator.userAgent.match(/\bChrome\/([^\s]+)/);return e&&e[1]};if(chr()&&parseInt(chr().version)<=50){supported=false}return supported};this.isNativeHls=function(){var riphone=/(iphone)/i,ripad=/(ipad)/i,rwebkit=/(webkit)[ \/]([^\s]+)/i;var iphone=riphone.test(navigator.userAgent);var ipad=ripad.test(navigator.userAgent);var safari=rwebkit.test(navigator.userAgent)&&!/chrome/i.test(navigator.userAgent)&&!ipad&&!iphone;return iphone||ipad||safari};this.createM3u8Arr=function(item){var m3u8Arr=[];var ratio=item.aspect_ratio;var counter=10;var versions=item.versions;for(var key in versions){if(versions.hasOwnProperty(key)&&versions[key].mime=="application/x-mpegURL"&&key.indexOf("ts_")!=-1){var resolution="";var h=parseInt(versions[key].name);var w=ratio*h;resolution=w+"X"+h;if(versions[key].url.indexOf("m3u8=segbr")>-1){this.isSegbr=true}else{this.isSegbr=false}m3u8Arr.push({url:versions[key].url+(versions[key].key?"?token="+versions[key].key:""),display_name:versions[key].name,resolution:resolution,bandwidth:counter});counter++}}return m3u8Arr};this.playHLS=function(mediaelement,json,autostart){var that=this;if(json.item.content_type.indexOf("audio")>-1&&self.go.args.audio_support){if(this.hls){this.hls.destroy();this.hls=undefined}this.player.setSrc(this.getContentUrl(json.item));this.go.onSkinEvent("video.load",json);return}var objID=this.go.loaderParams._object;that.m3u8Arr=this.createM3u8Arr(json.item);var item={};if(typeof json!="undefined"){item=json.item}var content_url=this.getContentUrl(item);zeQuery("#mediaElementVideo"+objID).data("currentplayingvideourl",content_url);var dataURI="";if(json.item.content_real_type=="live"){dataURI=this.getContentUrl(item)}else{if(json.item.m3u8){dataURI=json.item.m3u8}else{dataURI=this.masterM3u8DataUri(that.m3u8Arr);if(dataURI&&is_ie()==11&&(/(Windows 8.1|Windows NT 6.3)/.test(navigator.appVersion)||/(Windows 10.0|Windows NT 10.0)/.test(navigator.appVersion))){dataURI=cincopa.getPlaylistUrl(json.item.rid)}}}if(this.hls){this.hls.detachMedia();this.hls.destroy();this.hls=undefined}if(that.isHlsSupported()&&dataURI){var hlsOptions={maxMaxBufferLength:(this.go.args.fast_start?parseInt(this.go.args.hls_max_fast_start_buffer_length):parseInt(this.go.args.hls_max_buffer_length))};if(json.item.content_real_type!="live"){hlsOptions.autoStartLoad=false}if(json.item.content_real_type=="live"){if(json.item.liveSyncDuration){hlsOptions.liveSyncDuration=parseInt(json.item.liveSyncDuration)}if(json.item.liveMaxLatencyDuration){hlsOptions.liveMaxLatencyDuration=parseInt(json.item.liveMaxLatencyDuration)}}try{hlsOptions.fLoader=that.fLoader;hlsOptions.pLoader=that.pLoader}catch(ex){console.log(ex)}if(json.item.content_real_type!="live"||json.item.live_status=="started"){var hls=new Hls(hlsOptions);this.hls=hls;hls.loadSource(dataURI);hls.attachMedia(mediaelement)}else{if(json.item.live_status!="started"){that.showOfflineStream(objID,json.item.live_status=="starting"?"Live is starting...":"Live stream offline")}}if(json.item.content_real_type!="live"){hls.on(Hls.Events.MANIFEST_PARSED,function(){var videoLevel=that.getVideoLevel(json,hls);hls.MediaJSON=json;mediaelement.cincopaAddEventListener("play",function(e){if(typeof hls.firstTimePlayed==="undefined"){var newvideoLevel=that.getVideoLevel(json,hls);if(videoLevel!=newvideoLevel){that.changeLevel()}}});if(that.go.args.fast_start){var startTime=-1;if(json.item&&json.item.startTime){startTime=json.item.startTime}hls.currentLevel=videoLevel;hls.loadLevel=videoLevel;hls.nextLevel=videoLevel;hls.nextLoadLevel=videoLevel;hls.startLoad(startTime);hls.hlsStarted=true;json.version=hls.levelController.levels[videoLevel];that.go.onSkinEvent("video.load",json);mediaelement.cincopaAddEventListener("playing",function(e){if(typeof hls.cpBufferChanged==="undefined"){hls.cpBufferChanged=true;hls.config.maxMaxBufferLength=parseInt(that.go.args.hls_max_buffer_length)}});if(autostart){mediaelement.play()["catch"](function(err){_trace(err+"Video Playing error");if(err&&err.code===20){return}var posterURL=zeQuery(mediaelement).attr("data-posterURL");mediaelement.muted=true;mediaelement.play();var unmuteBtn=zeQuery("<div>").addClass("unmute-button");unmuteBtn.html("<div class='unmute-button-speaker'><span></span></div><span>"+(that.isMobile?"Tap for sound":"Click for sound")+"</span>");unmuteBtn.on("click."+self.gallery_id,function(){if(mediaelement.muted){mediaelement.muted=false}unmuteBtn.remove()});zeQuery(".mejs-layers",self.$gallery).append(unmuteBtn);that.go.onSkinEvent("player.failed",{player:that.player,error:err,posterURL:posterURL,errorDesc:"player.failed from playHLS"})})}}else{that.go.onSkinEvent("video.load",json)}})}else{if(hls){hls.MediaJSON=json;hls.isLive=true;if(json.item.live_status=="started"){that.go.onSkinEvent("video.load",json)}}}that.hls=hls;zeQuery(mediaelement).data("hls",hls);if(hls){hls.on(Hls.Events.ERROR,function(event,errorData){var current_url=zeQuery(mediaelement).data("currentplayingvideourl")||mediaelement.src;if(errorData.fatal){switch(errorData.type){case Hls.ErrorTypes.NETWORK_ERROR:_trace(errorData+" fatal network error encountered, try to recover");mediaelement.pause();hls.stopLoad();hls.fatalNetworkError=true;break;case Hls.ErrorTypes.MEDIA_ERROR:_trace(errorData+" fatal media error encountered, try to recover");if(!zeQuery(mediaelement).parents(".mejs-container").hasClass("mejsprerollstarted")){hls.recoverMediaError()}break;default:_trace(errorData+" destroy hls");if(cincopa.logError){cincopa.logError("hls fatal","disabling hls")}recoverVideo();break}}else{if(errorData.type=="networkError"&&errorData.details=="manifestLoadError"){recoverVideo()}}if(errorData.type=="mediaError"&&that.seeked){return true}var sendData=that.sendDataCollector(current_url);sendData.error_hls=errorData;if(errorData.type=="mediaError"||(errorData.fatal&&errorData.type=="networkError"&&errorData.details=="levelLoadError")){clearTimeout(self.streamStoppedtimer);self.checkStreamStatus(true)}that.go.onSkinEvent("video.error",sendData)})}if(that.vrPlayer){that.vrPlayer.destroy();zeQuery(window).off("resize.vrPlayer");that.vrPlayer=null}if(json.item.isVR){that.playVR(mediaelement)}return true}else{if(that.go.args.enable_hls&&dataURI&&that.isNativeHls()){if(json.item.content_real_type!="live"||json.item.live_status=="started"){if(json.item.content_real_type=="live"){mediaelement.setSrc(dataURI)}else{if(json.item.m3u8){mediaElement.setSrc(json.item.m3u8)}else{mediaelement.setSrc(cincopa.getPlaylistUrl(json.item.rid)+(that.isSegbr?"&m3u8=segbr":""))}}if(json.item&&json.item.startTime){mediaelement.cincopaAddEventListener("loadeddata",function(){mediaelement.setCurrentTime(json.item.startTime)},{once:true})}if(this.go.args.liveid){var onTimeUpdate=function(){clearTimeout(self.playingEventTimer);self.playingEventTimer=setTimeout(function(){self.checkStreamStatus(true);delete self.playingEventTimer},10000)};mediaelement.removeEventListener("timeupdate",onTimeUpdate);mediaelement.cincopaAddEventListener("timeupdate",onTimeUpdate);var onPause=function(){clearTimeout(self.playingEventTimer);delete self.playingEventTimer};mediaelement.removeEventListener("pause",onPause);mediaelement.cincopaAddEventListener("pause",onPause)}mediaelement.cincopaAddEventListener("error",function(e){console.log("errrrrorrrrr",e);if(cincopa.logError){cincopa.logError("hls fatal","native hls")}if(self.go.args.liveid){self.checkStreamStatus(true)}});that.go.onSkinEvent("video.load",json)}else{that.showOfflineStream(objID,json.item.live_status=="starting"?"Live is starting...":"Live stream offline")}}else{var videoSource;if(json.item.versions){recoverVideo()}else{if(json.item.content_real_type=="live"){that.showOfflineStream(objID,"Live stream doesn't supported")}}}}if(that.vrPlayer){that.vrPlayer.destroy();zeQuery(window).off("resize.vrPlayer");that.vrPlayer=null}if(json.item.isVR){that.playVR(mediaelement)}function recoverVideo(){var videoSourceRecovered="";if(json.item.versions){if(json.item.versions.mp4_hd){json.version=json.item.versions.mp4_hd;videoSourceRecovered=json.item.versions.mp4_hd.url}else{json.version=json.item.versions.original;videoSourceRecovered=json.item.versions.original.url}that.go.onSkinEvent("video.load",json);if(hls){hls.destroy()}mediaelement.setSrc(videoSourceRecovered);if(json.item&&json.item.startTime){mediaelement.cincopaAddEventListener("loadeddata",function(){mediaelement.setCurrentTime(json.item.startTime)},{once:true})}if(autostart){setTimeout(function(){mediaelement.play()["catch"](function(err){_trace(err+"Video Playing error");var posterURL=zeQuery(mediaelement).attr("data-posterURL");that.go.onSkinEvent("player.failed",{player:that.player,error:err,posterURL:posterURL,errorDesc:"player.failed from recoverVideo function"})})},300)}}}return false};this.getVideoLevel=function(json,hls){var videoLevel;var objID=this.go.loaderParams._object;var h=Math.max(zeQuery("#mediaElementVideo"+objID).height(),zeQuery("#mediaElementVideo"+objID).attr("height"));if(typeof this.go.args.netflix_popup!="undefined"&&this.go.args.netflix_popup){var wnd=self.getWindow();h=Math.max(wnd.innerHeight,h)}this.currentPlayerHeight=h;if(typeof this.m3u8Arr=="undefined"){this.m3u8Arr=this.createM3u8Arr(json.item)}if(json.item.isVR){videoLevel=this.getHlsLevel(10000);hls.disableResize=false}else{if(zeQuery.cookie("cincopavideoQuality")==null||zeQuery.cookie("cincopavideoQuality")=="auto"||this.go.args.versions==="off"){videoLevel=this.getHlsLevel(h);hls.disableResize=false}else{for(var m=0;m<this.m3u8Arr.length;m++){if(this.m3u8Arr[m].display_name==zeQuery.cookie("cincopavideoQuality")){videoLevel=m;hls.disableResize=true;break}}if(videoLevel==null){videoLevel=this.getHlsLevel(h);zeQuery.cookie("cincopavideoQuality","auto");hls.disableResize=false}}}return videoLevel};this.getHlsLevel=function(height){var m3u8Arr=this.m3u8Arr;var sizes=[];if(!m3u8Arr.length){return false}var gt=[],lt=[];for(var i=0;i<m3u8Arr.length;i++){var s=parseInt(m3u8Arr[i].display_name);if(!isNaN(s)){if(s<height){lt.push(s)}else{gt.push(s)}}}var nearSize;if(gt.length){nearSize=Math.min.apply(null,gt)}else{if(lt.length){nearSize=Math.max.apply(null,lt)}}var videoLevel;if(nearSize){for(var j=0;j<m3u8Arr.length;j++){var s=parseInt(m3u8Arr[j].display_name);if(m3u8Arr[j].display_name==nearSize+"p"){videoLevel=j;break}}}else{}return videoLevel};this.changeLevel=function(){if(!this.hls||this.hls.isLive||this.hls.disableResize){return}var objID=this.go.loaderParams._object;var h=zeQuery("#mediaElementVideo"+objID).height();var level=this.getHlsLevel(h);if(this.hls.loadLevel!=level){if(typeof this.hls.loadLevel==="undefined"){var startTime=this.hls.MediaJSON.startTime||-1;this.hls.startLoad(startTime);this.hls.hlsStarted=true}else{this.hls.nextLevel=level}this.hls.MediaJSON.version=this.hls.levelController.levels[level];this.go.onSkinEvent("video.change",this.hls.MediaJSON)}};this.playVR=function(mediaelement){var t=this;var width=zeQuery(mediaelement).width();var height=zeQuery(mediaelement).height();this.vrPlayer=new Kaleidoscope.Video({height:height,width:width,source:mediaelement,containerId:"#"+t.go.loaderParams._object+" .mejs-mediaelement",initialYaw:180});this.vrPlayer.render();zeQuery(window).on("resize.vrPlayer."+self.gallery_id,function(){var width=zeQuery(mediaelement).width();var height=zeQuery(mediaelement).height();t.vrPlayer.setSize({width:width,height:height})});return this.vrPlayer};this.showOfflineStream=function(objID,message){zeQuery("#mediaElementVideoContainer"+objID).find(".mejs-controls").addClass("cp-hide");var layers=zeQuery("#mediaElementVideoContainer"+objID).find(".mejs-layers");layers.find(".share-button").hide();layers.find(".mejs-overlay-play").hide();layers.find(".mejs-poster").show();layers.find(".unmute-button").remove();layers.find(".mejs-offline-slate-bar").remove();layers.append('<div class="mejs-offline-slate-bar"><span class="mejs-offline-slate-icon"><svg fill="#fff" height="100%" viewBox="0 0 24 24" width="100%"><path d="M16.94 6.91l-1.41 1.45c.9.94 1.46 2.22 1.46 3.64s-.56 2.71-1.46 3.64l1.41 1.45c1.27-1.31 2.05-3.11 2.05-5.09s-.78-3.79-2.05-5.09zM19.77 4l-1.41 1.45C19.98 7.13 21 9.44 21 12.01c0 2.57-1.01 4.88-2.64 6.54l1.4 1.45c2.01-2.04 3.24-4.87 3.24-7.99 0-3.13-1.23-5.96-3.23-8.01zM7.06 6.91c-1.27 1.3-2.05 3.1-2.05 5.09s.78 3.79 2.05 5.09l1.41-1.45c-.9-.94-1.46-2.22-1.46-3.64s.56-2.71 1.46-3.64L7.06 6.91zM5.64 5.45L4.24 4C2.23 6.04 1 8.87 1 11.99c0 3.13 1.23 5.96 3.23 8.01l1.41-1.45C4.02 16.87 3 14.56 3 11.99s1.01-4.88 2.64-6.54z"></path><circle cx="12" cy="12" r="3"></circle></svg></span><span class="mejs-offline-slate-messages"><div class="mejs-offline-slate-main-text">'+message+"</div></span></div>");if(!this.streamInterval){this.streamInterval=setInterval(function(){self.checkStreamStatus()},10000)}};this.hideOfflineStream=function(objID){var self=this;zeQuery("#mediaElementVideoContainer"+objID).find(".mejs-controls").removeClass("cp-hide").removeClass("make-hidden");var layers=zeQuery("#mediaElementVideoContainer"+objID).find(".mejs-layers");layers.find(".mejs-overlay-play").hide();layers.find(".mejs-poster").hide();layers.find(".share-button").show();layers.find(".mejs-offline-slate-bar").remove();setTimeout(function(){var mediaElement=zeQuery("#mediaElementVideo"+objID).get(0);mediaElement.play()["catch"](function(err){mediaElement.muted=true;mediaElement.play();var unmuteBtn=zeQuery("<div>").addClass("unmute-button");layers.find(".mejs-poster").hide();unmuteBtn.html("<div class='unmute-button-speaker'><span></span></div><span>"+(self.isMobile?"Tap for sound":"Click for sound")+"</span>");unmuteBtn.on("click."+self.gallery_id,function(){if(mediaElement.muted){mediaElement.muted=false}unmuteBtn.remove()});layers.append(unmuteBtn);_trace(err+"Video Playing error")});zeQuery(".mejs-container.ze-autohide",self.$gallery).removeClass("ze-autohide");zeQuery(".mejs-container.ze-show-control-bar",self.$gallery).removeClass("ze-show-control-bar");zeQuery(".mejs-container.ze-mobile-hide-controls",self.$gallery).removeClass("ze-mobile-hide-controls")},500)};this.setStreamStoppedTimer=function(){clearTimeout(self.streamStoppedtimer);self.streamStoppedtimer=setTimeout(function(){self.checkStreamStatus(true)},10000)};this.checkStreamStatus=function(stop){if(this.checkingStreamStatus){return}this.checkingStreamStatus=true;var self=this;if(!this.go.args.liveid){return}if(!this.isHlsSupported()&&!this.isNativeHls()){return}var objID=this.go.loaderParams._object;var current_url=zeQuery("#mediaElementVideo"+objID).data("currentplayingvideourl")||("#mediaElementVideoContainer"+objID).src;var sendData=this.sendDataCollector(current_url);var update_status_url=sendData.item.update_status_url;zeQuery.ajax({url:update_status_url,dataType:"json",success:function(data){if(data.items.length&&data.items[0]){var status=data.items[0].live_status;if(status=="stopped"||status=="starting"){zeQuery("#mediaElementVideo"+objID).get(0).pause();setTimeout(function(){self.showOfflineStream(objID,status=="starting"?"Live is starting...":"Live stream offline");zeQuery(".mejs-overlay-loading",self.$gallery).parent().hide();zeQuery("#mediaElementVideoContainer"+objID).find(".mejs-poster").show()},500);delete self.firstLivePlaybackRestart;if(stop){if(self.hls){self.hls.stopLoad()}}}else{if(status=="started"){clearInterval(self.streamInterval);zeQuery("#mediaElementVideoContainer"+objID).find(".mejs-controls").show();self.streamInterval=undefined;self.hideOfflineStream(objID);var videoSrc=zeQuery(".cp_pl_item[data-url]",self.$gallery).first().attr("data-url");var sendData=self.sendDataCollector(videoSrc);sendData.item.live_status=status;var restartPlayback=false;if(sendData.item.hls_playback_url!=data.items[0].hls_playback_url){sendData.item.hls_playback_url=data.items[0].hls_playback_url;restartPlayback=true}if(!self.firstLivePlaybackRestart&&!restartPlayback){restartPlayback=true;self.firstLivePlaybackRestart=true}if(restartPlayback){if(self.hls){var mediaelement=zeQuery("#mediaElementVideo"+objID).get(0);self.hls.detachMedia();self.hls.loadSource(sendData.item.hls_playback_url);self.hls.attachMedia(mediaelement);self.hls.startLoad();self.hls.hlsStarted=true;mediaelement.play()["catch"](function(err){_trace(err+"Video Playing error from stream status started");if(err&&err.code===20){return}mediaelement.muted=true;mediaelement.play();var unmuteBtn=zeQuery("<div>").addClass("unmute-button");unmuteBtn.html("<div class='unmute-button-speaker'><span></span></div><span>Click for sound</span>");unmuteBtn.on("click."+self.gallery_id,function(){if(mediaelement.muted){mediaelement.muted=false}unmuteBtn.remove()});zeQuery(".mejs-layers",self.$gallery).append(unmuteBtn)})}else{self.playHLS(zeQuery("#mediaElementVideo"+objID).get(0),sendData,true)}}}}}delete self.checkingStreamStatus},error:function(){delete self.checkingStreamStatus},complete:function(){delete self.checkingStreamStatus}})};this.do_play=function(data){if(data.second=="postroll"){var lastIndex=zeQuery("#"+this.go.loaderParams._object+".mediaElement_playlist .cp_pl_item:last.current").length;if(lastIndex==0){this.player.playNextTrack(this.player)}}else{this.player.$media[0].play()["catch"](function(err){_trace(err+"Video Playing error")})}};this.sendDataCollector=function(current_url){var sendData={};if(this.go.args.group_by==true||this.go.args.group_by=="on"){var itemIndex=zeQuery('.cp_pl_item[data-url="'+current_url+'"]',self.$gallery).parent().index();var elemTag=zeQuery('.cp_pl_item[data-url="'+current_url+'"] ',self.$gallery).attr("data-cat");if(elemTag){var elems=this.getItems()[elemTag].filter(function(el){return el.content_type.indexOf("video")>-1||(el.content_type.indexOf("audio")>-1&&self.go.args.audio_support)});sendData.item=elems[itemIndex]}}else{var itemIndex=zeQuery('.cp_pl_item[data-url="'+current_url+'"]',self.$gallery).index();var elems=this.getItems().filter(function(el){return el.content_type.indexOf("video")>-1||(el.content_type.indexOf("audio")>-1&&self.go.args.audio_support)});sendData.item=elems[itemIndex]}return sendData};this.getShareUrl=function(){var li=zeQuery(".cp_pl_item.current",this.gallery).parent("li").length?true:false;var index;if(li){index=zeQuery(".cp_pl_item.current",self.gallery).attr("data-share")}else{index=zeQuery(".cp_pl_item.current",self.gallery).index()}var shareUrl="";var index_hash=location.href.indexOf("#");if(index_hash>-1){shareUrl=location.href.substring(0,index_hash)+"#linkshare/"+this.go.loaderParams._fid+"/"+(parseInt(index)+1)}else{shareUrl=location.href+"#linkshare/"+this.go.loaderParams._fid+"/"+(parseInt(index)+1)}return shareUrl};this.buildChannelHashUrl=function(cat,index){cat="channel";var isNumber=false;if(isNaN(index)==false){isNumber=true}var oldHashtag=this.getUrl("cprtstatus");var chapterUrl="";if(oldHashtag){if(oldHashtag.indexOf((isNumber?(parseInt(index)+1):index))>-1&&oldHashtag.indexOf("/chapter")>-1){var chapterIndex=oldHashtag.split("chapter-").pop();chapterUrl="/chapter-"+chapterIndex}}var cprtstatus=(this.go.loaderParams._iframeParentId||this.go.loaderParams._id)+"/"+cat+"/"+(isNumber?(parseInt(index)+1):index)+chapterUrl;this.buildHash("cprtstatus",cprtstatus)};this.runFromHashTag=function(){var self=this;var hashtag=this.getUrl("cprtstatus");_trace("runFromHashTag "+hashtag);if(hashtag){var objID=self.go.loaderParams._object;hashtag=hashtag.replace((self.go.loaderParams._iframeParentId||self.go.loaderParams._id)+"/channel/","");if(hashtag.indexOf("chapter-")>-1){var chapterIndex=hashtag.split("chapter-").pop()}hashtag=hashtag.replace("/chapter-"+parseInt(chapterIndex),"");var isNumber=false;if(isNaN(hashtag)==false){hashtag=parseInt(hashtag)-1;isNumber=true}if(self.plsTimerObject){clearTimeout(self.plsTimerObject)}setTimeout(function(){if(typeof self.go.args.url_changer!="undefined"&&self.go.args.url_changer){var category=self.getUrl("cat");if(category){if(zeQuery("#"+objID+' .mediaElement_categories_tab[data-category="'+category+'"]').length){zeQuery("#"+objID+' .mediaElement_categories_tab[data-category="'+category+'"]')[0].click()}}if(hashtag){if(zeQuery("#"+objID+' .playlistContainer div[data-cat="'+self.getBeautyNameOfTag(category)+'"] a[data-rid="'+self.getBeautyNameOfTag(hashtag)+'"]').length){zeQuery("#"+objID+' .playlistContainer div[data-cat="'+self.getBeautyNameOfTag(category)+'"] a[data-rid="'+self.getBeautyNameOfTag(hashtag)+'"]')[0].click()}}}else{if(isNumber){if(zeQuery("#"+objID+' .cp_pl_item[data-share ="'+hashtag+'"]').length){zeQuery("#"+objID+' .cp_pl_item[data-share ="'+hashtag+'"]')[0].click()}else{if(zeQuery("#"+objID+' .cp_pl_item[data-index ="'+hashtag+'"]').length){zeQuery("#"+objID+' .cp_pl_item[data-index ="'+hashtag+'"]')[0].click()}}}else{if(zeQuery("#"+objID+' .cp_pl_item[data-rid ="'+hashtag+'"]').length){zeQuery("#"+objID+' .cp_pl_item[data-rid ="'+hashtag+'"]')[0].click()}}}},100)}};this.on_cp_lightbox_close=function(){this.buildHash("cprtstatus","")};this.on_cp_lightbox_open=function(index){if(this.getUrl("cprtstatus")==""){self.userInteraction=true}if(!this.getUrl("cprtstatus")){index=typeof index=="undefined"?"/":"/"+index;this.buildHash("cprtstatus",(this.go.loaderParams._iframeParentId||this.go.loaderParams._id)+"/channel"+index);_trace("on_cp_lightbox_open");this.runFromHashTag()}};this.on_cp_lightbox_init=function(){var urlHash=this.getUrl("cprtstatus");if(urlHash&&urlHash.indexOf("channel")>-1){if(urlHash.indexOf((this.go.loaderParams._iframeParentId||this.go.loaderParams._id))>-1){this.go.startPopupSkin()}}};this.buildHash=function(param,value){if(this.go.args.anchor_videos=="with_hash"){this.setHash(param,value)}else{if(this.go.args.anchor_videos=="with_link"){this.setUrlParam(param,value)}}};this.setUrlParam=function(key,value){if(this.go.args.disable_url_change){return}var correctWindow=this.getWindow();if(correctWindow.history.replaceState){value=value.replaceAll("/","!");var newurl=correctWindow.location.pathname+"?"+insertParam(key,value);if(correctWindow.location.hash){newurl+=correctWindow.location.hash}correctWindow.history.replaceState({vportal:this.go.args.new_video_portal},correctWindow.document.title,newurl)}function insertParam(key,value){key=escape(key);if(typeof value!="undefined"){value=encodeURIComponent(value)}else{value=null}var kvp=correctWindow.document.location.search.substr(1).split("&");if(kvp==""){if(value===null){return""}return key+"="+value}else{var i=kvp.length;var x;while(i--){x=kvp[i].split("=");if(x[0]==key&&value===null){kvp[i]="marktodelete";break}if(x[0]==key){x[1]=value;kvp[i]=x.join("=");break}}kvp=kvp.filter(function(el){return el!="marktodelete"});if(i<0&&value!==null){kvp[kvp.length]=[key,value].join("=")}return kvp.join("&")}}};this.setHash=function(param,value){if(this.go.args.disable_url_change){return}var wnd=this.getWindow();var l_hash=wnd.location.hash;if(l_hash!=""){var filter_arr,filter_val;if(l_hash.indexOf(param)>-1){var arr_hash=l_hash.split("|");zeQuery.each(arr_hash,function(i,v){if(v.indexOf(param)>-1){filter_arr=v.split("=");filter_val=filter_arr[1];return false}});if(value!=""){var new_loc_hash=l_hash.replace(param+"="+filter_val,param+"="+value)}else{var sIndex=l_hash.indexOf(param+"="+filter_val);new_loc_hash=l_hash;var replaceVal=param+"="+filter_val;if(sIndex>-1){if(l_hash.charAt(sIndex-1)==="|"){new_loc_hash=l_hash.substring(0,sIndex-1)+l_hash.substring(sIndex,l_hash.length)}else{if(l_hash.charAt(sIndex+replaceVal.length)==="|"){new_loc_hash=l_hash.substring(0,sIndex+replaceVal.length)+l_hash.substring(sIndex+replaceVal.length+1,l_hash.length)}}}new_loc_hash=new_loc_hash.replace(param+"="+filter_val,"")}try{wnd.location.hash=new_loc_hash.replaceAll("/","!")}catch(ex){_trace(ex)}}else{new_loc_hash=l_hash;if(value!=""){try{wnd.location.hash=new_loc_hash+"|"+param+"="+value.replaceAll("/","!")}catch(ex){_trace(ex)}}}}else{if(value!=""){try{wnd.location.hash="#"+param+"="+value.replaceAll("/","!")}catch(ex){_trace(ex)}}}};this.build_bottom_share_layer=function(){var shareUrl=this.getShareUrl();shareUrl=encodeURIComponent(shareUrl);var mediaSource={fb:"http://www.facebook.com/share.php?u={ADDRESS}",twitter:"http://twitter.com/home?status={ADDRESS}",linkedin:"http://www.linkedin.com/shareArticle?mini=true&url={ADDRESS}",};var html="";html+='<ul class="share-icons"><li class="ze_fb"><span class="fb-share" onclick="window.open(\''+mediaSource.fb.replace("{ADDRESS}",shareUrl)+'\', \'_blank\')"><i class="icon-fb"></i></span></li><li class="ze_tw"><span class="tw-share" onclick="window.open(\''+mediaSource.twitter.replace("{ADDRESS}",shareUrl)+'\', \'_blank\')"><i class="icon-twitter"></i></span></li><li class="ze_li"><span class="li-share" onclick="window.open(\''+mediaSource.linkedin.replace("{ADDRESS}",shareUrl)+"', '_blank')\"><i class=\"icon-linkedin\"></i></span></li></ul>";return html};this.videosLength=function(){var duration=0,items=this.go.MediaJSON.items;for(var i=0;i<items.length;i++){if(items[i]["content_type"].indexOf("video")>-1||(items[i]["content_type"].indexOf("audio")>-1&&items[i].duration&&self.go.args.audio_support)){duration+=hmsToSecondsOnly(items[i].duration)}}return'<div class="mediaelement_videos_length"> <span>'+(this.go.args.summary_text?this.go.args.summary_text:"")+"</span><span> "+Math.floor(duration/60)+":"+duration%60+" min </span></div>"};this.annotationExists=function(){var exist=false;var json=this.getItems();if(this.go.args.group_by!=true||this.go.args.group_by=="on"){}else{for(var i=0;i<json.length;i++){var timeline=json[i].timeline;if(timeline){eval("var timeLineObj = "+decodeXml(timeline));if(typeof timeLineObj.annotation!="undefined"||timeLineObj.calltoaction!="undefined"){exist=true;break}}}}return exist};this.inBetween=function(str,start,end){var i=0;if(start!=null&&start!=""){i=str.indexOf(start);if(i==-1){return""}}else{start=""}var x=str.indexOf(end,i+start.length);if(x==-1||end==null||end==""){return str.substr(i+start.length)}return str.substr(i+start.length,x-i-start.length)};this.shuffleItems=function(array){var currentIndex=array.length,temporaryValue,randomIndex;while(0!==currentIndex){randomIndex=Math.floor(Math.random()*currentIndex);currentIndex-=1;temporaryValue=array[currentIndex];array[currentIndex]=array[randomIndex];array[randomIndex]=temporaryValue}return array};this.sortByTag=function(arrayP){var that=this;var newSortedByTags={};newSortedByTags.length=0;newSortedByTags.sortedByTag=true;var prerollVideo={};var postrolVideo={};var tagsOrder=[];for(var i=0;i<arrayP.length;i++){if(arrayP[i].prepostrollVideo&&this.go.args.rollFrequency!="on_each"&&this.go.args.rollFrequency!=undefined){if(arrayP[i].preVideo){prerollVideo=arrayP[i]}if(arrayP[i].postVideo){postrolVideo=arrayP[i]}continue}var tags="";if(this.go.args.cincopaTV){tags="cincopaTV"}else{tags=arrayP[i].tags.substring(1,arrayP[i].tags.length-1)}tags=tags.split(",");for(var p=0;p<tags.length;p++){var tag=tags[p],isIn=false,founded=[];if(tag==""){tag="no-tag"}var groupedTags=this.go.args.group_video_tag.toLowerCase().split(",");var filtered_arr=zeQuery.grep(groupedTags,function(n,i){var val=n.replace(/\(.*?\)/g,"");return val==tag});if(filtered_arr.length){tag=tag}else{if(this.go.args.group_video_tag!=""){continue}}if(typeof newSortedByTags[tag]!="undefined"){newSortedByTags[tag].push(arrayP[i])}else{tagsOrder.push(tag);newSortedByTags[tag]=[];newSortedByTags[tag].push(arrayP[i]);newSortedByTags.length++}}}var firstTag="";var lastTag="";tagsOrder=tagsOrder.sort();this.allOrderTags=tagsOrder;if(tagsOrder.length){firstTag=tagsOrder[0];lastTag=tagsOrder[tagsOrder.length-1]}if(this.go.args.prerollVideoUrl||this.go.args.postrollVideoUrl){var firstNewArray=[];var lastNewArray=[];if(this.go.args.rollFrequency!="on_each"&&this.go.args.rollFrequency!=undefined){var index=0;for(var i=0;i<newSortedByTags[firstTag].length;i++){if(this.go.args.prerollVideoUrl&&i==0){firstNewArray[0]=prerollVideo;index++}firstNewArray[index]=newSortedByTags[firstTag][i];index++;if(this.go.args.postrollVideoUrl&&this.go.args.rollFrequency=="on_first"&&i==0){firstNewArray[2]=postrolVideo;index++}}newSortedByTags[firstTag]=firstNewArray}if(this.go.args.rollFrequency=="on_first_last"){var index=0;for(var i=0;i<newSortedByTags[lastTag].length;i++){lastNewArray[index]=newSortedByTags[lastTag][i];if(this.go.args.postrollVideoUrl){lastNewArray[newSortedByTags[lastTag].length]=postrolVideo}index++}newSortedByTags[lastTag]=lastNewArray}}if(this.go.args.tags_order!="none"&&this.go.args.tags_order!=undefined){var sorted={},key,arr=[];for(key in newSortedByTags){if(newSortedByTags.hasOwnProperty(key)){arr.push(key)}}if(this.go.args.tags_order=="order_asc"){arr.sort(function(a,b){var keyAIndex=a.toLowerCase();var keyBIndex=b.toLowerCase();if(keyAIndex>keyBIndex){return 1}if(keyAIndex<keyBIndex){return -1}return 0})}else{if(this.go.args.tags_order=="order_desc"){arr.sort(function(a,b){var keyAIndex=a.toLowerCase();var keyBIndex=b.toLowerCase();if(keyAIndex<keyBIndex){return 1}if(keyAIndex>keyBIndex){return -1}return 0})}else{if(this.go.args.tags_order=="order_tags"&&this.go.args.group_video_tag!=""){var gr_video_tags=this.go.args.group_video_tag.toLowerCase().split(",");gr_video_tags=gr_video_tags.map(function(t){return t.split("(")[0]});arr.sort(function(a,b){var keyAIndex=gr_video_tags.indexOf(a);var keyBIndex=gr_video_tags.indexOf(b);if(keyAIndex>keyBIndex){return 1}if(keyAIndex<keyBIndex){return -1}return 0})}else{arr.sort()}}}this.go.sortedItemsKeys=arr;for(key=0;key<arr.length;key++){sorted[arr[key]]=newSortedByTags[arr[key]]}return sorted}else{this.go.sortedItemsKeys=Object.keys(newSortedByTags);return newSortedByTags}};this.checkIsCasting=function(){if(this.session&&typeof this.session!="undefined"){return true}else{return false}};this.currentCastMedia=function(){if(this.session&&this.session.media[this.session.media.length-1]&&this.session.media[this.session.media.length-1]!="undefined"){return this.session.media[this.session.media.length-1]}else{return false}};this.resizePlayer=function(){var container=zeQuery(".mejs-container",this.$gallery);var objID=this.go.loaderParams._object;var className="";switch(true){case (container.width()<=500):className="wS";break;case (container.width()>500&&container.width()<768):className="wM";break;case (container.width()>=768&&container.width()<=1024):className="wL";break;case (container.width()>1024):className="wXL";break}zeQuery("#"+objID).removeClass("wS wM wL wXL");zeQuery("#"+objID).addClass(className);var subtitlesContainer=zeQuery("#"+objID+" .mejs-captions-position");if(subtitlesContainer.length){var container=zeQuery(".mejs-container",this.$gallery);var controls_h=zeQuery(".mejs-controls",this.$gallery).height();if(container.hasClass("ze-mobile-video-container")){var controls_h=zeQuery(".mejs-controls",this.$gallery).height()}if(controls_h>0){subtitlesContainer.css("bottom",controls_h+15)}}};this.onEsc=function(e){var self=this;if(typeof self.go.args.netflix_popup!="undefined"&&self.go.args.netflix_popup){e.preventDefault();e.stopPropagation();if(e.keyCode==27){self.onEsc.activeListener=false;zeQuery(window).off("keyup.netflix_popup");zeQuery(".netflix_close_btn",self.$gallery).click()}}};this.adjustControls=function(){if(this.go.args.css_version!="1.1"||this.go.args.auto_resize){return}function intersect(a,b){var d={};var results=[];for(var i=0;i<b.length;i++){d[b[i]]=true}for(var j=0;j<a.length;j++){if(d[a[j]]){results.push(a[j])}}return results}var objID=this.go.loaderParams._object;var controls=zeQuery(".mejs-controls",this.$gallery);var container=zeQuery(".mejs-container",this.$gallery);var buttons=[];controls.find(">div").each(function(){if(zeQuery(this).css("position")!="absolute"){buttons.push(zeQuery(this))}});var contW=container.width()-10;var buttonsOrder=["mejs-playpause-button","mejs-player-logo-button","mejs-fullscreen-button","mejs-prevtrack-button","mejs-nexttrack-button","mejs-gear-button","mejs-volume-button","mejs-playlist-button","mejs-time","mejs-shuffle-button","mejs-loop-button","mejs-speed-button","mejs-jump-back","mejs-jump-forward"];var buttonsReverseOrder=buttonsOrder.reverse();for(var i=0;i<buttons.length;i++){if(buttons[i].hasClass("mejs-button-notadjust")){continue}buttons[i].removeClass("mejs-force-hidden-button")}var sum=0;zeQuery(buttons).each(function(){sum+=zeQuery(this).outerWidth()});var freeSpace=contW-sum;if(freeSpace<0){var fS=Math.abs(freeSpace);var sumOfHiddenButtons=0;for(var j=0;j<buttonsReverseOrder.length;j++){var btn=controls.find("."+buttonsReverseOrder[j]);if(btn.css("position")=="absolute"){continue}sumOfHiddenButtons+=btn.outerWidth();btn.addClass("mejs-force-hidden-button");if(sumOfHiddenButtons>=fS){break}}}var newControlsHeight=zeQuery(".mejs-controls",this.$gallery).outerHeight(true)+zeQuery(".mejs-time-rail",this.$gallery).outerHeight(true);zeQuery("#adjustControls_"+objID).remove();zeQuery('<style id="adjustControls_'+objID+'">').text("#"+objID+":hover .mejs-chapters-wrap{  height:calc(100% - "+newControlsHeight+"px) !important}#"+objID+" .mejs-chapters-wrap{  height:100% !important}#"+objID+".ze-mouseleave .mediaElementVideoContainer .mejs-container .mejs-layers.mejs-show-chapters .mejs-chapters-wrap{height:100%!important}#"+objID+" .mediaElementVideoContainer .mejs-container.ze-show-control-bar .mejs-layers.mejs-show-chapters .mejs-chapters-wrap,#"+objID+" .mejs-container.ze-autohide.ze-show-control-bar .mejs-layers.mejs-show-chapters .mejs-chapters-wrap{height:calc(100% - "+newControlsHeight+"px) !important}").appendTo(zeQuery("#"+objID))};this.video_is_type_stored=function(json_item){var storage=json_item.storage;var compareValue=19;if(this.go.args.storyboard=="small"){compareValue=18}return(((storage&(1<<compareValue))>0)?true:false)};this.stringToSec=function(str){if(str==""){return""}if(typeof this.go.args.netflix_popup!="undefined"&&this.go.args.netflix_popup){var p=str.split(":"),s=0,m=1;while(p.length>0){s+=m*parseInt(p.pop(),10);m*=60}if(s<60){return s+" sec"}else{return parseInt(s/60)+" min"}return s}else{if(parseInt(str.split(":")[0])===0){var strArr=str.split(":").slice(1);str=strArr.join(":")}return str}};this.playlistHeight=function(checked){if(zeQuery(".playlistContainer",this.$gallery).css("overflow")=="visible"&&checked){zeQuery(".playlistContainer",this.$gallery).addClass("oldCourseSkin")}if(zeQuery(".playlistContainer",this.$gallery).hasClass("oldCourseSkin")){return}var wnd=self.getWindow();if(wnd.innerWidth<=800){zeQuery(".playlistContainer",this.$gallery).css({height:"auto",overflow:"visible"})}else{var titleHeight=zeQuery(".mediaElement_playlist_title",this.$gallery).outerHeight(true);var height=zeQuery(".mediaElementVideoContainer",this.$gallery).outerHeight(true)-titleHeight;var oldHeight=zeQuery(".playlistContainer",this.$gallery).outerHeight(true);if(oldHeight<height||checked){zeQuery(".playlistContainer",this.$gallery).css({height:height+"px",overflow:"auto"})}}};function escapeQueryString(str){return str.replace(/\?/gi,"%3F").replace(/&/gi,"%26").replace(/=/gi,"%3D")}var escaped_one_to_xml_special_map={"&amp;":"&","&quot;":'"',"&lt;":"<","&gt;":">"};function decodeXml(string){if(!string){return""}else{return string.replace(/(&quot;|&lt;|&gt;|&amp;)/g,function(str,item){return escaped_one_to_xml_special_map[item]})}}function hmsToSecondsOnly(str){if(typeof str=="undefined"){return""}var p=str.split(":"),s=0,m=1;while(p.length>0){s+=m*parseInt(p.pop(),10);m*=60}return s}function toHHMMSS(duration){var seconds=Math.floor(duration),hours=Math.floor(seconds/3600);seconds-=hours*3600;var minutes=Math.floor(seconds/60);seconds-=minutes*60;if(hours<10){hours="0"+hours}if(minutes<10){minutes="0"+minutes}if(seconds<10){seconds="0"+seconds}return hours+":"+minutes+":"+seconds}function orderByTime(timeline){var newOrderedArray=[];for(var i in timeline){newOrderedArray.push({time:i,value:timeline[i]})}newOrderedArray.sort(function(a,b){return hmsToSecondsOnly(a.time)-hmsToSecondsOnly(b.time)});return newOrderedArray}this.getUrl=function(param){var urlParam="";if(this.go.args.anchor_videos=="with_hash"){urlParam=this.getHashtag(param)}else{if(this.go.args.anchor_videos=="with_link"){urlParam=this.getParamFromUrl(param)}}if(urlParam){urlParam=urlParam.replaceAll("!","/")}return urlParam};this.getHashtag=function(preffix){if(typeof preffix=="undefined"){preffix="linkshare"}var reg=new RegExp(preffix+"=(.*?)(?:\\||$)");var wnd=this.getWindow();var url=wnd.location.hash.replace("#","");var hashtag=url.match(reg);if(hashtag&&hashtag.length){return hashtag[1].replaceAll("!","/")}else{return""}};this.getParamFromUrl=function(parameterName,url){var result=null,tmp=[],items;var wnd=this.getWindow();if(typeof url!="undefined"){items=url.substr(1).split("&")}else{items=wnd.location.search.substr(1).split("&")}for(var index=0;index<items.length;index++){tmp=items[index].split("=");if(tmp[0]===parameterName){result=decodeURIComponent(tmp[1])}}return result};function getUrlVars(url){var vars={};var href=url||window.location.href;var parts=href.replace(/[#|]+([^=|]+)=([^|]*)/gi,function(m,key,value){vars[key]=value});return vars}function isHistorySupported(){return window.history&&window.history.pushState}function base64Encode(text){var BASE64_KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(var t=0,n="";t<text.length;){var r=text.charCodeAt(t++),a=text.charCodeAt(t++),u=text.charCodeAt(t++),l=r>>2,o=(3&r)<<4|a>>4,s=(15&a)<<2|u>>6,i=63&u;isNaN(a)?s=i=64:isNaN(u)&&(i=64),n=n+BASE64_KEY_STR.charAt(l)+BASE64_KEY_STR.charAt(o)+BASE64_KEY_STR.charAt(s)+BASE64_KEY_STR.charAt(i)}return n}function is_ie(){var ua=window.navigator.userAgent;var edge=ua.indexOf("Edge/");var msie=ua.indexOf("MSIE ");if(msie>0){return parseInt(ua.substring(msie+5,ua.indexOf(".",msie)))}else{if(!!navigator.userAgent.match(/Trident.*rv\:11\./)){return 11}else{if(edge>0){return(parseInt(ua.substring(edge+5,ua.indexOf(".",edge)),10))}}}return false}function is_ie_hls_supported(){var ua=window.navigator.userAgent;var edge=ua.indexOf("Edge/");var msie=ua.indexOf("MSIE ");if(msie>0){var ver=parseInt(ua.substring(msie+5,ua.indexOf(".",msie)));if(ver<11){return false}}else{if(!!navigator.userAgent.match(/Trident.*rv\:11\./)){if(navigator&&(/(Windows 8.1|Windows NT 6.3)/.test(navigator.appVersion)||/(Windows 10.0|Windows NT 10.0)/.test(navigator.appVersion))){return true}}else{if(edge>0){return true}}}return false}var PF_SRT=function(){var pattern=/(\d+)\n([\d:,]+)\s+-{2}\>\s+([\d:,]+)\n([\s\S]*?(?=\n{2}|$))/gm;var _regExp;var init=function(){_regExp=new RegExp(pattern)};var parse=function(f){if(typeof(f)!="string"){throw"Sorry, Parser accept string only."}var result="";if(f==null){return _subtitles}f=f.replace(/\r\n|\r|\n/g,"\n");while((matches=pattern.exec(f))!=null){result+=toLineObj(matches)}return result};var toLineObj=function(group){return group[4]+"\n"};init();return{parse:parse}}()}};
// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/js/zequery-1.9.1.min.js  D:\WebSites\tmpCincopaAppsV2\_cms/fpskins/mediaelement/1/js/zequery-1.9.1.min.js   3/21/2022 9:13:17 AM 
_cp_preloaded_files["/fpskins/mediaelement/1/js/zequery-1.9.1.min.js"] = true;
if (!window.zeQuery ) /* zeQuery v1.9.1 | (c) 2005, 2012 zeQuery Foundation, Inc. | jquery.org/license
//@ sourceMappingURL=jquery.min.map
*/
if(!window.zeQuery){(function(e,t){var n,r,i=typeof t,o=e.document,a=e.location,s=e.zeQuery,u=e.$,l={},c=[],p="1.9.1",f=c.concat,d=c.push,h=c.slice,g=c.indexOf,m=l.toString,y=l.hasOwnProperty,v=p.trim,b=function(e,t){return new b.fn.init(e,t,r)},x=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,T=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,N=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,k=/^[\],:{}\s]*$/,E=/(?:^|:|,)(?:\s*\[)+/g,S=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,A=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,j=/^-ms-/,D=/-([\da-z])/gi,L=function(e,t){return t.toUpperCase()},H=function(e){(o.addEventListener||"load"===e.type||"complete"===o.readyState)&&(q(),b.ready())},q=function(){o.addEventListener?(o.removeEventListener("DOMContentLoaded",H,!1),e.removeEventListener("load",H,!1)):(o.detachEvent("onreadystatechange",H),e.detachEvent("onload",H))};b.fn=b.prototype={jquery:p,constructor:b,init:function(e,n,r){var i,a;if(!e){return this}if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:N.exec(e),!i||!i[1]&&n){return !n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}if(i[1]){if(n=n instanceof b?n[0]:n,b.merge(this,b.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:o,!0)),C.test(i[1])&&b.isPlainObject(n)){for(i in n){b.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i])}}return this}if(a=o.getElementById(i[2]),a&&a.parentNode){if(a.id!==i[2]){return r.find(e)}this.length=1,this[0]=a}return this.context=o,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):b.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return h.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},slice:function(){return this.pushStack(h.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(b.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:d,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,n,r,i,o,a,s=arguments[0]||{},u=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},u=2),"object"==typeof s||b.isFunction(s)||(s={}),l===u&&(s=this,--u);l>u;u++){if(null!=(o=arguments[u])){for(i in o){e=s[i],r=o[i],s!==r&&(c&&r&&(b.isPlainObject(r)||(n=b.isArray(r)))?(n?(n=!1,a=e&&b.isArray(e)?e:[]):a=e&&b.isPlainObject(e)?e:{},s[i]=b.extend(c,a,r)):r!==t&&(s[i]=r))}}}return s},b.extend({noConflict:function(t){return e.$===b&&(e.$=u),t&&e.zeQuery===b&&(e.zeQuery=s),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(e===!0?!--b.readyWait:!b.isReady){if(!o.body){return setTimeout(b.ready)}b.isReady=!0,e!==!0&&--b.readyWait>0||(n.resolveWith(o,[b]),b.fn.trigger&&b(o).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===b.type(e)},isArray:Array.isArray||function(e){return"array"===b.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return !isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[m.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==b.type(e)||e.nodeType||b.isWindow(e)){return !1}try{if(e.constructor&&!y.call(e,"constructor")&&!y.call(e.constructor.prototype,"isPrototypeOf")){return !1}}catch(n){return !1}var r;for(r in e){}return r===t||y.call(e,r)},isEmptyObject:function(e){var t;for(t in e){return !1}return !0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e){return null}"boolean"==typeof t&&(n=t,t=!1),t=t||o;var r=C.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=b.buildFragment([e],t,i),i&&b(i).remove(),b.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=b.trim(n),n&&k.test(n.replace(S,"@").replace(A,"]").replace(E,"")))?Function("return "+n)():(b.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n){return null}try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&b.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(j,"ms-").replace(D,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,a=M(e);if(n){if(a){for(;o>i;i++){if(r=t.apply(e[i],n),r===!1){break}}}else{for(i in e){if(r=t.apply(e[i],n),r===!1){break}}}}else{if(a){for(;o>i;i++){if(r=t.call(e[i],i,e[i]),r===!1){break}}}else{for(i in e){if(r=t.call(e[i],i,e[i]),r===!1){break}}}}return e},trim:v&&!v.call("\ufeff\u00a0")?function(e){return null==e?"":v.call(e)}:function(e){return null==e?"":(e+"").replace(T,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(M(Object(e))?b.merge(n,"string"==typeof e?[e]:e):d.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(g){return g.call(t,e,n)}for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++){if(n in t&&t[n]===e){return n}}}return -1},merge:function(e,n){var r=n.length,i=e.length,o=0;if("number"==typeof r){for(;r>o;o++){e[i++]=n[o]}}else{while(n[o]!==t){e[i++]=n[o++]}}return e.length=i,e},grep:function(e,t,n){var r,i=[],o=0,a=e.length;for(n=!!n;a>o;o++){r=!!t(e[o],o),n!==r&&i.push(e[o])}return i},map:function(e,t,n){var r,i=0,o=e.length,a=M(e),s=[];if(a){for(;o>i;i++){r=t(e[i],i,n),null!=r&&(s[s.length]=r)}}else{for(i in e){r=t(e[i],i,n),null!=r&&(s[s.length]=r)}}return f.apply([],s)},guid:1,proxy:function(e,n){var r,i,o;return"string"==typeof n&&(o=e[n],n=e,e=o),b.isFunction(e)?(r=h.call(arguments,2),i=function(){return e.apply(n||this,r.concat(h.call(arguments)))},i.guid=e.guid=e.guid||b.guid++,i):t},access:function(e,n,r,i,o,a,s){var u=0,l=e.length,c=null==r;if("object"===b.type(r)){o=!0;for(u in r){b.access(e,n,u,r[u],!0,a,s)}}else{if(i!==t&&(o=!0,b.isFunction(i)||(s=!0),c&&(s?(n.call(e,i),n=null):(c=n,n=function(e,t,n){return c.call(b(e),n)})),n)){for(;l>u;u++){n(e[u],r,s?i:i.call(e[u],u,n(e[u],r)))}}}return o?e:c?n.call(e):l?n(e[0],r):a},now:function(){return(new Date).getTime()}}),b.ready.promise=function(t){if(!n){if(n=b.Deferred(),"complete"===o.readyState){setTimeout(b.ready)}else{if(o.addEventListener){o.addEventListener("DOMContentLoaded",H,!1),e.addEventListener("load",H,!1)}else{o.attachEvent("onreadystatechange",H),e.attachEvent("onload",H);var r=!1;try{r=null==e.frameElement&&o.documentElement}catch(i){}r&&r.doScroll&&function a(){if(!b.isReady){try{r.doScroll("left")}catch(e){return setTimeout(a,50)}q(),b.ready()}}()}}}return n.promise(t)},b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});function M(e){var t=e.length,n=b.type(e);return b.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}r=b(o);var _={};function F(e){var t=_[e]={};return b.each(e.match(w)||[],function(e,n){t[n]=!0}),t}b.Callbacks=function(e){e="string"==typeof e?_[e]||F(e):b.extend({},e);var n,r,i,o,a,s,u=[],l=!e.once&&[],c=function(t){for(r=e.memory&&t,i=!0,a=s||0,s=0,o=u.length,n=!0;u&&o>a;a++){if(u[a].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}}n=!1,u&&(l?l.length&&c(l.shift()):r?u=[]:p.disable())},p={add:function(){if(u){var t=u.length;(function i(t){b.each(t,function(t,n){var r=b.type(n);"function"===r?e.unique&&p.has(n)||u.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?o=u.length:r&&(s=t,c(r))}return this},remove:function(){return u&&b.each(arguments,function(e,t){var r;while((r=b.inArray(t,u,r))>-1){u.splice(r,1),n&&(o>=r&&o--,a>=r&&a--)}}),this},has:function(e){return e?b.inArray(e,u)>-1:!(!u||!u.length)},empty:function(){return u=[],this},disable:function(){return u=l=r=t,this},disabled:function(){return !u},lock:function(){return l=t,r||p.disable(),this},locked:function(){return !l},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!u||i&&!l||(n?l.push(t):c(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return !!i}};return p},b.extend({Deferred:function(e){var t=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return b.Deferred(function(n){b.each(t,function(t,o){var a=o[0],s=b.isFunction(e[t])&&e[t];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?b.extend(e,r):r}},i={};return r.pipe=r.then,b.each(t,function(e,o){var a=o[2],s=o[3];r[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=a.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=h.call(arguments),r=n.length,i=1!==r||e&&b.isFunction(e.promise)?r:0,o=1===i?e:b.Deferred(),a=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?h.call(arguments):r,n===s?o.notifyWith(t,n):--i||o.resolveWith(t,n)}},s,u,l;if(r>1){for(s=Array(r),u=Array(r),l=Array(r);r>t;t++){n[t]&&b.isFunction(n[t].promise)?n[t].promise().done(a(t,l,n)).fail(o.reject).progress(a(t,u,s)):--i}}return i||o.resolveWith(l,n),o.promise()}}),b.support=function(){var t,n,r,a,s,u,l,c,p,f,d=o.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*"),r=d.getElementsByTagName("a")[0],!n||!r||!n.length){return{}}s=o.createElement("select"),l=s.appendChild(o.createElement("option")),a=d.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==d.className,leadingWhitespace:3===d.firstChild.nodeType,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:"/a"===r.getAttribute("href"),opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:!!a.value,optSelected:l.selected,enctype:!!o.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==o.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===o.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!l.disabled;try{delete d.test}catch(h){t.deleteExpando=!1}a=o.createElement("input"),a.setAttribute("value",""),t.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),t.radioValue="t"===a.value,a.setAttribute("checked","t"),a.setAttribute("name","t"),u=o.createDocumentFragment(),u.appendChild(a),t.appendChecked=a.checked,t.checkClone=u.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(f in {submit:!0,change:!0,focusin:!0}){d.setAttribute(c="on"+f,"t"),t[f+"Bubbles"]=c in e||d.attributes[c].expando===!1}return d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip,b(function(){var n,r,a,s="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",u=o.getElementsByTagName("body")[0];u&&(n=o.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",u.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",a=d.getElementsByTagName("td"),a[0].style.cssText="padding:0;margin:0;border:0;display:none",p=0===a[0].offsetHeight,a[0].style.display="",a[1].style.display="none",t.reliableHiddenOffsets=p&&0===a[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===d.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==u.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,r=d.appendChild(o.createElement("div")),r.style.cssText=d.style.cssText=s,r.style.marginRight=r.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof d.style.zoom!==i&&(d.innerHTML="",d.style.cssText=s+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(u.style.zoom=1)),u.removeChild(n),n=d=a=r=null)}),n=s=u=l=r=a=null,t}();var O=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,B=/([A-Z])/g;function P(e,n,r,i){if(b.acceptData(e)){var o,a,s=b.expando,u="string"==typeof n,l=e.nodeType,p=l?b.cache:e,f=l?e[s]:e[s]&&s;if(f&&p[f]&&(i||p[f].data)||!u||r!==t){return f||(l?e[s]=f=c.pop()||b.guid++:f=s),p[f]||(p[f]={},l||(p[f].toJSON=b.noop)),("object"==typeof n||"function"==typeof n)&&(i?p[f]=b.extend(p[f],n):p[f].data=b.extend(p[f].data,n)),o=p[f],i||(o.data||(o.data={}),o=o.data),r!==t&&(o[b.camelCase(n)]=r),u?(a=o[n],null==a&&(a=o[b.camelCase(n)])):a=o,a}}}function R(e,t,n){if(b.acceptData(e)){var r,i,o,a=e.nodeType,s=a?b.cache:e,u=a?e[b.expando]:b.expando;if(s[u]){if(t&&(o=n?s[u]:s[u].data)){b.isArray(t)?t=t.concat(b.map(t,b.camelCase)):t in o?t=[t]:(t=b.camelCase(t),t=t in o?[t]:t.split(" "));for(r=0,i=t.length;i>r;r++){delete o[t[r]]}if(!(n?$:b.isEmptyObject)(o)){return}}(n||(delete s[u].data,$(s[u])))&&(a?b.cleanData([e],!0):b.support.deleteExpando||s!=s.window?delete s[u]:s[u]=null)}}}b.extend({cache:{},expando:"zeQuery"+(p+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?b.cache[e[b.expando]]:e[b.expando],!!e&&!$(e)},data:function(e,t,n){return P(e,t,n)},removeData:function(e,t){return R(e,t)},_data:function(e,t,n){return P(e,t,n,!0)},_removeData:function(e,t){return R(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType){return !1}var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return !t||t!==!0&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(e,n){var r,i,o=this[0],a=0,s=null;if(e===t){if(this.length&&(s=b.data(o),1===o.nodeType&&!b._data(o,"parsedAttrs"))){for(r=o.attributes;r.length>a;a++){i=r[a].name,i.indexOf("data-")||(i=b.camelCase(i.slice(5)),W(o,i,s[i]))}b._data(o,"parsedAttrs",!0)}return s}return"object"==typeof e?this.each(function(){b.data(this,e)}):b.access(this,function(n){return n===t?o?W(o,e,b.data(o,e)):null:(this.each(function(){b.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){b.removeData(this,e)})}});function W(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(B,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:O.test(r)?b.parseJSON(r):r}catch(o){}b.data(e,n,r)}else{r=t}}return r}function $(e){var t;for(t in e){if(("data"!==t||!b.isEmptyObject(e[t]))&&"toJSON"!==t){return !1}}return !0}b.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=b._data(e,n),r&&(!i||b.isArray(r)?i=b._data(e,n,b.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=b.queue(e,t),r=n.length,i=n.shift(),o=b._queueHooks(e,t),a=function(){b.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),o.cur=i,i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return b._data(e,n)||b._data(e,n,{empty:b.Callbacks("once memory").add(function(){b._removeData(e,t+"queue"),b._removeData(e,n)})})}}),b.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?b.queue(this[0],e):n===t?this:this.each(function(){var t=b.queue(this,e,n);b._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(e,t){return e=b.fx?b.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,o=b.Deferred(),a=this,s=this.length,u=function(){--i||o.resolveWith(a,[a])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(s--){r=b._data(a[s],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(u))}return u(),o.promise(n)}});var I,z,X=/[\t\r\n]/g,U=/\r/g,V=/^(?:input|select|textarea|button|object)$/i,Y=/^(?:a|area)$/i,J=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,G=/^(?:checked|selected)$/i,Q=b.support.getSetAttribute,K=b.support.input;b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,a=0,s=this.length,u="string"==typeof e&&e;if(b.isFunction(e)){return this.each(function(t){b(this).addClass(e.call(this,t,this.className))})}if(u){for(t=(e||"").match(w)||[];s>a;a++){if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):" ")){o=0;while(i=t[o++]){0>r.indexOf(" "+i+" ")&&(r+=i+" ")}n.className=b.trim(r)}}}return this},removeClass:function(e){var t,n,r,i,o,a=0,s=this.length,u=0===arguments.length||"string"==typeof e&&e;if(b.isFunction(e)){return this.each(function(t){b(this).removeClass(e.call(this,t,this.className))})}if(u){for(t=(e||"").match(w)||[];s>a;a++){if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):"")){o=0;while(i=t[o++]){while(r.indexOf(" "+i+" ")>=0){r=r.replace(" "+i+" "," ")}}n.className=e?b.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r="boolean"==typeof t;return b.isFunction(e)?this.each(function(n){b(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var o,a=0,s=b(this),u=t,l=e.match(w)||[];while(o=l[a++]){u=r?u:!s.hasClass(o),s[u?"addClass":"removeClass"](o)}}else{(n===i||"boolean"===n)&&(this.className&&b._data(this,"__className__",this.className),this.className=this.className||e===!1?"":b._data(this,"__className__")||"")}})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++){if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(X," ").indexOf(t)>=0){return !0}}return !1},val:function(e){var n,r,i,o=this[0];if(arguments.length){return i=b.isFunction(e),this.each(function(n){var o,a=b(this);1===this.nodeType&&(o=i?e.call(this,n,a.val()):e,null==o?o="":"number"==typeof o?o+="":b.isArray(o)&&(o=b.map(o,function(e){return null==e?"":e+""})),r=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()],r&&"set" in r&&r.set(this,o,"value")!==t||(this.value=o))})}if(o){return r=b.valHooks[o.type]||b.valHooks[o.nodeName.toLowerCase()],r&&"get" in r&&(n=r.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(U,""):null==n?"":n)}}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return !t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,a=o?null:[],s=o?i+1:r.length,u=0>i?s:o?i:0;for(;s>u;u++){if(n=r[u],!(!n.selected&&u!==i||(b.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&b.nodeName(n.parentNode,"optgroup"))){if(t=b(n).val(),o){return t}a.push(t)}}return a},set:function(e,t){var n=b.makeArray(t);return b(e).find("option").each(function(){this.selected=b.inArray(b(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var o,a,s,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u){return typeof e.getAttribute===i?b.prop(e,n,r):(a=1!==u||!b.isXMLDoc(e),a&&(n=n.toLowerCase(),o=b.attrHooks[n]||(J.test(n)?z:I)),r===t?o&&a&&"get" in o&&null!==(s=o.get(e,n))?s:(typeof e.getAttribute!==i&&(s=e.getAttribute(n)),null==s?t:s):null!==r?o&&a&&"set" in o&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r):(b.removeAttr(e,n),t))}},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(w);if(o&&1===e.nodeType){while(n=o[i++]){r=b.propFix[n]||n,J.test(n)?!Q&&G.test(n)?e[b.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:b.attr(e,n,""),e.removeAttribute(Q?n:r)}}},attrHooks:{type:{set:function(e,t){if(!b.support.radioValue&&"radio"===t&&b.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s){return a=1!==s||!b.isXMLDoc(e),a&&(n=b.propFix[n]||n,o=b.propHooks[n]),r!==t?o&&"set" in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get" in o&&null!==(i=o.get(e,n))?i:e[n]}},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):V.test(e.nodeName)||Y.test(e.nodeName)&&e.href?0:t}}}}),z={get:function(e,n){var r=b.prop(e,n),i="boolean"==typeof r&&e.getAttribute(n),o="boolean"==typeof r?K&&Q?null!=i:G.test(n)?e[b.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return o&&o.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?b.removeAttr(e,n):K&&Q||!G.test(n)?e.setAttribute(!Q&&b.propFix[n]||n,n):e[b.camelCase("default-"+n)]=e[n]=!0,n}},K&&Q||(b.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return b.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t},set:function(e,n,r){return b.nodeName(e,"input")?(e.defaultValue=n,t):I&&I.set(e,n,r)}}),Q||(I=b.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&("id"===n||"name"===n||"coords"===n?""!==r.value:r.specified)?r.value:t},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},b.attrHooks.contenteditable={get:I.get,set:function(e,t,n){I.set(e,""===t?!1:t,n)}},b.each(["width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}})})),b.support.hrefNormalized||(b.each(["href","src","width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return null==r?t:r}})}),b.each(["href","src"],function(e,t){b.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,n){return b.isArray(n)?e.checked=b.inArray(b(e).val(),n)>=0:t}})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;function it(){return !0}function ot(){return !1}b.event={global:{},add:function(e,n,r,o,a){var s,u,l,c,p,f,d,h,g,m,y,v=b._data(e);if(v){r.handler&&(c=r,r=c.handler,a=c.selector),r.guid||(r.guid=b.guid++),(u=v.events)||(u=v.events={}),(f=v.handle)||(f=v.handle=function(e){return typeof b===i||e&&b.event.triggered===e.type?t:b.event.dispatch.apply(f.elem,arguments)},f.elem=e),n=(n||"").match(w)||[""],l=n.length;while(l--){s=rt.exec(n[l])||[],g=y=s[1],m=(s[2]||"").split(".").sort(),p=b.event.special[g]||{},g=(a?p.delegateType:p.bindType)||g,p=b.event.special[g]||{},d=b.extend({type:g,origType:y,data:o,handler:r,guid:r.guid,selector:a,needsContext:a&&b.expr.match.needsContext.test(a),namespace:m.join(".")},c),(h=u[g])||(h=u[g]=[],h.delegateCount=0,p.setup&&p.setup.call(e,o,m,f)!==!1||(e.addEventListener?e.addEventListener(g,f,!1):e.attachEvent&&e.attachEvent("on"+g,f))),p.add&&(p.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),a?h.splice(h.delegateCount++,0,d):h.push(d),b.event.global[g]=!0}e=null}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,p,f,d,h,g,m=b.hasData(e)&&b._data(e);if(m&&(c=m.events)){t=(t||"").match(w)||[""],l=t.length;while(l--){if(s=rt.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){p=b.event.special[d]||{},d=(r?p.delegateType:p.bindType)||d,f=c[d]||[],s=s[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=o=f.length;while(o--){a=f[o],!i&&g!==a.origType||n&&n.guid!==a.guid||s&&!s.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(f.splice(o,1),a.selector&&f.delegateCount--,p.remove&&p.remove.call(e,a))}u&&!f.length&&(p.teardown&&p.teardown.call(e,h,m.handle)!==!1||b.removeEvent(e,d,m.handle),delete c[d])}else{for(d in c){b.event.remove(e,d+t[l],n,r,!0)}}}b.isEmptyObject(c)&&(delete m.handle,b._removeData(e,"events"))}},trigger:function(n,r,i,a){var s,u,l,c,p,f,d,h=[i||o],g=y.call(n,"type")?n.type:n,m=y.call(n,"namespace")?n.namespace.split("."):[];if(l=f=i=i||o,3!==i.nodeType&&8!==i.nodeType&&!nt.test(g+b.event.triggered)&&(g.indexOf(".")>=0&&(m=g.split("."),g=m.shift(),m.sort()),u=0>g.indexOf(":")&&"on"+g,n=n[b.expando]?n:new b.Event(g,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:b.makeArray(r,[n]),p=b.event.special[g]||{},a||!p.trigger||p.trigger.apply(i,r)!==!1)){if(!a&&!p.noBubble&&!b.isWindow(i)){for(c=p.delegateType||g,nt.test(c+g)||(l=l.parentNode);l;l=l.parentNode){h.push(l),f=l}f===(i.ownerDocument||o)&&h.push(f.defaultView||f.parentWindow||e)}d=0;while((l=h[d++])&&!n.isPropagationStopped()){n.type=d>1?c:p.bindType||g,s=(b._data(l,"events")||{})[n.type]&&b._data(l,"handle"),s&&s.apply(l,r),s=u&&l[u],s&&b.acceptData(l)&&s.apply&&s.apply(l,r)===!1&&n.preventDefault()}if(n.type=g,!(a||n.isDefaultPrevented()||p._default&&p._default.apply(i.ownerDocument,r)!==!1||"click"===g&&b.nodeName(i,"a")||!b.acceptData(i)||!u||!i[g]||b.isWindow(i))){f=i[u],f&&(i[u]=null),b.event.triggered=g;try{i[g]()}catch(v){}b.event.triggered=t,f&&(i[u]=f)}return n.result}},dispatch:function(e){e=b.event.fix(e);var n,r,i,o,a,s=[],u=h.call(arguments),l=(b._data(this,"events")||{})[e.type]||[],c=b.event.special[e.type]||{};if(u[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){s=b.event.handlers.call(this,e,l),n=0;while((o=s[n++])&&!e.isPropagationStopped()){e.currentTarget=o.elem,a=0;while((i=o.handlers[a++])&&!e.isImmediatePropagationStopped()){(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((b.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,u),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}}return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,o,a,s=[],u=n.delegateCount,l=e.target;if(u&&l.nodeType&&(!e.button||"click"!==e.type)){for(;l!=this;l=l.parentNode||this){if(1===l.nodeType&&(l.disabled!==!0||"click"!==e.type)){for(o=[],a=0;u>a;a++){i=n[a],r=i.selector+" ",o[r]===t&&(o[r]=i.needsContext?b(r,this).index(l)>=0:b.find(r,this,null,[l]).length),o[r]&&o.push(i)}o.length&&s.push({elem:l,handlers:o})}}}return n.length>u&&s.push({elem:this,handlers:n.slice(u)}),s},fix:function(e){if(e[b.expando]){return e}var t,n,r,i=e.type,a=e,s=this.fixHooks[i];s||(this.fixHooks[i]=s=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new b.Event(a),t=r.length;while(t--){n=r[t],e[n]=a[n]}return e.target||(e.target=a.srcElement||o),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,a):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,a,s=n.button,u=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||o,a=i.documentElement,r=i.body,e.pageX=n.clientX+(a&&a.scrollLeft||r&&r.scrollLeft||0)-(a&&a.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(a&&a.scrollTop||r&&r.scrollTop||0)-(a&&a.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&u&&(e.relatedTarget=u===e.target?n.toElement:u),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return b.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==o.activeElement&&this.focus){try{return this.focus(),!1}catch(e){}}},delegateType:"focusin"},blur:{trigger:function(){return this===o.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=b.extend(new b.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?b.event.trigger(i,null,t):b.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},b.removeEvent=o.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},b.Event=function(e,n){return this instanceof b.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:ot):this.type=e,n&&b.extend(this,n),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0,t):new b.Event(e,n)},b.Event.prototype={isDefaultPrevented:ot,isPropagationStopped:ot,isImmediatePropagationStopped:ot,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return(!i||i!==r&&!b.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){return b.nodeName(this,"form")?!1:(b.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=b.nodeName(n,"input")||b.nodeName(n,"button")?n.form:t;r&&!b._data(r,"submitBubbles")&&(b.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),b._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return b.nodeName(this,"form")?!1:(b.event.remove(this,"._submit"),t)}}),b.support.changeBubbles||(b.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(b.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)})),!1):(b.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!b._data(t,"changeBubbles")&&(b.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||b.event.simulate("change",this.parentNode,e,!0)}),b._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return b.event.remove(this,"._change"),!Z.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){b.event.simulate(t,e.target,b.event.fix(e),!0)};b.event.special[t]={setup:function(){0===n++&&o.addEventListener(e,r,!0)},teardown:function(){0===--n&&o.removeEventListener(e,r,!0)}}}),b.fn.extend({on:function(e,n,r,i,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(a in e){this.on(a,n,r,e[a],o)}return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1){i=ot}else{if(!i){return this}}return 1===o&&(s=i,i=function(e){return b().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=b.guid++)),this.each(function(){b.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,o;if(e&&e.preventDefault&&e.handleObj){return i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this}if("object"==typeof e){for(o in e){this.off(o,n,e[o])}return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=ot),this.each(function(){b.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?b.event.trigger(e,n,r,!0):t}}),function(e,t){var n,r,i,o,a,s,u,l,c,p,f,d,h,g,m,y,v,x="sizzle"+-new Date,w=e.document,T={},N=0,C=0,k=it(),E=it(),S=it(),A=typeof t,j=1<<31,D=[],L=D.pop,H=D.push,q=D.slice,M=D.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++){if(this[t]===e){return t}}return -1},_="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=F.replace("w","w#"),B="([*^$|!~]?=)",P="\\["+_+"*("+F+")"+_+"*(?:"+B+_+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+O+")|)|)"+_+"*\\]",R=":("+F+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+P.replace(3,8)+")*)|.*)\\)|)",W=RegExp("^"+_+"+|((?:^|[^\\\\])(?:\\\\.)*)"+_+"+$","g"),$=RegExp("^"+_+"*,"+_+"*"),I=RegExp("^"+_+"*([\\x20\\t\\r\\n\\f>+~])"+_+"*"),z=RegExp(R),X=RegExp("^"+O+"$"),U={ID:RegExp("^#("+F+")"),CLASS:RegExp("^\\.("+F+")"),NAME:RegExp("^\\[name=['\"]?("+F+")['\"]?\\]"),TAG:RegExp("^("+F.replace("w","w*")+")"),ATTR:RegExp("^"+P),PSEUDO:RegExp("^"+R),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+_+"*(even|odd|(([+-]|)(\\d*)n|)"+_+"*(?:([+-]|)"+_+"*(\\d+)|))"+_+"*\\)|)","i"),needsContext:RegExp("^"+_+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+_+"*((?:-\\d)?\\d*)"+_+"*\\)|)(?=[^-]|$)","i")},V=/[\x20\t\r\n\f]*[+~]/,Y=/^[^{]+\{\s*\[native code/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,G=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,K=/'|\\/g,Z=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,et=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,tt=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{q.call(w.documentElement.childNodes,0)[0].nodeType}catch(nt){q=function(e){var t,n=[];while(t=this[e++]){n.push(t)}return n}}function rt(e){return Y.test(e+"")}function it(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function ot(e){return e[x]=!0,e}function at(e){var t=p.createElement("div");try{return e(t)}catch(n){return !1}finally{t=null}}function st(e,t,n,r){var i,o,a,s,u,l,f,g,m,v;if((t?t.ownerDocument||t:w)!==p&&c(t),t=t||p,n=n||[],!e||"string"!=typeof e){return n}if(1!==(s=t.nodeType)&&9!==s){return[]}if(!d&&!r){if(i=J.exec(e)){if(a=i[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode){return n}if(o.id===a){return n.push(o),n}}else{if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&y(t,o)&&o.id===a){return n.push(o),n}}}else{if(i[2]){return H.apply(n,q.call(t.getElementsByTagName(e),0)),n}if((a=i[3])&&T.getByClassName&&t.getElementsByClassName){return H.apply(n,q.call(t.getElementsByClassName(a),0)),n}}}if(T.qsa&&!h.test(e)){if(f=!0,g=x,m=t,v=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){l=ft(e),(f=t.getAttribute("id"))?g=f.replace(K,"\\$&"):t.setAttribute("id",g),g="[id='"+g+"'] ",u=l.length;while(u--){l[u]=g+dt(l[u])}m=V.test(e)&&t.parentNode||t,v=l.join(",")}if(v){try{return H.apply(n,q.call(m.querySelectorAll(v),0)),n}catch(b){}finally{f||t.removeAttribute("id")}}}}return wt(e.replace(W,"$1"),t,n,r)}a=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},c=st.setDocument=function(e){var n=e?e.ownerDocument||e:w;return n!==p&&9===n.nodeType&&n.documentElement?(p=n,f=n.documentElement,d=a(n),T.tagNameNoComments=at(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),T.attributes=at(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),T.getByClassName=at(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),T.getByName=at(function(e){e.id=x+0,e.innerHTML="<a name='"+x+"'></a><div name='"+x+"'></div>",f.insertBefore(e,f.firstChild);var t=n.getElementsByName&&n.getElementsByName(x).length===2+n.getElementsByName(x+0).length;return T.getIdNotName=!n.getElementById(x),f.removeChild(e),t}),i.attrHandle=at(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==A&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},T.getIdNotName?(i.find.ID=function(e,t){if(typeof t.getElementById!==A&&!d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==A&&!d){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==A&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==A&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=T.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==A?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++]){1===n.nodeType&&r.push(n)}return r}return o},i.find.NAME=T.getByName&&function(e,n){return typeof n.getElementsByName!==A?n.getElementsByName(name):t},i.find.CLASS=T.getByClassName&&function(e,n){return typeof n.getElementsByClassName===A||d?t:n.getElementsByClassName(e)},g=[],h=[":focus"],(T.qsa=rt(n.querySelectorAll))&&(at(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||h.push("\\["+_+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||h.push(":checked")}),at(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&h.push("[*^$]="+_+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||h.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),h.push(",.*:")})),(T.matchesSelector=rt(m=f.matchesSelector||f.mozMatchesSelector||f.webkitMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&at(function(e){T.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),g.push("!=",R)}),h=RegExp(h.join("|")),g=RegExp(g.join("|")),y=rt(f.contains)||f.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t){while(t=t.parentNode){if(t===e){return !0}}}return !1},v=f.compareDocumentPosition?function(e,t){var r;return e===t?(u=!0,0):(r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&r||e.parentNode&&11===e.parentNode.nodeType?e===n||y(w,e)?-1:t===n||y(w,t)?1:0:4&r?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,o=e.parentNode,a=t.parentNode,s=[e],l=[t];if(e===t){return u=!0,0}if(!o||!a){return e===n?-1:t===n?1:o?-1:a?1:0}if(o===a){return ut(e,t)}r=e;while(r=r.parentNode){s.unshift(r)}r=t;while(r=r.parentNode){l.unshift(r)}while(s[i]===l[i]){i++}return i?ut(s[i],l[i]):s[i]===w?-1:l[i]===w?1:0},u=!1,[0,0].sort(v),T.detectDuplicates=u,p):p},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&c(e),t=t.replace(Z,"='$1']"),!(!T.matchesSelector||d||g&&g.test(t)||h.test(t))){try{var n=m.call(e,t);if(n||T.disconnectedMatch||e.document&&11!==e.document.nodeType){return n}}catch(r){}}return st(t,p,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==p&&c(e),y(e,t)},st.attr=function(e,t){var n;return(e.ownerDocument||e)!==p&&c(e),d||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):d||T.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},st.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,n=[],r=1,i=0;if(u=!T.detectDuplicates,e.sort(v),u){for(;t=e[r];r++){t===e[r-1]&&(i=n.push(r))}while(i--){e.splice(n[i],1)}}return e};function ut(e,t){var n=t&&e,r=n&&(~t.sourceIndex||j)-(~e.sourceIndex||j);if(r){return r}if(n){while(n=n.nextSibling){if(n===t){return -1}}}return e?1:-1}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pt(e){return ot(function(t){return t=+t,ot(function(n,r){var i,o=e([],n.length,t),a=o.length;while(a--){n[i=o[a]]&&(n[i]=!(r[i]=n[i]))}})})}o=st.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent){return e.textContent}for(e=e.firstChild;e;e=e.nextSibling){n+=o(e)}}else{if(3===i||4===i){return e.nodeValue}}}else{for(;t=e[r];r++){n+=o(t)}}return n},i=st.selectors={cacheLength:50,createPseudo:ot,match:U,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return U.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&z.test(n)&&(t=ft(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return !0}:(e=e.replace(et,tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[e+" "];return t||(t=RegExp("(^|"+_+")"+e+"("+_+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==A&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return !!e.parentNode}:function(t,n,u){var l,c,p,f,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),v=!u&&!s;if(m){if(o){while(g){p=t;while(p=p[g]){if(s?p.nodeName.toLowerCase()===y:1===p.nodeType){return !1}}h=g="only"===e&&!h&&"nextSibling"}return !0}if(h=[a?m.firstChild:m.lastChild],a&&v){c=m[x]||(m[x]={}),l=c[e]||[],d=l[0]===N&&l[1],f=l[0]===N&&l[2],p=d&&m.childNodes[d];while(p=++d&&p&&p[g]||(f=d=0)||h.pop()){if(1===p.nodeType&&++f&&p===t){c[e]=[N,d,f];break}}}else{if(v&&(l=(t[x]||(t[x]={}))[e])&&l[0]===N){f=l[1]}else{while(p=++d&&p&&p[g]||(f=d=0)||h.pop()){if((s?p.nodeName.toLowerCase()===y:1===p.nodeType)&&++f&&(v&&((p[x]||(p[x]={}))[e]=[N,f]),p===t)){break}}}}return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return r[x]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?ot(function(e,n){var i,o=r(e,t),a=o.length;while(a--){i=M.call(e,o[a]),e[i]=!(n[i]=o[a])}}):function(e){return r(e,0,n)}):r}},pseudos:{not:ot(function(e){var t=[],n=[],r=s(e.replace(W,"$1"));return r[x]?ot(function(e,t,n,i){var o,a=r(e,null,i,[]),s=e.length;while(s--){(o=a[s])&&(e[s]=!(t[s]=o))}}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:ot(function(e){return function(t){return st(e,t).length>0}}),contains:ot(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:ot(function(e){return X.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do{if(n=d?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang){return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-")}}while((t=t.parentNode)&&1===t.nodeType);return !1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling){if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType){return !1}}return !0},parent:function(e){return !i.pseudos.empty(e)},header:function(e){return Q.test(e.nodeName)},input:function(e){return G.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[0>n?n+t:n]}),even:pt(function(e,t){var n=0;for(;t>n;n+=2){e.push(n)}return e}),odd:pt(function(e,t){var n=1;for(;t>n;n+=2){e.push(n)}return e}),lt:pt(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;){e.push(r)}return e}),gt:pt(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;){e.push(r)}return e})}};for(n in {radio:!0,checkbox:!0,file:!0,password:!0,image:!0}){i.pseudos[n]=lt(n)}for(n in {submit:!0,reset:!0}){i.pseudos[n]=ct(n)}function ft(e,t){var n,r,o,a,s,u,l,c=E[e+" "];if(c){return t?0:c.slice(0)}s=e,u=[],l=i.preFilter;while(s){(!n||(r=$.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),u.push(o=[])),n=!1,(r=I.exec(s))&&(n=r.shift(),o.push({value:n,type:r[0].replace(W," ")}),s=s.slice(n.length));for(a in i.filter){!(r=U[a].exec(s))||l[a]&&!(r=l[a](r))||(n=r.shift(),o.push({value:n,type:a,matches:r}),s=s.slice(n.length))}if(!n){break}}return t?s.length:s?st.error(e):E(e,u).slice(0)}function dt(e){var t=0,n=e.length,r="";for(;n>t;t++){r+=e[t].value}return r}function ht(e,t,n){var i=t.dir,o=n&&"parentNode"===i,a=C++;return t.first?function(t,n,r){while(t=t[i]){if(1===t.nodeType||o){return e(t,n,r)}}}:function(t,n,s){var u,l,c,p=N+" "+a;if(s){while(t=t[i]){if((1===t.nodeType||o)&&e(t,n,s)){return !0}}}else{while(t=t[i]){if(1===t.nodeType||o){if(c=t[x]||(t[x]={}),(l=c[i])&&l[0]===p){if((u=l[1])===!0||u===r){return u===!0}}else{if(l=c[i]=[p],l[1]=e(t,n,s)||r,l[1]===!0){return !0}}}}}}}function gt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--){if(!e[i](t,n,r)){return !1}}return !0}:e[0]}function mt(e,t,n,r,i){var o,a=[],s=0,u=e.length,l=null!=t;for(;u>s;s++){(o=e[s])&&(!n||n(o,r,i))&&(a.push(o),l&&t.push(s))}return a}function yt(e,t,n,r,i,o){return r&&!r[x]&&(r=yt(r)),i&&!i[x]&&(i=yt(i,o)),ot(function(o,a,s,u){var l,c,p,f=[],d=[],h=a.length,g=o||xt(t||"*",s.nodeType?[s]:s,[]),m=!e||!o&&t?g:mt(g,f,e,s,u),y=n?i||(o?e:h||r)?[]:a:m;if(n&&n(m,y,s,u),r){l=mt(y,d),r(l,[],s,u),c=l.length;while(c--){(p=l[c])&&(y[d[c]]=!(m[d[c]]=p))}}if(o){if(i||e){if(i){l=[],c=y.length;while(c--){(p=y[c])&&l.push(m[c]=p)}i(null,y=[],l,u)}c=y.length;while(c--){(p=y[c])&&(l=i?M.call(o,p):f[c])>-1&&(o[l]=!(a[l]=p))}}}else{y=mt(y===a?y.splice(h,y.length):y),i?i(null,a,y,u):H.apply(a,y)}})}function vt(e){var t,n,r,o=e.length,a=i.relative[e[0].type],s=a||i.relative[" "],u=a?1:0,c=ht(function(e){return e===t},s,!0),p=ht(function(e){return M.call(t,e)>-1},s,!0),f=[function(e,n,r){return !a&&(r||n!==l)||((t=n).nodeType?c(e,n,r):p(e,n,r))}];for(;o>u;u++){if(n=i.relative[e[u].type]){f=[ht(gt(f),n)]}else{if(n=i.filter[e[u].type].apply(null,e[u].matches),n[x]){for(r=++u;o>r;r++){if(i.relative[e[r].type]){break}}return yt(u>1&&gt(f),u>1&&dt(e.slice(0,u-1)).replace(W,"$1"),n,r>u&&vt(e.slice(u,r)),o>r&&vt(e=e.slice(r)),o>r&&dt(e))}f.push(n)}}return gt(f)}function bt(e,t){var n=0,o=t.length>0,a=e.length>0,s=function(s,u,c,f,d){var h,g,m,y=[],v=0,b="0",x=s&&[],w=null!=d,T=l,C=s||a&&i.find.TAG("*",d&&u.parentNode||u),k=N+=null==T?1:Math.random()||0.1;for(w&&(l=u!==p&&u,r=n);null!=(h=C[b]);b++){if(a&&h){g=0;while(m=e[g++]){if(m(h,u,c)){f.push(h);break}}w&&(N=k,r=++n)}o&&((h=!m&&h)&&v--,s&&x.push(h))}if(v+=b,o&&b!==v){g=0;while(m=t[g++]){m(x,y,u,c)}if(s){if(v>0){while(b--){x[b]||y[b]||(y[b]=L.call(f))}}y=mt(y)}H.apply(f,y),w&&!s&&y.length>0&&v+t.length>1&&st.uniqueSort(f)}return w&&(N=k,l=T),x};return o?ot(s):s}s=st.compile=function(e,t){var n,r=[],i=[],o=S[e+" "];if(!o){t||(t=ft(e)),n=t.length;while(n--){o=vt(t[n]),o[x]?r.push(o):i.push(o)}o=S(e,bt(i,r))}return o};function xt(e,t,n){var r=0,i=t.length;for(;i>r;r++){st(e,t[r],n)}return n}function wt(e,t,n,r){var o,a,u,l,c,p=ft(e);if(!r&&1===p.length){if(a=p[0]=p[0].slice(0),a.length>2&&"ID"===(u=a[0]).type&&9===t.nodeType&&!d&&i.relative[a[1].type]){if(t=i.find.ID(u.matches[0].replace(et,tt),t)[0],!t){return n}e=e.slice(a.shift().value.length)}o=U.needsContext.test(e)?0:a.length;while(o--){if(u=a[o],i.relative[l=u.type]){break}if((c=i.find[l])&&(r=c(u.matches[0].replace(et,tt),V.test(a[0].type)&&t.parentNode||t))){if(a.splice(o,1),e=r.length&&dt(a),!e){return H.apply(n,q.call(r,0)),n}break}}}return s(e,p)(r,t,d,n,V.test(e)),n}i.pseudos.nth=i.pseudos.eq;function Tt(){}i.filters=Tt.prototype=i.pseudos,i.setFilters=new Tt,c(),st.attr=b.attr,b.find=st,b.expr=st.selectors,b.expr[":"]=b.expr.pseudos,b.unique=st.uniqueSort,b.text=st.getText,b.isXMLDoc=st.isXML,b.contains=st.contains}(e);var at=/Until$/,st=/^(?:parents|prev(?:Until|All))/,ut=/^.[^:#\[\.,]*$/,lt=b.expr.match.needsContext,ct={children:!0,contents:!0,next:!0,prev:!0};b.fn.extend({find:function(e){var t,n,r,i=this.length;if("string"!=typeof e){return r=this,this.pushStack(b(e).filter(function(){for(t=0;i>t;t++){if(b.contains(r[t],this)){return !0}}}))}for(n=[],t=0;i>t;t++){b.find(e,this[t],n)}return n=this.pushStack(i>1?b.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=b(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++){if(b.contains(this,n[t])){return !0}}})},not:function(e){return this.pushStack(ft(this,e,!1))},filter:function(e){return this.pushStack(ft(this,e,!0))},is:function(e){return !!e&&("string"==typeof e?lt.test(e)?b(e,this.context).index(this[0])>=0:b.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,o=[],a=lt.test(e)||"string"!=typeof e?b(e,t||this.context):0;for(;i>r;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&11!==n.nodeType){if(a?a.index(n)>-1:b.find.matchesSelector(n,e)){o.push(n);break}n=n.parentNode}}return this.pushStack(o.length>1?b.unique(o):o)},index:function(e){return e?"string"==typeof e?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),r=b.merge(this.get(),n);return this.pushStack(b.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack;function pt(e,t){do{e=e[t]}while(e&&1!==e.nodeType);return e}b.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,n){return b.dir(e,"parentNode",n)},next:function(e){return pt(e,"nextSibling")},prev:function(e){return pt(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,n){return b.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return b.dir(e,"previousSibling",n)},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(e,t){b.fn[e]=function(n,r){var i=b.map(this,t,n);return at.test(e)||(r=n),r&&"string"==typeof r&&(i=b.filter(r,i)),i=this.length>1&&!ct[e]?b.unique(i):i,this.length>1&&st.test(e)&&(i=i.reverse()),this.pushStack(i)}}),b.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,n,r){var i=[],o=e[n];while(o&&9!==o.nodeType&&(r===t||1!==o.nodeType||!b(o).is(r))){1===o.nodeType&&i.push(o),o=o[n]}return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling){1===e.nodeType&&e!==t&&n.push(e)}return n}});function ft(e,t,n){if(t=t||0,b.isFunction(t)){return b.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n})}if(t.nodeType){return b.grep(e,function(e){return e===t===n})}if("string"==typeof t){var r=b.grep(e,function(e){return 1===e.nodeType});if(ut.test(t)){return b.filter(t,r,!n)}t=b.filter(t,r)}return b.grep(e,function(e){return b.inArray(e,t)>=0===n})}function dt(e){var t=ht.split("|"),n=e.createDocumentFragment();if(n.createElement){while(t.length){n.createElement(t.pop())}}return n}var ht="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gt=/ zeQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+ht+")[\\s/>]","i"),yt=/^\s+/,vt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,xt=/<tbody/i,wt=/<|&#?\w+;/,Tt=/<(?:script|style|link)/i,Nt=/^(?:checkbox|radio)$/i,Ct=/checked\s*(?:[^=]|=\s*.checked.)/i,kt=/^$|\/(?:java|ecma)script/i,Et=/^true\/(.*)/,St=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,At={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:b.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},jt=dt(o),Dt=jt.appendChild(o.createElement("div"));At.optgroup=At.option,At.tbody=At.tfoot=At.colgroup=At.caption=At.thead,At.th=At.td,b.fn.extend({text:function(e){return b.access(this,function(e){return e===t?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||o).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(b.isFunction(e)){return this.each(function(t){b(this).wrapAll(e.call(this,t))})}if(this[0]){var t=b(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType){e=e.firstChild}return e}).append(this)}return this},wrapInner:function(e){return b.isFunction(e)?this.each(function(t){b(this).wrapInner(e.call(this,t))}):this.each(function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=b.isFunction(e);return this.each(function(n){b(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=0;for(;null!=(n=this[r]);r++){(!e||b.filter(e,[n]).length>0)&&(t||1!==n.nodeType||b.cleanData(Ot(n)),n.parentNode&&(t&&b.contains(n.ownerDocument,n)&&Mt(Ot(n,"script")),n.parentNode.removeChild(n)))}return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++){1===e.nodeType&&b.cleanData(Ot(e,!1));while(e.firstChild){e.removeChild(e.firstChild)}e.options&&b.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t){return 1===n.nodeType?n.innerHTML.replace(gt,""):t}if(!("string"!=typeof e||Tt.test(e)||!b.support.htmlSerialize&&mt.test(e)||!b.support.leadingWhitespace&&yt.test(e)||At[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(vt,"<$1></$2>");try{for(;i>r;r++){n=this[r]||{},1===n.nodeType&&(b.cleanData(Ot(n,!1)),n.innerHTML=e)}n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=b.isFunction(e);return t||"string"==typeof e||(e=b(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(b(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=f.apply([],e);var i,o,a,s,u,l,c=0,p=this.length,d=this,h=p-1,g=e[0],m=b.isFunction(g);if(m||!(1>=p||"string"!=typeof g||b.support.checkClone)&&Ct.test(g)){return this.each(function(i){var o=d.eq(i);m&&(e[0]=g.call(this,i,n?o.html():t)),o.domManip(e,n,r)})}if(p&&(l=b.buildFragment(e,this[0].ownerDocument,!1,this),i=l.firstChild,1===l.childNodes.length&&(l=i),i)){for(n=n&&b.nodeName(i,"tr"),s=b.map(Ot(l,"script"),Ht),a=s.length;p>c;c++){o=l,c!==h&&(o=b.clone(o,!0,!0),a&&b.merge(s,Ot(o,"script"))),r.call(n&&b.nodeName(this[c],"table")?Lt(this[c],"tbody"):this[c],o,c)}if(a){for(u=s[s.length-1].ownerDocument,b.map(s,qt),c=0;a>c;c++){o=s[c],kt.test(o.type||"")&&!b._data(o,"globalEval")&&b.contains(u,o)&&(o.src?b.ajax({url:o.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):b.globalEval((o.text||o.textContent||o.innerHTML||"").replace(St,"")))}}l=i=null}return this}});function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function Ht(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function qt(e){var t=Et.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Mt(e,t){var n,r=0;for(;null!=(n=e[r]);r++){b._data(n,"globalEval",!t||b._data(t[r],"globalEval"))}}function _t(e,t){if(1===t.nodeType&&b.hasData(e)){var n,r,i,o=b._data(e),a=b._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s){for(r=0,i=s[n].length;i>r;r++){b.event.add(t,n,s[n][r])}}}a.data&&(a.data=b.extend({},a.data))}}function Ft(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!b.support.noCloneEvent&&t[b.expando]){i=b._data(t);for(r in i.events){b.removeEvent(t,r,i.handle)}t.removeAttribute(b.expando)}"script"===n&&t.text!==e.text?(Ht(t).text=e.text,qt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Nt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){var n,r=0,i=[],o=b(e),a=o.length-1;for(;a>=r;r++){n=r===a?this:this.clone(!0),b(o[r])[t](n),d.apply(i,n.get())}return this.pushStack(i)}});function Ot(e,n){var r,o,a=0,s=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!s){for(s=[],r=e.childNodes||e;null!=(o=r[a]);a++){!n||b.nodeName(o,n)?s.push(o):b.merge(s,Ot(o,n))}}return n===t||n&&b.nodeName(e,n)?b.merge([e],s):s}function Bt(e){Nt.test(e.type)&&(e.defaultChecked=e.checked)}b.extend({clone:function(e,t,n){var r,i,o,a,s,u=b.contains(e.ownerDocument,e);if(b.support.html5Clone||b.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Dt.innerHTML=e.outerHTML,Dt.removeChild(o=Dt.firstChild)),!(b.support.noCloneEvent&&b.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e))){for(r=Ot(o),s=Ot(e),a=0;null!=(i=s[a]);++a){r[a]&&Ft(i,r[a])}}if(t){if(n){for(s=s||Ot(e),r=r||Ot(o),a=0;null!=(i=s[a]);a++){_t(i,r[a])}}else{_t(e,o)}}return r=Ot(o,"script"),r.length>0&&Mt(r,!u&&Ot(e,"script")),r=s=i=null,o},buildFragment:function(e,t,n,r){var i,o,a,s,u,l,c,p=e.length,f=dt(t),d=[],h=0;for(;p>h;h++){if(o=e[h],o||0===o){if("object"===b.type(o)){b.merge(d,o.nodeType?[o]:o)}else{if(wt.test(o)){s=s||f.appendChild(t.createElement("div")),u=(bt.exec(o)||["",""])[1].toLowerCase(),c=At[u]||At._default,s.innerHTML=c[1]+o.replace(vt,"<$1></$2>")+c[2],i=c[0];while(i--){s=s.lastChild}if(!b.support.leadingWhitespace&&yt.test(o)&&d.push(t.createTextNode(yt.exec(o)[0])),!b.support.tbody){o="table"!==u||xt.test(o)?"<table>"!==c[1]||xt.test(o)?0:s:s.firstChild,i=o&&o.childNodes.length;while(i--){b.nodeName(l=o.childNodes[i],"tbody")&&!l.childNodes.length&&o.removeChild(l)}}b.merge(d,s.childNodes),s.textContent="";while(s.firstChild){s.removeChild(s.firstChild)}s=f.lastChild}else{d.push(t.createTextNode(o))}}}}s&&f.removeChild(s),b.support.appendChecked||b.grep(Ot(d,"input"),Bt),h=0;while(o=d[h++]){if((!r||-1===b.inArray(o,r))&&(a=b.contains(o.ownerDocument,o),s=Ot(f.appendChild(o),"script"),a&&Mt(s),n)){i=0;while(o=s[i++]){kt.test(o.type||"")&&n.push(o)}}}return s=null,f},cleanData:function(e,t){var n,r,o,a,s=0,u=b.expando,l=b.cache,p=b.support.deleteExpando,f=b.event.special;for(;null!=(n=e[s]);s++){if((t||b.acceptData(n))&&(o=n[u],a=o&&l[o])){if(a.events){for(r in a.events){f[r]?b.event.remove(n,r):b.removeEvent(n,r,a.handle)}}l[o]&&(delete l[o],p?delete n[u]:typeof n.removeAttribute!==i?n.removeAttribute(u):n[u]=null,c.push(o))}}}});var Pt,Rt,Wt,$t=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,zt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Ut=/^margin/,Vt=RegExp("^("+x+")(.*)$","i"),Yt=RegExp("^("+x+")(?!px)[a-z%]+$","i"),Jt=RegExp("^([+-])=("+x+")","i"),Gt={BODY:"block"},Qt={position:"absolute",visibility:"hidden",display:"block"},Kt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];function tn(e,t){if(t in e){return t}var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--){if(t=en[i]+n,t in e){return t}}return r}function nn(e,t){return e=t||e,"none"===b.css(e,"display")||!b.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,o=[],a=0,s=e.length;for(;s>a;a++){r=e[a],r.style&&(o[a]=b._data(r,"olddisplay"),n=r.style.display,t?(o[a]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(o[a]=b._data(r,"olddisplay",un(r.nodeName)))):o[a]||(i=nn(r),(n&&"none"!==n||!i)&&b._data(r,"olddisplay",i?n:b.css(r,"display"))))}for(a=0;s>a;a++){r=e[a],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[a]||"":"none"))}return e}b.fn.extend({css:function(e,n){return b.access(this,function(e,n,r){var i,o,a={},s=0;if(b.isArray(n)){for(o=Rt(e),i=n.length;i>s;s++){a[n[s]]=b.css(e,n[s],!1,o)}return a}return r!==t?b.style(e,n,r):b.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:nn(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Wt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,u=b.camelCase(n),l=e.style;if(n=b.cssProps[u]||(b.cssProps[u]=tn(l,u)),s=b.cssHooks[n]||b.cssHooks[u],r===t){return s&&"get" in s&&(o=s.get(e,!1,i))!==t?o:l[n]}if(a=typeof r,"string"===a&&(o=Jt.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(b.css(e,n)),a="number"),!(null==r||"number"===a&&isNaN(r)||("number"!==a||b.cssNumber[u]||(r+="px"),b.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(l[n]="inherit"),s&&"set" in s&&(r=s.set(e,r,i))===t))){try{l[n]=r}catch(c){}}}},css:function(e,n,r,i){var o,a,s,u=b.camelCase(n);return n=b.cssProps[u]||(b.cssProps[u]=tn(e.style,u)),s=b.cssHooks[n]||b.cssHooks[u],s&&"get" in s&&(a=s.get(e,!0,r)),a===t&&(a=Wt(e,n,i)),"normal"===a&&n in Kt&&(a=Kt[n]),""===r||r?(o=parseFloat(a),r===!0||b.isNumeric(o)?o||0:a):a},swap:function(e,t,n,r){var i,o,a={};for(o in t){a[o]=e.style[o],e.style[o]=t[o]}i=n.apply(e,r||[]);for(o in t){e.style[o]=a[o]}return i}}),e.getComputedStyle?(Rt=function(t){return e.getComputedStyle(t,null)},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s.getPropertyValue(n)||s[n]:t,l=e.style;return s&&(""!==u||b.contains(e.ownerDocument,e)||(u=b.style(e,n)),Yt.test(u)&&Ut.test(n)&&(i=l.width,o=l.minWidth,a=l.maxWidth,l.minWidth=l.maxWidth=l.width=u,u=s.width,l.width=i,l.minWidth=o,l.maxWidth=a)),u}):o.documentElement.currentStyle&&(Rt=function(e){return e.currentStyle},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s[n]:t,l=e.style;return null==u&&l&&l[n]&&(u=l[n]),Yt.test(u)&&!zt.test(n)&&(i=l.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),l.left="fontSize"===n?"1em":u,u=l.pixelLeft+"px",l.left=i,a&&(o.left=a)),""===u?"auto":u});function on(e,t,n){var r=Vt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function an(e,t,n,r,i){var o=n===(r?"border":"content")?4:"width"===t?1:0,a=0;for(;4>o;o+=2){"margin"===n&&(a+=b.css(e,n+Zt[o],!0,i)),r?("content"===n&&(a-=b.css(e,"padding"+Zt[o],!0,i)),"margin"!==n&&(a-=b.css(e,"border"+Zt[o]+"Width",!0,i))):(a+=b.css(e,"padding"+Zt[o],!0,i),"padding"!==n&&(a+=b.css(e,"border"+Zt[o]+"Width",!0,i)))}return a}function sn(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=Rt(e),a=b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=Wt(e,t,o),(0>i||null==i)&&(i=e.style[t]),Yt.test(i)){return i}r=a&&(b.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+an(e,t,n||(a?"border":"content"),r,o)+"px"}function un(e){var t=o,n=Gt[e];return n||(n=ln(e,t),"none"!==n&&n||(Pt=(Pt||b("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(Pt[0].contentWindow||Pt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=ln(e,t),Pt.detach()),Gt[e]=n),n}function ln(e,t){var n=b(t.createElement(e)).appendTo(t.body),r=b.css(n[0],"display");return n.remove(),r}b.each(["height","width"],function(e,n){b.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(b.css(e,"display"))?b.swap(e,Qt,function(){return sn(e,n,i)}):sn(e,n,i):t},set:function(e,t,r){var i=r&&Rt(e);return on(e,t,r?an(e,n,r,b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,i),i):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?0.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=b.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===b.trim(o.replace($t,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=$t.test(o)?o.replace($t,i):o+" "+i)}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,n){return n?b.swap(e,{display:"inline-block"},Wt,[e,"marginRight"]):t}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,n){b.cssHooks[n]={get:function(e,r){return r?(r=Wt(e,n),Yt.test(r)?b(e).position()[n]+"px":r):t}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!b.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||b.css(e,"display"))},b.expr.filters.visible=function(e){return !b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(n){var r=0,i={},o="string"==typeof n?n.split(" "):[n];for(;4>r;r++){i[e+Zt[r]+t]=o[r]||o[r-2]||o[0]}return i}},Ut.test(e)||(b.cssHooks[e+t].set=on)});var cn=/%20/g,pn=/\[\]$/,fn=/\r?\n/g,dn=/^(?:submit|button|image|reset|file)$/i,hn=/^(?:input|select|textarea|keygen)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&hn.test(this.nodeName)&&!dn.test(e)&&(this.checked||!Nt.test(e))}).map(function(e,t){var n=b(this).val();return null==n?null:b.isArray(n)?b.map(n,function(e){return{name:t.name,value:e.replace(fn,"\r\n")}}):{name:t.name,value:n.replace(fn,"\r\n")}}).get()}}),b.param=function(e,n){var r,i=[],o=function(e,t){t=b.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=b.ajaxSettings&&b.ajaxSettings.traditional),b.isArray(e)||e.jquery&&!b.isPlainObject(e)){b.each(e,function(){o(this.name,this.value)})}else{for(r in e){gn(r,e[r],n,o)}}return i.join("&").replace(cn,"+")};function gn(e,t,n,r){var i;if(b.isArray(t)){b.each(t,function(t,i){n||pn.test(e)?r(e,i):gn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)})}else{if(n||"object"!==b.type(t)){r(e,t)}else{for(i in t){gn(e+"["+i+"]",t[i],n,r)}}}}b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),b.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var mn,yn,vn=b.now(),bn=/\?/,xn=/#.*$/,wn=/([?&])_=[^&]*/,Tn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Nn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Cn=/^(?:GET|HEAD)$/,kn=/^\/\//,En=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Sn=b.fn.load,An={},jn={},Dn="*/".concat("*");try{yn=a.href}catch(Ln){yn=o.createElement("a"),yn.href="",yn=yn.href}mn=En.exec(yn.toLowerCase())||[];function Hn(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(w)||[];if(b.isFunction(n)){while(r=o[i++]){"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}}}function qn(e,n,r,i){var o={},a=e===jn;function s(u){var l;return o[u]=!0,b.each(e[u]||[],function(e,u){var c=u(n,r,i);return"string"!=typeof c||a||o[c]?a?!(l=c):t:(n.dataTypes.unshift(c),s(c),!1)}),l}return s(n.dataTypes[0])||!o["*"]&&s("*")}function Mn(e,n){var r,i,o=b.ajaxSettings.flatOptions||{};for(i in n){n[i]!==t&&((o[i]?e:r||(r={}))[i]=n[i])}return r&&b.extend(!0,e,r),e}b.fn.load=function(e,n,r){if("string"!=typeof e&&Sn){return Sn.apply(this,arguments)}var i,o,a,s=this,u=e.indexOf(" ");return u>=0&&(i=e.slice(u,e.length),e=e.slice(0,u)),b.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&b.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){o=arguments,s.html(i?b("<div>").append(b.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){s.each(r,o||[e.responseText,t,e])}),this},b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,r,i,o){return b.isFunction(r)&&(o=o||i,i=r,r=t),b.ajax({url:e,type:n,dataType:o,data:r,success:i})}}),b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:yn,type:"GET",isLocal:Nn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Mn(Mn(e,b.ajaxSettings),t):Mn(b.ajaxSettings,e)},ajaxPrefilter:Hn(An),ajaxTransport:Hn(jn),ajax:function(e,n){"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,o,a,s,u,l,c,p=b.ajaxSetup({},n),f=p.context||p,d=p.context&&(f.nodeType||f.jquery)?b(f):b.event,h=b.Deferred(),g=b.Callbacks("once memory"),m=p.statusCode||{},y={},v={},x=0,T="canceled",N={readyState:0,getResponseHeader:function(e){var t;if(2===x){if(!c){c={};while(t=Tn.exec(a)){c[t[1].toLowerCase()]=t[2]}}t=c[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===x?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return x||(e=v[n]=v[n]||e,y[e]=t),this},overrideMimeType:function(e){return x||(p.mimeType=e),this},statusCode:function(e){var t;if(e){if(2>x){for(t in e){m[t]=[m[t],e[t]]}}else{N.always(e[N.status])}}return this},abort:function(e){var t=e||T;return l&&l.abort(t),k(0,t),this}};if(h.promise(N).complete=g.add,N.success=N.done,N.error=N.fail,p.url=((e||p.url||yn)+"").replace(xn,"").replace(kn,mn[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=b.trim(p.dataType||"*").toLowerCase().match(w)||[""],null==p.crossDomain&&(r=En.exec(p.url.toLowerCase()),p.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?80:443))==(mn[3]||("http:"===mn[1]?80:443)))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=b.param(p.data,p.traditional)),qn(An,p,n,N),2===x){return N}u=p.global,u&&0===b.active++&&b.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Cn.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(bn.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=wn.test(o)?o.replace(wn,"$1_="+vn++):o+(bn.test(o)?"&":"?")+"_="+vn++)),p.ifModified&&(b.lastModified[o]&&N.setRequestHeader("If-Modified-Since",b.lastModified[o]),b.etag[o]&&N.setRequestHeader("If-None-Match",b.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&N.setRequestHeader("Content-Type",p.contentType),N.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Dn+"; q=0.01":""):p.accepts["*"]);for(i in p.headers){N.setRequestHeader(i,p.headers[i])}if(p.beforeSend&&(p.beforeSend.call(f,N,p)===!1||2===x)){return N.abort()}T="abort";for(i in {success:1,error:1,complete:1}){N[i](p[i])}if(l=qn(jn,p,n,N)){N.readyState=1,u&&d.trigger("ajaxSend",[N,p]),p.async&&p.timeout>0&&(s=setTimeout(function(){N.abort("timeout")},p.timeout));try{x=1,l.send(y,k)}catch(C){if(!(2>x)){throw C}k(-1,C)}}else{k(-1,"No Transport")}function k(e,n,r,i){var c,y,v,w,T,C=n;2!==x&&(x=2,s&&clearTimeout(s),l=t,a=i||"",N.readyState=e>0?4:0,r&&(w=_n(p,N,r)),e>=200&&300>e||304===e?(p.ifModified&&(T=N.getResponseHeader("Last-Modified"),T&&(b.lastModified[o]=T),T=N.getResponseHeader("etag"),T&&(b.etag[o]=T)),204===e?(c=!0,C="nocontent"):304===e?(c=!0,C="notmodified"):(c=Fn(p,w),C=c.state,y=c.data,v=c.error,c=!v)):(v=C,(e||!C)&&(C="error",0>e&&(e=0))),N.status=e,N.statusText=(n||C)+"",c?h.resolveWith(f,[y,C,N]):h.rejectWith(f,[N,C,v]),N.statusCode(m),m=t,u&&d.trigger(c?"ajaxSuccess":"ajaxError",[N,p,c?y:v]),g.fireWith(f,[N,C]),u&&(d.trigger("ajaxComplete",[N,p]),--b.active||b.event.trigger("ajaxStop")))}return N},getScript:function(e,n){return b.get(e,t,n,"script")},getJSON:function(e,t,n){return b.get(e,t,n,"json")}});function _n(e,n,r){var i,o,a,s,u=e.contents,l=e.dataTypes,c=e.responseFields;for(s in c){s in r&&(n[c[s]]=r[s])}while("*"===l[0]){l.shift(),o===t&&(o=e.mimeType||n.getResponseHeader("Content-Type"))}if(o){for(s in u){if(u[s]&&u[s].test(o)){l.unshift(s);break}}}if(l[0] in r){a=l[0]}else{for(s in r){if(!l[0]||e.converters[s+" "+l[0]]){a=s;break}i||(i=s)}a=a||i}return a?(a!==l[0]&&l.unshift(a),r[a]):t}function Fn(e,t){var n,r,i,o,a={},s=0,u=e.dataTypes.slice(),l=u[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u[1]){for(i in e.converters){a[i.toLowerCase()]=e.converters[i]}}for(;r=u[++s];){if("*"!==r){if("*"!==l&&l!==r){if(i=a[l+" "+r]||a["* "+r],!i){for(n in a){if(o=n.split(" "),o[1]===r&&(i=a[l+" "+o[0]]||a["* "+o[0]])){i===!0?i=a[n]:a[n]!==!0&&(r=o[0],u.splice(s--,0,r));break}}}if(i!==!0){if(i&&e["throws"]){t=i(t)}else{try{t=i(t)}catch(c){return{state:"parsererror",error:i?c:"No conversion from "+l+" to "+r}}}}}l=r}}return{state:"success",data:t}}b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=o.head||b("head")[0]||o.documentElement;return{send:function(t,i){n=o.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var On=[],Bn=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=On.pop()||b.expando+"_"+vn++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(n,r,i){var o,a,s,u=n.jsonp!==!1&&(Bn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bn.test(n.data)&&"data");return u||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=b.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,u?n[u]=n[u].replace(Bn,"$1"+o):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||b.error(o+" was not called"),s[0]},n.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=a,n[o]&&(n.jsonpCallback=r.jsonpCallback,On.push(o)),s&&b.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Pn,Rn,Wn=0,$n=e.ActiveXObject&&function(){var e;for(e in Pn){Pn[e](t,!0)}};function In(){try{return new e.XMLHttpRequest}catch(t){}}function zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}b.ajaxSettings.xhr=e.ActiveXObject?function(){return !this.isLocal&&In()||zn()}:In,Rn=b.ajaxSettings.xhr(),b.support.cors=!!Rn&&"withCredentials" in Rn,Rn=b.support.ajax=!!Rn,Rn&&b.ajaxTransport(function(n){if(!n.crossDomain||b.support.cors){var r;return{send:function(i,o){var a,s,u=n.xhr();if(n.username?u.open(n.type,n.url,n.async,n.username,n.password):u.open(n.type,n.url,n.async),n.xhrFields){for(s in n.xhrFields){u[s]=n.xhrFields[s]}}n.mimeType&&u.overrideMimeType&&u.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i){u.setRequestHeader(s,i[s])}}catch(l){}u.send(n.hasContent&&n.data||null),r=function(e,i){var s,l,c,p;try{if(r&&(i||4===u.readyState)){if(r=t,a&&(u.onreadystatechange=b.noop,$n&&delete Pn[a]),i){4!==u.readyState&&u.abort()}else{p={},s=u.status,l=u.getAllResponseHeaders(),"string"==typeof u.responseText&&(p.text=u.responseText);try{c=u.statusText}catch(f){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=p.text?200:404}}}catch(d){i||o(-1,d)}p&&o(s,c,p,l)},n.async?4===u.readyState?setTimeout(r):(a=++Wn,$n&&(Pn||(Pn={},b(e).unload($n)),Pn[a]=r),u.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Un,Vn=/^(?:toggle|show|hide)$/,Yn=RegExp("^(?:([+-])=|)("+x+")([a-z%]*)$","i"),Jn=/queueHooks$/,Gn=[nr],Qn={"*":[function(e,t){var n,r,i=this.createTween(e,t),o=Yn.exec(t),a=i.cur(),s=+a||0,u=1,l=20;if(o){if(n=+o[2],r=o[3]||(b.cssNumber[e]?"":"px"),"px"!==r&&s){s=b.css(i.elem,e,!0)||n||1;do{u=u||".5",s/=u,b.style(i.elem,e,s+r)}while(u!==(u=i.cur()/a)&&1!==u&&--l)}i.unit=r,i.start=s,i.end=o[1]?s+(o[1]+1)*n:n}return i}]};function Kn(){return setTimeout(function(){Xn=t}),Xn=b.now()}function Zn(e,t){b.each(t,function(t,n){var r=(Qn[t]||[]).concat(Qn["*"]),i=0,o=r.length;for(;o>i;i++){if(r[i].call(e,t,n)){return}}})}function er(e,t,n){var r,i,o=0,a=Gn.length,s=b.Deferred().always(function(){delete u.elem}),u=function(){if(i){return !1}var t=Xn||Kn(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,o=1-r,a=0,u=l.tweens.length;for(;u>a;a++){l.tweens[a].run(o)}return s.notifyWith(e,[l,o,n]),1>o&&u?n:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Kn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=b.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i){return this}for(i=!0;r>n;n++){l.tweens[n].run(1)}return t?s.resolveWith(e,[l,t]):s.rejectWith(e,[l,t]),this}}),c=l.props;for(tr(c,l.opts.specialEasing);a>o;o++){if(r=Gn[o].call(l,e,c,l.opts)){return r}}return Zn(l,c),b.isFunction(l.opts.start)&&l.opts.start.call(e,l),b.fx.timer(b.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function tr(e,t){var n,r,i,o,a;for(i in e){if(r=b.camelCase(i),o=t[r],n=e[i],b.isArray(n)&&(o=n[1],n=e[i]=n[0]),i!==r&&(e[r]=n,delete e[i]),a=b.cssHooks[r],a&&"expand" in a){n=a.expand(n),delete e[r];for(i in n){i in e||(e[i]=n[i],t[i]=o)}}else{t[r]=o}}}b.Animation=b.extend(er,{tweener:function(e,t){b.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++){n=e[r],Qn[n]=Qn[n]||[],Qn[n].unshift(t)}},prefilter:function(e,t){t?Gn.unshift(e):Gn.push(e)}});function nr(e,t,n){var r,i,o,a,s,u,l,c,p,f=this,d=e.style,h={},g=[],m=e.nodeType&&nn(e);n.queue||(c=b._queueHooks(e,"fx"),null==c.unqueued&&(c.unqueued=0,p=c.empty.fire,c.empty.fire=function(){c.unqueued||p()}),c.unqueued++,f.always(function(){f.always(function(){c.unqueued--,b.queue(e,"fx").length||c.empty.fire()})})),1===e.nodeType&&("height" in t||"width" in t)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===b.css(e,"display")&&"none"===b.css(e,"float")&&(b.support.inlineBlockNeedsLayout&&"inline"!==un(e.nodeName)?d.zoom=1:d.display="inline-block")),n.overflow&&(d.overflow="hidden",b.support.shrinkWrapBlocks||f.always(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(i in t){if(a=t[i],Vn.exec(a)){if(delete t[i],u=u||"toggle"===a,a===(m?"hide":"show")){continue}g.push(i)}}if(o=g.length){s=b._data(e,"fxshow")||b._data(e,"fxshow",{}),"hidden" in s&&(m=s.hidden),u&&(s.hidden=!m),m?b(e).show():f.done(function(){b(e).hide()}),f.done(function(){var t;b._removeData(e,"fxshow");for(t in h){b.style(e,t,h[t])}});for(i=0;o>i;i++){r=g[i],l=f.createTween(r,m?s[r]:0),h[r]=s[r]||b.style(e,r),r in s||(s[r]=l.start,m&&(l.end=l.start,l.start="width"===r||"height"===r?1:0))}}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}b.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(b.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=b.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[b.cssProps[e.prop]]||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(e,t){var n=b.fn[t];b.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),b.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=b.isEmptyObject(e),o=b.speed(t,n,r),a=function(){var t=er(this,b.extend({},e),o);a.finish=function(){t.stop(!0)},(i||b._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=b.timers,a=b._data(this);if(n){a[n]&&a[n].stop&&i(a[n])}else{for(n in a){a[n]&&a[n].stop&&Jn.test(n)&&i(a[n])}}for(n=o.length;n--;){o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1))}(t||!r)&&b.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=b._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=b.timers,a=r?r.length:0;for(n.finish=!0,b.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=o.length;t--;){o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1))}for(t=0;a>t;t++){r[t]&&r[t].finish&&r[t].finish.call(this)}delete n.finish})}});function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t){n=Zt[i],r["margin"+n]=r["padding"+n]=e}return t&&(r.opacity=r.width=e),r}b.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),b.speed=function(e,t,n){var r=e&&"object"==typeof e?b.extend({},e):{complete:n||!n&&t||b.isFunction(e)&&e,duration:e,easing:n&&t||t&&!b.isFunction(t)&&t};return r.duration=b.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in b.fx.speeds?b.fx.speeds[r.duration]:b.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){b.isFunction(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.easing={linear:function(e){return e},swing:function(e){return 0.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=rr.prototype.init,b.fx.tick=function(){var e,n=b.timers,r=0;for(Xn=b.now();n.length>r;r++){e=n[r],e()||n[r]!==e||n.splice(r--,1)}n.length||b.fx.stop(),Xn=t},b.fx.timer=function(e){e()&&b.timers.push(e)&&b.fx.start()},b.fx.interval=13,b.fx.start=function(){Un||(Un=setInterval(b.fx.tick,b.fx.interval))},b.fx.stop=function(){clearInterval(Un),Un=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length}),b.fn.offset=function(e){if(arguments.length){return e===t?this:this.each(function(t){b.offset.setOffset(this,e,t)})}var n,r,o={top:0,left:0},a=this[0],s=a&&a.ownerDocument;if(s){return n=s.documentElement,b.contains(n,a)?(typeof a.getBoundingClientRect!==i&&(o=a.getBoundingClientRect()),r=or(s),{top:o.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:o.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):o}},b.offset={setOffset:function(e,t,n){var r=b.css(e,"position");"static"===r&&(e.style.position="relative");var i=b(e),o=i.offset(),a=b.css(e,"top"),s=b.css(e,"left"),u=("absolute"===r||"fixed"===r)&&b.inArray("auto",[a,s])>-1,l={},c={},p,f;u?(c=i.position(),p=c.top,f=c.left):(p=parseFloat(a)||0,f=parseFloat(s)||0),b.isFunction(t)&&(t=t.call(e,n,o)),null!=t.top&&(l.top=t.top-o.top+p),null!=t.left&&(l.left=t.left-o.left+f),"using" in t?t.using.call(e,l):i.css(l)}},b.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===b.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),b.nodeName(e[0],"html")||(n=e.offset()),n.top+=b.css(e[0],"borderTopWidth",!0),n.left+=b.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-b.css(r,"marginTop",!0),left:t.left-n.left-b.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||o.documentElement;while(e&&!b.nodeName(e,"html")&&"static"===b.css(e,"position")){e=e.offsetParent}return e||o.documentElement})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);b.fn[e]=function(i){return b.access(this,function(e,i,o){var a=or(e);return o===t?a?n in a?a[n]:a.document.documentElement[i]:e[i]:(a?a.scrollTo(r?b(a).scrollLeft():o,r?o:b(a).scrollTop()):e[i]=o,t)},e,i,arguments.length,null)}});function or(e){return b.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}b.each({Height:"height",Width:"width"},function(e,n){b.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){b.fn[i]=function(i,o){var a=arguments.length&&(r||"boolean"!=typeof i),s=r||(i===!0||o===!0?"margin":"border");return b.access(this,function(n,r,i){var o;return b.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):i===t?b.css(n,r,s):b.style(n,r,i,s)},n,a?i:t,a,null)}})}),e.zeQuery=e.$=b,"function"==typeof define&&define.amd&&define.amd.zeQuery&&define("jquery",[],function(){return b})})(window)};
// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/js/cast_sender.js  D:\WebSites\tmpCincopaAppsV2\_cms/fpskins/mediaelement/1/js/cast_sender.js   3/21/2022 9:13:17 AM 
_cp_preloaded_files["/fpskins/mediaelement/1/js/cast_sender.js"] = true;
(function(){var y=function(){var h=i,l=0;return function(){return l<h.length?{done:!1,value:h[l++]}:{done:!0}}},W=this||self,Y=/^[\w+/_-]+[=]{0,2}$/,ab=null,ad=function(h){return(h=h.querySelector&&h.querySelector("script[nonce]"))&&(h=h.nonce||h.getAttribute("nonce"))&&Y.test(h)?h:""},af=function(h,l){function m(){}m.prototype=l.prototype;h.i=l.prototype;h.prototype=new m;h.prototype.constructor=h;h.h=function(n,r,t){for(var q=Array(arguments.length-2),p=2;p<arguments.length;p++){q[p-2]=arguments[p]}return l.prototype[r].apply(n,q)}},ai=function(h){return h};function ak(h){if(Error.captureStackTrace){Error.captureStackTrace(this,ak)}else{var l=Error().stack;l&&(this.stack=l)}h&&(this.message=String(h))}af(ak,Error);ak.prototype.name="CustomError";var am=function(h,l){h=h.split("%s");for(var n="",m=h.length-1,p=0;p<m;p++){n+=h[p]+(p<l.length?l[p]:"%s")}ak.call(this,n+h[m])};af(am,ak);am.prototype.name="AssertionError";var an=function(h,l){throw new am("Failure"+(h?": "+h:""),Array.prototype.slice.call(arguments,1))};var ao;var a=function(h,l){this.g=l===ap?h:""};a.prototype.toString=function(){return this.g+""};var ap={};var b=function(){var h=window.navigator.userAgent.match(/Chrome\/([0-9]+)/);return h?parseInt(h[1],10):0},c=function(h){return !!document.currentScript&&(-1!=document.currentScript.src.indexOf("?"+h)||-1!=document.currentScript.src.indexOf("&"+h))},d=function(){return"function"==typeof window.__onGCastApiAvailable?window.__onGCastApiAvailable:null},f=function(h){h.length?e(h.shift(),function(){f(h)}):g()},j=function(h){return"chrome-extension://"+h+"/cast_sender.js"},e=function(h,l,p){var m=document.createElement("script");m.onerror=l;p&&(m.onload=p);if(void 0===ao){if(l=null,(p=W.trustedTypes)&&p.createPolicy){try{l=p.createPolicy("goog#html",{createHTML:ai,createScript:ai,createScriptURL:ai})}catch(u){W.console&&W.console.error(u.message)}ao=l}else{ao=l}}h=(l=ao)?l.createScriptURL(h):h;h=new a(h,ap);h:{try{var r=m&&m.ownerDocument,t=r&&(r.defaultView||r.parentWindow);t=t||W;if(t.Element&&t.Location){var q=t;break h}}catch(u){}q=null}if(q&&"undefined"!=typeof q.HTMLScriptElement&&(!m||!(m instanceof q.HTMLScriptElement)&&(m instanceof q.Location||m instanceof q.Element))){q=typeof m;if("object"==q&&null!=m||"function"==q){try{var n=m.constructor.displayName||m.constructor.name||Object.prototype.toString.call(m)}catch(u){n="<object could not be stringified>"}}else{n=void 0===m?"undefined":null===m?"null":typeof m}an("Argument is not a %s (or a non-Element, non-Location mock); got: %s","HTMLScriptElement",n)}h instanceof a&&h.constructor===a?n=h.g:(n=typeof h,an("expected object of type TrustedResourceUrl, got '"+h+"' of type "+("object"!=n?n:h?Array.isArray(h)?"array":n:"null")),n="type_error:TrustedResourceUrl");m.src=n;(n=m.ownerDocument&&m.ownerDocument.defaultView)&&n!=W?n=ad(n.document):(null===ab&&(ab=ad(W.document)),n=ab);n&&m.setAttribute("nonce",n);(document.head||document.documentElement).appendChild(m)},k=function(){var h=b(),l=[];if(1<h){var m=h-1;l.push("//www.gstatic.com/eureka/clank/"+h+"/cast_sender.js");l.push("//www.gstatic.com/eureka/clank/"+m+"/cast_sender.js")}return l},g=function(){var h=d();h&&h(!1,"No cast extension found")},s=function(){if(o){var h=2,l=d(),m=function(){h--;0==h&&l&&l(!0)};window.__onGCastApiAvailable=m;e("//www.gstatic.com/cast/sdk/libs/sender/1.0/cast_framework.js",g,m)}},o=c("loadCastFramework")||c("loadCastApplicationFramework"),V=["pkedcjkdefgpdelpbcmbmeomcjbeemfm","enhhojjnijigcajfphajepfemndkmdlo"];if(0<=window.navigator.userAgent.indexOf("Android")&&0<=window.navigator.userAgent.indexOf("Chrome/")&&window.navigator.presentation){if(60<=b()){s();var X=k();X.push("//www.gstatic.com/eureka/clank/cast_sender.js");f(X)}}else{if(!window.chrome||!window.navigator.presentation||0<=window.navigator.userAgent.indexOf("Edge")){g()}else{if(89<=b()){s();var Z=k(),aa=Z.push,ac=aa.apply,i=V.map(j),ae;if(i instanceof Array){ae=i}else{var ag,ah="undefined"!=typeof Symbol&&Symbol.iterator&&i[Symbol.iterator];ag=ah?ah.call(i):{next:y()};for(var aj,al=[];!(aj=ag.next()).done;){al.push(aj.value)}ae=al}ac.call(aa,Z,ae);Z.push("//www.gstatic.com/eureka/clank/cast_sender.js");f(Z)}else{s(),f(V.map(j))}}}}).call(this);
// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/js/ze-mediaelement-and-player.min.js  D:\WebSites\tmpCincopaAppsV2\_cms/fpskins/mediaelement/1/js/ze-mediaelement-and-player.min.js   12/20/2022 3:30:38 AM 
_cp_preloaded_files["/fpskins/mediaelement/1/js/ze-mediaelement-and-player.min.js"] = true;
/*
 *
 * MediaElement.js
 * HTML5 <video> and <audio> shim and player
 * http://mediaelementjs.com/
 *
 * Creates a JavaScript object that mimics HTML5 MediaElement API
 * for browsers that don't understand HTML5 or can't play the provided codec
 * Can play MP4 (H.264), Ogg, WebM, FLV, WMV, WMA, ACC, and MP3
 *
 * Copyright 2010-2014, John Dyer (http://j.hn)
 * License: MIT
 *
 */
var cincopa_mejs=cincopa_mejs||{};(function(a){a.cincopa=true;a.version="2.23.4";a.meIndex=0;a.plugins={silverlight:[{version:[3,0],types:["video/mp4","video/m4v","video/mov","video/wmv","audio/wma","audio/m4a","audio/mp3","audio/wav","audio/mpeg"]}],flash:[{version:[9,0,124],types:["video/mp4","video/m4v","video/mov","video/flv","video/rtmp","video/x-flv","audio/flv","audio/x-flv","audio/mp3","audio/m4a","audio/mp4","audio/mpeg","video/dailymotion","video/x-dailymotion","application/x-mpegURL","audio/ogg"]}],youtube:[{version:null,types:["video/youtube","video/x-youtube","audio/youtube","audio/x-youtube"]}],vimeo:[{version:null,types:["video/vimeo","video/x-vimeo"]}]};a.Utility={encodeUrl:function(b){return encodeURIComponent(b)},escapeHTML:function(b){return b.toString().split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;")},absolutizeUrl:function(c){var b=document.createElement("div");b.innerHTML='<a href="'+this.escapeHTML(c)+'">x</a>';return b.firstChild.href},getScriptPath:function(k){var d=0,f,b="",p="",o,c,n,l,h,m=document.getElementsByTagName("script"),e=m.length,g=k.length;for(;d<e;d++){n=m[d].src;o=n.lastIndexOf("/");if(o>-1){h=n.substring(o+1);l=n.substring(0,o+1)}else{h=n;l=""}for(f=0;f<g;f++){p=k[f];c=h.indexOf(p);if(c>-1){b=l;break}}if(b!==""){break}}return b},calculateTimeFormat:function(u,p,e){if(u<0){u=0}if(typeof e=="undefined"){e=25}var d=p.timeFormat,b=d[0],c=(d[1]==d[0]),t=c?2:1,s=":",h=Math.floor(u/3600)%24,o=Math.floor(u/60)%60,r=Math.floor(u%60),f=Math.floor(((u%1)*e).toFixed(3)),n=[[f,"f"],[r,"s"],[o,"m"],[h,"h"]];if(d.length<t){s=d[t]}var q=false;for(var k=0,m=n.length;k<m;k++){if(d.indexOf(n[k][1])!==-1){q=true}else{if(q){var g=false;for(var l=k;l<m;l++){if(n[l][0]>0){g=true;break}}if(!g){break}if(!c){d=b+d}d=n[k][1]+s+d;if(c){d=n[k][1]+d}b=n[k][1]}}}p.currentTimeFormat=d},twoDigitsString:function(b){if(b<10){return"0"+b}return String(b)},secondsToTimeCode:function(m,j){if(m<0){m=0}if(typeof j!=="object"){var b="m:ss";b=arguments[1]?"hh:mm:ss":b;b=arguments[2]?b+":ff":b;j={currentTimeFormat:b,framesPerSecond:arguments[3]||25}}var c=j.framesPerSecond;if(typeof c==="undefined"){c=25}var b=j.currentTimeFormat,e=Math.floor(m/3600)%24,h=Math.floor(m/60)%60,l=Math.floor(m%60),d=Math.floor(((m%1)*c).toFixed(3));lis=[[d,"f"],[l,"s"],[h,"m"],[e,"h"]];var k=b;for(var f=0,g=lis.length;f<g;f++){k=k.replace(lis[f][1]+lis[f][1],this.twoDigitsString(lis[f][0]));k=k.replace(lis[f][1],lis[f][0])}return k},timeCodeToSeconds:function(d,b,e,c){if(typeof e=="undefined"){e=false}else{if(typeof c=="undefined"){c=25}}var f=d.split(":"),h=parseInt(f[0],10),j=parseInt(f[1],10),k=parseInt(f[2],10),g=0,i=0;if(e){g=parseInt(f[3])/c}i=(h*3600)+(j*60)+k+g;return i},convertSMPTEtoSeconds:function(f){if(typeof f!="string"){return false}f=f.replace(",",".");var e=0,b=(f.indexOf(".")!=-1)?f.split(".")[1].length:0,d=1;f=f.split(":").reverse();for(var c=0;c<f.length;c++){d=1;if(c>0){d=Math.pow(60,c)}e+=Number(f[c])*d}return Number(e.toFixed(b))},removeSwf:function(b){var c=document.getElementById(b);if(c&&/object|embed/i.test(c.nodeName)){if(a.MediaFeatures.isIE){c.style.display="none";(function(){if(c.readyState==4){a.Utility.removeObjectInIE(b)}else{setTimeout(arguments.callee,10)}})()}else{c.parentNode.removeChild(c)}}},removeObjectInIE:function(c){var d=document.getElementById(c);if(d){for(var b in d){if(typeof d[b]=="function"){d[b]=null}}d.parentNode.removeChild(d)}},determineScheme:function(b){if(b&&b.indexOf("://")!=-1){return b.substr(0,b.indexOf("://")+3)}return"//"},debounce:function(b,e,c){var d;return function(){var h=this,f=arguments;var i=function(){d=null;if(!c){b.apply(h,f)}};var g=c&&!d;clearTimeout(d);d=setTimeout(i,e);if(g){b.apply(h,f)}}},isNodeAfter:function(b,c){return !!(b&&c&&typeof b.compareDocumentPosition==="function"&&b.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_PRECEDING)}};a.PluginDetector={hasPluginVersion:function(b,d){var c=this.plugins[b];d[1]=d[1]||0;d[2]=d[2]||0;return(c[0]>d[0]||(c[0]==d[0]&&c[1]>d[1])||(c[0]==d[0]&&c[1]==d[1]&&c[2]>=d[2]))?true:false},nav:window.navigator,ua:window.navigator.userAgent.toLowerCase(),plugins:[],addPlugin:function(e,f,d,b,c){this.plugins[e]=this.detectPlugin(f,d,b,c)},detectPlugin:function(k,j,b,d){var l=[0,0,0],f,h,c;if(typeof(this.nav.plugins)!="undefined"&&typeof this.nav.plugins[k]=="object"){f=this.nav.plugins[k].description;if(f&&!(typeof this.nav.mimeTypes!="undefined"&&this.nav.mimeTypes[j]&&!this.nav.mimeTypes[j].enabledPlugin)){l=f.replace(k,"").replace(/^\s+/,"").replace(/\sr/gi,".").split(".");for(h=0;h<l.length;h++){l[h]=parseInt(l[h].match(/\d+/),10)}}}else{if(typeof(window.ActiveXObject)!="undefined"){try{c=new ActiveXObject(b);if(c){l=d(c)}}catch(g){}}}return l}};a.PluginDetector.addPlugin("flash","Shockwave Flash","application/x-shockwave-flash","ShockwaveFlash.ShockwaveFlash",function(b){var e=[],c=b.GetVariable("$version");if(c){c=c.split(" ")[1].split(",");e=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]}return e});a.PluginDetector.addPlugin("silverlight","Silverlight Plug-In","application/x-silverlight-2","AgControl.AgControl",function(b){var d=[0,0,0,0],c=function(e,h,f,g){while(e.isVersionSupported(h[0]+"."+h[1]+"."+h[2]+"."+h[3])){h[f]+=g}h[f]-=g};c(b,d,0,1);c(b,d,1,1);c(b,d,2,10000);c(b,d,2,1000);c(b,d,2,100);c(b,d,2,10);c(b,d,2,1);c(b,d,3,1);return d});a.MediaFeatures={init:function(){var j=this,b=document,h=a.PluginDetector.nav,k=a.PluginDetector.ua.toLowerCase(),g,l,f=["source","track","audio","video"];j.isiPad=(k.match(/ipad/i)!==null);j.isiPhone=(k.match(/iphone/i)!==null);j.isiOS=j.isiPhone||j.isiPad;j.isAndroid=(k.match(/android/i)!==null);j.isBustedAndroid=(k.match(/android 2\.[12]/)!==null);j.isBustedNativeHTTPS=(location.protocol==="https:"&&(k.match(/android [12]\./)!==null||k.match(/macintosh.* version.* safari/)!==null));j.isIE=(h.appName.toLowerCase().indexOf("microsoft")!=-1||h.appName.toLowerCase().match(/trident/gi)!==null);j.isChrome=(k.match(/chrome/gi)!==null);j.isChromium=(k.match(/chromium/gi)!==null);j.isFirefox=(k.match(/firefox/gi)!==null);j.isWebkit=(k.match(/webkit/gi)!==null);j.isGecko=(k.match(/gecko/gi)!==null)&&!j.isWebkit&&!j.isIE;j.isOpera=(k.match(/opera/gi)!==null);j.hasTouch=("ontouchstart" in window&&!j.isChrome)||("ontouchstart" in window&&j.isChrome&&/Android|iPhone|iPad|iPod/i.test(navigator.userAgent));j.svgAsImg=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1");for(g=0;g<f.length;g++){l=document.createElement(f[g])}j.supportsMediaTag=(typeof l.canPlayType!=="undefined"||j.isBustedAndroid);try{l.canPlayType("video/mp4")}catch(c){j.supportsMediaTag=false}j.supportsPointerEvents=(function(){var e=document.createElement("x"),d=document.documentElement,i=window.getComputedStyle,m;if(!("pointerEvents" in e.style)){return false}e.style.pointerEvents="auto";e.style.pointerEvents="x";d.appendChild(e);m=i&&i(e,"").pointerEvents==="auto";d.removeChild(e);return !!m})();j.hasFirefoxPluginMovingProblem=false;j.hasiOSFullScreen=(typeof l.webkitEnterFullscreen!=="undefined");j.hasNativeFullscreen=(typeof l.requestFullscreen!=="undefined");j.hasWebkitNativeFullScreen=(typeof l.webkitRequestFullScreen!=="undefined");j.hasMozNativeFullScreen=(typeof l.mozRequestFullScreen!=="undefined");j.hasMsNativeFullScreen=(typeof l.msRequestFullscreen!=="undefined");j.hasTrueNativeFullScreen=(j.hasWebkitNativeFullScreen||j.hasMozNativeFullScreen||j.hasMsNativeFullScreen);j.nativeFullScreenEnabled=j.hasTrueNativeFullScreen;if(j.hasMozNativeFullScreen){j.nativeFullScreenEnabled=document.mozFullScreenEnabled}else{if(j.hasMsNativeFullScreen){j.nativeFullScreenEnabled=document.msFullscreenEnabled}}if(j.isChrome){j.hasiOSFullScreen=false}if(j.hasTrueNativeFullScreen){j.fullScreenEventName="";if(j.hasWebkitNativeFullScreen){j.fullScreenEventName="webkitfullscreenchange"}else{if(j.hasMozNativeFullScreen){j.fullScreenEventName="mozfullscreenchange"}else{if(j.hasMsNativeFullScreen){j.fullScreenEventName="MSFullscreenChange"}}}j.isFullScreen=function(){if(j.hasMozNativeFullScreen){return b.mozFullScreen}else{if(j.hasWebkitNativeFullScreen){return b.webkitIsFullScreen}else{if(j.hasMsNativeFullScreen){return b.msFullscreenElement!==null}}}};j.requestFullScreen=function(d){if(d.getAttribute("data-forcenativefullscreen")=="true"){var e=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform);if(j.hasiOSFullScreen&&e&&d.querySelector("video")){d.querySelector("video").webkitEnterFullscreen();return}}if(j.hasWebkitNativeFullScreen){d.webkitRequestFullScreen()}else{if(j.hasMozNativeFullScreen){d.mozRequestFullScreen()}else{if(j.hasMsNativeFullScreen){d.msRequestFullscreen()}}}};j.cancelFullScreen=function(){if(j.hasWebkitNativeFullScreen){document.webkitCancelFullScreen()}else{if(j.hasMozNativeFullScreen){document.mozCancelFullScreen()}else{if(j.hasMsNativeFullScreen){document.msExitFullscreen()}}}}}if(j.hasiOSFullScreen&&k.match(/mac os x 10_5/i)){j.hasNativeFullScreen=false;j.hasiOSFullScreen=false}}};a.MediaFeatures.init();a.HtmlMediaElement={pluginType:"native",isFullScreen:false,setCurrentTime:function(b){this.currentTime=b},setMuted:function(b){this.muted=b},setVolume:function(b){this.volume=b},stop:function(){this.pause()},setSrc:function(e){var b=this.getElementsByTagName("source");while(b.length>0){this.removeChild(b[0])}if(typeof e=="string"){this.src=e}else{var c,d;for(c=0;c<e.length;c++){d=e[c];if(this.canPlayType(d.type)){this.src=d.src;break}}}},setVideoSize:function(c,b){this.width=c;this.height=b}};a.PluginMediaElement=function(c,d,b){this.id=c;this.pluginType=d;this.src=b;this.events={};this.attributes={}};a.PluginMediaElement.prototype={pluginElement:null,pluginType:"",isFullScreen:false,playbackRate:-1,defaultPlaybackRate:-1,seekable:[],played:[],paused:true,ended:false,seeking:false,duration:0,error:null,tagName:"",muted:false,volume:1,currentTime:0,play:function(){if(this.pluginApi!=null){if(this.pluginType=="youtube"||this.pluginType=="vimeo"){this.pluginApi.playVideo()}else{this.pluginApi.playMedia()}this.paused=false}},load:function(){if(this.pluginApi!=null){if(this.pluginType=="youtube"||this.pluginType=="vimeo"){}else{this.pluginApi.loadMedia()}this.paused=false}},pause:function(){if(this.pluginApi!=null){if(this.pluginType=="youtube"||this.pluginType=="vimeo"){if(this.pluginApi.getPlayerState()==1){this.pluginApi.pauseVideo()}}else{this.pluginApi.pauseMedia()}this.paused=true}},stop:function(){if(this.pluginApi!=null){if(this.pluginType=="youtube"||this.pluginType=="vimeo"){this.pluginApi.stopVideo()}else{this.pluginApi.stopMedia()}this.paused=true}},canPlayType:function(f){var b,c,d,e=a.plugins[this.pluginType];for(b=0;b<e.length;b++){d=e[b];if(a.PluginDetector.hasPluginVersion(this.pluginType,d.version)){for(c=0;c<d.types.length;c++){if(f==d.types[c]){return"probably"}}}}return""},positionFullscreenButton:function(c,d,b){if(this.pluginApi!=null&&this.pluginApi.positionFullscreenButton){this.pluginApi.positionFullscreenButton(Math.floor(c),Math.floor(d),b)}},hideFullscreenButton:function(){if(this.pluginApi!=null&&this.pluginApi.hideFullscreenButton){this.pluginApi.hideFullscreenButton()}},setSrc:function(d){if(typeof d=="string"){this.pluginApi.setSrc(a.Utility.absolutizeUrl(d));this.src=a.Utility.absolutizeUrl(d)}else{var b,c;for(b=0;b<d.length;b++){c=d[b];if(this.canPlayType(c.type)){this.pluginApi.setSrc(a.Utility.absolutizeUrl(c.src));this.src=a.Utility.absolutizeUrl(c.src);break}}}},setCurrentTime:function(b){if(this.pluginApi!=null){if(this.pluginType=="youtube"||this.pluginType=="vimeo"){this.pluginApi.seekTo(b)}else{this.pluginApi.setCurrentTime(b)}this.currentTime=b}},setVolume:function(b){if(this.pluginApi!=null){if(this.pluginType=="youtube"){this.pluginApi.setVolume(b*100)}else{this.pluginApi.setVolume(b)}this.volume=b}},setMuted:function(b){if(this.pluginApi!=null){if(this.pluginType=="youtube"){if(b){this.pluginApi.mute()}else{this.pluginApi.unMute()}this.muted=b;this.dispatchEvent({type:"volumechange"})}else{this.pluginApi.setMuted(b)}this.muted=b}},setVideoSize:function(c,b){if(this.pluginElement&&this.pluginElement.style){this.pluginElement.style.width=c+"px";this.pluginElement.style.height=b+"px"}if(this.pluginApi!=null&&this.pluginApi.setVideoSize){this.pluginApi.setVideoSize(c,b)}},setFullscreen:function(b){if(this.pluginApi!=null&&this.pluginApi.setFullscreen){this.pluginApi.setFullscreen(b)}},enterFullScreen:function(){if(this.pluginApi!=null&&this.pluginApi.setFullscreen){this.setFullscreen(true)}},exitFullScreen:function(){if(this.pluginApi!=null&&this.pluginApi.setFullscreen){this.setFullscreen(false)}},cincopaAddEventListener:function(d,c,b){this.events[d]=this.events[d]||[];this.events[d].push(c)},removeEventListener:function(d,b){if(!d){this.events={};return true}var c=this.events[d];if(!c){return true}if(!b){this.events[d]=[];return true}for(var e=0;e<c.length;e++){if(c[e]===b){this.events[d].splice(e,1);return true}}return false},dispatchEvent:function(d){var e,b,c=this.events[d.type];if(c){for(e=0;e<c.length;e++){c[e].apply(this,[d])}}},hasAttribute:function(b){return(b in this.attributes)},removeAttribute:function(b){delete this.attributes[b]},getAttribute:function(b){if(this.hasAttribute(b)){return this.attributes[b]}return null},setAttribute:function(b,c){this.attributes[b]=c},remove:function(){a.Utility.removeSwf(this.pluginElement.id)}};a.MediaElementDefaults={mode:"auto",plugins:["flash","silverlight","youtube","vimeo"],enablePluginDebug:false,httpsBasicAuthSite:false,type:"",pluginPath:a.Utility.getScriptPath(["mediaelement.js","mediaelement.min.js","mediaelement-and-player.js","mediaelement-and-player.min.js"]),flashName:"flashmediaelement.swf",flashStreamer:"",flashScriptAccess:"sameDomain",enablePluginSmoothing:false,enablePseudoStreaming:false,pseudoStreamingStartQueryParam:"start",silverlightName:"silverlightmediaelement.xap",defaultVideoWidth:480,defaultVideoHeight:270,pluginWidth:-1,pluginHeight:-1,pluginVars:[],timerRate:250,startVolume:0.8,customError:"",success:function(){},error:function(){}};a.MediaElement=function(b,c){return a.HtmlMediaElementShim.create(b,c)};a.HtmlMediaElementShim={create:function(d,g){var h={},e=(typeof(d)=="string")?document.getElementById(d):d,n=e.tagName.toLowerCase(),f=(n==="audio"||n==="video"),m=(f)?e.getAttribute("src"):e.getAttribute("href"),j=e.getAttribute("poster"),b=e.getAttribute("autoplay"),k=e.getAttribute("preload"),c=e.getAttribute("controls"),i,l;for(l in a.MediaElementDefaults){h[l]=a.MediaElementDefaults[l]}for(l in g){h[l]=g[l]}m=(typeof m=="undefined"||m===null||m=="")?null:m;j=(typeof j=="undefined"||j===null)?"":j;k=(typeof k=="undefined"||k===null||k==="false")?"none":k;b=!(typeof b=="undefined"||b===null||b==="false");c=!(typeof c=="undefined"||c===null||c==="false");i=this.determinePlayback(e,h,a.MediaFeatures.supportsMediaTag,f,m);i.url=(i.url!==null)?a.Utility.absolutizeUrl(i.url):"";i.scheme=a.Utility.determineScheme(i.url);if(i.method=="native"){if(a.MediaFeatures.isBustedAndroid){e.src=i.url;e.cincopaAddEventListener("click",function(){e.play()},false)}return this.updateNative(i,h,b,k)}else{if(i.method!==""){return this.createPlugin(i,h,j,b,k,c)}else{this.createErrorMessage(i,h,j);return this}}},determinePlayback:function(c,q,w,e,v){var o=[],d,f,g,h,p,x,u={method:"",url:"",htmlMediaElement:c,isVideo:(c.tagName.toLowerCase()!=="audio"),scheme:""},s,t,r,b,m;if(typeof q.type!="undefined"&&q.type!==""){if(typeof q.type=="string"){o.push({type:q.type,url:v})}else{for(d=0;d<q.type.length;d++){o.push({type:q.type[d],url:v})}}}else{if(v!==null){x=this.formatType(v,c.getAttribute("type"));o.push({type:x,url:v})}else{for(d=0;d<c.childNodes.length;d++){p=c.childNodes[d];if(p.nodeType==1&&p.tagName.toLowerCase()=="source"){v=p.getAttribute("src");x=this.formatType(v,p.getAttribute("type"));m=p.getAttribute("media");if(!m||!window.matchMedia||(window.matchMedia&&window.matchMedia(m).matches)){o.push({type:x,url:v})}}}}}if(!e&&o.length>0&&o[0].url!==null&&this.getTypeFromFile(o[0].url).indexOf("audio")>-1){u.isVideo=false}if(u.isVideo&&a.MediaFeatures.isBustedAndroid){c.canPlayType=function(i){return(i.match(/video\/(mp4|m4v)/gi)!==null)?"maybe":""}}if(u.isVideo&&a.MediaFeatures.isChromium){c.canPlayType=function(i){return(i.match(/video\/(webm|ogv|ogg)/gi)!==null)?"maybe":""}}if(w&&(q.mode==="auto"||q.mode==="auto_plugin"||q.mode==="native")&&!(a.MediaFeatures.isBustedNativeHTTPS&&q.httpsBasicAuthSite===true)){if(!e){b=document.createElement(u.isVideo?"video":"audio");c.parentNode.insertBefore(b,c);c.style.display="none";u.htmlMediaElement=c=b}for(d=0;d<o.length;d++){if(o[d].type=="video/m3u8"||c.canPlayType(o[d].type).replace(/no/,"")!==""||c.canPlayType(o[d].type.replace(/mp3/,"mpeg")).replace(/no/,"")!==""||c.canPlayType(o[d].type.replace(/m4a/,"mp4")).replace(/no/,"")!==""){u.method="native";u.url=o[d].url;break}}if(u.method==="native"){if(u.url!==null){c.src=u.url}if(q.mode!=="auto_plugin"){return u}}}if(q.mode==="auto"||q.mode==="auto_plugin"||q.mode==="shim"){for(d=0;d<o.length;d++){x=o[d].type;for(f=0;f<q.plugins.length;f++){s=q.plugins[f];t=a.plugins[s];for(g=0;g<t.length;g++){r=t[g];if(r.version==null||a.PluginDetector.hasPluginVersion(s,r.version)){for(h=0;h<r.types.length;h++){if(x.toLowerCase()==r.types[h].toLowerCase()){u.method=s;u.url=o[d].url;return u}}}}}}}if(q.mode==="auto_plugin"&&u.method==="native"){return u}if(u.method===""&&o.length>0){u.url=o[0].url}return u},formatType:function(c,b){if(c&&!b){return this.getTypeFromFile(c)}else{if(b&&~b.indexOf(";")){return b.substr(0,b.indexOf(";"))}else{return b}}},getTypeFromFile:function(d){d=d.split("?")[0];var c=d.substring(d.lastIndexOf(".")+1).toLowerCase(),b=/(mp4|m4v|ogg|ogv|m3u8|webm|webmv|flv|wmv|mpeg|mov)/gi.test(c)?"video/":"audio/";return this.getTypeFromExtension(c,b)},getTypeFromExtension:function(c,b){b=b||"";switch(c){case"mp4":case"m4v":case"m4a":case"f4v":case"f4a":return b+"mp4";case"flv":return b+"x-flv";case"webm":case"webma":case"webmv":return b+"webm";case"ogg":case"oga":case"ogv":return b+"ogg";case"m3u8":return"application/x-mpegurl";case"ts":return b+"mp2t";default:return b+c}},createErrorMessage:function(h,g,i){var f=h.htmlMediaElement,c=document.createElement("div"),d=g.customError;c.className="me-cannotplay";try{c.style.width=f.width+"px";c.style.height=f.height+"px"}catch(b){}if(!d){d='<a href="'+h.url+'">';if(i!==""){d+='<img src="'+i+'" width="100%" height="100%" alt="" />'}d+="<span>"+a.i18n.t("mejs.download-file")+"</span></a>"}c.innerHTML=d;f.parentNode.insertBefore(c,f);f.style.display="none";g.error(f)},createPlugin:function(o,n,u,c,v,g){var j=o.htmlMediaElement,A=1,h=1,s="me_"+o.method+"_"+(a.meIndex++),t=new a.PluginMediaElement(s,o.method,o.url),f=document.createElement("div"),w,m,l;t.tagName=j.tagName;for(var k=0;k<j.attributes.length;k++){var b=j.attributes[k];if(b.specified){t.setAttribute(b.name,b.value)}}m=j.parentNode;while(m!==null&&m.tagName!=null&&m.tagName.toLowerCase()!=="body"&&m.parentNode!=null&&m.parentNode.tagName!=null&&m.parentNode.constructor!=null&&m.parentNode.constructor.name==="ShadowRoot"){if(m.parentNode.tagName.toLowerCase()==="p"){m.parentNode.parentNode.insertBefore(m,m.parentNode);break}m=m.parentNode}if(o.isVideo){A=(n.pluginWidth>0)?n.pluginWidth:(n.videoWidth>0)?n.videoWidth:(j.getAttribute("width")!==null)?j.getAttribute("width"):n.defaultVideoWidth;h=(n.pluginHeight>0)?n.pluginHeight:(n.videoHeight>0)?n.videoHeight:(j.getAttribute("height")!==null)?j.getAttribute("height"):n.defaultVideoHeight;A=a.Utility.encodeUrl(A);h=a.Utility.encodeUrl(h)}else{if(n.enablePluginDebug){A=320;h=240}}t.success=n.success;f.className="me-plugin";f.id=s+"_container";if(o.isVideo){j.parentNode.insertBefore(f,j)}else{document.body.insertBefore(f,document.body.childNodes[0])}if(o.method==="flash"||o.method==="silverlight"){var d=j.getAttribute("type")==="audio/mp4",e=j.getElementsByTagName("source");if(e&&!d){for(var k=0,x=e.length;k<x;k++){if(e[k].getAttribute("type")==="audio/mp4"){d=true}}}l=["id="+s,"isvideo="+((o.isVideo||d)?"true":"false"),"autoplay="+((c)?"true":"false"),"preload="+v,"width="+A,"startvolume="+n.startVolume,"timerrate="+n.timerRate,"flashstreamer="+n.flashStreamer,"height="+h,"pseudostreamstart="+n.pseudoStreamingStartQueryParam];if(o.url!==null){if(o.method=="flash"){l.push("file="+a.Utility.encodeUrl(o.url))}else{l.push("file="+o.url)}}if(n.enablePluginDebug){l.push("debug=true")}if(n.enablePluginSmoothing){l.push("smoothing=true")}if(n.enablePseudoStreaming){l.push("pseudostreaming=true")}if(g){l.push("controls=true")}if(n.pluginVars){l=l.concat(n.pluginVars)}window[s+"_init"]=function(){switch(t.pluginType){case"flash":t.pluginElement=t.pluginApi=document.getElementById(s);break;case"silverlight":t.pluginElement=document.getElementById(t.id);t.pluginApi=t.pluginElement.Content.MediaElementJS;break}if(t.pluginApi!=null&&t.success){t.success(t,j)}};window[s+"_event"]=function(D,F){var C,E,B;C={type:D,target:t};for(E in F){t[E]=F[E];C[E]=F[E]}B=F.bufferedTime||0;C.target.buffered=C.buffered={start:function(i){return 0},end:function(i){return B},length:1};t.dispatchEvent(C)}}switch(o.method){case"silverlight":f.innerHTML='<object data="data:application/x-silverlight-2," type="application/x-silverlight-2" id="'+s+'" name="'+s+'" width="'+A+'" height="'+h+'" class="mejs-shim"><param name="initParams" value="'+l.join(",")+'" /><param name="windowless" value="true" /><param name="background" value="black" /><param name="minRuntimeVersion" value="3.0.0.0" /><param name="autoUpgrade" value="true" /><param name="source" value="'+n.pluginPath+n.silverlightName+'" /></object>';break;case"flash":if(a.MediaFeatures.isIE){w=document.createElement("div");f.appendChild(w);w.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+s+'" width="'+A+'" height="'+h+'" class="mejs-shim"><param name="movie" value="'+n.pluginPath+n.flashName+"?"+(new Date().getTime())+'" /><param name="flashvars" value="'+l.join("&amp;")+'" /><param name="quality" value="high" /><param name="bgcolor" value="#000000" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="'+n.flashScriptAccess+'" /><param name="allowFullScreen" value="true" /><param name="scale" value="default" /></object>'}else{f.innerHTML='<embed id="'+s+'" name="'+s+'" play="true" loop="false" quality="high" bgcolor="#000000" wmode="transparent" allowScriptAccess="'+n.flashScriptAccess+'" allowFullScreen="true" type="application/x-shockwave-flash" pluginspage="//www.macromedia.com/go/getflashplayer" src="'+n.pluginPath+n.flashName+'" flashvars="'+l.join("&")+'" width="'+A+'" height="'+h+'" scale="default"class="mejs-shim"></embed>'}break;case"youtube":var y;if(o.url.lastIndexOf("youtu.be")!=-1){y=o.url.substr(o.url.lastIndexOf("/")+1);if(y.indexOf("?")!=-1){y=y.substr(0,y.indexOf("?"))}}else{var z=o.url.match(/[?&]v=([^&#]+)|&|#|$/);if(z){y=z[1]}}youtubeSettings={container:f,containerId:f.id,pluginMediaElement:t,pluginId:s,videoId:y,height:h,width:A,scheme:o.scheme,variables:n.youtubeIframeVars};if(window.postMessage){a.YouTubeApi.enqueueIframe(youtubeSettings)}else{if(a.PluginDetector.hasPluginVersion("flash",[10,0,0])){a.YouTubeApi.createFlash(youtubeSettings,n)}}break;case"vimeo":var q=s+"_player";t.vimeoid=o.url.substr(o.url.lastIndexOf("/")+1);f.innerHTML='<iframe src="'+o.scheme+"player.vimeo.com/video/"+t.vimeoid+"?api=1&portrait=0&byline=0&title=0&player_id="+q+'" width="'+A+'" height="'+h+'" frameborder="0" class="mejs-shim" id="'+q+'" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';if(typeof($f)=="function"){var p=$f(f.childNodes[0]),r=-1;p.addEvent("ready",function(){p.playVideo=function(){p.api("play")};p.stopVideo=function(){p.api("unload")};p.pauseVideo=function(){p.api("pause")};p.seekTo=function(B){p.api("seekTo",B)};p.setVolume=function(B){p.api("setVolume",B)};p.setMuted=function(B){if(B){p.lastVolume=p.api("getVolume");p.api("setVolume",0)}else{p.api("setVolume",p.lastVolume);delete p.lastVolume}};p.getPlayerState=function(){return r};function i(E,F,D,B){var C={type:D,target:F};if(D=="timeupdate"){F.currentTime=C.currentTime=B.seconds;F.duration=C.duration=B.duration}F.dispatchEvent(C)}p.addEvent("play",function(){r=1;i(p,t,"play");i(p,t,"playing")});p.addEvent("pause",function(){r=2;i(p,t,"pause")});p.addEvent("finish",function(){r=0;i(p,t,"ended")});p.addEvent("playProgress",function(B){i(p,t,"timeupdate",B)});p.addEvent("seek",function(B){r=3;i(p,t,"seeked",B)});p.addEvent("loadProgress",function(B){r=3;i(p,t,"progress",B)});t.pluginElement=f;t.pluginApi=p;t.success(t,t.pluginElement)})}else{console.warn("You need to include froogaloop for vimeo to work")}break}j.style.display="none";j.removeAttribute("autoplay");return t},updateNative:function(f,e,b,g){var c=f.htmlMediaElement,d;for(d in a.HtmlMediaElement){c[d]=a.HtmlMediaElement[d]}e.success(c,c);return c}};a.YouTubeApi={isIframeStarted:false,isIframeLoaded:false,loadIframeApi:function(d){if(!this.isIframeStarted){var c=document.createElement("script");c.src=d.scheme+"www.youtube.com/player_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(c,b);this.isIframeStarted=true}},iframeQueue:[],enqueueIframe:function(b){if(this.isLoaded){this.createIframe(b)}else{this.loadIframeApi(b);this.iframeQueue.push(b)}},createIframe:function(e){var d=e.pluginMediaElement,b={controls:0,wmode:"transparent"},c=new YT.Player(e.containerId,{height:e.height,width:e.width,videoId:e.videoId,playerVars:a.$.extend({},b,e.variables),events:{onReady:function(f){c.setVideoSize=function(h,g){c.setSize(h,g)};e.pluginMediaElement.pluginApi=c;e.pluginMediaElement.pluginElement=document.getElementById(e.containerId);d.success(d,d.pluginElement);a.YouTubeApi.createEvent(c,d,"canplay");setInterval(function(){a.YouTubeApi.createEvent(c,d,"timeupdate")},250);if(typeof d.attributes.autoplay!=="undefined"){c.playVideo()}},onStateChange:function(f){a.YouTubeApi.handleStateChange(f.data,c,d)}}})},createEvent:function(e,f,d){var c={type:d,target:f};if(e&&e.getDuration){f.currentTime=c.currentTime=e.getCurrentTime();f.duration=c.duration=e.getDuration();c.paused=f.paused;c.ended=f.ended;c.muted=e.isMuted();c.volume=e.getVolume()/100;c.bytesTotal=e.getVideoBytesTotal();c.bufferedBytes=e.getVideoBytesLoaded();var b=c.bufferedBytes/c.bytesTotal*c.duration;c.target.buffered=c.buffered={start:function(g){return 0},end:function(g){return b},length:1}}f.dispatchEvent(c)},iFrameReady:function(){this.isLoaded=true;this.isIframeLoaded=true;while(this.iframeQueue.length>0){var b=this.iframeQueue.pop();this.createIframe(b)}},flashPlayers:{},createFlash:function(b){this.flashPlayers[b.pluginId]=b;var c,d=b.scheme+"www.youtube.com/apiplayer?enablejsapi=1&amp;playerapiid="+b.pluginId+"&amp;version=3&amp;autoplay=0&amp;controls=0&amp;modestbranding=1&loop=0";if(a.MediaFeatures.isIE){c=document.createElement("div");b.container.appendChild(c);c.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+b.scheme+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+b.pluginId+'" width="'+b.width+'" height="'+b.height+'" class="mejs-shim"><param name="movie" value="'+d+'" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="'+options.flashScriptAccess+'" /><param name="allowFullScreen" value="true" /></object>'}else{b.container.innerHTML='<object type="application/x-shockwave-flash" id="'+b.pluginId+'" data="'+d+'" width="'+b.width+'" height="'+b.height+'" style="visibility: visible; " class="mejs-shim"><param name="allowScriptAccess" value="'+options.flashScriptAccess+'"><param name="wmode" value="transparent"></object>'}},flashReady:function(c){var f=this.flashPlayers[c],d=document.getElementById(c),e=f.pluginMediaElement;e.pluginApi=e.pluginElement=d;f.success(e,e.pluginElement);d.cueVideoById(f.videoId);var b=f.containerId+"_callback";window[b]=function(g){a.YouTubeApi.handleStateChange(g,d,e)};d.cincopaAddEventListener("onStateChange",b);setInterval(function(){a.YouTubeApi.createEvent(d,e,"timeupdate")},250);a.YouTubeApi.createEvent(d,e,"canplay")},handleStateChange:function(d,b,c){switch(d){case -1:c.paused=true;c.ended=true;a.YouTubeApi.createEvent(b,c,"loadedmetadata");break;case 0:c.paused=false;c.ended=true;a.YouTubeApi.createEvent(b,c,"ended");break;case 1:c.paused=false;c.ended=false;a.YouTubeApi.createEvent(b,c,"play");a.YouTubeApi.createEvent(b,c,"playing");break;case 2:c.paused=true;c.ended=false;a.YouTubeApi.createEvent(b,c,"pause");break;case 3:a.YouTubeApi.createEvent(b,c,"progress");break;case 5:break}}};window.onYouTubePlayerAPIReady=function(){a.YouTubeApi.iFrameReady()};window.onYouTubePlayerReady=function(b){a.YouTubeApi.flashReady(b)};window.cincopa_mejs=a;window.CincopaMediaElement=a.MediaElement;(function(b,f,d,e){var c={"default":"en",locale:{language:(d.i18n&&d.i18n.locale.language)||"",strings:(d.i18n&&d.i18n.locale.strings)||{}},pluralForms:[function(){return arguments[1]},function(){var g=arguments;if(g[0]===1){return g[1]}else{return g[2]}},function(){var g=arguments;if([0,1].indexOf(g[0])>-1){return g[1]}else{return g[2]}},function(){var g=arguments;if(g[0]%10===1&&g[0]%100!==11){return g[1]}else{if(g[0]!==0){return g[2]}else{return g[3]}}},function(){var g=arguments;if(g[0]===1||g[0]===11){return g[1]}else{if(g[0]===2||g[0]===12){return g[2]}else{if(g[0]>2&&g[0]<20){return g[3]}else{return g[4]}}}},function(){if(args[0]===1){return args[1]}else{if(args[0]===0||(args[0]%100>0&&args[0]%100<20)){return args[2]}else{return args[3]}}},function(){var g=arguments;if(g[0]%10===1&&g[0]%100!==11){return g[1]}else{if(g[0]%10>=2&&(g[0]%100<10||g[0]%100>=20)){return g[2]}else{return[3]}}},function(){var g=arguments;if(g[0]%10===1&&g[0]%100!==11){return g[1]}else{if(g[0]%10>=2&&g[0]%10<=4&&(g[0]%100<10||g[0]%100>=20)){return g[2]}else{return g[3]}}},function(){var g=arguments;if(g[0]===1){return g[1]}else{if(g[0]>=2&&g[0]<=4){return g[2]}else{return g[3]}}},function(){var g=arguments;if(g[0]===1){return g[1]}else{if(g[0]%10>=2&&g[0]%10<=4&&(g[0]%100<10||g[0]%100>=20)){return g[2]}else{return g[3]}}},function(){var g=arguments;if(g[0]%100===1){return g[2]}else{if(g[0]%100===2){return g[3]}else{if(g[0]%100===3||g[0]%100===4){return g[4]}else{return g[1]}}}},function(){var g=arguments;if(g[0]===1){return g[1]}else{if(g[0]===2){return g[2]}else{if(g[0]>2&&g[0]<7){return g[3]}else{if(g[0]>6&&g[0]<11){return g[4]}else{return g[5]}}}}},function(){var g=arguments;if(g[0]===0){return g[1]}else{if(g[0]===1){return g[2]}else{if(g[0]===2){return g[3]}else{if(g[0]%100>=3&&g[0]%100<=10){return g[4]}else{if(g[0]%100>=11){return g[5]}else{return g[6]}}}}}},function(){var g=arguments;if(g[0]===1){return g[1]}else{if(g[0]===0||(g[0]%100>1&&g[0]%100<11)){return g[2]}else{if(g[0]%100>10&&g[0]%100<20){return g[3]}else{return g[4]}}}},function(){var g=arguments;if(g[0]%10===1){return g[1]}else{if(g[0]%10===2){return g[2]}else{return g[3]}}},function(){var g=arguments;if(g[0]!==11&&g[0]%10===1){return g[1]}else{return g[2]}},function(){var g=arguments;if(g[0]===1){return g[1]}else{if(g[0]%10>=2&&g[0]%10<=4&&(g[0]%100<10||g[0]%100>=20)){return g[2]}else{return g[3]}}},function(){var g=arguments;if(g[0]===1){return g[1]}else{if(g[0]===2){return g[2]}else{if(g[0]!==8&&g[0]!==11){return g[3]}else{return g[4]}}}},function(){var g=arguments;if(g[0]===0){return g[1]}else{return g[2]}},function(){var g=arguments;if(g[0]===1){return g[1]}else{if(g[0]===2){return g[2]}else{if(g[0]===3){return g[3]}else{return g[4]}}}},function(){var g=arguments;if(g[0]===0){return g[1]}else{if(g[0]===1){return g[2]}else{return g[3]}}}],getLanguage:function(){var g=c.locale.language||c["default"];return/^(x\-)?[a-z]{2,}(\-\w{2,})?(\-\w{2,})?$/.exec(g)?g:c["default"]},t:function(i,l){if(typeof i==="string"&&i.length){var h=c.getLanguage(),m,k,j=function(o,p,n){if(typeof o!=="object"||typeof p!=="number"||typeof n!=="number"){return o}if(typeof o==="string"){return o}return c.pluralForms[n].apply(null,[p].concat(o))},g=function(n){var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return n.replace(/[&<>"]/g,function(p){return o[p]})};if(c.locale.strings&&c.locale.strings[h]){m=c.locale.strings[h][i];if(typeof l==="number"){k=c.locale.strings[h]["mejs.plural-form"];m=j.apply(null,[m,l,k])}}if(!m&&c.locale.strings&&c.locale.strings[c["default"]]){m=c.locale.strings[c["default"]][i];if(typeof l==="number"){k=c.locale.strings[c["default"]]["mejs.plural-form"];m=j.apply(null,[m,l,k])}}m=m||i;if(typeof l==="number"){m=m.replace("%1",l)}return g(m)}return i}};if(typeof mejsL10n!=="undefined"){c.locale.language=mejsL10n.language}d.i18n=c}(document,window,a));(function(b,c){if(typeof mejsL10n!=="undefined"){b[mejsL10n.lang]=mejsL10n.strings}}(a.i18n.locale.strings));
/*
	 * This is a i18n.locale language object.
	 *
	 * English; This can serve as a template for other languages to translate
	 *
	 * @author
	 *   TBD
	 *   Sascha Greuel (Twitter: @SoftCreatR)
	 *
	 * @see
	 *   me-i18n.js
	 *
	 * @params
	 *  - exports - CommonJS, window ..
	 */
(function(b){if(b.en===undefined){b.en={"mejs.plural-form":1,"mejs.download-file":"Download File","mejs.fullscreen-off":"Turn off Fullscreen","mejs.fullscreen-on":"Go Fullscreen","mejs.download-video":"Download Video","mejs.fullscreen":"Fullscreen","mejs.time-jump-forward":["Jump forward 1 second","Jump forward %1 seconds"],"mejs.play":"Play","mejs.pause":"Pause","mejs.close":"Close","mejs.time-slider":"Time Slider","mejs.time-help-text":"Use Left/Right Arrow keys to advance one second, Up/Down arrows to advance ten seconds.","mejs.time-skip-back":["Skip back 1 second","Skip back %1 seconds"],"mejs.captions-subtitles":"Captions/Subtitles","mejs.none":"None","mejs.mute-toggle":"Mute Toggle","mejs.volume-help-text":"Use Up/Down Arrow keys to increase or decrease volume.","mejs.unmute":"Unmute","mejs.mute":"Mute","mejs.volume-slider":"Volume Slider","mejs.video-player":"Video Player","mejs.audio-player":"Audio Player","mejs.ad-skip":"Skip ad","mejs.ad-skip-info":["Skip in 1 second","Skip in %1 seconds"],"mejs.source-chooser":"Source Chooser"}}}(a.i18n.locale.strings));
/*
	 *
	 * MediaElementPlayer
	 * http://mediaelementjs.com/
	 *
	 * Creates a controller bar for HTML5 <video> add <audio> tags
	 * using zeQuery and MediaElement.js (HTML5 Flash/Silverlight wrapper)
	 *
	 * Copyright 2010-2013, John Dyer (http://j.hn/)
	 * License: MIT
	 *
	 */
if(typeof zeQuery!="undefined"){a.$=zeQuery}else{if(typeof Zepto!="undefined"){a.$=Zepto;Zepto.fn.outerWidth=function(b){var c=$(this).width();if(b){c+=parseInt($(this).css("margin-right"),10);c+=parseInt($(this).css("margin-left"),10)}return c}}else{if(typeof ender!="undefined"){a.$=ender}}}(function(b){a.MepDefaults={poster:"",showPosterWhenEnded:false,defaultVideoWidth:480,defaultVideoHeight:270,videoWidth:-1,videoHeight:-1,defaultAudioWidth:400,defaultAudioHeight:30,defaultSeekBackwardInterval:function(c){return(c.duration*0.05)},defaultSeekForwardInterval:function(c){return(c.duration*0.05)},setDimensions:true,audioWidth:-1,audioHeight:-1,startVolume:0.8,loop:false,autoRewind:true,enableAutosize:true,timeFormat:"",alwaysShowHours:false,showTimecodeFrameCount:false,framesPerSecond:25,autosizeProgress:true,alwaysShowControls:false,hideVideoControlsOnLoad:false,clickToPlayPause:true,controlsTimeoutDefault:1500,controlsTimeoutMouseEnter:2500,controlsTimeoutMouseLeave:1000,iPadUseNativeControls:false,iPhoneUseNativeControls:false,AndroidUseNativeControls:false,features:["playpause","current","progress","duration","tracks","volume","fullscreen"],isVideo:true,stretching:"auto",enableKeyboard:true,pauseOtherPlayers:true,keyActions:[{keys:[32,179],action:function(f,e,d,c){if(!a.MediaFeatures.isFirefox){if(e.paused||e.ended){e.play()}else{e.pause()}}}},{keys:[38],action:function(g,e,d,c){g.container.find(".mejs-volume-slider").css("display","block");if(g.isVideo){g.showControls();g.startControlsTimer()}var f=Math.min(e.volume+0.1,1);e.setVolume(f)}},{keys:[40],action:function(g,e,d,c){g.container.find(".mejs-volume-slider").css("display","block");if(g.isVideo){g.showControls();g.startControlsTimer()}var f=Math.max(e.volume-0.1,0);e.setVolume(f)}},{keys:[37,227],action:function(g,e,d,c){if(!isNaN(e.duration)&&e.duration>0){if(g.isVideo){g.showControls();g.startControlsTimer()}var f=Math.max(e.currentTime-g.options.defaultSeekBackwardInterval(e),0);e.setCurrentTime(f)}}},{keys:[39,228],action:function(g,e,d,c){if(!isNaN(e.duration)&&e.duration>0){if(g.isVideo){g.showControls();g.startControlsTimer()}var f=Math.min(e.currentTime+g.options.defaultSeekForwardInterval(e),e.duration);e.setCurrentTime(f)}}},{keys:[70],action:function(f,e,d,c){if(typeof f.enterFullScreen!="undefined"){if(f.isFullScreen){f.exitFullScreen()}else{f.enterFullScreen()}}}},{keys:[77],action:function(f,e,d,c){f.container.find(".mejs-volume-slider").css("display","block");if(f.isVideo){f.showControls();f.startControlsTimer()}if(f.media.muted){f.setMuted(false)}else{f.setMuted(true)}}}]};a.mepIndex=0;a.players={};a.MediaElementPlayer=function(c,d){if(!(this instanceof a.MediaElementPlayer)){return new a.MediaElementPlayer(c,d)}var e=this;e.$media=e.$node=b(c);e.node=e.media=e.$media[0];if(!e.node){return}if(typeof e.node.player!="undefined"){return e.node.player}if(typeof d=="undefined"){d=e.$node.data("mejsoptions")}e.options=b.extend({},a.MepDefaults,d);if(!e.options.timeFormat){e.options.timeFormat="mm:ss";if(e.options.alwaysShowHours){e.options.timeFormat="hh:mm:ss"}if(e.options.showTimecodeFrameCount){e.options.timeFormat+=":ff"}}a.Utility.calculateTimeFormat(0,e.options,e.options.framesPerSecond||25);e.id="mep_"+(a.mepIndex++)+"_"+Date.now();a.players[e.id]=e;e.init();return e};a.MediaElementPlayer.prototype={hasFocus:false,controlsAreVisible:true,init:function(){var f=this,e=a.MediaFeatures,d=b.extend(true,{},f.options,{success:function(k,j){f.meReady(k,j)},error:function(j){f.handleError(j)}}),g=f.media.tagName.toLowerCase();f.isDynamic=(g!=="audio"&&g!=="video");if(f.isDynamic){f.isVideo=f.options.isVideo}else{f.isVideo=(g!=="audio"&&f.options.isVideo)}if((e.isiPad&&f.options.iPadUseNativeControls)||(e.isiPhone&&f.options.iPhoneUseNativeControls)){f.$media.attr("controls","controls");if(e.isiPad&&f.media.getAttribute("autoplay")!==null){f.play()}}else{if(e.isAndroid&&f.options.AndroidUseNativeControls){}else{if(f.isVideo||(!f.isVideo&&f.options.features.length)){f.$media.removeAttr("controls");var i=f.isVideo?a.i18n.t("mejs.video-player"):a.i18n.t("mejs.audio-player");b('<span class="mejs-offscreen">'+i+"</span>").insertBefore(f.$media);f.container=b('<div id="'+f.id+'" class="mejs-container '+(a.MediaFeatures.svgAsImg?"svg":"no-svg")+'" tabindex="0" role="application" aria-label="'+i+'"><div class="mejs-inner"><div class="mejs-mediaelement"></div><div class="mejs-layers"></div><div class="mejs-controls"></div><div class="mejs-clear"></div></div></div>').addClass(f.$media[0].className).insertBefore(f.$media).focus(function(l){if(!f.controlsAreVisible&&!f.hasFocus&&f.controlsEnabled){f.showControls(true);if(!f.hasMsNativeFullScreen){var j=".mejs-playpause-button > button";if(a.Utility.isNodeAfter(l.relatedTarget,f.container[0])){j=".mejs-controls .mejs-button:last-child > button"}var k=f.container.find(j);k.focus()}}});if(!f.options.features.length){f.container.css("background","transparent").find(".mejs-controls").hide()}if(f.isVideo&&f.options.stretching==="fill"&&!f.container.parent("mejs-fill-container").length){f.outerContainer=f.$media.parent();f.container.wrap('<div class="mejs-fill-container"/>')}f.container.addClass((e.isAndroid?"mejs-android ":"")+(e.isiOS?"mejs-ios ":"")+(e.isiPad?"mejs-ipad ":"")+(e.isiPhone?"mejs-iphone ":"")+(f.isVideo?"mejs-video ":"mejs-audio "));f.container.find(".mejs-mediaelement").append(f.$media);f.node.player=f;f.controls=f.container.find(".mejs-controls");f.layers=f.container.find(".mejs-layers");var h=(f.isVideo?"video":"audio"),c=h.substring(0,1).toUpperCase()+h.substring(1);if(f.options[h+"Width"]>0||f.options[h+"Width"].toString().indexOf("%")>-1){f.width=f.options[h+"Width"]}else{if(f.media.style.width!==""&&f.media.style.width!==null){f.width=f.media.style.width}else{if(f.media.getAttribute("width")!==null){f.width=f.$media.attr("width")}else{f.width=f.options["default"+c+"Width"]}}}if(f.options[h+"Height"]>0||f.options[h+"Height"].toString().indexOf("%")>-1){f.height=f.options[h+"Height"]}else{if(f.media.style.height!==""&&f.media.style.height!==null){f.height=f.media.style.height}else{if(f.$media[0].getAttribute("height")!==null){f.height=f.$media.attr("height")}else{f.height=f.options["default"+c+"Height"]}}}f.setPlayerSize(f.width,f.height);d.pluginWidth=f.width;d.pluginHeight=f.height}else{if(!f.isVideo&&!f.options.features.length){f.$media.hide()}}}}a.MediaElement(f.$media[0],d);if(typeof(f.container)!=="undefined"&&f.options.features.length&&f.controlsAreVisible){f.container.trigger("controlsshown")}},showControls:function(c){var d=this;c=typeof c=="undefined"||c;if(d.controlsAreVisible){return}if(c){d.controls.removeClass("mejs-offscreen").stop(true,true).fadeIn(200,function(){d.controlsAreVisible=true;d.container.trigger("controlsshown")});d.container.find(".mejs-control").removeClass("mejs-offscreen").stop(true,true).fadeIn(200,function(){d.controlsAreVisible=true})}else{d.controls.removeClass("mejs-offscreen").css("display","block");d.container.find(".mejs-control").removeClass("mejs-offscreen").css("display","block");d.controlsAreVisible=true;d.container.trigger("controlsshown")}d.setControlsSize();d.container.find(".mejs-captions-position").removeClass("mejs-captions-position-bottom")},hideControls:function(c){var d=this;c=typeof c=="undefined"||c;if(!d.controlsAreVisible||d.options.alwaysShowControls||d.keyboardAction||d.media.paused||d.media.ended){return}if(c){d.controls.stop(true,true).fadeOut(200,function(){b(this).addClass("mejs-offscreen");if(parseFloat(d.options.css_version)>=1.1){b(this).css("display","block")}d.controlsAreVisible=false;d.container.find(".mejs-captions-position").addClass("mejs-captions-position-bottom");d.container.trigger("controlshidden")});d.container.find(".mejs-control").stop(true,true).fadeOut(200,function(){b(this).addClass("mejs-offscreen");if(parseFloat(d.options.css_version)>=1.1){b(this).css("display","block")}})}else{d.controls.addClass("mejs-offscreen").css("display","block");d.container.find(".mejs-control").addClass("mejs-offscreen").css("display","block");d.controlsAreVisible=false;d.container.trigger("controlshidden");d.container.find(".mejs-captions-position").addClass("mejs-captions-position-bottom")}},controlsTimer:null,startControlsTimer:function(d){var c=this;d=typeof d!="undefined"?d:c.options.controlsTimeoutDefault;c.killControlsTimer("start");c.controlsTimer=setTimeout(function(){c.hideControls();c.killControlsTimer("hide")},d)},killControlsTimer:function(c){var d=this;if(d.controlsTimer!==null){clearTimeout(d.controlsTimer);delete d.controlsTimer;d.controlsTimer=null}},controlsEnabled:true,disableControls:function(){var c=this;c.killControlsTimer();c.hideControls(false);this.controlsEnabled=false},enableControls:function(){var c=this;c.showControls(false);c.controlsEnabled=true},meReady:function(k,f){var m=this,l=a.MediaFeatures,d=f.getAttribute("autoplay"),c=!(typeof d=="undefined"||d===null||d==="false"),j,i;if(m.created){return}else{m.created=true}m.media=k;m.domNode=f;if(!(l.isAndroid&&m.options.AndroidUseNativeControls)&&!(l.isiPad&&m.options.iPadUseNativeControls)&&!(l.isiPhone&&m.options.iPhoneUseNativeControls)){if(!m.isVideo&&!m.options.features.length){if(c&&k.pluginType=="native"){m.play()}if(m.options.success){if(typeof m.options.success=="string"){window[m.options.success](m.media,m.domNode,m)}else{m.options.success(m.media,m.domNode,m)}}return}m.buildposter(m,m.controls,m.layers,m.media);m.buildkeyboard(m,m.controls,m.layers,m.media);m.buildoverlays(m,m.controls,m.layers,m.media);m.findTracks();for(j in m.options.features){i=m.options.features[j];if(m["build"+i]){try{m["build"+i](m,m.controls,m.layers,m.media)}catch(h){}}}m.container.trigger("controlsready");m.setPlayerSize(m.width,m.height);m.setControlsSize();if(m.isVideo){if(a.MediaFeatures.hasTouch&&!m.options.alwaysShowControls){m.$media.bind("touchstart",function(){if(m.controlsAreVisible){m.hideControls(false)}else{if(m.controlsEnabled){m.showControls(false)}}})}else{m.clickToPlayPauseCallback=function(){if(m.options.clickToPlayPause){if(m.media.paused){m.play()}else{m.pause()}var e=m.$media.closest(".mejs-container").find(".mejs-overlay-button"),n=e.attr("aria-pressed");e.attr("aria-pressed",!n)}};m.media.cincopaAddEventListener("click",m.clickToPlayPauseCallback,false);m.container.bind("mouseenter",function(){if(m.controlsEnabled){if(!m.options.alwaysShowControls){m.killControlsTimer("enter");m.showControls();if(parseFloat(m.options.css_version)>=1.1){}else{m.startControlsTimer(m.options.controlsTimeoutMouseEnter)}}}}).bind("mousemove",function(){if(m.controlsEnabled){if(!m.controlsAreVisible){m.showControls()}if(!m.options.alwaysShowControls){if(parseFloat(m.options.css_version)>=1.1){}else{m.startControlsTimer(m.options.controlsTimeoutMouseEnter)}}}}).bind("mouseleave",function(){if(m.controlsEnabled){if(!m.media.paused&&!m.options.alwaysShowControls){if(parseFloat(m.options.css_version)>=1.1){}else{m.startControlsTimer(m.options.controlsTimeoutMouseEnter)}}}})}if(m.options.hideVideoControlsOnLoad){m.hideControls(false)}if(c&&!m.options.alwaysShowControls){m.hideControls()}if(m.options.enableAutosize){m.media.cincopaAddEventListener("loadedmetadata",function(n){if(m.options.videoHeight<=0&&m.domNode.getAttribute("height")===null&&!isNaN(n.target.videoHeight)){m.setPlayerSize(n.target.videoWidth,n.target.videoHeight);m.setControlsSize();m.media.setVideoSize(n.target.videoWidth,n.target.videoHeight)}},false)}}m.media.cincopaAddEventListener("play",function(){var n;for(n in a.players){var e=a.players[n];if(e.id!=m.id&&m.options.pauseOtherPlayers&&!e.paused&&!e.ended){e.pause()}e.hasFocus=false}m.hasFocus=true},false);m.media.cincopaAddEventListener("ended",function(n){if(m.options.autoRewind){try{m.media.setCurrentTime(0);window.setTimeout(function(){b(m.container).find(".mejs-overlay-loading").parent().hide()},20)}catch(o){}}if(m.media.pluginType==="youtube"){m.media.stop()}else{m.media.pause()}if(m.setProgressRail){m.setProgressRail()}if(m.setCurrentRail){m.setCurrentRail()}if(m.options.loop){m.media.play()}else{if(!m.options.alwaysShowControls&&m.controlsEnabled){m.showControls()}}},false);m.media.cincopaAddEventListener("loadedmetadata",function(){a.Utility.calculateTimeFormat(m.duration,m.options,m.options.framesPerSecond||25);if(m.updateDuration){m.updateDuration()}if(m.updateCurrent){m.updateCurrent()}if(!m.isFullScreen){m.setPlayerSize(m.width,m.height);m.setControlsSize()}},false);var g=null;var g=null;m.media.cincopaAddEventListener("timeupdate",function(){if(g!==this.duration){g=this.duration;a.Utility.calculateTimeFormat(g,m.options,m.options.framesPerSecond||25);if(m.updateDuration){m.updateDuration()}if(m.updateCurrent){m.updateCurrent()}m.setControlsSize()}},false);m.container.focusout(function(o){if(o.relatedTarget){var n=b(o.relatedTarget);if(m.keyboardAction&&n.parents(".mejs-container").length===0){m.keyboardAction=false;if(m.isVideo&&!m.options.alwaysShowControls){m.hideControls(true)}}}});setTimeout(function(){m.setPlayerSize(m.width,m.height);m.setControlsSize()},50);m.globalBind("resize",function(){if(!(m.isFullScreen||(a.MediaFeatures.hasTrueNativeFullScreen&&document.webkitIsFullScreen))){m.setPlayerSize(m.width,m.height)}m.setControlsSize()});if(m.media.pluginType=="youtube"&&(l.isiOS||l.isAndroid)){m.container.find(".mejs-overlay-play").hide();m.container.find(".mejs-poster").hide()}}if(c&&k.pluginType=="native"){m.play()}if(m.options.success){if(typeof m.options.success=="string"){window[m.options.success](m.media,m.domNode,m)}else{m.options.success(m.media,m.domNode,m)}}},handleError:function(c){var d=this;if(d.controls){d.controls.hide()}if(d.options.error){d.options.error(c)}},setPlayerSize:function(e,c){var d=this;if(!d.options.setDimensions){return false}if(typeof e!="undefined"){d.width=e}if(typeof c!="undefined"){d.height=c}switch(d.options.stretching){case"fill":if(d.isVideo){this.setFillMode()}else{this.setDimensions(d.width,d.height)}break;case"responsive":this.setResponsiveMode();break;case"none":this.setDimensions(d.width,d.height);break;default:if(this.hasFluidMode()===true){this.setResponsiveMode()}else{this.setDimensions(d.width,d.height)}break}},hasFluidMode:function(){var c=this;return(c.height.toString().indexOf("%")>0||(c.$node.css("max-width")!=="none"&&c.$node.css("max-width")!=="t.width")||(c.$node[0].currentStyle&&c.$node[0].currentStyle.maxWidth==="100%"))},setResponsiveMode:function(){var h=this;var d=(function(){if(h.isVideo){if(h.media.videoWidth&&h.media.videoWidth>0){return h.media.videoWidth}else{if(h.media.getAttribute("width")!==null){return h.media.getAttribute("width")}else{return h.options.defaultVideoWidth}}}else{return h.options.defaultAudioWidth}})();var c=(function(){if(h.isVideo){if(h.media.videoHeight&&h.media.videoHeight>0){return h.media.videoHeight}else{if(h.media.getAttribute("height")!==null){return h.media.getAttribute("height")}else{return h.options.defaultVideoHeight}}}else{return h.options.defaultAudioHeight}})();var g=h.container.parent().closest(":visible").width(),f=h.container.parent().closest(":visible").height(),e=h.isVideo||!h.options.autosizeProgress?parseInt(g*c/d,10):c;if(isNaN(e)||(f!==0&&e>f&&f>c)){e=f}if(h.container.parent().length>0&&h.container.parent()[0].tagName.toLowerCase()==="body"){g=b(window).width();e=b(window).height()}if(e&&g){h.container.width(g).height(e);h.$media.add(h.container.find(".mejs-shim")).width("100%").height("100%");if(h.isVideo){if(h.media.setVideoSize){h.media.setVideoSize(g,e)}}h.layers.children(".mejs-layer").width("100%").height("100%")}},setFillMode:function(){var o=this,h=o.outerContainer;if(!h.width()){h.height(o.$media.width())}if(!h.height()){h.height(o.$media.height())}var j=h.width(),i=h.height();o.setDimensions("100%","100%");o.container.find(".mejs-poster img").css("display","block");targetElement=o.container.find("object, embed, iframe, video");var f=o.height,g=o.width,k=j,m=(f*j)/g,l=(g*i)/f,n=i,c=!(l>j),e=c?Math.floor(k):Math.floor(l),d=c?Math.floor(m):Math.floor(n);if(c){targetElement.height(d).width(j);if(o.media.setVideoSize){o.media.setVideoSize(j,d)}}else{targetElement.height(i).width(e);if(o.media.setVideoSize){o.media.setVideoSize(e,i)}}targetElement.css({"margin-left":Math.floor((j-e)/2),"margin-top":0})},setDimensions:function(e,c){var d=this;d.container.width(e).height(c);d.layers.children(".mejs-layer").width(e).height(c)},setControlsSize:function(){var i=this,k=0,h=0,g=i.controls.find(".mejs-time-rail"),j=i.controls.find(".mejs-time-total"),f=g.siblings(),d=f.last(),e=null,c=i.options&&!i.options.autosizeProgress;if(!i.container.is(":visible")||!g.length||!g.is(":visible")){return}if(c){h=parseInt(g.css("width"),10)}if(h===0||!h){f.each(function(){var l=b(this);if(l.css("position")!="absolute"&&l.is(":visible")){k+=b(this).outerWidth(true)}});h=i.controls.width()-k-(g.outerWidth(true)-g.width())}do{if(!c){g.width(h)}j.width(h-(j.outerWidth(true)-j.width()));if(d.css("position")!="absolute"){e=d.length?d.position():null;h--}}while(e!==null&&e.top.toFixed(2)>0&&h>0);i.container.trigger("controlsresize")},buildposter:function(f,c,d,e){var i=this,g=b('<div class="mejs-poster mejs-layer"></div>').appendTo(d),h=f.$media.attr("data-posterurl");if(f.options.poster!==""){h=f.options.poster}if(h){i.setPoster(h)}else{g.hide()}e.cincopaAddEventListener("play",function(){g.hide()},false);if(f.options.showPosterWhenEnded&&f.options.autoRewind){e.cincopaAddEventListener("ended",function(){g.show()},false)}},setPoster:function(f){var e=this,c=e.container.find(".mejs-poster"),d=c.find("img");if(d.length===0){d=b('<img width="100%" height="100%" alt="" />').appendTo(c)}d.attr("src",f)},buildoverlays:function(i,d,f,h){var j=this;if(!i.isVideo){return}var k="";if(a.MediaFeatures.isiOS){k="touchstart"}var g=b('<div class="mejs-overlay mejs-layer"><div class="mejs-overlay-loading"><span></span></div></div>').hide().appendTo(f),e=b('<div class="mejs-overlay mejs-layer"><div class="mejs-overlay-error"></div></div>').hide().appendTo(f),c=b('<div class="mejs-overlay mejs-layer mejs-overlay-play"><div class="mejs-overlay-button" role="button" aria-label="'+a.i18n.t("mejs.play")+'" aria-pressed="false"></div></div>').appendTo(f).bind("click "+k,function(){if(j.options.clickToPlayPause){if(h.paused){h.play()}var l=b(this).find(".mejs-overlay-button"),m=l.attr("aria-pressed");l.attr("aria-pressed",!!m)}});h.cincopaAddEventListener("play",function(){c.hide();g.hide();d.find(".mejs-time-buffering").hide();e.hide()},false);h.cincopaAddEventListener("playing",function(){c.hide();g.hide();d.find(".mejs-time-buffering").hide();e.hide()},false);h.cincopaAddEventListener("seeking",function(){g.show();d.find(".mejs-time-buffering").show()},false);h.cincopaAddEventListener("seeked",function(){g.hide();d.find(".mejs-time-buffering").hide()},false);h.cincopaAddEventListener("pause",function(){if(!a.MediaFeatures.isiPhone){c.show()}},false);h.cincopaAddEventListener("waiting",function(){g.show();d.find(".mejs-time-buffering").show()},false);h.cincopaAddEventListener("loadeddata",function(){g.show();d.find(".mejs-time-buffering").show();if(a.MediaFeatures.isAndroid){h.canplayTimeout=window.setTimeout(function(){if(document.createEvent){var l=document.createEvent("HTMLEvents");l.initEvent("canplay",true,true);return h.dispatchEvent(l)}},300)}},false);h.cincopaAddEventListener("canplay",function(){g.hide();d.find(".mejs-time-buffering").hide();clearTimeout(h.canplayTimeout)},false);h.cincopaAddEventListener("error",function(l){j.handleError(l);g.hide();c.hide();e.show();e.find(".mejs-overlay-error").html("Error loading this resource")},false);h.cincopaAddEventListener("keydown",function(l){j.onkeydown(i,h,l)},false)},buildkeyboard:function(f,c,d,e){var g=this;g.container.keydown(function(){g.keyboardAction=true});g.globalBind("keydown",function(h){f.hasFocus=b(h.target).closest(".mejs-container").length!==0&&b(h.target).closest(".mejs-container").attr("id")===f.$media.closest(".mejs-container").attr("id");return g.onkeydown(f,e,h)});g.globalBind("click",function(h){f.hasFocus=b(h.target).closest(".mejs-container").length!==0})},onkeydown:function(m,l,c){if(m.hasFocus&&m.options.enableKeyboard){for(var d=0,f=m.options.keyActions.length;d<f;d++){var k=m.options.keyActions[d];for(var g=0,h=k.keys.length;g<h;g++){if(c.keyCode==k.keys[g]){if(typeof(c.preventDefault)=="function"){c.preventDefault()}k.action(m,l,c.keyCode,c);return false}}}}return true},findTracks:function(){var c=this,d=c.$media.find("track");c.tracks=[];d.each(function(e,f){f=b(f);c.tracks.push({srclang:(f.attr("srclang"))?f.attr("srclang").toLowerCase():"",src:f.attr("src"),"data-src":f.attr("data-src"),kind:f.attr("kind"),label:f.attr("label")||"",entries:[],isLoaded:false})})},changeSkin:function(c){this.container[0].className="mejs-container "+c;this.setPlayerSize(this.width,this.height);this.setControlsSize()},play:function(){this.load();this.media.play()},pause:function(){try{this.media.pause()}catch(c){}},load:function(){if(!this.isLoaded){this.media.load()}this.isLoaded=true},setMuted:function(c){this.media.setMuted(c)},setCurrentTime:function(c){this.media.setCurrentTime(c)},getCurrentTime:function(){return this.media.currentTime},setVolume:function(c){this.media.setVolume(c)},getVolume:function(){return this.media.volume},setSrc:function(e){var f=this;if(f.media.pluginType==="youtube"){var g;if(typeof e!=="string"){var c,d;for(c=0;c<e.length;c++){d=e[c];if(this.canPlayType(d.type)){e=d.src;break}}}if(e.lastIndexOf("youtu.be")!==-1){g=e.substr(e.lastIndexOf("/")+1);if(g.indexOf("?")!==-1){g=g.substr(0,g.indexOf("?"))}}else{var h=e.match(/[?&]v=([^&#]+)|&|#|$/);if(h){g=h[1]}}if(f.media.getAttribute("autoplay")!==null){f.media.pluginApi.loadVideoById(g)}else{f.media.pluginApi.cueVideoById(g)}}else{f.media.setSrc(e)}},remove:function(){var g=this,f,d;g.container.prev(".mejs-offscreen").remove();for(f in g.options.features){d=g.options.features[f];if(g["clean"+d]){try{g["clean"+d](g)}catch(c){}}}if(!g.isDynamic){g.$media.prop("controls",true);g.$node.clone().insertBefore(g.container).show();g.$node.remove()}else{g.$node.insertBefore(g.container)}if(g.media.pluginType!=="native"){g.media.remove()}delete a.players[g.id];if(typeof g.container=="object"){g.container.remove()}g.globalUnbind();delete g.node.player},rebuildtracks:function(){var c=this;c.findTracks();c.buildtracks(c,c.controls,c.layers,c.media)},resetSize:function(){var c=this;setTimeout(function(){c.setPlayerSize(c.width,c.height);c.setControlsSize()},50)}};(function(){var c=/^((after|before)print|(before)?unload|hashchange|message|o(ff|n)line|page(hide|show)|popstate|resize|storage)\b/;function d(e,f){var g={d:[],w:[]};b.each((e||"").split(" "),function(i,j){var h=j+"."+f;if(h.indexOf(".")===0){g.d.push(h);g.w.push(h)}else{g[c.test(j)?"w":"d"].push(h)}});g.d=g.d.join(" ");g.w=g.w.join(" ");return g}a.MediaElementPlayer.prototype.globalBind=function(h,f,e){var i=this;var g=i.node?i.node.ownerDocument:document;h=d(h,i.id);if(h.d){b(g).bind(h.d,f,e)}if(h.w){b(window).bind(h.w,f,e)}};a.MediaElementPlayer.prototype.globalUnbind=function(g,e){var h=this;var f=h.node?h.node.ownerDocument:document;g=d(g,h.id);if(g.d){b(f).unbind(g.d,e)}if(g.w){b(window).unbind(g.w,e)}}})();if(typeof zeQuery!="undefined"){zeQuery.fn.mediaelementplayer=function(c){if(c===false){this.each(function(){var d=zeQuery(this).data("mediaelementplayer");if(d){d.remove()}zeQuery(this).removeData("mediaelementplayer")})}else{this.each(function(){zeQuery(this).data("mediaelementplayer",new a.MediaElementPlayer(this,c))})}return this};b(document).ready(function(){b(".mejs-player").mediaelementplayer()})}window.CincopaMediaElementPlayer=a.MediaElementPlayer})(a.$);(function(b){b.extend(a.MepDefaults,{playText:"",pauseText:""});b.extend(CincopaMediaElementPlayer.prototype,{buildplaypause:function(j,c,d,e){var l=this,f=l.options,k=f.playText?f.playText:a.i18n.t("mejs.play"),g=f.pauseText?f.pauseText:a.i18n.t("mejs.pause"),h=b('<div class="mejs-button mejs-playpause-button mejs-play" ><button type="button" aria-controls="'+l.id+'" title="'+k+'" aria-label="'+g+'"></button></div>').appendTo(c).click(function(n){n.preventDefault();if(e.paused){e.play()}else{e.pause()}return false}),i=h.find("button");function m(n){if("play"===n){h.removeClass("mejs-play").addClass("mejs-pause");i.attr({title:g,"aria-label":g})}else{h.removeClass("mejs-pause").addClass("mejs-play");i.attr({title:k,"aria-label":k})}}m("pse");e.cincopaAddEventListener("play",function(){m("play")},false);e.cincopaAddEventListener("playing",function(){m("play")},false);e.cincopaAddEventListener("pause",function(){m("pse")},false);e.cincopaAddEventListener("paused",function(){m("pse")},false)}})})(a.$);(function(b){b.extend(a.MepDefaults,{stopText:"Stop"});b.extend(CincopaMediaElementPlayer.prototype,{buildstop:function(f,c,d,e){var g=this;b('<div class="mejs-button mejs-stop-button mejs-stop"><button type="button" aria-controls="'+g.id+'" title="'+g.options.stopText+'" aria-label="'+g.options.stopText+'"></button></div>').appendTo(c).click(function(){if(!e.paused){e.pause()}if(e.currentTime>0){e.setCurrentTime(0);e.pause();c.find(".mejs-time-current").width("0px");c.find(".mejs-time-handle").css("left","0px");c.find(".mejs-time-float-current").html(a.Utility.secondsToTimeCode(0,f.options));c.find(".mejs-currenttime").html(a.Utility.secondsToTimeCode(0,f.options));d.find(".mejs-poster").show()}})}})})(a.$);(function(b){b.extend(a.MepDefaults,{enableProgressTooltip:true,progressHelpText:""});b.extend(CincopaMediaElementPlayer.prototype,{buildprogress:function(k,d,g,h){var o=this,i=false,j=false,f=0,n=false,c=k.options.autoRewind,l=o.options.progressHelpText?o.options.progressHelpText:a.i18n.t("mejs.time-help-text"),p=k.options.enableProgressTooltip?'<span class="mejs-time-float"><span class="mejs-time-float-current">00:00</span><span class="mejs-time-float-corner"></span></span>':"";b('<div class="mejs-time-rail"><span  class="mejs-slider-unvisible"><span class="mejs-slider-unvisible-total"></span></span><span  class="mejs-time-total mejs-time-slider"><span class="mejs-time-buffering"></span><span class="mejs-time-loaded"></span><span class="mejs-time-current"></span><span class="mejs-time-handle"></span>'+p+"</span></div>").appendTo(d);d.find(".mejs-time-buffering").hide();o.total=d.find(".mejs-time-total");o.loaded=d.find(".mejs-time-loaded");o.current=d.find(".mejs-time-current");o.handle=d.find(".mejs-time-handle");o.timefloat=d.find(".mejs-time-float");o.timefloatcurrent=d.find(".mejs-time-float-current");o.slider=d.find(".mejs-time-slider");o.unvisibleSlider=d.find(".mejs-slider-unvisible");var e=function(r){var t=o.total.offset(),w=o.total.width(),u=0,s=0,v=0,y;if(r.originalEvent&&r.originalEvent.changedTouches){y=r.originalEvent.changedTouches[0].pageX}else{if(r.changedTouches){y=r.changedTouches[0].pageX}else{y=r.pageX}}if(h.duration){if(y<t.left){y=t.left}else{if(y>w+t.left){y=w+t.left}}v=y-t.left;u=(v/w);s=Math.floor(u*h.duration);if(i&&s!==h.currentTime){h.setCurrentTime(s)}if(!a.MediaFeatures.hasTouch||k.options.floatTimeAlways){if(!isNaN(s)){o.timefloat.css("left",v);o.timefloatcurrent.html(a.Utility.secondsToTimeCode(s,k.options));o.timefloat.show()}}}},q=function(s){var t=h.currentTime,v=a.i18n.t("mejs.time-slider"),u=a.Utility.secondsToTimeCode(t,k.options),r=h.duration;o.slider.attr({"aria-label":v,"aria-valuemin":0,"aria-valuemax":r,"aria-valuenow":t,"aria-valuetext":u,role:"slider",tabindex:0})},m=function(){var r=new Date();if(r-f>=1000){h.play()}};o.slider.bind("focus",function(r){k.options.autoRewind=false});o.slider.bind("blur",function(r){k.options.autoRewind=c});o.slider.bind("keydown",function(s){if((new Date()-f)>=1000){n=h.paused}var t=s.keyCode,r=h.duration,w=h.currentTime,v=k.options.defaultSeekForwardInterval(h),u=k.options.defaultSeekBackwardInterval(h);switch(t){case 37:case 40:w-=u;break;case 39:case 38:w+=v;break;case 36:w=0;break;case 35:w=r;break;case 32:case 13:h.paused?h.play():h.pause();return;default:return}w=w<0?0:(w>=r?r:Math.floor(w));f=new Date();if(!n){h.pause()}if(w<h.duration&&!n){setTimeout(m,1100)}h.setCurrentTime(w);s.preventDefault();s.stopPropagation();return false});o.total.bind("mousedown touchstart",function(r){if(r.which===1||r.which===0){i=true;e(r);o.globalBind("mousemove.dur touchmove.dur",function(s){if(s.type=="touchmove"){i=false}e(s)});o.globalBind("mouseup.dur touchend.dur",function(s){if(s.type=="touchend"){i=true;e(s)}i=false;if(typeof o.timefloat!=="undefined"){o.timefloat.hide()}o.globalUnbind(".dur")})}}).bind("mouseenter",function(r){j=true;o.globalBind("mousemove.dur",function(s){e(s)});if(typeof o.timefloat!=="undefined"&&!a.MediaFeatures.hasTouch){o.timefloat.show()}}).bind("mouseleave",function(r){j=false;if(!i){o.globalUnbind(".dur");if(typeof o.timefloat!=="undefined"){o.timefloat.hide()}}});o.unvisibleSlider.bind("mousedown touchstart",function(r){if(r.which===1||r.which===0){i=true;e(r);o.globalBind("mousemove.dur touchmove.dur",function(s){if(s.type=="touchmove"){i=false}e(s)});o.globalBind("mouseup.dur touchend.dur",function(s){if(s.type=="touchend"){i=true;e(s)}i=false;if(typeof o.timefloat!=="undefined"){o.timefloat.hide()}o.globalUnbind(".dur")})}}).bind("mouseenter",function(r){j=true;o.globalBind("mousemove.dur",function(s){e(s)});if(typeof o.timefloat!=="undefined"&&!a.MediaFeatures.hasTouch){o.timefloat.show()}}).bind("mouseleave",function(r){j=false;if(!i){o.globalUnbind(".dur");if(typeof o.timefloat!=="undefined"){o.timefloat.hide()}}});h.cincopaAddEventListener("progress",function(r){k.setProgressRail(r);k.setCurrentRail(r)},false);h.cincopaAddEventListener("timeupdate",function(r){k.setProgressRail(r);k.setCurrentRail(r);q(r)},false);o.container.on("controlsresize",function(r){k.setProgressRail(r);k.setCurrentRail(r)})},setProgressRail:function(c){var f=this,g=(c!==undefined)?c.target:f.media,d=null;if(g&&g.buffered&&g.buffered.length>0&&g.buffered.end&&g.duration){d=g.buffered.end(g.buffered.length-1)/g.duration}else{if(g&&g.bytesTotal!==undefined&&g.bytesTotal>0&&g.bufferedBytes!==undefined){d=g.bufferedBytes/g.bytesTotal}else{if(c&&c.lengthComputable&&c.total!==0){d=c.loaded/c.total}}}if(d!==null){d=Math.min(1,Math.max(0,d));if(f.loaded&&f.total){f.loaded.width(f.total.width()*d)}}},setCurrentRail:function(){var e=this;if(e.media.currentTime!==undefined&&e.media.duration){if(e.total&&e.handle){var d=Math.round(e.total.width()*e.media.currentTime/e.media.duration),c=d-Math.round(e.handle.outerWidth(true)/2);e.current.width(d);e.handle.css("left",c)}}}})})(a.$);(function(b){b.extend(a.MepDefaults,{duration:-1,timeAndDurationSeparator:"<span> / </span>"});b.extend(CincopaMediaElementPlayer.prototype,{buildcurrent:function(f,c,d,e){var g=this;b('<div class="mejs-time" role="timer" aria-live="off"><span class="mejs-currenttime">'+a.Utility.secondsToTimeCode(0,f.options)+"</span></div>").appendTo(c);g.currenttime=g.controls.find(".mejs-currenttime");e.cincopaAddEventListener("timeupdate",function(){if(g.controlsAreVisible){f.updateCurrent()}},false)},buildduration:function(f,c,d,e){var g=this;if(c.children().last().find(".mejs-currenttime").length>0){b(g.options.timeAndDurationSeparator+'<span class="mejs-duration">'+a.Utility.secondsToTimeCode(g.options.duration,g.options)+"</span>").appendTo(c.find(".mejs-time"))}else{c.find(".mejs-currenttime").parent().addClass("mejs-currenttime-container");b('<div class="mejs-time mejs-duration-container"><span class="mejs-duration">'+a.Utility.secondsToTimeCode(g.options.duration,g.options)+"</span></div>").appendTo(c)}g.durationD=g.controls.find(".mejs-duration");e.cincopaAddEventListener("timeupdate",function(){if(g.controlsAreVisible){f.updateDuration()}},false)},updateCurrent:function(){var d=this;var c=d.media.currentTime;if(isNaN(c)){c=0}if(d.currenttime){d.currenttime.html(a.Utility.secondsToTimeCode(c,d.options))}},updateDuration:function(){var d=this;var c=d.media.duration;if(d.options.duration>0){c=d.options.duration}if(isNaN(c)){c=0}d.container.toggleClass("mejs-long-video",c>3600);if(d.durationD&&c>0){d.durationD.html(a.Utility.secondsToTimeCode(c,d.options))}}})})(a.$);(function(b){b.extend(a.MepDefaults,{muteText:a.i18n.t("mejs.mute-toggle"),allyVolumeControlText:a.i18n.t("mejs.volume-help-text"),hideVolumeOnTouchDevices:true,audioVolume:"horizontal",videoVolume:"vertical"});b.extend(CincopaMediaElementPlayer.prototype,{buildvolume:function(k,c,e,f){if((a.MediaFeatures.isAndroid||a.MediaFeatures.isiOS)&&this.options.hideVolumeOnTouchDevices){return}var m=this,g=(m.isVideo)?m.options.videoVolume:m.options.audioVolume,j=(g=="horizontal")?b('<div class="mejs-button mejs-volume-button mejs-mute"><button type="button" aria-controls="'+m.id+'" title="'+m.options.muteText+'" aria-label="'+m.options.muteText+'"></button></div><a href="javascript:void(0);" class="mejs-horizontal-volume-slider"><span class="mejs-offscreen">'+m.options.allyVolumeControlText+'</span><div class="mejs-horizontal-volume-total"></div><div class="mejs-horizontal-volume-current"></div><div class="mejs-horizontal-volume-handle"></div></a>').appendTo(c):b('<div class="mejs-button mejs-volume-button mejs-mute"><button type="button" aria-controls="'+m.id+'" title="'+m.options.muteText+'" aria-label="'+m.options.muteText+'"></button><a href="javascript:void(0);" class="mejs-volume-slider"><span class="mejs-offscreen">'+m.options.allyVolumeControlText+'</span><div class="mejs-volume-total"></div><div class="mejs-volume-current"></div><div class="mejs-volume-handle"></div></a></div>').appendTo(c),q=m.container.find(".mejs-volume-slider, .mejs-horizontal-volume-slider"),r=m.container.find(".mejs-volume-total, .mejs-horizontal-volume-total"),o=m.container.find(".mejs-volume-current, .mejs-horizontal-volume-current"),p=m.container.find(".mejs-volume-handle, .mejs-horizontal-volume-handle"),l=function(y,u){if(!q.is(":visible")&&typeof u=="undefined"){q.show();l(y,true);q.hide();c.removeClass("volume-button-hover");return}y=Math.max(0,y);y=Math.min(y,1);if(y===0){j.removeClass("mejs-mute").addClass("mejs-unmute");j.children("button").attr("title",a.i18n.t("mejs.unmute")).attr("aria-label",a.i18n.t("mejs.unmute"))}else{j.removeClass("mejs-unmute").addClass("mejs-mute");j.children("button").attr("title",a.i18n.t("mejs.mute")).attr("aria-label",a.i18n.t("mejs.mute"))}var w=r.position();if(g=="vertical"){var v=r.height(),t=v-(v*y);p.css("top",Math.round(w.top+t-(p.height()/2)));o.height(v-t);o.css("top",w.top+t)}else{var x=r.width(),s=x*y;p.css("left",Math.round(w.left+s-(p.width()/2)));o.width(Math.round(s))}},d=function(s){var y=null,x=r.offset();if(g==="vertical"){var v=r.height(),u=s.pageY-x.top;y=(v-u)/v;if(x.top===0||x.left===0){return}}else{var w=r.width(),t=s.pageX-x.left;y=t/w}y=Math.max(0,y);y=Math.min(y,1);l(y);if(y===0){f.setMuted(true)}else{f.setMuted(false)}f.setVolume(y)},h=false,i=false;j.hover(function(){q.show();i=true;c.addClass("volume-button-hover")},function(){i=false;if(!h&&g=="vertical"){q.hide();c.removeClass("volume-button-hover")}});var n=function(s){var t=Math.floor(f.volume*100);q.attr({"aria-label":a.i18n.t("mejs.volume-slider"),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":t,"aria-valuetext":t+"%",role:"slider",tabindex:0})};q.bind("mouseover",function(){i=true}).bind("mousedown",function(s){d(s);m.globalBind("mousemove.vol",function(t){d(t)});m.globalBind("mouseup.vol",function(){h=false;m.globalUnbind(".vol");if(!i&&g=="vertical"){q.hide();c.removeClass("volume-button-hover")}});h=true;return false}).bind("keydown",function(s){var t=s.keyCode;var u=f.volume;switch(t){case 38:u=Math.min(u+0.1,1);break;case 40:u=Math.max(0,u-0.1);break;default:return true}h=false;l(u);f.setVolume(u);return false});j.find("button").click(function(){f.setMuted(!f.muted)});j.find("button").bind("focus",function(){q.show()});f.cincopaAddEventListener("volumechange",function(s){if(!h){if(f.muted){l(0);j.removeClass("mejs-mute").addClass("mejs-unmute")}else{l(f.volume);j.removeClass("mejs-unmute").addClass("mejs-mute")}}n(s)},false);if(k.options.startVolume===0){f.setMuted(true)}if(f.pluginType==="native"){f.setVolume(k.options.startVolume)}m.container.on("controlsresize",function(){if(f.muted){l(0);j.removeClass("mejs-mute").addClass("mejs-unmute")}else{l(f.volume);j.removeClass("mejs-unmute").addClass("mejs-mute")}})}})})(a.$);(function(b){b.extend(a.MepDefaults,{usePluginFullScreen:true,newWindowCallback:function(){return""},fullscreenText:""});b.extend(CincopaMediaElementPlayer.prototype,{isFullScreen:false,isNativeFullScreen:false,isInIframe:false,fullscreenMode:"",buildfullscreen:function(j,c,h,i){if(!j.isVideo){return}j.isInIframe=(window.location!=window.parent.location);i.cincopaAddEventListener("loadstart",function(){j.detectFullscreenMode()});var k=this,g=null,f=k.options.fullscreenText?k.options.fullscreenText:a.i18n.t("mejs.fullscreen"),d=b('<div class="mejs-button mejs-fullscreen-button"><button type="button" aria-controls="'+k.id+'" title="'+f+'" aria-label="'+f+'"></button></div>').appendTo(c).on("click",function(){var l=(a.MediaFeatures.hasTrueNativeFullScreen&&a.MediaFeatures.isFullScreen())||j.isFullScreen;if(l){j.exitFullScreen()}else{j.enterFullScreen()}}).on("mouseover",function(){if(k.fullscreenMode=="plugin-hover"){if(g!==null){clearTimeout(g);delete g}var l=d.offset(),m=j.container.offset();i.positionFullscreenButton(l.left-m.left,l.top-m.top,true)}}).on("mouseout",function(){if(k.fullscreenMode=="plugin-hover"){if(g!==null){clearTimeout(g);delete g}g=setTimeout(function(){i.hideFullscreenButton()},1500)}});j.fullscreenBtn=d;k.globalBind("keydown",function(l){if(l.keyCode==27&&((a.MediaFeatures.hasTrueNativeFullScreen&&a.MediaFeatures.isFullScreen())||k.isFullScreen)){j.exitFullScreen()}});k.normalHeight=0;k.normalWidth=0;if(a.MediaFeatures.hasTrueNativeFullScreen){var e=function(l){if(j.isFullScreen){if(a.MediaFeatures.isFullScreen()){j.isNativeFullScreen=true;j.setControlsSize()}else{j.isNativeFullScreen=false;j.exitFullScreen()}}};j.globalBind(a.MediaFeatures.fullScreenEventName,e)}},detectFullscreenMode:function(){var e=this,d="",c=a.MediaFeatures;if(c.hasTrueNativeFullScreen&&e.media.pluginType==="native"){d="native-native"}else{if(c.hasTrueNativeFullScreen&&e.media.pluginType!=="native"&&!c.hasFirefoxPluginMovingProblem){d="plugin-native"}else{if(e.usePluginFullScreen){if(a.MediaFeatures.supportsPointerEvents){d="plugin-click";e.createPluginClickThrough()}else{d="plugin-hover"}}else{d="fullwindow"}}}e.fullscreenMode=d;return d},isPluginClickThroughCreated:false,createPluginClickThrough:function(){var k=this;if(k.isPluginClickThroughCreated){return}var c=false,j=function(){if(c){for(var l in e){e[l].hide()}k.fullscreenBtn.css("pointer-events","");k.controls.css("pointer-events","");k.media.removeEventListener("click",k.clickToPlayPauseCallback);c=false}},e={},d=["top","left","right","bottom"],f,g,h=function(){var n=fullscreenBtn.offset().left-k.container.offset().left,o=fullscreenBtn.offset().top-k.container.offset().top,p=fullscreenBtn.outerWidth(true),m=fullscreenBtn.outerHeight(true),l=k.container.width(),i=k.container.height();for(f in e){e[f].css({position:"absolute",top:0,left:0})}e.top.width(l).height(o);e.left.width(n).height(m).css({top:o});e.right.width(l-n-p).height(m).css({top:o,left:n+p});e.bottom.width(l).height(i-m-o).css({top:o+m})};k.globalBind("resize",function(){h()});for(f=0,g=d.length;f<g;f++){e[d[f]]=b('<div class="mejs-fullscreen-hover" />').appendTo(k.container).mouseover(j).hide()}fullscreenBtn.on("mouseover",function(){if(!k.isFullScreen){var i=fullscreenBtn.offset(),l=player.container.offset();media.positionFullscreenButton(i.left-l.left,i.top-l.top,false);k.fullscreenBtn.css("pointer-events","none");k.controls.css("pointer-events","none");k.media.cincopaAddEventListener("click",k.clickToPlayPauseCallback);for(f in e){e[f].show()}h();c=true}});media.cincopaAddEventListener("fullscreenchange",function(i){k.isFullScreen=!k.isFullScreen;if(k.isFullScreen){k.media.removeEventListener("click",k.clickToPlayPauseCallback)}else{k.media.cincopaAddEventListener("click",k.clickToPlayPauseCallback)}j()});k.globalBind("mousemove",function(i){if(c){var l=fullscreenBtn.offset();if(i.pageY<l.top||i.pageY>l.top+fullscreenBtn.outerHeight(true)||i.pageX<l.left||i.pageX>l.left+fullscreenBtn.outerWidth(true)){fullscreenBtn.css("pointer-events","");k.controls.css("pointer-events","");c=false}}});k.isPluginClickThroughCreated=true},cleanfullscreen:function(c){c.exitFullScreen()},containerSizeTimeout:null,enterFullScreen:function(){var e=this;var d=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform);if((a.MediaFeatures.isiOS&&a.MediaFeatures.hasiOSFullScreen&&typeof e.media.webkitEnterFullscreen==="function")||(e.container.attr("data-forcenativefullscreen")=="true"&&e.media&&d&&a.MediaFeatures.hasiOSFullScreen)){e.media.webkitEnterFullscreen();return}b(document.documentElement).addClass("mejs-fullscreen");e.normalHeight=e.container.height();e.normalWidth=e.container.width();if(e.fullscreenMode==="native-native"||e.fullscreenMode==="plugin-native"){a.MediaFeatures.requestFullScreen(e.container[0]);if(e.isInIframe){setTimeout(function c(){if(e.isNativeFullScreen){var i=0.002,k=b(window).width(),j=screen.width,g=Math.abs(j-k),h=j*i;if(g>h){setTimeout(c,500)}else{setTimeout(c,500)}}},1000)}}else{if(e.fullscreeMode=="fullwindow"){}}e.container.addClass("mejs-container-fullscreen").width("100%").height("100%");e.containerSizeTimeout=setTimeout(function(){e.container.css({width:"100%",height:"100%"});e.setControlsSize()},500);if(e.media.pluginType==="native"){e.$media.width("100%").height("100%")}else{e.container.find(".mejs-shim").width("100%").height("100%");setTimeout(function(){var g=b(window),i=g.width(),h=g.height();e.media.setVideoSize(i,h)},500)}e.layers.children("div").width("100%").height("100%");if(e.fullscreenBtn){e.fullscreenBtn.removeClass("mejs-fullscreen").addClass("mejs-unfullscreen");e.fullscreenBtn.find("button").attr("title","Unfullscreen")}e.setControlsSize();e.isFullScreen=true;var f=Math.min(screen.width/e.width,screen.height/e.height);e.container.find(".mejs-captions-text").css("line-height","normal");e.container.trigger("enteredfullscreen")},exitFullScreen:function(){var c=this;clearTimeout(c.containerSizeTimeout);if(a.MediaFeatures.hasTrueNativeFullScreen&&(a.MediaFeatures.isFullScreen()||c.isFullScreen)){a.MediaFeatures.cancelFullScreen()}b(document.documentElement).removeClass("mejs-fullscreen");c.container.removeClass("mejs-container-fullscreen").width(c.normalWidth).height(c.normalHeight);if(c.media.pluginType==="native"){c.$media.width(c.normalWidth).height(c.normalHeight)}else{c.container.find(".mejs-shim").width(c.normalWidth).height(c.normalHeight);c.media.setVideoSize(c.normalWidth,c.normalHeight)}c.layers.children("div").width(c.normalWidth).height(c.normalHeight);c.fullscreenBtn.removeClass("mejs-unfullscreen").addClass("mejs-fullscreen");c.fullscreenBtn&&c.fullscreenBtn.find("button").attr("title","Fullscreen");c.setControlsSize();c.isFullScreen=false;c.container.find(".mejs-captions-position").css("bottom","");c.container.trigger("exitedfullscreen")}})})(a.$);(function(b){b.extend(a.MepDefaults,{speeds:["2.00","1.50","1.25","1.00","0.75"],defaultSpeed:"1.00",speedChar:"x"});b.extend(CincopaMediaElementPlayer.prototype,{buildspeed:function(o,c,k,m){var v=this;if(v.media.pluginType=="native"){var q=null,u=null,n=null,j=null;var r=[];var d=false;for(var g=0,l=v.options.speeds.length;g<l;g++){var p=v.options.speeds[g];if(typeof(p)==="string"){r.push({name:p+v.options.speedChar,value:p});if(p===v.options.defaultSpeed){d=true}}else{r.push(p);if(p.value===v.options.defaultSpeed){d=true}}}if(!d){r.push({name:v.options.defaultSpeed+v.options.speedChar,value:v.options.defaultSpeed})}r.sort(function(i,s){return parseFloat(s.value)-parseFloat(i.value)});var e=function(w){for(var s=0,t=r.length;s<t;s++){if(r[s].value===w){return r[s].name}}};var f='<div class="mejs-button mejs-speed-button"><button type="button">'+e(v.options.defaultSpeed)+'</button><div class="mejs-speed-selector"><ul>';for(var g=0,h=r.length;g<h;g++){j=v.id+"-speed-"+r[g].value;f+='<li><input type="radio" name="speed" value="'+r[g].value+'" id="'+j+'" '+(r[g].value===v.options.defaultSpeed?" checked":"")+' /><label for="'+j+'" '+(r[g].value===v.options.defaultSpeed?' class="mejs-speed-selected"':"")+">"+r[g].name+"</label></li>"}f+="</ul></div></div>";q=b(f).appendTo(c);u=q.find(".mejs-speed-selector");n=v.options.defaultSpeed;m.cincopaAddEventListener("loadedmetadata",function(i){if(n){m.playbackRate=parseFloat(n)}},true);u.on("click",'input[type="radio"]',function(){var i=b(this).attr("value");n=i;m.playbackRate=parseFloat(i);q.find("button").html(e(i));q.find(".mejs-speed-selected").removeClass("mejs-speed-selected");q.find('input[type="radio"]:checked').next().addClass("mejs-speed-selected")});q.one("mouseenter focusin",function(){u.height(q.find(".mejs-speed-selector ul").outerHeight(true)+q.find(".mejs-speed-translations").outerHeight(true)).css("top",(-1*u.height())+"px")})}}})})(a.$);(function(b){b.extend(a.MepDefaults,{startLanguage:"",tracksText:"",tracksAriaLive:false,hideCaptionsButtonWhenEmpty:true,toggleCaptionsButtonWhenOnlyOne:false,slidesSelector:""});b.extend(CincopaMediaElementPlayer.prototype,{hasChapters:false,cleartracks:function(f,c,d,e){if(f){if(f.captions){f.captions.remove()}if(f.chapters){f.chapters.remove()}if(f.captionsText){f.captionsText.remove()}if(f.captionsButton){f.captionsButton.remove()}}},buildtracks:function(k,d,h,j){if(k.tracks.length===0){return}var m=this,c=m.options.tracksAriaLive?'role="log" aria-live="assertive" aria-atomic="false"':"",n=m.options.tracksText?m.options.tracksText:a.i18n.t("mejs.captions-subtitles"),e,g;if(m.domNode.textTracks){for(e=m.domNode.textTracks.length-1;e>=0;e--){m.domNode.textTracks[e].mode="hidden"}}m.cleartracks(k,d,h,j);k.chapters=b('<div class="mejs-chapters mejs-layer"></div>').prependTo(h).hide();k.captions=b('<div class="mejs-captions-layer mejs-layer"><div class="mejs-captions-position mejs-captions-position-hover" '+c+'><span class="mejs-captions-text"></span></div></div>').prependTo(h).hide();k.captionsText=k.captions.find(".mejs-captions-text");var f=b(".mejs-chapters-button--new",d).length;k.captionsButton=b('<div class="mejs-button mejs-captions-button mejs-button-notadjust'+(f?" mejs-force-hidden-button":"")+' "><button type="button" aria-controls="'+m.id+'" title="'+n+'" aria-label="'+n+'"></button><div class="mejs-captions-selector"><ul><li><input type="radio" name="'+k.id+'_captions" id="'+k.id+'_captions_none" value="none" checked="checked" /><label for="'+k.id+'_captions_none">'+a.i18n.t("mejs.none")+"</label></li></ul></div></div>").appendTo(d);var l=0;for(e=0;e<k.tracks.length;e++){g=k.tracks[e].kind;if(g==="subtitles"||g==="captions"){l++}}if(m.options.toggleCaptionsButtonWhenOnlyOne&&l==1){k.captionsButton.on("click",function(){if(k.selectedTrack===null){lang=k.tracks[0].srclang}else{lang="none"}k.setTrack(lang)})}else{k.captionsButton.on("mouseenter focusin",function(){b(this).find(".mejs-captions-selector").removeClass("mejs-offscreen")}).on("click","input[type=radio]",function(){lang=this.value;k.setTrack(lang)});k.captionsButton.on("click",".mejs-captions-list",function(){setTimeout(function(){k.captionsButton.find(".mejs-captions-selector").addClass("mejs-offscreen")},10)})}if(!k.options.alwaysShowControls){k.container.bind("controlsshown",function(){k.container.find(".mejs-captions-position").addClass("mejs-captions-position-hover")}).bind("controlshidden",function(){if(!j.paused){k.container.find(".mejs-captions-position").removeClass("mejs-captions-position-hover")}})}else{k.container.find(".mejs-captions-position").addClass("mejs-captions-position-hover")}k.trackToLoad=-1;k.selectedTrack=null;k.isLoadingTrack=false;for(e=0;e<k.tracks.length;e++){g=k.tracks[e].kind;if(g==="subtitles"||g==="captions"){k.addTrackButton(k.tracks[e].srclang,k.tracks[e].label)}}k.loadNextTrack();j.cincopaAddEventListener("timeupdate",function(){k.displayCaptions()},false);if(k.options.slidesSelector!==""){k.slidesContainer=b(k.options.slidesSelector);j.cincopaAddEventListener("timeupdate",function(){k.displaySlides()},false)}j.cincopaAddEventListener("loadedmetadata",function(){k.displayChapters()},false);k.container.hover(function(){if(k.hasChapters){k.chapters.removeClass("mejs-offscreen");k.chapters.fadeIn(200).height(k.chapters.find(".mejs-chapter").outerHeight())}},function(){if(k.hasChapters&&!j.paused){k.chapters.fadeOut(200,function(){b(this).addClass("mejs-offscreen");b(this).css("display","block")})}});m.container.on("controlsresize",function(){m.adjustLanguageBox()});if(k.node.getAttribute("autoplay")!==null){k.chapters.addClass("mejs-offscreen")}},setTrack:function(e){var f=this,d;if(e=="none"){f.selectedTrack=null;f.captionsButton.removeClass("mejs-captions-enabled")}else{for(d=0;d<f.tracks.length;d++){if(f.tracks[d].srclang==e){if(f.selectedTrack===null){f.captionsButton.addClass("mejs-captions-enabled")}f.selectedTrack=f.tracks[d];f.captions.attr("lang",f.selectedTrack.srclang);if(document.createEvent){var c=document.createEvent("HTMLEvents");c.initEvent("selectedTrack",true,true);f.media.dispatchEvent(c)}f.displayCaptions();break}}}},loadNextTrack:function(){var c=this;c.trackToLoad++;if(c.trackToLoad<c.tracks.length){c.isLoadingTrack=true;c.loadTrack(c.trackToLoad)}else{c.isLoadingTrack=false;c.checkForTracks()}},loadTrack:function(d){var f=this,g=f.tracks[d],c=function(){g.isLoaded=true;f.enableTrackButton(g.srclang,g.label);f.loadNextTrack()};if(g.src!==undefined||g.src!==""||g["data-src"]!==undefined||g["data-src"]!==""){var e=g.src||g["data-src"];b.ajax({url:e,dataType:"text",success:function(h){if(typeof h=="string"&&(/<tt\s+xml/ig).exec(h)){g.entries=a.TrackFormatParser.dfxp.parse(h)}else{g.entries=a.TrackFormatParser.webvtt.parse(h)}c();if(g.kind=="chapters"){f.media.cincopaAddEventListener("play",function(){if(f.media.duration>0){f.displayChapters(g)}},false)}if(g.kind=="slides"){f.setupSlides(g)}},error:function(){f.removeTrackButton(g.srclang);f.loadNextTrack()}})}},enableTrackButton:function(d,c){var e=this;if(c===""){c=a.language.codes[d]||d}e.captionsButton.find("input[value="+d+"]").prop("disabled",false).siblings("label").html(c);if(e.options.startLanguage==d){b("#"+e.id+"_captions_"+d).prop("checked",true).trigger("click")}e.adjustLanguageBox()},removeTrackButton:function(c){var d=this;d.captionsButton.find("input[value="+c+"]").closest("li").remove();d.adjustLanguageBox()},addTrackButton:function(d,c){var e=this;if(c===""){c=a.language.codes[d]||d}e.captionsButton.find("ul").append(b('<li><input type="radio" name="'+e.id+'_captions" id="'+e.id+"_captions_"+d+'" value="'+d+'" disabled="disabled" /><label for="'+e.id+"_captions_"+d+'">'+c+" (loading)</label></li>"));e.adjustLanguageBox();e.container.find(".mejs-captions-translations option[value="+d+"]").remove()},adjustLanguageBox:function(){var c=this;c.captionsButton.find(".mejs-captions-selector").height(c.captionsButton.find(".mejs-captions-selector ul").outerHeight(true)+c.captionsButton.find(".mejs-captions-translations").outerHeight(true))},checkForTracks:function(){var f=this,c=false;if(f.options.hideCaptionsButtonWhenEmpty){for(var d=0;d<f.tracks.length;d++){var e=f.tracks[d].kind;if((e==="subtitles"||e==="captions")&&f.tracks[d].isLoaded){c=true;break}}if(!c){f.captionsButton.hide();f.setControlsSize()}}},displayCaptions:function(){if(typeof this.tracks=="undefined"){return}var d=this,c,e=d.selectedTrack;if(e!==null&&e.isLoaded){for(c=0;c<e.entries.times.length;c++){if(d.media.currentTime>=e.entries.times[c].start&&d.media.currentTime<=e.entries.times[c].stop){d.captionsText.html(e.entries.text[c]+"<i class='mejs-captions-search-icon'></i>").attr("class","mejs-captions-text "+(e.entries.times[c].identifier||""));d.captions.show().height(0);return}}d.captions.hide()}else{d.captions.hide()}},setupSlides:function(d){var c=this;c.slides=d;c.slides.entries.imgs=[c.slides.entries.text.length];c.showSlide(0)},showSlide:function(d){if(typeof this.tracks=="undefined"||typeof this.slidesContainer=="undefined"){return}var e=this,f=e.slides.entries.text[d],c=e.slides.entries.imgs[d];if(typeof c=="undefined"||typeof c.fadeIn=="undefined"){e.slides.entries.imgs[d]=c=b('<img src="'+f+'">').on("load",function(){c.appendTo(e.slidesContainer).hide().fadeIn().siblings(":visible").fadeOut()})}else{if(!c.is(":visible")&&!c.is(":animated")){c.fadeIn().siblings(":visible").fadeOut()}}},displaySlides:function(){if(typeof this.slides=="undefined"){return}var e=this,d=e.slides,c;for(c=0;c<d.entries.times.length;c++){if(e.media.currentTime>=d.entries.times[c].start&&e.media.currentTime<=d.entries.times[c].stop){e.showSlide(c);return}}},displayChapters:function(){var d=this,c;for(c=0;c<d.tracks.length;c++){if(d.tracks[c].kind=="chapters"&&d.tracks[c].isLoaded){d.drawChapters(d.tracks[c]);d.hasChapters=true;break}}},drawChapters:function(c){var g=this,e,d,f=0,h=0;g.chapters.empty();for(e=0;e<c.entries.times.length;e++){d=c.entries.times[e].stop-c.entries.times[e].start;f=Math.floor(d/g.media.duration*100);if(f+h>100||e==c.entries.times.length-1&&f+h<100){f=100-h}g.chapters.append(b('<div class="mejs-chapter" rel="'+c.entries.times[e].start+'" style="left: '+h.toString()+"%;width: "+f.toString()+'%;"><div class="mejs-chapter-block'+((e==c.entries.times.length-1)?" mejs-chapter-block-last":"")+'"><span class="ch-title">'+c.entries.text[e]+'</span><span class="ch-time">'+a.Utility.secondsToTimeCode(c.entries.times[e].start,g.options)+"&ndash;"+a.Utility.secondsToTimeCode(c.entries.times[e].stop,g.options)+"</span></div></div>"));h+=f}g.chapters.find("div.mejs-chapter").click(function(){g.media.setCurrentTime(parseFloat(b(this).attr("rel")));if(g.media.paused){g.media.play()}});g.chapters.show()}});a.language={codes:{af:"Afrikaans",sq:"Albanian",ar:"Arabic",be:"Belarusian",bg:"Bulgarian",ca:"Catalan",zh:"Chinese","zh-cn":"Chinese Simplified","zh-tw":"Chinese Traditional",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch",en:"English",et:"Estonian",fl:"Filipino",fi:"Finnish",fr:"French",gl:"Galician",de:"German",el:"Greek",ht:"Haitian Creole",iw:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",ga:"Irish",it:"Italian",ja:"Japanese",ko:"Korean",lv:"Latvian",lt:"Lithuanian",mk:"Macedonian",ms:"Malay",mt:"Maltese",no:"Norwegian",fa:"Persian",pl:"Polish",pt:"Portuguese",ro:"Romanian",ru:"Russian",sr:"Serbian",sk:"Slovak",sl:"Slovenian",es:"Spanish",sw:"Swahili",sv:"Swedish",tl:"Tagalog",th:"Thai",tr:"Turkish",uk:"Ukrainian",vi:"Vietnamese",cy:"Welsh",yi:"Yiddish"}};a.TrackFormatParser={webvtt:{pattern_timecode:/^((?:[0-9]{1,2}:)?[0-9]{2}:[0-9]{2}([,.][0-9]{1,3})?) --\> ((?:[0-9]{1,2}:)?[0-9]{2}:[0-9]{2}([,.][0-9]{3})?)(.*)$/,parse:function(j){var d=0,f=a.TrackFormatParser.split2(j,/\r?\n/),c={text:[],times:[]},h,g,e;for(;d<f.length;d++){h=this.pattern_timecode.exec(f[d]);if(h&&d<f.length){if((d-1)>=0&&f[d-1]!==""){e=f[d-1]}d++;g=f[d];d++;while(f[d]!==""&&d<f.length){g=g+"\n"+f[d];d++}g=b.trim(g).replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,"<a href='$1' target='_blank'>$1</a>");c.text.push(g);c.times.push({identifier:e,start:(a.Utility.convertSMPTEtoSeconds(h[1])===0)?0.2:a.Utility.convertSMPTEtoSeconds(h[1]),stop:a.Utility.convertSMPTEtoSeconds(h[3]),settings:h[5]})}e=""}return c}},dfxp:{parse:function(o){o=b(o).filter("tt");var h=0,f=o.children("div").eq(0),j=f.find("p"),l=o.find("#"+f.attr("style")),m,n,g={text:[],times:[]};if(l.length){var e=l.removeAttr("id").get(0).attributes;if(e.length){m={};for(h=0;h<e.length;h++){m[e[h].name.split(":")[1]]=e[h].value}}}for(h=0;h<j.length;h++){var k;var d={start:null,stop:null,style:null};if(j.eq(h).attr("begin")){d.start=a.Utility.convertSMPTEtoSeconds(j.eq(h).attr("begin"))}if(!d.start&&j.eq(h-1).attr("end")){d.start=a.Utility.convertSMPTEtoSeconds(j.eq(h-1).attr("end"))}if(j.eq(h).attr("end")){d.stop=a.Utility.convertSMPTEtoSeconds(j.eq(h).attr("end"))}if(!d.stop&&j.eq(h+1).attr("begin")){d.stop=a.Utility.convertSMPTEtoSeconds(j.eq(h+1).attr("begin"))}if(m){k="";for(var c in m){k+=c+":"+m[c]+";"}}if(k){d.style=k}if(d.start===0){d.start=0.2}g.times.push(d);n=b.trim(j.eq(h).html()).replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,"<a href='$1' target='_blank'>$1</a>");g.text.push(n)}return g}},split2:function(d,c){return d.split(c)}};if("x\n\ny".split(/\n/gi).length!=3){a.TrackFormatParser.split2=function(g,f){var e=[],c="",d;for(d=0;d<g.length;d++){c+=g.substring(d,d+1);if(f.test(c)){e.push(c.replace(f,""));c=""}}e.push(c);return e}}})(a.$);(function(b){b.extend(a.MepDefaults,{sourcechooserText:""});b.extend(CincopaMediaElementPlayer.prototype,{buildsourcechooser:function(h,c,f,g){var l=this,j=l.options.sourcechooserText?l.options.sourcechooserText:a.i18n.t("mejs.source-chooser"),d;h.sourcechooserButton=b('<div class="mejs-button mejs-sourcechooser-button"><button type="button" role="button" aria-haspopup="true" aria-owns="'+l.id+'" title="'+j+'" aria-label="'+j+'"></button><div class="mejs-sourcechooser-selector mejs-offscreen" role="menu" aria-expanded="false" aria-hidden="true"><ul></ul></div></div>').appendTo(c).hover(function(){clearTimeout(d);h.showSourcechooserSelector()},function(){var i=b(this);d=setTimeout(function(){h.hideSourcechooserSelector()},500)}).on("keydown",function(i){var m=i.keyCode;switch(m){case 32:if(!a.MediaFeatures.isFirefox){h.showSourcechooserSelector()}b(this).find(".mejs-sourcechooser-selector").find("input[type=radio]:checked").first().focus();break;case 13:h.showSourcechooserSelector();b(this).find(".mejs-sourcechooser-selector").find("input[type=radio]:checked").first().focus();break;case 27:h.hideSourcechooserSelector();b(this).find("button").focus();break;default:return true}}).on("focusout",a.Utility.debounce(function(i){setTimeout(function(){var m=b(document.activeElement).closest(".mejs-sourcechooser-selector");if(!m.length){h.hideSourcechooserSelector()}},0)},100)).delegate("input[type=radio]","click",function(){b(this).attr("aria-selected",true).attr("checked","checked");b(this).closest(".mejs-sourcechooser-selector").find("input[type=radio]").not(this).attr("aria-selected","false").removeAttr("checked");var o=this.value;if(g.currentSrc!=o){var m=g.currentTime;var n=g.paused;g.pause();g.setSrc(o);g.cincopaAddEventListener("loadedmetadata",function(p){g.currentTime=m},true);var i=function(p){if(!n){g.play()}g.removeEventListener("canplay",i,true)};g.cincopaAddEventListener("canplay",i,true);g.load()}}).delegate("button","click",function(i){if(b(this).siblings(".mejs-sourcechooser-selector").hasClass("mejs-offscreen")){h.showSourcechooserSelector();b(this).siblings(".mejs-sourcechooser-selector").find("input[type=radio]:checked").first().focus()}else{h.hideSourcechooserSelector()}});for(var e in this.node.children){var k=this.node.children[e];if(k.nodeName==="SOURCE"&&(g.canPlayType(k.type)=="probably"||g.canPlayType(k.type)=="maybe")){h.addSourceButton(k.src,k.title,k.type,g.src==k.src)}}},addSourceButton:function(e,d,g,c){var f=this;if(d===""||d==undefined){d=e}g=g.split("/")[1];f.sourcechooserButton.find("ul").append(b('<li><input type="radio" name="'+f.id+'_sourcechooser" id="'+f.id+"_sourcechooser_"+d+g+'" role="menuitemradio" value="'+e+'" '+(c?'checked="checked"':"")+'aria-selected="'+c+'" /><label for="'+f.id+"_sourcechooser_"+d+g+'" aria-hidden="true">'+d+" ("+g+")</label></li>"));f.adjustSourcechooserBox()},adjustSourcechooserBox:function(){var c=this;c.sourcechooserButton.find(".mejs-sourcechooser-selector").height(c.sourcechooserButton.find(".mejs-sourcechooser-selector ul").outerHeight(true))},hideSourcechooserSelector:function(){this.sourcechooserButton.find(".mejs-sourcechooser-selector").addClass("mejs-offscreen").attr("aria-expanded","false").attr("aria-hidden","true").find("input[type=radio]").attr("tabindex","-1")},showSourcechooserSelector:function(){this.sourcechooserButton.find(".mejs-sourcechooser-selector").removeClass("mejs-offscreen").attr("aria-expanded","true").attr("aria-hidden","false").find("input[type=radio]").attr("tabindex","0")}})})(a.$);(function(b){b.extend(a.MepDefaults,{contextMenuItems:[{render:function(c){if(typeof c.enterFullScreen=="undefined"){return null}if(c.isFullScreen){return a.i18n.t("mejs.fullscreen-off")}else{return a.i18n.t("mejs.fullscreen-on")}},click:function(c){if(c.isFullScreen){c.exitFullScreen()}else{c.enterFullScreen()}}},{render:function(c){if(c.media.muted){return a.i18n.t("mejs.unmute")}else{return a.i18n.t("mejs.mute")}},click:function(c){if(c.media.muted){c.setMuted(false)}else{c.setMuted(true)}}},{isSeparator:true},{render:function(c){return a.i18n.t("mejs.download-video")},click:function(c){window.location.href=c.media.currentSrc}}]});b.extend(CincopaMediaElementPlayer.prototype,{buildcontextmenu:function(f,c,d,e){f.contextMenu=b('<div class="mejs-contextmenu"></div>').appendTo(b("body")).hide();f.container.bind("contextmenu",function(g){if(f.isContextMenuEnabled){g.preventDefault();f.renderContextMenu(g.clientX-1,g.clientY-1);return false}});f.container.bind("click",function(){f.contextMenu.hide()});f.contextMenu.bind("mouseleave",function(){f.startContextMenuTimer()})},cleancontextmenu:function(c){c.contextMenu.remove()},isContextMenuEnabled:true,enableContextMenu:function(){this.isContextMenuEnabled=true},disableContextMenu:function(){this.isContextMenuEnabled=false},contextMenuTimeout:null,startContextMenuTimer:function(){var c=this;c.killContextMenuTimer();c.contextMenuTimer=setTimeout(function(){c.hideContextMenu();c.killContextMenuTimer()},750)},killContextMenuTimer:function(){var c=this.contextMenuTimer;if(c!=null){clearTimeout(c);delete c;c=null}},hideContextMenu:function(){this.contextMenu.hide()},renderContextMenu:function(j,k){var h=this,c="",f=h.options.contextMenuItems;for(var d=0,e=f.length;d<e;d++){if(f[d].isSeparator){c+='<div class="mejs-contextmenu-separator"></div>'}else{var g=f[d].render(h);if(g!=null){c+='<div class="mejs-contextmenu-item" data-itemindex="'+d+'" id="element-'+(Math.random()*1000000)+'">'+g+"</div>"}}}h.contextMenu.empty().append(b(c)).css({top:k,left:j}).show();h.contextMenu.find(".mejs-contextmenu-item").each(function(){var i=b(this),m=parseInt(i.data("itemindex"),10),l=h.options.contextMenuItems[m];if(typeof l.show!="undefined"){l.show(i,h)}i.click(function(){if(typeof l.click!="undefined"){l.click(h)}h.contextMenu.hide()})});setTimeout(function(){h.killControlsTimer("rev3")},100)}})})(a.$);(function(b){b.extend(a.MepDefaults,{skipBackInterval:30,skipBackText:""});b.extend(CincopaMediaElementPlayer.prototype,{buildskipback:function(h,c,e,g){var j=this,d=a.i18n.t("mejs.time-skip-back",j.options.skipBackInterval),i=j.options.skipBackText?j.options.skipBackText:d,f=b('<div class="mejs-button mejs-skip-back-button"><button type="button" aria-controls="'+j.id+'" title="'+i+'" aria-label="'+i+'">'+j.options.skipBackInterval+"</button></div>").appendTo(c).click(function(){g.setCurrentTime(Math.max(g.currentTime-j.options.skipBackInterval,0));b(this).find("button").blur()})}})})(a.$);(function(b){b.extend(a.MepDefaults,{postrollCloseText:""});b.extend(CincopaMediaElementPlayer.prototype,{buildpostroll:function(f,c,d,e){var i=this,h=i.options.postrollCloseText?i.options.postrollCloseText:a.i18n.t("mejs.close"),g=i.container.find('link[rel="postroll"]').attr("href");if(typeof g!=="undefined"){f.postroll=b('<div class="mejs-postroll-layer mejs-layer"><a class="mejs-postroll-close" onclick="$(this).parent().hide();return false;">'+h+'</a><div class="mejs-postroll-layer-content"></div></div>').prependTo(d).hide();i.media.cincopaAddEventListener("ended",function(j){b.ajax({dataType:"html",url:g,success:function(k,l){d.find(".mejs-postroll-layer-content").html(k)}});f.postroll.show()},false)}}})})(a.$);(function(b){b.extend(a.MepDefaults,{markerColor:"#E9BC3D",markers:[],markerCallback:function(){}});b.extend(CincopaMediaElementPlayer.prototype,{buildmarkers:function(l,c,j,k){var m=this,f=0,e=-1,d=-1,h=-1,g=-1;for(f=0;f<l.options.markers.length;++f){c.find(".mejs-time-total").append('<span class="mejs-time-marker"></span>')}k.cincopaAddEventListener("durationchange",function(i){l.setmarkers(c)});k.cincopaAddEventListener("timeupdate",function(i){e=Math.floor(k.currentTime);if(h>e){if(g>e){g=-1}}else{h=e}for(f=0;f<l.options.markers.length;++f){d=Math.floor(l.options.markers[f]);if(e===d&&d!==g){l.options.markerCallback(k,k.currentTime);g=d}}},false)},setmarkers:function(c){var f=this,d=0,e;for(d=0;d<f.options.markers.length;++d){if(Math.floor(f.options.markers[d])<=f.media.duration&&Math.floor(f.options.markers[d])>=0){e=100*Math.floor(f.options.markers[d])/f.media.duration;b(c.find(".mejs-time-marker")[d]).css({width:"1px",left:e+"%",background:f.options.markerColor})}}}})})(a.$)})(cincopa_mejs);
// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/js/mep-feature-playlist.js  D:\WebSites\tmpCincopaAppsV2\_cms/fpskins/mediaelement/1/js/mep-feature-playlist.js   7/19/2022 5:20:22 AM 
_cp_preloaded_files["/fpskins/mediaelement/1/js/mep-feature-playlist.js"] = true;
(function(a){a.extend(cincopa_mejs.MepDefaults,{loopText:"Repeat On/Off",shuffleText:"Shuffle On/Off",nextText:"Next Track",prevText:"Previous Track",playlistText:"Show/Hide Playlist"});a.extend(CincopaMediaElementPlayer.prototype,{buildloopbutton:function(f,b,c,e){var g=this;var d=a('<div class="mejs-button mejs-loop-button '+((f.options.loop)?"mejs-loop-on":"mejs-loop-off")+'"><button type="button" aria-controls="'+f.id+'" title="'+f.options.loopText+'"></button></div>').appendTo(b).click(function(h){f.options.loop=!f.options.loop;a(e).trigger("mep-looptoggle",[f.options.loop]);if(f.options.loop){d.removeClass("mejs-loop-off").addClass("mejs-loop-on")}else{d.removeClass("mejs-loop-on").addClass("mejs-loop-off")}});g.loopToggle=g.controls.find(".mejs-loop-button")},loopToggleClick:function(){var b=this;b.loopToggle.trigger("click")},buildshuffle:function(e,b,c,d){var g=this;var f=a('<div class="mejs-button mejs-shuffle-button '+((e.options.shuffle)?"mejs-shuffle-on":"mejs-shuffle-off")+'"><button type="button" aria-controls="'+e.id+'" title="'+e.options.shuffleText+'"></button></div>').appendTo(b).click(function(h){e.options.shuffle=!e.options.shuffle;a(d).trigger("mep-shuffletoggle",[e.options.shuffle]);if(e.options.shuffle){f.removeClass("mejs-shuffle-off").addClass("mejs-shuffle-on")}else{f.removeClass("mejs-shuffle-on").addClass("mejs-shuffle-off")}});g.shuffleToggle=g.controls.find(".mejs-shuffle-button")},shuffleToggleClick:function(){var b=this;b.shuffleToggle.trigger("click")},buildprevtrack:function(e,b,c,d){var g=this;var f=a('<div class="mejs-button mejs-prevtrack-button mejs-prevtrack"><button type="button" aria-controls="'+e.id+'" title="'+e.options.prevText+'"></button></div>').appendTo(b).click(function(h){a(d).trigger("mep-playprevtrack");e.playPrevTrack(e)});g.prevTrack=g.controls.find(".mejs-prevtrack-button")},prevTrackClick:function(){var b=this;b.prevTrack.trigger("click")},buildnexttrack:function(f,b,c,d){var g=this;var e=a('<div class="mejs-button mejs-nexttrack-button mejs-nexttrack"><button type="button" aria-controls="'+f.id+'" title="'+f.options.nextText+'"></button></div>').appendTo(b).click(function(h){a(d).trigger("mep-playnexttrack");f.playNextTrack(f)});g.nextTrack=g.controls.find(".mejs-nexttrack-button")},nextTrackClick:function(){var b=this;b.nextTrack.trigger("click")},buildplaylist:function(e,b,c,d){var g=this;var f=a('<div class="mejs-button mejs-playlist-button '+((e.options.playlist)?"mejs-hide-playlist":"mejs-show-playlist")+'"><button type="button" aria-controls="'+e.id+'" title="'+e.options.playlistText+'"></button></div>').appendTo(b).click(function(h){e.options.playlist=!e.options.playlist;a(d).trigger("mep-playlisttoggle",[e.options.playlist]);if(e.options.playlist){c.children(".mejs-playlist").show();f.removeClass("mejs-show-playlist").addClass("mejs-hide-playlist")}else{c.children(".mejs-playlist").hide();f.removeClass("mejs-hide-playlist").addClass("mejs-show-playlist")}});g.playlistToggle=g.controls.find(".mejs-playlist-button")},playlistToggleClick:function(){var b=this;b.playlistToggle.trigger("click")},buildplaylistfeature:function(g,c,e,f){var h=a('<div class="mejs-playlist mejs-layer"><ul class="mejs"></ul></div>').appendTo(e);e.attr("data-galID",g.options.galleryId);if(!g.options.playlist){h.hide()}if(g.options.playlistposition=="bottom"){h.css("top",g.options.audioHeight+"px")}else{h.css("bottom",g.options.audioHeight+"px")}var d=function(l){var m=l.split("/");if(m.length>0){return decodeURIComponent(m[m.length-1])}else{return""}};var k=[];a("#"+g.id.toString()).find(".mejs-mediaelement source").each(function(m,l){if(a.trim(a(this).attr("src"))!=""){var n={};n.source=a.trim(a(this).attr("src"));if(a.trim(a(this).attr("data-tag"))!=""){n.tags=a.trim(a(this).attr("data-tag"))}if(a.trim(a(this).attr("title"))!=""){n.name=a.trim(a(this).attr("title"))}else{n.name=d(n.source)}if(a.trim(a(this).attr("data-cat"))!=""){n.category=a.trim(a(this).attr("data-cat"))}else{n.category=""}n.index=parseInt(a(this).attr("data-index"));n.rid=a(this).attr("data-rid");n.thumbnail=a(this).attr("data-thumbnail");k.push(n)}});for(var j=0;j<k.length;j++){e.find(".mejs-playlist > ul").append('<li data-cat="'+k[j].category+'"  data-url="'+k[j].source+'" title="'+k[j].name+'" data-rid="'+k[j].rid+'"  data-index="'+k[j].index+'" data-thumbnail="'+k[j].thumbnail+'">'+k[j].name+"</li>");if(k[j].category){var b=e.find(".mejs-playlist > ul li.current").attr("data-cat")||e.find(".mejs-playlist > ul li:first").attr("data-cat");e.find('li[data-url="'+g.media.src+'"][data-cat="'+b+'"]').addClass("current played")}else{e.find('li[data-url="'+g.media.src+'"]').addClass("current played")}}e.find(".mejs-playlist > ul li").click(function(l){if(!a(this).hasClass("current")){a(this).addClass("played");g.playTrack(a(this),"",g)}else{g.play()}});var i=false;this.container.on("mejsprerollcreativeveiw",function(){i=true});this.container.on("mejsprerollended",function(){i=false});if(!g.options.skinObject.go.skin.isLive){f.cincopaAddEventListener("ended",function(m){if(i){return}if(g.options.skinObject.hls){g.options.skinObject.hls.destroy();g.options.skinObject.hls=undefined}var n=a("#"+e.attr("data-galID")+" .mediaElement_playlist .cp_pl_item:first.current").length;var o=a("#"+e.attr("data-galID")+" .mediaElement_playlist .cp_pl_item:last.current").length;var l=a(g.media).data("currentplayingvideourl")||g.media.src;g.options.skinObject.videoEnded=true;var p=g.options.skinObject.sendDataCollector(l);var q=g.options.skinObject.sendDataCollector(l);q.second=~~m.target.duration;if(!g.options.skinObject.advertising){g.options.skinObject.go.onSkinEvent("video.ended",p);g.options.skinObject.go.onSkinEvent("video.pause",q)}g.options.skinObject.playing=false;g.options.skinObject.loaded=false;g.options.skinObject.canSendPlay=true;if(!g.options.playlistAtEnd&&!g.options.skinObject.go.ctaShowed&&!a("#"+g.options.galleryId).hasClass("cp_form_opened")){if(g.options.skinObject.go.args.postrollVideoUrl){a(".mejs-overlay-play",g.options.skinObject.$gallery).addClass("cp-hide");a(f).css("visibility","hidden")}if(g.options.skinObject.go.args.prerollVideoUrl||g.options.skinObject.go.args.postrollVideoUrl){if(o){g.options.skinObject.go.preRollAction="return";a(g.container).find(".mejs-poster").show();a(f).css("visibility","visible");g.playPrevTrack(g,true)}else{g.options.skinObject.go.preRollAction="next";if(g.options.skinObject.go.args.autoPlayNextTrack){g.playNextTrack(g)}}}else{if(g.options.skinObject.go.args.autoPlayNextTrack){g.playNextTrack(g)}}}},false)}},playNextTrack:function(g,d){var j=this;var k=j.layers.find(".mejs-playlist > ul > li");if(j.media.pluginType!="native"&&k.length==0&&a("#"+j.layers.attr("data-galID")+"_playlist .playlistContainer > a").length>0){k=a("#"+j.layers.attr("data-galID")+"_playlist .playlistContainer > a")}var b=k.filter(".current");var e=k.not(".played");if(e.length<1){b.removeClass("played").siblings().removeClass("played");e=k.not(".current")}if(j.options.shuffle){var h=Math.floor(Math.random()*e.length);var f=e.eq(h)}else{var f=b.next().first();if(f.length<1&&j.options.loop){if(k.length==1){f=b}else{f=b.siblings().first()}}}if(f.length==1){f.addClass("played");if(g.options.skinObject.go.args.prerollVideoUrl||g.options.skinObject.go.args.postrollVideoUrl){g.options.skinObject.prepostRollBeforePlay("next")}j.playTrack(f,"next",g);var c=f.attr("data-url");var i=g.options.skinObject.sendDataCollector(c);if(g.options.skinObject.go.args.prerollVideoUrl||g.options.skinObject.go.args.postrollVideoUrl){g.options.skinObject.prepostRollCallback("next")}g.options.skinObject.go.onSkinEvent("playlist.next",i)}else{if(k.length==1&&!d){a(j.container).find(".mejs-poster").show()}var c=b.attr("data-url");var i=g.options.skinObject.sendDataCollector(c);g.options.skinObject.playHLS(g.media,i,false)}},playPrevTrack:function(f,d){var j=this;var k=j.layers.find(".mejs-playlist > ul > li");if(j.media.pluginType!="native"&&k.length==0&&a("#"+j.layers.attr("data-galID")+"_playlist .playlistContainer > a").length>0){k=a("#"+j.layers.attr("data-galID")+"_playlist .playlistContainer > a")}var b=k.filter(".current");var e=k.filter(".played").not(".current");if(e.length<1){b.removeClass("played");e=k.not(".current")}if(j.options.shuffle){var h=Math.floor(Math.random()*e.length);var g=e.eq(h)}else{var g=b.prev();if(g.length<1&&j.options.loop){if(k.length==1){g=b}else{g=b.siblings().last()}}}if(g.length==1){b.removeClass("played");if(f.options.skinObject.go.args.prerollVideoUrl||f.options.skinObject.go.args.postrollVideoUrl){f.options.skinObject.prepostRollBeforePlay("prev")}j.playTrack(g,"prev",f,d);var c=g.attr("data-url");var i=f.options.skinObject.sendDataCollector(c);if(f.options.skinObject.go.args.prerollVideoUrl||f.options.skinObject.go.args.postrollVideoUrl){f.options.skinObject.prepostRollCallback("prev")}f.options.skinObject.go.onSkinEvent("playlist.prev",i)}},playTrack:function(g,c,e,d,b){var f=this;if(typeof g.attr("data-cat")!="undefined"){e.options.skinObject.onClick(g,g.attr("data-url"),g.attr("data-cat"),c,d,b)}else{e.options.skinObject.onClick(g,g.attr("data-url"),undefined,undefined,d,b)}g.addClass("current").siblings().removeClass("current")}})})(cincopa_mejs.$);
// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/js/zequery-mediaelement-universal.js  D:\WebSites\tmpCincopaAppsV2\_cms/fpskins/mediaelement/1/js/zequery-mediaelement-universal.js   12/27/2022 3:14:15 AM 
_cp_preloaded_files["/fpskins/mediaelement/1/js/zequery-mediaelement-universal.js"] = true;
/*version 1.0.57*/


(function ($) {
    CincopaMediaElementPlayer.prototype.buildlinertvhelper = function (player, controls, layers, media) {
        player.container[0].addEventListener('keydown', function(e) {
            e.preventDefault();
            e.stopPropagation();
            return;
        })
    };
})(zeQuery);



/*!
 * mejs-feature-logo.js
 * Add any logo to your players for MediaElement.js.
 * http://www.hark.com/
 *
 * Copyright 2012, Hark.com (http://www.hark.com/)
 * Licensed under the MIT license.
 */
(function ($) { 
    CincopaMediaElementPlayer.prototype.buildlogo = function (player, controls, layers, media) {
        var targetOption = player.options.logo.new_page == true ? '_blank' : '_self';

        var positionsArray = ['watermark_center','top_left', 'top_right','bottom_left', 'bottom_right'];
        var content = '<img src="' + player.options.logo.img + '" style="width:100%;height:auto;max-height:100%;max-width:100%;display:block;" />';
        if(player.options.logo.watermark_text){
            content = '<p class="mejs-watermark-text" style="color:' + player.options.logo.watermark_text_color + '; font-size:' + player.options.logo.watermark_text_size + '; opacity:' + player.options.logo.watermark_text_opacity + '; font-family: ' + player.options.logo.watermark_text_font + ' ">'+player.options.logo.watermark_text+'</p>'
        }
        var logoContainer = $('<div class="mejs-button mejs-logo-button ' + player.options.logo.position + '  ' + (player.options.logo.link != '' ? 'has-link' : '') + '" >' +
                content +
                //'<span>' + player.options.logo.text + '</span>' +
                '</div>')
                // append it to the toolbar
                .appendTo(layers)
                // add a click toggle event
                .click(function () {
                    if (player.options.logo.link != ''){
                        if(!player.options.logo.iframe) {
                            window.open(player.options.logo.link, targetOption);
                        } else {
                            parent.open(player.options.logo.link, targetOption);
                        }
                    }
                        
                });
        if(!player.options.logo.link){
            $('.mejs-button.mejs-logo-button', layers).css('cursor','default');
        }

        
        if(player.options.logo.position == 'random'){
            var positionInterval;
            positionInterval = setInterval(function(){
                var randomPosition =  Math.floor(Math.random() * positionsArray.length);
                changePosition(randomPosition);
            },player.options.logo.watermark_text_position_interval);

        }
        function changePosition(positionIndex){
            logoContainer.removeClass( positionsArray.join(' ') );
            logoContainer.addClass( positionsArray[positionIndex] );
        }

    };
})(zeQuery);

/*!
 * player_logo plaugin
 * Copyright 2014
 * Licensed under the MIT license.
 */
(function ($) {
    CincopaMediaElementPlayer.prototype.buildplayer_logo = function (player, controls, layers, media) {
        var targetOption = player.options.player_logo.new_page == true || player.options.player_logo.new_page == 'true' ? '_blank' : '_self';
        var player_loop = $('<div class="mejs-player-button mejs-player-logo-button  ' + (player.options.player_logo.link != '' ? 'has-link' : '') + '" >' +
                '<img src="' + player.options.player_logo.img + '" style="width:auto;height:auto;max-height:100%;max-width:100%;display:block;" />' +
                '</div>')
                .appendTo(controls)
                .click(function () {
                    if(!player.options.player_logo.iframe){
                        window.open(player.options.player_logo.link, targetOption);
                    } else {
                        parent.open(player.options.player_logo.link, targetOption);
                    }
                });
    };
})(zeQuery);

/*!
 * speed plugin
 * Copyright 2015
 */

(function($) {

	// Speed
	$.extend(cincopa_mejs.MepDefaults, {

		// We also support to pass object like this:
		// [{name: 'Slow', value: '0.75'}, {name: 'Normal', value: '1.00'}, ...]
		speeds: ['2.00', '1.50', '1.25', '1.00', '0.75', '0.5'],

		defaultSpeed: '1.00',

		speedChar: 'x'

	});

	$.extend(CincopaMediaElementPlayer.prototype, {

		buildspeed: function(player, controls, layers, media) {
			var t = this;
			if (t.media.pluginType == 'native') {
				var
					speedButton = null,
					speedSelector = null,
					playbackSpeed = null,
					inputId = null;

				var speeds = [];
				var defaultInArray = false;
				for (var i=0, len=t.options.speeds.length; i < len; i++) {
					var s = t.options.speeds[i];
					if (typeof(s) === 'string'){
						speeds.push({
							name: s + t.options.speedChar,
							value: s
						});
						if(s === t.options.defaultSpeed) {
							defaultInArray = true;
						}
					}
					else {
						speeds.push(s);
						if(s.value === t.options.defaultSpeed) {
							defaultInArray = true;
						}
					}
				}

				if (!defaultInArray) {
					speeds.push({
						name: t.options.defaultSpeed + t.options.speedChar,
						value: t.options.defaultSpeed
					});
				}

				speeds.sort(function(a, b) {
					return parseFloat(b.value) - parseFloat(a.value);
				});

				var getSpeedNameFromValue = function(value) {
					for(var i=0,len=speeds.length; i <len; i++) {
						if (speeds[i].value === value) {
							return speeds[i].name;
						}
					}
				};

				var html = '<div class="mejs-button mejs-speed-button">' +
							'<button type="button">speed</button>' +
							'<div class="mejs-speed-selector">' +
							'<ul>';

				for (var i = 0, il = speeds.length; i<il; i++) {
					inputId = t.id + '-speed-' + speeds[i].value;
					html += '<li '+ (speeds[i].value === t.options.defaultSpeed ? ' class="mejs-speed-selected"' : '') +'>' +
								'<input type="radio" name="speed" ' +
											'value="' + speeds[i].value + '" ' +
											'id="' + inputId + '" ' +
											(speeds[i].value === t.options.defaultSpeed ? ' checked' : '') +
											' />' +
								'<label for="' + inputId + '" >' + speeds[i].name + '</label>' +
							'</li>';
				}
				html += '</ul></div></div>';

				speedButton = $(html).appendTo(controls);
				speedSelector = speedButton.find('.mejs-speed-selector');

				playbackSpeed = t.options.defaultSpeed;

				media.cincopaAddEventListener('loadedmetadata', function(e) {
					if (playbackSpeed) {
						media.playbackRate = parseFloat(playbackSpeed);
					}
				}, true);

				speedSelector
					.on('click', 'input[type="radio"]', function() {
						var newSpeed = $(this).attr('value');
						playbackSpeed = newSpeed;
						media.playbackRate = parseFloat(newSpeed);
						//speedButton.find('button').html(getSpeedNameFromValue(newSpeed));
						speedButton.find('.mejs-speed-selected').removeClass('mejs-speed-selected');
						speedButton.find('input[type="radio"]:checked').parent().addClass('mejs-speed-selected');
					});
				speedButton
					.one( 'mouseenter focusin', function() {
						speedSelector
							.height(
								speedButton.find('.mejs-speed-selector ul').outerHeight(true) +
								speedButton.find('.mejs-speed-translations').outerHeight(true))
							.css('top', (-1 * speedSelector.height()) + 'px');
					});
			}
		}
	});

})(cincopa_mejs.$);



/*!
 * chromecast plugin
 * Copyright 2015
 */
(function ($) {
    CincopaMediaElementPlayer.prototype.buildchromecast_logo = function (player, controls, layers, media) {
        var session, chromeCast,idle = null ,interval;
        // window['__onGCastApiAvailable'] = function(isAvailable) {
        //     if (isAvailable) {
        //         create();
        //     }
        // };
        // var interval = setInterval(create(),5000);

        window['__onGCastApiAvailable'] = function(isAvailable) {
          clearTimeout(callInterval);
          if (isAvailable) {
            create();
          } 
        };
        var objID = player.options.skinObject.go.loaderParams["_object"];

        var callInterval = setTimeout(function() {
          create();
        },4000);

        function create(){
            if (typeof chrome !== "undefined") {
                if (typeof chrome.cast !== "undefined") {
                  if(zeQuery('.mejs-player-chrome-cast-button',controls).length != 0) {
                    return
                  };
                    var chromecast_loop = $('<div class="mejs-button mejs-player-chrome-cast-button" >' +
                    '<button type="button" aria-controls="' + player.id + '" title="Play on Tv"></button>' +
                    '</div>')
                    .appendTo(controls);
                    
                    var chromecast_logo = $('<div class="chromecast-logo">' +
                    '<div class="chromecast-logo-icon"></div>' +
                    '<div class="chromecast-logo-text">playing on</div>' +
                                '<div class="chromecast-logo-title"></div>' +
                                '</div>').appendTo(layers);

                        zeQuery(chromecast_loop).on('mouseenter', function() {
                            zeQuery(".chromecast-hover").addClass("visible");
                        });
                        
                        zeQuery(chromecast_loop).on('mouseleave',  function() {
                            zeQuery(".chromecast-hover").addClass("visible");
                        });
                
                        zeQuery(controls).find('.mejs-playpause-button button').on('click', function () {        
                            if (zeQuery(this).parent().hasClass("mejs-pause")) {
                                if (session && session.media[session.media.length-1] ) {
                                    pauseMedia();
                                    zeQuery(this).parent().removeClass("mejs-pause").addClass("mejs-play");
                                    zeQuery('.mediaElement_playlist a.cp_pl_item.current', this.$gallery).addClass("pause");
                                    return false;
                                }
                            }else if (zeQuery(this).parent().hasClass("mejs-play")) {
                                if (session && session.media[session.media.length-1]) {
                                    playMedia();
                                    zeQuery(this).parent().removeClass("mejs-play").addClass("mejs-pause");
                                    zeQuery('.mediaElement_playlist a.cp_pl_item.current', this.$gallery).removeClass("pause");
                                    return false;
                                }
                            }            
                        });            
                        
                        zeQuery(chromecast_loop).on('click', function() {
                            if (chromeCast){
                                launchApp();
                                if(player.isFullScreen)
                                    player.exitFullScreen();
                            }
                        });

                        media.cincopaAddEventListener('onclickforcast', function(e) { 
                            if(zeQuery(e.el).hasClass('current')){
                                if (zeQuery(e.el).hasClass("pause")) {
                                    if (session  && session.media[session.media.length-1]) {
                                        playMedia();
                                        zeQuery(e.el).removeClass("pause");
                                        zeQuery('#' + objID + ' .mejs-playpause-button').removeClass("mejs-play").addClass("mejs-pause");
                                        return false;
                                    }
                                }else{
                                    if (session  && session.media[session.media.length-1]) {
                                        pauseMedia();
                                        zeQuery(this).addClass("pause");
                                        zeQuery('#' + objID + ' .mejs-playpause-button').removeClass("mejs-pause").addClass("mejs-play");
                                        return false;
                                    }
                                }
                            }else{
                                idle = false;  
                                var currentUrl  = e.url || zeQuery(e.el).data('url');            
                                loadMedia('url',currentUrl);
                                showPoster(currentUrl);  
                            }
                        },true);

                        media.cincopaAddEventListener('seeked',function() {
                            if (session && session.media[session.media.length-1]) {
                              var currentTime = media.currentTime;
                              //if (currentTime != 0) {
                                seekMedia(currentTime);
                              //}
                            }
                        });
                        
                        media.cincopaAddEventListener('volumechange', function () {                     
                            var volumeButton = zeQuery('.mejs-volume-button', controls);
                            var volume = media.volume;
                            if(volumeButton.hasClass('mejs-unmute')) {
                                volume = 0;
                            }
                            if (session){
                                changeVolume(volume);
                            }                                
                        }, false);

                        var loadCastInterval = setInterval(function () {
                            var current_url;
                            var playerOptionsdata;
                            if(player && player.options){
                                playerOptionsdata = player.options.dataCollector
                            }

                            if(playerOptionsdata && typeof $(media).data(playerOptionsdata) != 'undefined'){
                                current_url = $(media).data(playerOptionsdata);
                            }else{
                                current_url = media.src;
                            }                    

                            if (chrome.cast.isAvailable) {                            
                                chromeCast = true;
                                chrome.cast.cincopa =  chrome.cast.cincopa || {};
                                clearInterval(loadCastInterval);
                                initializeCastApi();                                
                                onSkinEvent('chromecast.detected');
                            } else {
                                //_trace('Unavailable');
                            }
                        }, 1000);
                    };
                }
        }

        /****** ChromeCast ********/
        function _trace(msg) {
            if(cincopa.trace)
                cincopa.trace("SKIN: "+ msg);
        }

        function sendDataCollector(param) {
           return player.options.skinObject.sendDataCollector(param)
        }
        function showPoster(url){
            var current_url;
            if(typeof url ==  'undefined'){
                if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                    current_url = media.src;
                }else{
                    current_url = $(media).data(player.options.dataCollector);
                }
                
            }else{
                current_url = url;
            }
            var item = sendDataCollector(current_url).item
            var postUrl;
            if(item.versions && item.versions.jpg_1200x900) {
                postUrl = item.versions.jpg_1200x900.url
            } else if(item.thumbnail_url) {
                postUrl = item.thumbnail_url
            }
            var currentSkin = player.options.skinObject;
            
            zeQuery(currentSkin.player.container[0]).find(".mejs-poster").css("background-image","url("+ postUrl +")");
            zeQuery(currentSkin.player.container[0]).find(".mejs-poster img").attr("src", postUrl);
            zeQuery(currentSkin.player.container[0]).find(".mejs-poster").show();

        }
        function onSkinEvent(event,data){            
            var current_url;
            if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                current_url = media.src;
            }else{
                current_url = $(media).data(player.options.dataCollector);
            }

            var sendData =  sendDataCollector(current_url);
            if(typeof data == 'object'){
                $.extend(sendData, data);
            }
            player.options.skinObject.go.onSkinEvent(event,sendData)
        }        

        var initializeCastApi = function () {
            var applicationID = '52281FB8';
            var sessionRequest = new chrome.cast.SessionRequest(applicationID);
            var apiConfig = new chrome.cast.ApiConfig(sessionRequest, sessionListener,receiverListener);

            try{
                chrome.cast.initialize(apiConfig, onInitSuccess, onInitError);
            }catch(ex){
                console.log(ex);
            }
            try{
              chrome.cast.addReceiverActionListener(function(e,action){
                    var currentSkin;
                    if(player && player.options){
                        currentSkin = player.options.skinObject
                    }
                    if(currentSkin && action == "cast"){
                        currentSkin.player.pause();
                        //showPoster()
                        setTimeout(function(){
                            zeQuery(currentSkin.player.container[0]).find('.mejs-playpause-button').removeClass("mejs-play").addClass("mejs-pause");
                            zeQuery(currentSkin.player.container[0]).parents(".mediaElement").find('.cp_pl_item.current').removeClass("pause");
                        },300);
                    }
                    if(action=="stop"){
                        stopMedia();
                    }
              });
            }catch(ex){
              console.log(ex);
            }

        };

        var sessionListener = function (e) {
            session = e;
            player.options.skinObject.session = session;
            
            if(session.media.length == 0){
               session.leave();
               return true;
            }

            if(zeQuery('.mediaElementVideoContainer').length > 1 ){
              session = null;
              delete player.options.skinObject.session;
              return true;
            }

            var objID = player.options.skinObject.go.loaderParams["_object"];
            var video_url =  session.media[session.media.length-1].media.metadata.video_url;
            player.setSrc(video_url);
            player.pause();

            zeQuery('#' + objID + ' [data-url].current').removeClass('current');
            zeQuery('#' + objID + ' [data-url="'+ video_url +'"]').addClass('current');

            if(session.media[session.media.length-1].playerState == 'PAUSED'){
                zeQuery(player.container[0]).parents(".mediaElement").find('.cp_pl_item.current').addClass("pause");
                zeQuery(player.container[0]).find('.mejs-playpause-button').removeClass("mejs-pause").addClass("mejs-play");

            }else if(session.media[session.media.length-1].playerState == 'PLAYING'){
                zeQuery(player.container[0]).find('.mejs-playpause-button').removeClass("mejs-play").addClass("mejs-pause");
            }

            showPoster(video_url);

            /* set chromecast info */
            var friendlyName = session.receiver.friendlyName;
            friendlyName = friendlyName.replace(/&#39;/g, '\'').replace(/&#40;/g, '\(').replace(/&#41;/g, '\)').replace(/&#34;/g, '\"').replace(/&#45;/g, '\-').replace(/&#44;/g, '\,').replace(/&#38;/g, '\&');
            zeQuery(player.container[0]).parent().find('.chromecast-logo-title').text(friendlyName);
            zeQuery(player.container[0]).parents(".mediaElementVideoContainer").addClass("cast-connected");
            /* show controls after reconnecting to chromecast */
            zeQuery('.mejs-container', this.$gallery).find('.mejs-controls').removeClass("make-hidden");

            clearInterval(interval);
            interval = setInterval(function () {
                if (session) {
                    if (typeof session.media[session.media.length-1] !== "undefined") {
                        player.setCurrentTime(session.media[session.media.length-1].getEstimatedTime());
                    }
                }
            }, 1000);
            if(idle == null){
                idle = true;
            }
            session.media[session.media.length-1].addUpdateListener(function (e) {
                if(!session || !session.media[session.media.length-1]){
                  return;
                }
                if (session.media[session.media.length-1].playerState == "IDLE") {
                    clearInterval(interval);
                    if(idle){
                        player.playNextTrack(player);
                        idle = false;
                    }
                    //idle = true;
                } else if(session.media[session.media.length-1].playerState == "PLAYING"){
                    zeQuery(".mejs-playpause-button",this.$gallery).removeClass("mejs-play").addClass("mejs-pause");
                    zeQuery('.mediaElement_playlist a.cp_pl_item.current', this.$gallery).removeClass("pause");
                    idle = true;
                } else if(session.media[session.media.length-1].playerState == "PAUSED"){
                    zeQuery(".mejs-playpause-button",this.$gallery).removeClass("mejs-pause").addClass("mejs-play");
                    zeQuery('.mediaElement_playlist a.cp_pl_item.current', this.$gallery).addClass("pause");
                }
            });

        }

        var receiverListener = function (e) {
            if (e === 'available') {
                zeQuery('.mediaElementVideoContainer').addClass('chromecastExist');
                zeQuery('.mediaElementVideoContainer .mejs-controls').resize();
                player.options.skinObject.chromecastExist = true; 
            }
            else {
                zeQuery('.mediaElementVideoContainer').removeClass('chromecastExist');
                stopMedia();
                zeQuery('.mediaElementVideoContainer .mejs-controls').resize();
                player.options.skinObject.chromecastExist = false;
            }
        }

        var onInitSuccess = function () {
            _trace("Initialization succeeded");
        }

        var onInitError = function () {
            _trace("Initialization failed");
        }

        var launchApp = function () {
            _trace("Launching the Chromecast App...");
            chrome.cast.requestSession(onRequestSessionSuccess, onLaunchError);
        }

        var onRequestSessionSuccess = function (e) {
            player.media.stop()
            player.setCurrentTime(0);
            _trace("Successfully created session: " + e.sessionId);
            session = e;
            player.options.skinObject.session = e;

            /* collect data for event */
            onSkinEvent('chromecast.start');

            session.addUpdateListener(function(e){
                if(session){
                    if(session.status == chrome.cast.SessionStatus.STOPPED){
                        stopMedia('leave');
                    }
                }
            })
            var startTime = (player.getCurrentTime() > 3) ? player.getCurrentTime() : 0;
            loadMedia(undefined, undefined, startTime);
        }

        var onLaunchError = function (e) {
            _trace("Error connecting to the Chromecast.");
            onSkinEvent('chromecast.error', {chromecast:{ error: e}});
        }

        var requestCurrentTime;
        var loadMedia = function (track, url , time) {
            if (typeof session === "undefined") {
                _trace("No session.");
                return;
            }
            var current_src = zeQuery(player.media).data("currentplayingvideourl") || player.media.currentSrc;
            if (track == 'url'){
                current_src = url;
            }
            
            var sendData = sendDataCollector(current_src);
            /* chromecast doesnt support base64 encoded uri */
            var m3u8URL;
            if(sendData.item.m3u8){
              m3u8URL = sendData.item.m3u8;
            } else {
              m3u8URL = cincopa.getPlaylistUrl(sendData.item.rid) + '&m3u8=segbr';
            }
            var mediaInfo = new chrome.cast.media.MediaInfo(m3u8URL);

            mediaInfo.contentType = '';
            if(chrome.cast.media.ContainerMetadata){
                mediaInfo.metadata = new chrome.cast.media.ContainerMetadata();
            }else if(chrome.cast.media.MovieMediaMetadata){
                mediaInfo.metadata = new chrome.cast.media.MovieMediaMetadata();
            } else{
                return;
            }
            mediaInfo.metadata.title = sendData.item.title || sendData.item.filename ;
            mediaInfo.metadata.video_url = current_src;
            var sbt = []
            for(let i in player.tracks) {
                sbt.push(new chrome.cast.media.Track(+i+1, chrome.cast.media.TrackType.TEXT))
                sbt[i].trackContentType = 'text/vtt';
                sbt[i].trackContentId = player.tracks[i]['data-src']
                sbt[i].subtype = chrome.cast.media.TextTrackType.SUBTITLES;
                sbt[i].name = player.tracks[i].label
                sbt[i].language = player.tracks[i].srclang
                sbt[i].customData = null;
            }
            mediaInfo.tracks = sbt;
            var request = new chrome.cast.media.LoadRequest(mediaInfo);

            request.autoplay = true;
            if(typeof time != "undefined"){
                request.currentTime = time;
                requestCurrentTime = time;  
            }
            var isError = true;
            session.loadMedia(request, function() {
                onMediaDiscovered(null, session.media[session.media.length - 1]);
                isError = false;
            }, function() {
                isError = false;
                mediaInfo = new chrome.cast.media.MediaInfo(current_src);
                    request = new chrome.cast.media.LoadRequest(mediaInfo);
                    mediaInfo.contentType = '';
                    if(chrome.cast.media.ContainerMetadata){
                    mediaInfo.metadata = new chrome.cast.media.ContainerMetadata();
                    }else if(chrome.cast.media.MovieMediaMetadata){
                    mediaInfo.metadata = new chrome.cast.media.MovieMediaMetadata();
                    } else{
                    return;
                    }          
                    mediaInfo.metadata.title = sendData.item.title || sendData.item.filename ;
                    mediaInfo.metadata.video_url = current_src;
                    if(typeof time != "undefined"){
                        request.currentTime = time;  
                    }
                    request.autoplay = true;
                    mediaInfo.tracks = sbt;
                    session.loadMedia(request, function() {
                        onMediaDiscovered(null, session.media[session.media.length - 1]);
                    }, onLoadError);
            });

            setTimeout(function() {
                if(isError && session.status == 'connected') {
                    mediaInfo = new chrome.cast.media.MediaInfo(current_src);
                    request = new chrome.cast.media.LoadRequest(mediaInfo);
                    mediaInfo.contentType = '';
                    if(chrome.cast.media.ContainerMetadata){
                    mediaInfo.metadata = new chrome.cast.media.ContainerMetadata();
                    }else if(chrome.cast.media.MovieMediaMetadata){
                    mediaInfo.metadata = new chrome.cast.media.MovieMediaMetadata();
                    } else{
                    return;
                    }          
                    mediaInfo.metadata.title = sendData.item.title || sendData.item.filename ;
                    mediaInfo.metadata.video_url = current_src;
                    if(typeof time != "undefined"){
                        request.currentTime = time;  
                    }
                    request.autoplay = true;
                    mediaInfo.tracks = sbt;
                    session.loadMedia(request, onMediaDiscovered.bind(this, 'loadMedia'));
                }
            }, 500);
        }
        
        var pauseMedia = function () {
            session.media[session.media.length-1].pause();
        }

        var playMedia = function () {
            try{
                session && session.media[session.media.length-1] &&  session.media[session.media.length-1].play()
            }catch(ex){
                _trace('Video Playing error ' + ex)
            }
        }

        var changeVolume = function (volume) {
            session.setReceiverVolumeLevel(volume);
        }

        var seekMedia = function (currenttime) {
            var request = new chrome.cast.media.SeekRequest();
            request.currentTime = currenttime;
            session.media[session.media.length-1].seek(request);
        }

        var stopMedia = function (status) {
            if(!session || status == undefined) return true;

            onSkinEvent('chromecast.stop', {chromecast:{session_status :session.status}});

            clearInterval(interval);
            if(status != 'leave' && session && session.media.length ){
                session.media[session.media.length-1].stop();
            }
            zeQuery(player.container[0]).parents(".mediaElementVideoContainer").removeClass("cast-connected");

            if(status == 'leave'){
                var time = Math.floor(session.media[session.media.length - 1].getEstimatedTime());
                player.setCurrentTime(time);
                session.leave();
                session = null;
                delete player.options.skinObject.session;
                
                player.container.off('touchend.'+player.options.galleryId)
                zeQuery('.mejs-pause-button', player.container).off('touchend.'+player.options.galleryId)
                zeQuery('.mejs-pause-button', player.container).removeClass('mejs-force-paused')
                zeQuery('.mejs-video-jump', player.container).addClass('cp-hide')
            }
            

            player.pause();
            zeQuery(".mejs-playpause-button",player.container).removeClass("mejs-pause").addClass("mejs-play");
            zeQuery("#" + player.options.galleryId+' .mediaElement_playlist a.cp_pl_item.current').addClass("pause");
        }

        var onMediaDiscovered = function (how, castMedia) {

            player.pause();
            var timeout = null;
            player.container.on('touchend.'+player.options.galleryId, function() {
                zeQuery('.mejs-video-jump', player.container).css({
                    zIndex: 9,
                    position: 'relative'
                })
                zeQuery('.mejs-video-jump', player.container).removeClass('cp-hide')
                clearTimeout(timeout)
                timeout = setTimeout(function() {
                    if(player.jumping) return;
                    zeQuery('.mejs-video-jump', player.container).removeClass('cp-hide')
                }, 600);
            })

            zeQuery('.mejs-pause-button', player.container).on('touchend.'+player.options.galleryId, function() {
                zeQuery(this).toggleClass('mejs-force-paused')
                if(zeQuery(this).hasClass('mejs-force-paused')) {
                    pauseMedia()
                } else {
                    playMedia();
                }
            })
            
            var activeTrackIds;
            var tracksInfoRequest;
            if(typeof lang !== 'undefined' && lang !== 'none') {
                activeTrackIds = [+player.tracks.indexOf(player.tracks.find(el => el.srclang == lang)) + 1]

                tracksInfoRequest = new chrome.cast.media.EditTracksInfoRequest(activeTrackIds)
                castMedia.editTracksInfo(tracksInfoRequest);
            }
            zeQuery('.mejs-captions-button').on('click', function() {

                if(typeof lang !== 'undefined' && lang !== 'none') {
                activeTrackIds = [+player.tracks.indexOf(player.tracks.find(el => el.srclang == lang)) + 1]
                    tracksInfoRequest = new chrome.cast.media.EditTracksInfoRequest(activeTrackIds)
                    castMedia.editTracksInfo(tracksInfoRequest);
            } else {
                activeTrackIds = []
                tracksInfoRequest = new chrome.cast.media.EditTracksInfoRequest(activeTrackIds)
                castMedia.editTracksInfo(tracksInfoRequest);
                }
            })

            try{
              if(session) {
                showPoster(session.media[session.media.length-1].media.metadata.video_url);
              }
            }catch(ex){
                console.log(ex, 'EX')
               _trace(ex + ' ShowPoster error')
            }
          
            
            /* set chromecast info */
            if(session){
              var friendlyName = session.receiver.friendlyName;
              friendlyName = friendlyName.replace(/&#39;/g, '\'').replace(/&#40;/g, '\(').replace(/&#41;/g, '\)').replace(/&#34;/g, '\"').replace(/&#45;/g, '\-').replace(/&#44;/g, '\,').replace(/&#38;/g, '\&');
              zeQuery(player.container[0]).parent().find('.chromecast-logo-title').text(friendlyName);
              zeQuery(player.container[0]).parents(".mediaElementVideoContainer").addClass("cast-connected");
            }
            if(idle == null){
                idle = true;
            }
            
            clearInterval(interval);
            interval = setInterval(function () {
                if (session) {
                    if (typeof session.media[session.media.length-1] !== "undefined") {
                        let time = Math.floor(session.media[session.media.length - 1].getEstimatedTime())
                        let timeHtml = ''
                        if(time < 60) {
                            if(time < 10) {
                                timeHtml = '00:'+'0'+time
                            } else {
                                timeHtml = '00:'+time
                            }
                        } else {
                            var minutes;
                            var seconds;
                            if(Math.floor(time / 60) < 10) {
                                minutes = '0'+Math.floor(time / 60)
                            } else {
                                minutes = Math.floor(time / 60)
                            }
                            if(time % 60 < 10) {
                                seconds = '0'+time%60
                            } else {
                                seconds = time % 60
                            }
                            timeHtml = minutes+':'+seconds
                        }
                        zeQuery('.mejs-currenttime').html(timeHtml)
                    }
                }
            }, 1000)
            /*var activeTrackIds = [0];
            var tracksInfoRequest = new chrome.cast.media.EditTracksInfoRequest(activeTrackIds);
            media.editTracksInfo(tracksInfoRequest, successTrackCallback, errorTrackCallback);*/
            
            castMedia.addUpdateListener(function (e) {    
                if(!session || !session.media[session.media.length-1]){
                  return;
                }
                if(session.media[session.media.length-1].currentTime > 0 && requestCurrentTime && session.media[session.media.length-1].playerState == 'PLAYING' ){
                    seekMedia(requestCurrentTime);
                    requestCurrentTime = 0;
                }                
 
                if (session && session.media[session.media.length-1] && session.media[session.media.length-1].playerState == "IDLE") {
                    clearInterval(interval);
                    if(idle){
                        player.playNextTrack(player);
                        idle = false;
                    }
                    //idle = true;
                } else if(session.media[session.media.length-1].playerState == "PLAYING"){
                    zeQuery(".mejs-playpause-button",this.$gallery).removeClass("mejs-play").addClass("mejs-pause");
                    zeQuery('.mediaElement_playlist a.cp_pl_item.current', this.$gallery).removeClass("pause");
                    idle = true;
                } else if(session.media[session.media.length-1].playerState == "PAUSED"){
                    zeQuery(".mejs-playpause-button",this.$gallery).removeClass("mejs-pause").addClass("mejs-play");
                    zeQuery('.mediaElement_playlist a.cp_pl_item.current', this.$gallery).addClass("pause");
                }
            });
        }
        var onLoadError = function () {
            zeQuery(player.container[0]).parents(".mediaElementVideoContainer").removeClass("cast-connected");
            player.play()['catch'](function(err){  _trace(err + 'Video Playing error') });
        }

		/***** End ChromeCast ******/


        }
})(zeQuery);

/* Apple Air Play Integration */
(function ($) {
    
    CincopaMediaElementPlayer.prototype.buildairplay_logo = function (player, controls, layers, media) {
        var airplay_icon = $('<div class="mejs-button mejs-player-air-play-button cp-hide" >' +
                '<button type="button" aria-controls="' + player.id + '" title="Play via AirPlay"></button>' +
                '</div>')
        .appendTo(controls);
        var isLive = player.options.skinObject.go.skin.isLive
        if(isLive) {
            airplay_icon.addClass('live-airplay')
        }

        if (window.WebKitPlaybackTargetAvailabilityEvent) {

            media.addEventListener('webkitplaybacktargetavailabilitychanged',
                function(event) {        
                    switch (event.availability) {
                    case "available":
                        airplay_icon.removeClass('cp-hide')
                        break;
                    case "not-available":
                        airplay_icon.addClass('cp-hide')
                        break;
                } 
            }); 
            airplay_icon.on('click', function() {
                media.webkitShowPlaybackTargetPicker();
            })
            media.addEventListener('webkitcurrentplaybacktargetiswirelesschanged', 
            function() {
                var current_src = $(player.media).data("currentplayingvideourl") || player.media.currentSrc;
                var sendData = player.options.skinObject.sendDataCollector(current_src);
                var versions = sendData.versions;
                if(media.webkitCurrentPlaybackTargetIsWireless) {
                    if(media.src.indexOf('m3u8') > - 1) {
                        return;
                    } else {
                        var isSegbr = true;
                        for (var key in versions) {
                            if (versions.hasOwnProperty(key) && versions[key].mime == "application/x-mpegURL" && key.indexOf('ts_')!= -1) {
                                if(versions[key].url.indexOf('m3u8=segbr') > -1 ){
                                    isSegbr = true;
                                }
                            }
                        }
                        /* chromecast doesnt support base64 encoded uri */
                        var m3u8URL;
                        if(sendData.item.m3u8){
                            m3u8URL = sendData.item.m3u8;
                        } else {
                            m3u8URL = cincopa.getPlaylistUrl(sendData.item.rid) + (isSegbr ? '&m3u8=segbr' : '');
                        }
                        var currentTime = player.getCurrentTime();
                        player.setSrc(m3u8URL);
                        player.setCurrentTime(currentTime);
                        player.play();
                    }
                }
            });
       
        }
    }
        
})(zeQuery);


/* annotation plugin */
(function ($) {
    CincopaMediaElementPlayer.prototype.buildannotation = function (player, controls, layers, media) {
        var h = layers.parents(".mejs-container").outerHeight();
        var annotationBlock = $('<div class="ze_htmloverlay_placeholder" id="ze_htmloverlay_placeholder_' + player.options.skinObject.go.loaderParams["_object"] + '"></div>' +
             '<div class="ze_annotation_placeholder" id="ze_annotation_placeholder_' + player.options.skinObject.go.loaderParams["_object"] + '_' + player.id +'" style="height:' + h + 'px"></div>' +
             '<div class="ze_htmloverlay_placeholder" id="ze_htmloverlay_placeholder_' + player.options.skinObject.go.loaderParams["_object"] + '_' + player.id + '"></div>').appendTo(layers);
            $(media).off('resizeComplete').on('resizeComplete.' + player.options.galleryId, function(){               
                var new_h = player.container.outerHeight();
                $('.ze_annotation_placeholder', player.container).height(new_h);
            })
    };
})(zeQuery);


/* live button */
(function ($) {

    CincopaMediaElementPlayer.prototype.buildliveButton = function (player, controls, layers, media) {
        $('<div class="mejs-time" role="timer" aria-live="off">' +
                '<span class="mejs-currenttime">' +
                    'LIVE' +
                '</span>'+
            '</div>')
        .appendTo(controls);
    };
})(zeQuery);


/* chapters  */
(function ($) {
    CincopaMediaElementPlayer.prototype.buildchapter = function (player,controls,layers,media) {

        var isMobile = {
            Android: function () {
                return navigator.userAgent.match(/Android/i);
            },
            BlackBerry: function () {
                return navigator.userAgent.match(/BlackBerry/i);
            },
            iOS: function () {
                return navigator.userAgent.match(/iPhone|iPad|iPod/i) || ((/iPad|iPhone|iPod/.test(navigator.platform) ||
                    (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) &&
                    !window.MSStream);
            },
            Opera: function () {
                return navigator.userAgent.match(/Opera Mini/i);
            },
            Windows: function () {
                return navigator.userAgent.match(/IEMobile/i) || navigator.userAgent.match(/WPDesktop/i);
            },
            any: function () {
                return (this.Android() || this.BlackBerry() || this.iOS() || this.Opera() || this.Windows());
            }
        };

        var chapter_on =  player.options.skinObject.go.args.chapter_on;
        if(isMobile.any ()){
            chapter_on = false;
        }

        if (chapter_on) {
            layers.addClass("mejs-show-chapters");
        }
        if (!layers.find(".mejs-chapters-wrap").length) {
            var chapterBlock = $('<div class="mejs-chapters-wrap"><div class="mejs-chapters-wrap-inner"></div></div>').appendTo(layers);
        }
        else {
            var chapterBlock = $(".mejs-chapters-wrap",layers);
        }
        var chapterBtn = $("<div>").addClass("mejs-button").addClass("mejs-chapters-button");
        if (!chapter_on){ 
            chapterBtn.addClass("mejs-chapters-off")
        }
        

        var newChaptersBtnBlock = $("<div class='mejs-button mejs-captions-button mejs-chapters-button--new " + (player.tracks.length == 0 ? 'cp-hide' : '') + "'></div>");
        var newChaptersBtn = $('<button type="button" title="CC"></button>');
        newChaptersBtnBlock.append(newChaptersBtn);
        $(newChaptersBtnBlock).appendTo(controls);

        newChaptersBtnBlock.on('click', function(){
            var lang = 'none';
            if(!$(this).hasClass('mejs-chapters-button--active')){             
                if( $.cookie('cincopavideoTrack') && $.cookie('cincopavideoTrack') != 'none' ) {
                    lang = $.cookie('cincopavideoTrack');
                }else {
                    lang = $('.mejs-captions-list .track-current').first().find('input').val();
                }
                $(this).addClass( "mejs-chapters-button--active" );               
            }else{
                $(this).removeClass( "mejs-chapters-button--active" ); 
            }
            $("input[type=radio][value='" + lang + "']", controls).trigger("click");
           
        })

        media.cincopaAddEventListener('selectedTrack', function(){
            newChaptersBtnBlock.addClass('mejs-chapters-button--active');
        })
        media.cincopaAddEventListener('loadeddata', function (e) {
            newChaptersBtnBlock.removeClass('mejs-chapters-button--active');  
        });
        
        
        
        chapterBtn.html('<button type="button" title="Close Chapters"></button>');
        $(chapterBtn).appendTo(controls);

        $(chapterBtn).on("click",function () {
            if ($(this).hasClass("mejs-chapters-off")) {
                $(this).removeClass("mejs-chapters-off");
                layers.addClass("mejs-show-chapters");
                $(chapterBtn).find("button").attr("title","Close Chapters");
            } else {
                $(this).addClass("mejs-chapters-off");
                layers.removeClass("mejs-show-chapters");
                $(chapterBtn).find("button").attr("title","Open Chapters");
            }
        });
        $(player.container).on("mouseleave",function () {
            $("#" + player.options.galleryId).addClass('ze-mouseleave');
            $(player.container).addClass('ze-mouseleave');
            if (!layers.parents(".mejs-container").hasClass("ze-autohide")) {
                var gallery = $("#" + player.options.galleryId);
                if (gallery.hasClass('status-play')) {
                    layers.removeClass("mejs-show-chapters");
                } else {
                    if (!$(chapterBtn).hasClass("mejs-chapters-off")) {
                        layers.addClass("mejs-show-chapters");
                    }
                }
                $(chapterBtn).find("button").attr("title","Open Chapters");
            }
        })

        $(player.container).on("mouseover",function () {
            $("#" + player.options.galleryId).removeClass('ze-mouseleave');
            $(player.container).removeClass('ze-mouseleave');
            if (!$(chapterBtn).hasClass("mejs-chapters-off") && !$(controls).hasClass('fadeafterseconds')) {
                layers.addClass("mejs-show-chapters");
            } else {
                layers.removeClass("mejs-show-chapters");
            }

        });

        /* REQUIRED media must have data-index to allow get current item */
        var current_url;
        if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
            current_url = media.src;
        }else{
            current_url = $(media).data(player.options.dataCollector);
        }

        var currentData = player.options.skinObject.sendDataCollector(current_url || 0);
        var currentItem = currentData.item;
        if (!currentItem) {
            return;
        }

        var pluginActivation = true
        $(media).on("loadeddata",function () { 
            if(pluginActivation) return;
            var current_url;
             if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                current_url = media.src;
            }else{
                current_url = $(media).data(player.options.dataCollector);
            }
            
            var currentData = player.options.skinObject.sendDataCollector(current_url || 0)
            currentItem = currentData.item;
            if (!currentItem) {
                return;
            }
            buildChapters(currentItem,player);
        })
        

        buildChapters(currentItem,player);

        /* allow to call build chapters outside (from libasync.js) */
        player.options.skinObject.buildChapters = buildChapters;
        

        function buildChapters(item,player) {      
            pluginActivation = false;      
            var chapters = [];
            var timeline = item.timeline;
            var chaptersCont = $(".mejs-chapters-wrap-inner",player.container);
            chaptersCont.empty();
            if (timeline) {
                eval('var timeLineObj = ' + decodeXml(timeline));
                chapters = timeLineObj.chapter;
                chapters = orderByTime(chapters);
                if (item.caption) {
                    var h3 = $("<h3>").addClass("mejs-chapters-name").text(item.caption).css("height","80px");
                    chaptersCont.append(h3);
                }
                var ol = $("<ol>").addClass("mejs-chapters-list");
                if (item.caption) {
                    ol.css("height",chaptersCont.height() - 80)
                } else {
                    ol.css("height","100%")
                }

                chaptersCont.append(ol);
                for (var chapter = 0; chapter < chapters.length; chapter++) {
                    var ind = chapter + 1;
                    buildChapter(ind,ol,chapters[chapter].time,chapters[chapter].value.title,player,chapters[chapter].value.desc)
                }
                if(chapters.length){
                    var hashtagChapter =  player.options.skinObject.getUrl('cprtstatus');               
                    if (hashtagChapter && (hashtagChapter.indexOf('chapter-') > -1)) {
                        var chapterIndex = hashtagChapter.split('chapter-').pop();
                        chapterUrl = '/chapter-' + chapterIndex;
                    }             
                    if(chapterIndex){
                        $(ol).children().eq(parseInt(chapterIndex)-1).trigger('click');                    
                    }                    
                }
            }
            $(".mejs-chapters-wrap",player.container).attr("data-chaptersCount",chapters.length);
            if (chapters.length == 0) {
                $(player.container).addClass("no_chapters");
                $(layers).removeClass("mejs-show-chapters");
                $(".mejs-chapters-button",player.container).addClass("cp-hide");
            } else {
                $(".mejs-chapters-button",player.container).removeClass("cp-hide");
                $(player.container).removeClass("no_chapters");
            }
        }

        function _trace(msg) {
            if(cincopa.trace)
                cincopa.trace("SKIN: "+ msg);
        }

        function buildChannelHashUrl(oldurl, index){
            if(oldurl && oldurl.indexOf('chapter-') > -1) {
                var chapterIndex = oldurl.split('chapter-').pop();
            }
            oldurl = oldurl.replace('cprtstatus=','').replace('/chapter-' + parseInt(chapterIndex), '');  
            var cprtstatus = oldurl + '/chapter-' + index;
            player.options.skinObject.buildHash('cprtstatus', cprtstatus);
        }

        function buildChapter(index,ol,chapter,title,player,description) {          
            var hashtagChapter =  player.options.skinObject.getUrl('cprtstatus');            
            var mousenterTimer;           
            var li = $("<li>").attr("data-time", chapter).html("<span class='chapter_index'>" + index + "</span><span>" + title + "</span>")
            li
                .on("click",function () {
                    var that = this;
                    var time = $(this).attr("data-time");
                    var sec = hmsToSecondsOnly(time);
                    player.setCurrentTime(sec);
                    if (player.media && player.media.paused && !player.options.skinObject.session) {
                        player.$media[0].play()['catch'](function (err) {  _trace(err + 'Video Playing error') });
                    }else if(player.options.skinObject.session){
                        /* trigger seek event for chromecast */
                        try {
                            var event = document.createEvent("HTMLEvents");
                            event.initEvent("seeked", true, true);
                            event.eventName = "seeked";
                            media.dispatchEvent(event);
                        }catch(ex){
                             console.log(ex)
                        }
                    }

                    var sendingData = $.extend({},currentData);
                    sendingData.chapter = {
                        second: sec,
                        title: title,
                        description: description
                    }
                    $(this).trigger("mouseover");
                    player.options.skinObject.go.onSkinEvent("chapter.click", sendingData);

                    if(!hashtagChapter){ /* if cprtstatus not exist create default location hash */
                        player.options.skinObject.buildChannelHashUrl('channel', currentItem.rid);
                        hashtagChapter =  player.options.skinObject.getUrl('cprtstatus');
                    }
                    buildChannelHashUrl(hashtagChapter, $(this).index() + 1);
                    mousenterTimer = setTimeout(function(){
                        $(that).trigger("mouseleave");
                    },1000)

                })
                .on("mouseover",function () {
                    clearTimeout(mousenterTimer);
                    var time = $(this).attr("data-time");
                    var section = $(".ze_tl_chapter_section[data-time='" + time + "']",player.container);
                    var chapterInfoWidth = 200;
                    var timeRialwidth = $(".mejs-time-total",player.container).width();

                    var timePxSize = timeRialwidth / player.options.skinObject.go.playerAPI.duration();
                    var sectionLeft = parseInt(hmsToSecondsOnly(time)) * timePxSize;
                    if (timeRialwidth - sectionLeft < chapterInfoWidth) {
                        $(".ze_tl_chapter_info",section).css("margin-left",(timeRialwidth - sectionLeft - chapterInfoWidth) + "px");
                    } else {
                        $(".ze_tl_chapter_info",section).css("margin-left",0 + "px");
                    }
                    $(".ze_tl_chapter_section",player.container).removeClass("ze_tl_visible_chapter");
                    section.addClass("ze_tl_visible_chapter");
                })
                .on("mouseleave",function () {
                    var time = $(this).attr("data-time");
                    $(".ze_tl_chapter_section[data-time='" + time + "']",player.container).removeClass("ze_tl_visible_chapter");
                })
            ol.append(li);
        }

        /* helperse for chapter */
        function orderByTime(timeline) {
            var newOrderedArray = [];
            for (var i in timeline) {
                newOrderedArray.push({ time: i,value: timeline[i] });
            }
            newOrderedArray.sort(function (a,b) {
                return hmsToSecondsOnly(a.time) - hmsToSecondsOnly(b.time);
            })
            return newOrderedArray;

        }

        function decodeXml(string) {
            var escaped_one_to_xml_special_map = {
                '&amp;': '&',
                '&quot;': '"',
                '&lt;': '<',
                '&gt;': '>'
            };
            return string.replace(/(&quot;|&lt;|&gt;|&amp;)/g,
                function (str,item) {
                    return escaped_one_to_xml_special_map[item];
                });
        }

        function hmsToSecondsOnly(str) {
            if (typeof str == 'undefined') {
                return '';
            }
            var p = str.split(':'),
                s = 0,m = 1;

            while (p.length > 0) {
                s += m * parseInt(p.pop(),10);
                m *= 60;
            }

            return s;
        }

    };
})(zeQuery);



/*download-button */
(function ($) {
	$.extend(CincopaMediaElementPlayer.prototype, {
        // LOOP TOGGLE
        builddownload:function(player, controls, layers, media){
            
            var dw_btn = $('<div class="mejs-button  mejs-download-button" >'+
                    '<button class="download-button" type="button" aria-controls="' + player.id + '" title="Download"></button>' +
                    '</div>')
                    .appendTo(controls);
                    dw_btn.on("click", function(e){
                        e.preventDefault();
                        e.stopPropagation();
                        var current_url;
                        if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                            current_url = media.src;
                        }else{
                            current_url = $(media).data(player.options.dataCollector);
                        }

                        var currentData = player.options.skinObject.sendDataCollector(current_url || 0);
                        player.options.skinObject.go.onSkinEvent('item.download', currentData );
                        return;
                    });
                    

            
        },
        buildgear: function (player, controls, layers, media) {
            var t = this;

            var gear_btn = $('<div class="mejs-button mejs-gear-button" >' +
                    '<button type="button" aria-controls="' + player.id + '" title="Settings"></button>' +
                    '</div>')
                    .appendTo(controls)

            var popup = $("<div class='mejs-settings-menu'><div class='mejs-settings-panel'></div>")
                 .appendTo(gear_btn);

            gear_btn.on("click", function(e){
                e.preventDefault();
                e.stopPropagation();
                t.createMenu(player, controls, layers, media);
                popup.fadeIn(300);
            });
            $("body").on("click."+player.options.galleryId, function(e){
                if($(e.target).closest(".mejs-settings-menu").length == 0 && $(e.target).closest(".mejs-gear-button").length == 0){
                    controls.removeClass("ze-active-controls");
                    popup.fadeOut(50);
                }
            });

            // the container of chapters - hidden by default
            if(!layers.find(".mejs-chapters-wrap").length)
                var chapterBlock = $('<div class="mejs-chapters-wrap"><div class="mejs-chapters-wrap-inner"></div></div>').appendTo(layers);
            else
                var chapterBlock = $(".mejs-chapters-wrap", layers);

            media.cincopaAddEventListener('loadedmetadata', function(e) {
                t.showhidegear(player, controls, layers,media);
            }, true);

            media.cincopaAddEventListener('play', function(e) {
                setTimeout(function(){
                    t.showhidegear(player, controls, layers,media);
                }, 20)
            }, true);

            player.container.on('mouseleave', function () {
                controls.removeClass("ze-active-controls");
                popup.fadeOut(50);
            });

            $(controls).on('mouseenter', '.mejs-captions-button', function(){
                popup.fadeOut(50);
            });            
        },


        createM3u8Arr: function(item){
            var m3u8Arr = [];
            if(item){
                var ratio = item.aspect_ratio;
                var counter = 10;
                var versions = item.versions;
                for (var key in versions) {
                    if (versions.hasOwnProperty(key) && versions[key].mime == "application/x-mpegURL" && key.indexOf('ts_')!= -1) {
                        var resolution = "";
                        var h = parseInt(versions[key].name);
                        var w = ratio * h;
                        resolution = w + "X" + h;
                        m3u8Arr.push({
                            url: versions[key].url+ ( versions[key].key ? '?token='+versions[key].key : '' ),
                            display_name: versions[key].name,
                            resolution: resolution,
                            bandwidth: counter
                        });
                        counter ++;
                    }
                }
            }
            return m3u8Arr;
       },
       isHlsSupported: function(enable_hls){
        var supported = true;
        if(typeof Hls == "undefined"|| !Hls.isSupported())
            supported = false;
        if(!enable_hls)
            supported = false;
        if(is_ie() && !is_ie_hls_supported()){
            supported = false;
        }

        var chr = function() {
            return !(!/Chrome/.test(navigator.userAgent) || !/Google Inc/.test(navigator.vendor)) && {
                version: chromeVersion()
            }
        };
        var chromeVersion = function() {
            var e = navigator.userAgent.match(/\bChrome\/([^\s]+)/);
            return e && e[1]
        }
        if(chr() && parseInt(chr().version) <= 50){
             supported = false;
        }


        return supported;


        function is_ie(){
            var ua = window.navigator.userAgent;
            var edge = ua.indexOf('Edge/');
            var msie = ua.indexOf("MSIE ");
            if (msie > 0)  // If Internet Explorer, return version number
            {
                return parseInt(ua.substring(msie + 5, ua.indexOf(".", msie)));
            } else if (!!navigator.userAgent.match(/Trident.*rv\:11\./)) {
                return 11;
            } else if (edge > 0) {
                return (parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10));
            }

            return false;
        }

        function is_ie_hls_supported() {

            var ua = window.navigator.userAgent;

            var edge = ua.indexOf('Edge/');

            var msie = ua.indexOf("MSIE ");

            if (msie > 0)  // If Internet Explorer, return version number
            {
                var ver =  parseInt(ua.substring(msie + 5, ua.indexOf(".", msie)));
                if(ver < 11) return false;

            } else if (!!navigator.userAgent.match(/Trident.*rv\:11\./)) {
                if(navigator && (/(Windows 8.1|Windows NT 6.3)/.test(navigator.appVersion) || /(Windows 10.0|Windows NT 10.0)/.test(navigator.appVersion)))
                    return true;
            } else if (edge > 0) {
                return true
            }

            return false;

        }
        },
        isNativeHls: function(){
            var riphone = /(iphone)/i,
                ripad = /(ipad)/i,
                rwebkit = /(webkit)[ \/]([^\s]+)/i;
 
            var iphone = riphone.test(navigator.userAgent);
            var ipad = ripad.test(navigator.userAgent);
            var safari = rwebkit.test(navigator.userAgent) && !/chrome/i.test(navigator.userAgent) && !ipad && !iphone;
            return iphone || ipad || safari;
       },

        createMenu: function(player, controls, layers, media, details){
            var t = this;
            var current_url;
             if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                current_url = media.src;
            }else{
                current_url = $(media).data(player.options.dataCollector);
            }

            var currentData = player.options.skinObject.sendDataCollector(current_url || 0)
            var m3u8Arr = t.createM3u8Arr(currentData.item)
            var hlsObj = $(media).data('hls')

            var buttonsCount = 0;
            /* caption option enable/disable */
            var isChapters = false;
            if(player.options.skinObject.go.args.chapter && parseInt($(".mejs-chapters-wrap", layers).attr("data-chaptersCount")) > 0 && layers.parents(".mediaElement").find(".ze_tl_block").is(":hidden") && controls.find(".mejs-chapters-button").hasClass("mejs-force-hidden-button")){
                isChapters = true;
                buttonsCount++;
            }

            /* chromecast option enable/disable */
            var isChromecast = false;
            if(player.options.skinObject.chromecastExist && controls.find(".mejs-player-chrome-cast-button").hasClass("mejs-force-hidden-button")){
                isChromecast = true;
                buttonsCount++;
            }

            /* speed option enable/disable */
            var isSpeed = false
            if(player.options.skinObject.go.args.speed){
                isSpeed = true;
                buttonsCount++;
            }
            
            
            /* subtitle option enable/disable */
            var isSubtitle = false;
            if(player.options.skinObject.go.args.subtitle && player.tracks.length > 0 && $(".mejs-captions-selector li.track-current", controls).length > 0){
                isSubtitle = true;
                buttonsCount++;
            }

            /* quality option enable/disable */
            var isQuality = false;

            var isKeyboardShoutcart = false;
            if(player.options.skinObject.go.args.keyboardShoutcart) {
                isKeyboardShoutcart = true;
            }
            if(player.options.skinObject.go.args.versions === "on" || (hlsObj && 
                hlsObj.levelController.levels && hlsObj.levelController.levels.length > 0) || 
            (player.options.skinObject.go.args.enable_hls  && !t.isHlsSupported(player.options.skinObject.go.args.enable_hls) 
            && t.isNativeHls() && m3u8Arr.length > 0)){
                isQuality = true;
                buttonsCount++;
            }
            $(".mejs-settings-panel", controls).empty();
            $(".mejs-settings-panel", controls).append("<div class='mejs-settings-panel-menu'></div>");

            if(buttonsCount == 0){
                return;
            }           
            /*audio-options support */
            var isAudioSupport = false;
            if(!player.options.skinObject.go.args.audio_support) { //audio_jump: true;                
                isAudioSupport = true;
            }

            function getItem() {
                var current_url;
                if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                   current_url = media.src;
                }else{
                   current_url = $(media).data(player.options.dataCollector);
                }                        
                var currentData = player.options.skinObject.sendDataCollector(current_url || 0);
                return currentData.item;
            };

            if(isChapters){
                    var active = layers.hasClass("mejs-show-chapters");
                    $(".mejs-settings-panel-menu", controls)
                    .append("<div class='mejs-settings-menu-item' data-checked='" + active + "' data-action='chapters'>" +
                                "<div class='mejs-settings-menu-item-label'>Chapters</div>" +
                                "<div class='mejs-settings-menu-item-content'>" +
                                    "<div class='mejs-settings-menu-item-toggle-checkbox'></div>" +
                                "</div>" +
                            "</div>");
            }

            // if(isChromecast){
            //         $(".mejs-settings-panel-menu", controls)
            //         .append("<div class='mejs-settings-menu-item' data-action='chromecast'>" +
            //                     "<div class='mejs-settings-menu-item-label'>Play on TV</div>" +
            //                 "</div>");
            // }

            if(isSpeed){
                    var currentSpeed = media.playbackRate.toFixed(2);
                    var currentSpeedName = currentSpeed + t.options.speedChar;
                    if(currentSpeed == 1.00) currentSpeedName = "normal";
                    $(".mejs-settings-panel-menu", controls)
                    .append("<div class='mejs-settings-menu-item' data-haspopup='true' data-action='speed'>" +
                                "<div class='mejs-settings-menu-item-label mejs-settings-menu-item--long'>Playback Speed</div>" +
                                "<div class='mejs-settings-menu-item-content'>" +
                                    currentSpeedName.charAt(0).toUpperCase() + currentSpeedName.slice(1) +
                                "</div>" +
                            "</div>");
            }

            if(isSubtitle){
                    var currentTrack = "";
                    if(t.selectedTrack === null){
                        currentTrack = "None"
                    } else if (t.selectedTrack){
                        currentTrack = t.selectedTrack.label || cincopa_mejs.language.codes[t.selectedTrack.srclang] || t.selectedTrack.srclang;
                    }

                    $(".mejs-settings-panel-menu", controls)
                    .append("<div class='mejs-settings-menu-item' data-haspopup='true' data-action='subtitle'>" +
                                "<div class='mejs-settings-menu-item-label'>Subtitles/CC</div>" +
                                "<div class='mejs-settings-menu-item-content'>" +
                                    currentTrack +
                                "</div>" +
                            "</div>");
            }

            if(isQuality){
               
                    var currentVersion = "auto", currentVersionName = "auto";
                    if(hlsObj && hlsObj.disableResize){
                        var currentLevel = (typeof details != "undefined" && typeof details.version != "undefined" ? details.version : hlsObj.currentLevel)
                        currentVersion = hlsObj.levelController.levels[currentLevel];
                        if(currentVersion)
                            currentVersionName = currentVersion.name ||currentVersion.height+'p' ;
                        if(currentVersionName == "720p" || currentVersionName == "1080p" || currentVersionName == "1440p"){
                            currentVersionName += " <sup class='mejs-settings-menu-item-label-hd'>HD</sup>"
                        }else if(currentVersionName == "2160p"){
                            currentVersionName += " <sup class='mejs-settings-menu-item-label-hd'>4K</sup>"
                        }
                       
                    } else if (hlsObj){
                        var currentLevel = (typeof details != "undefined" && typeof details.level != "undefined" ? details.level : hlsObj.currentLevel)
                        var ver = hlsObj.levelController.levels[currentLevel];
                        if(ver)
                             var verName = ver.name || ver.height+'p';
                        if(verName == "720p" || verName == "1080p" || verName == "1440p"){
                            verName += " <sup class='mejs-settings-menu-item-label-hd'>HD</sup>"
                        }else if(verName == "2160p"){
                            verName += " <sup class='mejs-settings-menu-item-label-hd'>4K</sup>"
                        }
						
						if(verName){
							currentVersionName += " " + verName;
                        }

                    }else if(player.options.skinObject.go.args.enable_hls && !t.isHlsSupported(player.options.skinObject.go.args.enable_hls) && t.isNativeHls()){                        
                        var id = player.id
                            currentLevel = (player.options.skinObject.nativeHls && player.options.skinObject.nativeHls[id])  ? player.options.skinObject.nativeHls[id] : 'auto';
                            if(currentLevel != 'auto'){
                            currentVersionName = m3u8Arr[currentLevel].display_name;
                        }
                        if(currentVersionName == "720p" || currentVersionName == "1080p" || currentVersionName == "1440p"){
                            currentVersionName += " <sup class='mejs-settings-menu-item-label-hd'>HD</sup>"
                        }else if(currentVersionName == "2160p"){
                            currentVersionName += " <sup class='mejs-settings-menu-item-label-hd'>4K</sup>"
                        } 
                    }
                    $(".mejs-settings-panel-menu", controls)
                    .append("<div class='mejs-settings-menu-item' data-haspopup='true' data-action='quality'>" +
                                "<div class='mejs-settings-menu-item-label'>Quality</div>" +
                                "<div class='mejs-settings-menu-item-content'>" +
                                    "<span>" + currentVersionName + "</span>"+
                                "</div>" +
                            "</div>");

            }

            if(isKeyboardShoutcart) {
                $(".mejs-settings-panel-menu", controls)
                    .append("<div class='mejs-settings-menu-item' data-haspopup='true' data-action='keyboard'>" +
                                "<div class='mejs-settings-menu-item-label'>Keyboard</div>" +
                                "<div class='mejs-settings-menu-item-content'>" +
                                "</div>" +
                            "</div>");
            }
            
            var item = getItem();       
            if (item && item['extra_files']) {
                var getAudioData = item['extra_files'].filter(function(el) {
                    return (el.type.indexOf('audio_') > -1);
                });
            };

            if (isAudioSupport && getAudioData && getAudioData.length) {
                var audioLabel = "Original";
                audioLabel = !t.customAudioTrack ? audioLabel : t.customAudioTrack.label;
                $(".mejs-settings-panel-menu", controls)
                .append("<div class='mejs-settings-menu-item' data-haspopup='true' data-action='audios'>" +
                            "<div class='mejs-settings-menu-item-label'>Multilanguage</div>" +
                            "<div class='mejs-settings-menu-item-content'>" +
                                "<span>" + audioLabel + "</span>" +
                            "</div>" +
                        "</div>");
            }

            $(".mejs-settings-menu", controls).css("overflow", "hidden");
            var newDiv = $(".mejs-settings-menu", controls).clone().css({"height": "auto", "visibility" : "hidden"});
            var maxH = layers.parents(".mejs-container").height() - $(controls).height() -35;
            $(".mejs-settings-menu", controls).after(newDiv);
            var h = Math.min(maxH,newDiv.height()) ;
            newDiv.remove();
            $(".mejs-settings-menu", controls).css({
                "width": "225px",
                "height": h +5+ "px"
             })
            setTimeout(function(){
                $(".mejs-settings-menu", controls).css("overflow", "auto");
            }, 310)

            $(".mejs-settings-menu-item-toggle-checkbox", controls).on("click", function(e){
                e.preventDefault();
                e.stopPropagation();
                var activate = false;
                var parent = $(this).parents(".mejs-settings-menu-item");
                if(parent.attr("data-checked") == 'true'){
                    parent.attr("data-checked", 'false')
                } else {
                    parent.attr("data-checked", 'true');
                    activate = true;
                }
                var action = parent.attr("data-action");
                if(action == "chapters"){
                    if(activate){
                        layers.addClass("mejs-show-chapters");
                        controls.find(".mejs-chapters-button").removeClass("mejs-chapters-off");
                    } else {
                        layers.removeClass("mejs-show-chapters");
                        controls.find(".mejs-chapters-button").addClass("mejs-chapters-off");
                    }
                }

            })

            $(".mejs-settings-menu-item[data-action='chromecast']").on("click", function(e){
                e.preventDefault();
                e.stopPropagation();
                controls.find(".mejs-player-chrome-cast-button").trigger("click");
            })

            $('[data-haspopup="true"]').on("click", function(e){
                e.preventDefault();
                e.stopPropagation();
                controls.addClass("ze-active-controls");
                if($(this).attr("data-action") == "speed"){
                    t.createSpeedMenu(player, controls, layers, media);
                } else if($(this).attr("data-action") == "subtitle"){
                   t.createSubtitleMenu(player, controls, layers, media);
                } else if($(this).attr("data-action") == "quality"){
                    t.createQualityMenu(player, controls, layers, media);
                } else if($(this).attr("data-action") == "keyboard") {
                    t.createKeyboardMenu(player, controls, layers, media)
                } else if($(this).attr("data-action") == "audios") {
                    t.createAudiosMenu(player, controls, layers, media)
                }
            })
        },

        createCategoryMenu: function(title, html, player, controls, layers, media){
            var t = this;
            var header = '<div class="mejs-settings-header">' +
                            '<div class="mejs-settings-panel-title mejs-settings-panel-btn ' + (title == 'Playback Speed' ? 'mejs-settings-panel-title--playback' : '') + '">' + title + '</div>' +
                         '</div>';          

            $(".mejs-settings-panel", controls).empty();
            $(".mejs-settings-panel", controls).append(header);
            $(".mejs-settings-panel", controls).append("<div class='mejs-settings-panel-menu'></div>");
            $(".mejs-settings-panel-menu", controls).append(html);

            $(".mejs-settings-panel-title", controls).on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                if(title.toLowerCase() == "Font Size"){
                    t.createSubtitleMenu(player, controls, layers, media);
                } else{
                    t.createMenu(player, controls, layers, media);
                }

            });

            $(".mejs-settings-panel-fonts", controls).on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                t.createFontsMenu(player, controls, layers, media);
            });

        },

        createSpeedMenu: function(player, controls, layers, media){
            var t = this;
            if (t.media.pluginType == 'native') {
                var speedButton = null,
                speedSelector = null,
                playbackSpeed = null;

                var speeds = [];
                var defaultInArray = false;
                var currentSpeed = media.playbackRate.toFixed(2);
                for (var i=0, len=t.options.speeds.length; i < len; i++) {
                    var s = t.options.speeds[i];
                    if (typeof(s) === 'string'){
                        var sn = s !== "1.00" ? s + t.options.speedChar: "normal";
                        speeds.push({
                                name: sn,
                                value: s
                        });
                        if(s === currentSpeed) {
                                defaultInArray = true;
                        }
                    }
                    else {
                        speeds.push(s);
                        if(s.value === currentSpeed) {
                                defaultInArray = true;
                        }
                    }
                }

                if (!defaultInArray) {
                    var sn = s !== "1.00" ? s + t.options.speedChar: "normal";
                    speeds.push({
                            name: sn,
                            value: currentSpeed
                    });
                }
                speeds.sort(function(a, b) {
                        return parseFloat(b.value) - parseFloat(a.value);
                });

                var html = "";
                for (var i = 0, il = speeds.length; i<il; i++) {
                        html += '<div class="mejs-settings-menu-item mejs-settings-menu-item-list" data-value="' + speeds[i].value + '" ' + (speeds[i].value === currentSpeed ? 'data-checked="true"' : 'data-checked="false"') +'>' +
                                        '<div class="mejs-settings-menu-item-label" >' +  speeds[i].name.charAt(0).toUpperCase() + speeds[i].name.slice(1)  + '</div>' +
                                '</div>';
                }
                t.createCategoryMenu("Playback Speed", html, player, controls, layers, media);
                $(".mejs-settings-menu-item", controls).on('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    var newSpeed = $(this).attr('data-value');
                    playbackSpeed = newSpeed;
                    media.playbackRate = parseFloat(newSpeed);
                    $('.mejs-settings-menu-item-list', controls).attr('data-checked', 'false');
                    $(this).attr('data-checked', 'true');
                    t.createMenu(player, controls, layers, media);
                });
                $(".mejs-settings-menu", controls).css("overflow", "hidden");
                var newDiv = $(".mejs-settings-menu", controls).clone().css({"height": "auto", "visibility" : "hidden"});
                var maxH = layers.parents(".mejs-container").height() - $(controls).height() -35;
                $(".mejs-settings-menu", controls).after(newDiv);
                var h = Math.min(maxH,newDiv.height()) + 10 +'px' ;
                if($(".mejs-settings-menu", controls).eq(1).outerHeight(true) < player.container.height() - 35){
                    h = 'auto'
                }
                newDiv.remove();
                $(".mejs-settings-menu", controls).css({
                    "width": "122px",
                    "height": h ,
                    // "max-height": maxH
                 })
                setTimeout(function(){
                    $(".mejs-settings-menu", controls).css("overflow", "auto");
                }, 310)
            }
	    },
        createSubtitleMenu: function(player, controls, layers, media){
            
            var t = this;
            if (player.tracks.length === 0)
		    return;
            var subtitles = [];
            var subtitleListWrap = $(".mejs-captions-selector li", controls);
            for (var i=0; i<player.tracks.length; i++) {
                var kind = player.tracks[i].kind;
                if (kind === 'subtitles' || kind === 'captions') {
                    var radio = subtitleListWrap.find("input[type='radio'][value='" + player.tracks[i].srclang + "']");
                    if(radio.parent("li").hasClass("track-current"))
                        subtitles.push(player.tracks[i])
                }
            }
            if (subtitles.length === 0) {
                $('mejs-chapters-button--new').addClass('cp-hide')
                return;
            }
            $('mejs-chapters-button--new').removeClass('cp-hide')
            var html = "";
            for (var i = 0, il = subtitles.length; i<il; i++) {
                    html += '<div class="mejs-settings-menu-item mejs-settings-menu-item-list" data-value="' + subtitles[i].srclang + '" ' + (t.selectedTrack && t.selectedTrack.srclang == subtitles[i].srclang ? 'data-checked="true"' : 'data-checked="false"') +'>' +
                                    '<div class="mejs-settings-menu-item-label" >' + (subtitles[i].label || cincopa_mejs.language.codes[subtitles[i].srclang] || subtitles[i].srclang) + '</div>' +
                            '</div>';
            }
            html += '<div class="mejs-settings-menu-item mejs-settings-menu-item-list" data-value="none" ' + (t.selectedTrack === null ? 'data-checked="true"' : 'data-checked="false"') +'>' +
                        '<div class="mejs-settings-menu-item-label" >' + cincopa_mejs.i18n.t('mejs.none') + '</div>' +
                    '</div>';
            
            if(typeof $.cookie == 'undefined'){
                return;
            }

            html += "<div class='mejs-captions-fontsize'><span class='mejs-size-text'>font size</span><p class='mejs-increase-size'>+</p><p class='mejs-decrease-size'>&#8211;</p></div>";

            t.createCategoryMenu("Subtitles", html, player, controls, layers, media);
            
           
            var subtitleFontSizeStep ;

            if(!$(".mejs-captions-list",player.container).length){
                $(".mejs-captions-selector ul",player.container).wrap("<p class='mejs-captions-list'>")
            }

            $(".mejs-captions-selector ul li:first-child",player.container).appendTo($(".mejs-captions-selector ul" ));
            $(".mejs-captions-selector",player.container).append("<div class='mejs-captions-fontsize'><span class='mejs-size-text'>font size</span><p class='mejs-increase-size'>+</p><p class='mejs-decrease-size'>&#8211;</p></div>");

            if($.cookie('cincopavideoSubtitleFontSizeV2')){
                subtitleFontSizeStep = $.cookie('cincopavideoSubtitleFontSizeV2');
                adjustSubtitleSize();
            } else {
                subtitleFontSizeStep = 2;
                $.cookie('cincopavideoSubtitleFontSizeV2', 2);
                adjustSubtitleSize();
            }
            $(".mejs-captions-fontsize p",player.container).off("click").on("click", function(){
                if($(this).hasClass("mejs-increase-size") && subtitleFontSizeStep < 5 ){
                    subtitleFontSizeStep ++;
                    $.cookie('cincopavideoSubtitleFontSizeV2', subtitleFontSizeStep);
                    adjustSubtitleSize();
                } else if ($(this).hasClass("mejs-decrease-size") && subtitleFontSizeStep > 0){
                    subtitleFontSizeStep --;
                    $.cookie('cincopavideoSubtitleFontSizeV2', subtitleFontSizeStep);
                    adjustSubtitleSize();
                }
                return false;
            });

            function adjustSubtitleSize (){
                var width =  $(player.container).width();
                var fontSizes = [50 , 75, 100 , 150 , 200 , 300];
                var unit = 2.45;
                
                var fontSize;
                var normal_size =  (unit * width / 100 );
                if(subtitleFontSizeStep == 2){
                    fontSize = normal_size;
                } else if (subtitleFontSizeStep < 2){
                    fontSize = normal_size - (normal_size * (1 - fontSizes[subtitleFontSizeStep]/200))
                } else {
                    fontSize = normal_size *(1 + fontSizes[subtitleFontSizeStep] / 400)
                }
                if(fontSize < 16){
                    $(".mejs-captions-layer",player.container).addClass('mejs-captions-text--small');
                }else{                    
                    $(".mejs-captions-layer",player.container).removeClass('mejs-captions-text--small');
                }
                $(".mejs-captions-text",player.container).css("font-size", fontSize+"px");
            }


            $(".mejs-settings-menu-item", controls).on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                var lang = $(this).attr('data-value');
                $("input[type=radio][value='" + lang + "']", controls).trigger("click");
                //player.setTrack(lang);
                if(t.selectedTrack){
                    $.cookie('cincopavideoTrack', t.selectedTrack.srclang );
                } else {
                    $.cookie('cincopavideoTrack', null);
                }
                if(lang == 'none'){
                    $('.mejs-chapters-button--new', controls).removeClass('mejs-chapters-button--active')
                }
                $('.mejs-settings-menu-item-list', controls).attr('data-checked', 'false');
                $(this).attr('data-checked', 'true');
                t.createMenu(player, controls, layers, media);
            });

            $(".mejs-settings-menu", controls).css("overflow", "hidden");
            var newDiv = $(".mejs-settings-menu", controls).clone().css({"height": "auto", "visibility" : "hidden"});
            var maxH = layers.parents(".mejs-container").height() - $(controls).height() -35;
            $(".mejs-settings-menu", controls).after(newDiv);
            var h = Math.min(maxH,newDiv.height()) ;
            newDiv.remove();
            $(".mejs-settings-menu", controls).css({
                "width": "180px",
                "height": h + "px"
             })
            setTimeout(function(){
                $(".mejs-settings-menu", controls).css("overflow", "auto");
            }, 310)

        },
        
        createAudiosMenu: function(player, controls, layers, media){
            var that = this;
            var item = getItem();           
            if (item && item['extra_files']) {
                var getAudioData = item['extra_files'].filter(function(el) {
                    return (el.type.indexOf('audio_') > -1);
                });
            };
            
            if(!getAudioData || !getAudioData.length) return;
            
            var html = '';
            var currentAudioTrackLabel = 'original';
            if(this.customAudioTrack){
                currentAudioTrackLabel = this.customAudioTrack.label;
            }
            for (var i = 0; i < getAudioData.length; i++) {
                    var _label = getAudioData[i].type.replace('audio_', '');
                    var label = _label[0].toUpperCase() + _label.slice(1);
                    html += '<div class="mejs-settings-menu-item mejs-settings-menu-item-list mejs-settings-menu-item--audio" data-label="' + label + '" data-url="' + getAudioData[i].url + '" ' + 
                                (getAudioData[i].type.toLowerCase() === 'audio_' + currentAudioTrackLabel.toLowerCase() ? 'data-checked="true"' : 'data-checked="false"') +'>' +
                                '<div class="mejs-settings-menu-item-label" >' + label + '</div>' +
                            '</div>';
                    };
                    html += '<div class="mejs-settings-menu-item mejs-settings-menu-item-list mejs-settings-menu-item--audio" data-label="original" data-url="" ' + (currentAudioTrackLabel === 'original' ? 'data-checked="true"' : 'data-checked="false"') +'>' +
                                '<div class="mejs-settings-menu-item-label" >Original</div>' +
                            '</div>';


            this.createCategoryMenu("Audios", html, player, controls, layers, media);
           
            $(".mejs-settings-menu-item--audio", controls).on('click', function(e) {                
                var oldVolume;
                var label = $(this).data('label');
                that.customAudioTrack =  that.customAudioTrack || {
                    audio: new Audio(),
                    label,
                };
                try{
                    audioPause();
                }catch(ex){
                    console.log(ex)
                }
               
                that.customAudioTrack.label = label;
                if(that.customAudioTrack && that.customAudioTrack.audio){
                    that.customAudioTrack.audio.src = $(this).data('url');
                }
                if(label == 'original'){
                    media.volume = oldVolume || 1;
                    delete that.customAudioTrack; //to prevent customAudio volumechange event influence, for dominanting media's volumechange event, because here's happening media's volumechange event which we need to implement
                }else{
                    oldVolume = that.customAudioTrack.audio.volume;
                    that.customAudioTrack.audio.currentTime  = player.options.skinObject.go.playerAPI.currentTime();
                    if(!media.paused){
                       audioPlay();
                    };
                    media.setVolume(oldVolume);
                   
                    $('.mejs-volume-slider', controls).on('click', function(evt) {
                        evt.stopPropagation();   
                    });                 
                };

                if(that.customAudioTrack && that.customAudioTrack.audio){
                    that.customAudioTrack.audio.cincopaAddEventListener('ended',function(){
                        audioPause();
                    });
                    that.customAudioTrack.audio.cincopaAddEventListener('play',function(){
                        audioPlay();
                    });
                };          
            });

            media.setVolume = function(val){
                if (that.customAudioTrack && that.customAudioTrack.audio) {
                    if (!Number.isNaN(val)) {
                        that.customAudioTrack.audio.volume = val;
                        media.volume =  0;
                    }
                    }else{
                        media.volume = val;
                    };
                    return false;
            };           
                                 
            media.cincopaAddEventListener('play',function() {
                try{
                    if (that.customAudioTrack && that.customAudioTrack.audio) {
                       audioPlay();
                    }
                }catch(er){
                    console.log(er);
                };
            });


            media.cincopaAddEventListener('volumechange',function(e) {
                var volumeButton = zeQuery('.mejs-volume-button', controls);
                var volume = 0;
                if(that.customAudioTrack && that.customAudioTrack.audio){
                    if(volumeButton.hasClass('mejs-unmute')){
                        if (!media.paused) {
                            positionVolumeHandle(volume); 
                            audioPause();
                        }
                    }else if(volumeButton.hasClass('mejs-mute')){
                        volume = that.customAudioTrack.audio.volume;
                        if (!media.paused) {
                            positionVolumeHandle(volume);    
                            audioPlay();
                        }
                    }                              
                };
            });

            media.cincopaAddEventListener('pause', function () {
                try{
                    if (that.customAudioTrack && that.customAudioTrack.audio) {
                       audioPause();
                    }
                }catch(er) {
                     console.log(er);
                }
            });

            media.cincopaAddEventListener('seeked',function() {
                var currentTime = media.currentTime;
                var mediaDuration = media.duration;
                try{
                    if (that.customAudioTrack && that.customAudioTrack.audio) {
                        that.customAudioTrack.audio.currentTime = currentTime;  
                        var audioDuration = that.customAudioTrack.audio.duration;
                        if(currentTime <= audioDuration || audioDuration < mediaDuration){
                            audioPlay(currentTime);
                        }else{
                            audioPause();
                        }
                    }                    
                }catch(er){
                    console.log(er);
                }
            });            
            
            media.cincopaAddEventListener('ended', function() {
                try{
                    if(that.customAudioTrack && that.customAudioTrack.audio){
                        that.customAudioTrack.audio.currentTime = 0; 
                    }
                }catch(er){
                    console.log(er);
                };
            });

            function getItem() {
                var current_url;
                if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                   current_url = media.src;
                }else{
                   current_url = $(media).data(player.options.dataCollector);
                }                        
                var currentData = player.options.skinObject.sendDataCollector(current_url || 0);
                return currentData.item;
            };

            function audioPlay(currentTime) {
                currentTime = currentTime || '';
                that.customAudioTrack.audio.play(currentTime);
            };

            function audioPause() {
                that.customAudioTrack.audio.pause();
            };
            
            function positionVolumeHandle(volume, secondTry) {
                var volumeSlider = player.container.find('.mejs-volume-slider', controls);
                var volumeCurrent = player.container.find('.mejs-volume-current', controls);
                var volumeTotal = player.container.find('.mejs-volume-total', controls);
                var volumeHandle = player.container.find('.mejs-volume-handle', controls);
                var mute = player.container.find('.mejs-volume-button', controls);
                var mode = (that.isVideo) ? that.options.videoVolume : that.options.audioVolume;

                if (!volumeSlider.is(':visible') && typeof secondTry == 'undefined') {
                    volumeSlider.show();
                    positionVolumeHandle(volume, true);
                    volumeSlider.hide();
                    controls.removeClass('volume-button-hover');
                    return;
                };

                // correct to 0-1
                volume = Math.max(0, volume);
                volume = Math.min(volume, 1);

                // adjust mute button style
                if (volume === 0) {
                    mute.removeClass('mejs-mute').addClass('mejs-unmute');
                    mute.children('button').attr('title', cincopa_mejs.i18n.t('mejs.unmute')).attr('aria-label', cincopa_mejs.i18n.t('mejs.unmute'));
                } else {
                    mute.removeClass('mejs-unmute').addClass('mejs-mute');
                    mute.children('button').attr('title', cincopa_mejs.i18n.t('mejs.mute')).attr('aria-label', cincopa_mejs.i18n.t('mejs.mute'));
                };

                // top/left of full size volume slider background
                var totalPosition = volumeTotal.position();
                // position slider
                if (mode == 'vertical') {
                    var
                        // height of the full size volume slider background
                        totalHeight = volumeTotal.height(),

                        // the new top position based on the current volume
                        // 70% volume on 100px height == top:30px
                        newTop = totalHeight - (totalHeight * volume);

                    // handle
                    volumeHandle.css('top', Math.round(totalPosition.top + newTop - (volumeHandle.height() / 2)));

                    // show the current visibility
                    volumeCurrent.height(totalHeight - newTop);
                    volumeCurrent.css('top', totalPosition.top + newTop);
                    } else {
                        var
                            // height of the full size volume slider background
                            totalWidth = volumeTotal.width(),

                            // the new left position based on the current volume
                            newLeft = totalWidth * volume;

                        // handle
                        volumeHandle.css('left', Math.round(totalPosition.left + newLeft - (volumeHandle.width() / 2)));

                        // rezize the current part of the volume bar
                        volumeCurrent.width(Math.round(newLeft));
                    }
                };
            },
        createFontsMenu: function(player, controls, layers, media){
            var t = this;
            var currentFontSize = player.options.skinObject.subtitleFontSizeStep || 2;
            var fonts = [50 , 75, 100 , 150 , 200 , 300];

            var html = "";
            for (var i = 0, il = fonts.length; i<il; i++) {
                    html += '<div class="mejs-settings-menu-item mejs-settings-menu-item-list" data-value="' + i + '" ' + (currentFontSize == i ? 'data-checked="true"' : 'data-checked="false"') +'>' +
                                '<div class="mejs-settings-menu-item-label" >' + fonts[i] + "%" + '</div>' +
                        '</div>';
            }

            t.createCategoryMenu("Font size", html, player, controls, layers, media);


            $(".mejs-settings-menu-item", controls).on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                var step = parseInt($(this).attr('data-value'));
                $.cookie('cincopavideoSubtitleFontSizeV2', step );
                player.options.skinObject.subtitleFontSizeStep = step;
                player.options.skinObject.adjustSubtitleSize();
                $('.mejs-settings-menu-item-list', controls).attr('data-checked', 'false');
                $(this).attr('data-checked', 'true');


                t.createMenu(player, controls, layers, media);
            });

            $(".mejs-settings-menu", controls).css("overflow", "hidden");
            var newDiv = $(".mejs-settings-menu", controls).clone().css({"height": "auto", "visibility" : "hidden"});
            var maxH = layers.parents(".mejs-container").height() - $(controls).height() -35;
            $(".mejs-settings-menu", controls).after(newDiv);
            var h = Math.min(maxH,newDiv.height()) ;
            newDiv.remove();
            $(".mejs-settings-menu", controls).css({
                "width": "122px",
                "height": h + "px"
             })
            setTimeout(function(){
                $(".mejs-settings-menu", controls).css("overflow", "auto");
            }, 310)
        },

        createQualityMenu: function(player, controls, layers, media){         
            var t = this;
            var hlsObj = $(media).data('hls');
            var current_url;
             if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                current_url = media.src;
            }else{
                current_url = $(media).data(player.options.dataCollector);
            }

            var currentData = player.options.skinObject.sendDataCollector(current_url || 0)
            var m3u8Arr = t.createM3u8Arr(currentData.item)
            if (t.media.pluginType == 'native') {
                var versions = [];
                var hlsObj = $(media).data("hls");

                if(player.options.skinObject.go.args.enable_hls && !t.isHlsSupported(player.options.skinObject.go.args.enable_hls) && t.isNativeHls()){
                    for(var i = 0, il = m3u8Arr.length ; i < il; i++){
                        versions.push({
                            name: m3u8Arr[i].display_name,
                            value: i
                        })
                    }
                }else{
                    if(!hlsObj || !hlsObj.levels || !hlsObj.levels.length) return;
                    for(var i = 0, il = hlsObj.levels.length ; i < il; i++){
                        versions.push({
                            name: hlsObj.levels[i].name || hlsObj.levels[i].height+'p'  ,
                            value: i
                        })
                    }
                }
                versions.sort(function(a, b) {
                    return parseFloat(b.name) - parseFloat(a.name);
                });

                versions.push({name: "auto" , value: "auto"});
                var currentVersion = "auto";
                if(hlsObj && hlsObj.disableResize){
                    currentVersion = hlsObj.currentLevel;
                }else if(player.options.skinObject.nativeHls && player.options.skinObject.nativeHls[player.id]){
                    currentVersion = player.options.skinObject.nativeHls[player.id];
                }
                var html = "",versionName;
                for (var i = 0, il = versions.length; i<il; i++) {
                    versionName = versions[i].name
                    
                if(versionName == "720p" || versionName == "1080p" || versionName == "1440p"){
                    versionName += " <sup class='mejs-settings-menu-item-label-hd'>HD</sup>"
                }else if(versionName == "2160p"){
                    versionName += " <sup class='mejs-settings-menu-item-label-hd'>4K</sup>"
                }
                html += '<div class="mejs-settings-menu-item mejs-settings-menu-item-list" data-value="' + versions[i].value + '" ' + (currentVersion == versions[i].value ? 'data-checked="true"' : 'data-checked="false"') +'>' +
                            '<div class="mejs-settings-menu-item-label" ><span>'  + versionName + '</span></div>' +
                        '</div>';
                }
                t.createCategoryMenu("Quality", html, player, controls, layers, media);

                $(".mejs-settings-menu-item", controls).on('click', function(e) {
                    // e.preventDefault();
                    // e.stopPropagation();
                    var newVersion = $(this).attr('data-value');
                    t.switchVersion(player, newVersion,media);
                    $('.mejs-settings-menu-item-list', controls).attr('data-checked', 'false');
                    $(this).attr('data-checked', 'true');
                    if(newVersion != "auto"){
                        t.createMenu(player, controls, layers, media, {
                            version: newVersion
                        });
                    } else {
                        var h = player.$media.height();
                        var level = player.options.skinObject.getHlsLevel(h);
                        t.createMenu(player, controls, layers, media, {
                            level: level
                        });
                    }

                });

                $(".mejs-settings-menu", controls).css("overflow", "hidden");
                var newDiv = $(".mejs-settings-menu", controls).clone().css({"height": "auto", "visibility" : "hidden"});
                var maxH = layers.parents(".mejs-container").height() - $(controls).height() -35;
                $(".mejs-settings-menu", controls).after(newDiv);
                var h = Math.min(maxH,newDiv.height()) + 5 ;
                newDiv.remove();1
                $(".mejs-settings-menu", controls).css({
                    "width": "122px",
                    "height": h + "px"
                 })
                setTimeout(function(){
                    $(".mejs-settings-menu", controls).css("overflow", "auto");
                }, 310)
            }

        },

        createKeyboardMenu: function(player, controls, layers, media) {
            var t = this;

            var keyboardObj = {
                '&#8594;': 'Forward',
                '&#8592;': 'Backward',
                '&#8593;': 'Volume up',
                '&#8595;': 'Volume down',
                'space': 'Play/Pause',
                'm': 'Volume/Mute',
                'f': 'Full Screen',
            }

            var html = '';
            for (var prop in keyboardObj) {
                html += '<div class="mejs-settings-menu-item mejs-settings-menu-item-list" data-value="' + '222' + '" ' + ('33' == '44' ? 'data-checked="true"' : 'data-checked="false"') +'>' +
                    '<div class="mejs-settings-menu-item-label" >' + prop + '</div>' +
                    '<div class="mejs-settings-menu-item-content" >' + keyboardObj[prop] + '</div>' +
                '</div>';
            }
           
            t.createCategoryMenu("keyboard", html, player, controls, layers, media);

            $(".mejs-settings-menu", controls).css("overflow", "hidden");
                var newDiv = $(".mejs-settings-menu", controls).clone().css({"height": "auto", "visibility" : "hidden"});
                var maxH = layers.parents(".mejs-container").height() - $(controls).height() -35;
                $(".mejs-settings-menu", controls).after(newDiv);
                var h = Math.min(maxH,newDiv.height()) + 10 +'px' ;
                if($(".mejs-settings-menu", controls).eq(1).outerHeight(true) < player.container.height() - 35){
                    h = 'auto'
                }
                newDiv.remove();
                $(".mejs-settings-menu", controls).css({
                    "width": "200px",
                    "height": h ,
                    // "max-height": maxH
                 })
                setTimeout(function(){
                    $(".mejs-settings-menu", controls).css("overflow", "auto");
                }, 310)
        },

        switchVersion: function (player, version,media) {
            var t = this
            var current_url;
             if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                current_url = media.src;
            }else{
                current_url = $(media).data(player.options.dataCollector);
            }
            var currentData = player.options.skinObject.sendDataCollector(current_url || 0)
            var m3u8Arr = t.createM3u8Arr(currentData.item)
            var hlsObj = $(media).data('hls')
            var level;
            if(version != 'auto'){
                version = parseInt(version);
            }
            if(player.options.skinObject.go.args.enable_hls && !t.isHlsSupported(player.options.skinObject.go.args.enable_hls) && t.isNativeHls()){
                var mediaelement = player.options.skinObject.player.$media[0];
                var currentTime = player.options.skinObject.go.playerAPI.currentTime();
                var dataURI;
                if(version == 'auto'){
                    dataURI =  player.options.skinObject.masterM3u8DataUri(m3u8Arr);
                }else{
                    dataURI = m3u8Arr[version].url;
                }
                mediaelement.setSrc(dataURI);
                mediaelement.load();
                mediaelement.cincopaAddEventListener('loadeddata', function (e) {
                    player.options.skinObject.go.playerAPI.setCurrentTime(currentTime);
                    setTimeout(function(){
                        player.options.skinObject.go.playerAPI.play();
                    },100);                   
                });

                if(version != 'auto'){
                    $.cookie('cincopavideoQuality', m3u8Arr[version].display_name);
                }else{
                    $.cookie('cincopavideoQuality', 'auto');
                }
                
                if(typeof player.options.skinObject.nativeHls == 'undefined'){
                    player.options.skinObject.nativeHls = {}
                }
                player.options.skinObject.nativeHls[player.id] = version

                
                return;
            }else if(version != "auto"){
                hlsObj.disableResize = true;
                $(media).data('hls', hlsObj );
                level = version;
            }else {
                var h = player.$media.height();
                hlsObj.disableResize = false;
                $(media).data('hls', hlsObj );
                level = (player.options.skinObject.getHlsLevel(h) != false ? player.options.skinObject.getHlsLevel(h) : -1);
            }

            if(hlsObj.loadLevel != level){
                hlsObj.nextLevel = level;               
                hlsObj.MediaJSON.version = hlsObj.levelController.levels[level];
                player.options.skinObject.go.onSkinEvent('video.change', hlsObj.MediaJSON );
            }
            if(version != "auto"){
                $.cookie('cincopavideoQuality', hlsObj.MediaJSON.version.name || hlsObj.MediaJSON.version.height + 'p');
            } else {
                $.cookie('cincopavideoQuality', "auto");
            }
        },

        showhidegear: function (player, controls, layers,media) {


            var t = this;
            var current_url;
            if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                current_url = media.src;
            }else{
                current_url = $(media).data(player.options.dataCollector);
            }
            
            var currentData = player.options.skinObject.sendDataCollector(current_url || 0)
            var m3u8Arr = t.createM3u8Arr(currentData.item)

            var hlsObj = $(media).data('hls')

            var buttonsCount = 0;
            /* caption option enable/disable */
            var isChapters = false;
            if(player.options.skinObject.go.args.chapter && parseInt($(".mejs-chapters-wrap", layers).attr("data-chaptersCount")) > 0 && layers.parents(".mediaElement").find(".ze_tl_block").is(":hidden") && controls.find(".mejs-chapters-button").hasClass("mejs-force-hidden-button")){
                isChapters = true;
                buttonsCount++;
            }

            /* chromecast option enable/disable */
            var isChromecast = false;
            if(player.options.skinObject.chromecastExist && controls.find(".mejs-player-chrome-cast-button").hasClass("mejs-force-hidden-button")){
                isChromecast = true;
                buttonsCount++;
            }

            /* speed option enable/disable */
            var isSpeed = false
            if(player.options.skinObject.go.args.speed){
                isSpeed = true;
                buttonsCount++;
            }

            /* subtitle option enable/disable */
            var isSubtitle = false;
            if(player.options.skinObject.go.args.subtitle && player.tracks.length > 0 && $(".mejs-captions-selector li.track-current", controls).length > 0){
                isSubtitle = true;
                buttonsCount++;
            }

            /* quality option enable/disable */
            var isQuality = false;


            if(hlsObj && hlsObj.levelController.levels && hlsObj.levelController.levels.length > 0 || 
                (player.options.skinObject.go.args.enable_hls  && !t.isHlsSupported(player.options.skinObject.go.args.enable_hls) 
                && t.isNativeHls() && m3u8Arr.length > 0)
                ){
                isQuality = true;
                buttonsCount++;
            }
            if(buttonsCount == 0){
                $(".mejs-gear-button", controls).addClass("mejs-gear-button-hidden");
            } else {
                $(".mejs-gear-button", controls).removeClass("mejs-gear-button-hidden");
            }

        },


        buildcaptions_size: function (player, controls, layers, media) {


            if(typeof $.cookie == 'undefined'){
                return;
            }
            var subtitleFontSizeStep ;

            if(!$(".mejs-captions-list",player.container).length){
                $(".mejs-captions-selector ul",player.container).wrap("<p class='mejs-captions-list'>")
            }

            $(".mejs-captions-selector ul li:first-child",player.container).appendTo($(".mejs-captions-selector ul" ));
            $(".mejs-captions-selector",player.container).append("<div class='mejs-captions-fontsize'><span class='mejs-size-text'>font size</span><p class='mejs-increase-size'>+</p><p class='mejs-decrease-size'>&#8211;</p></div>");

            if($.cookie('cincopavideoSubtitleFontSizeV2')){
                subtitleFontSizeStep = $.cookie('cincopavideoSubtitleFontSizeV2');
                adjustSubtitleSize();
            } else {
                subtitleFontSizeStep = 2;
                $.cookie('cincopavideoSubtitleFontSizeV2', 2);
                adjustSubtitleSize();
            }
            $(".mejs-captions-fontsize p",player.container).off("click").on("click", function(){
                if($(this).hasClass("mejs-increase-size") && subtitleFontSizeStep < 5 ){
                    subtitleFontSizeStep ++;
                    $.cookie('cincopavideoSubtitleFontSizeV2', subtitleFontSizeStep);
                    adjustSubtitleSize();
                } else if ($(this).hasClass("mejs-decrease-size") && subtitleFontSizeStep > 0){
                    subtitleFontSizeStep --;
                    $.cookie('cincopavideoSubtitleFontSizeV2', subtitleFontSizeStep);
                    adjustSubtitleSize();
                }
            });



            function adjustSubtitleSize (){
                var width =  $(player.container).width();
                var fontSizes = [50 , 75, 100 , 150 , 200 , 300];
                var unit = 2.45;
                
                var fontSize;
                var normal_size =  (unit * width / 100 );
                if(subtitleFontSizeStep == 2){
                    fontSize = normal_size;
                } else if (subtitleFontSizeStep < 2){
                    fontSize = normal_size - (normal_size * (1 - fontSizes[subtitleFontSizeStep]/200))
                } else {
                    fontSize = normal_size *(1 + fontSizes[subtitleFontSizeStep] / 400)
                }
                if(fontSize < 16){
                    $(".mejs-captions-layer",player.container).addClass('mejs-captions-text--small');
                }else{                    
                    $(".mejs-captions-layer",player.container).removeClass('mejs-captions-text--small');
                }
                $(".mejs-captions-text",player.container).css("font-size", fontSize+"px");
            }

            var winSelector,resizeTimer;
            if (player.options.skinObject.go.args.iframe) {
                winSelector = parent.window;
            } else {
                winSelector = window;
            }

            if(!!navigator.userAgent.match(' Safari/') && !navigator.userAgent.match(' Chrom') && !!navigator.userAgent.match(' Version/5.')){
                winSelector = window;
            }
            $(winSelector).on('resize.mediaelement.'+player.options.galleryId, function () {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function () {
                    adjustSubtitleSize();
                }, 100);
            });
        }
    })
})(zeQuery);

/* search in captions */
(function ($) {

    $.extend(CincopaMediaElementPlayer.prototype, {
        // LOOP TOGGLE
        buildtranscript_search: function (player, controls, layers, media) {
            var t = this;
            var isVisible = false;
            t.container.addClass("mejs-transcript-search-container");
            var layer = $("<div>").addClass("mejs-layer mejs-transcript-search-overlay");
            var content = $("<div>").addClass("mejs-transcript-search-content");
            var header = $("<div>").addClass("mejs-transcript-search-header");
            var input = $("<input type='text'>").addClass("mejs-transcript-search-input");
            var list = $("<ul>").addClass("mejs-transcript-search-list");
            var ignoreNextScrollEvent = false;
            var preventAutoScrool = false;
            var timer = null;

            var header_actions = $("<div>").addClass("mejs-transcript-search-header-actions");
            header_actions.html("<span class='mejs-transcript-search-header-actions-counter'>0 / 0</span><span class='mejs-transcript-search-header-actions-clear'></span>")
            input.appendTo(header);
            header_actions.appendTo(header);
            header_actions.hide();
            header.appendTo(content);
            list.appendTo(content);
            content.appendTo(layer);
            layer.appendTo(layers);

            var close = $("<div>").addClass("mejs-transcript-close");
            close.html("<i></i>")
            close.appendTo(header);

            close.on("click", function(){
                hide();
            });
			
			$(document).off('keyup.transcript_search');

            media.cincopaAddEventListener('loadedmetadata',function (e) {  
                if(layers.hasClass("mejs-transcript-search-overlay-active")){
                    hide()
                }
            })    
            $(document).on("mousedown."+player.options.galleryId,".mejs-captions-search-icon", function(e){
                
                show();
				$(document).on('keyup.transcript_search.'+player.options.galleryId,function(e) {			 
				  if (e.which === 27) {
					  close.click();
					  $(document).off('keyup.transcript_search');
				  }
				});
            })
            
            t.container.off().on("click",".mejs-captions-text", function(e){
                show();
				$(document).on('keyup.transcript_search.'+player.options.galleryId,function(e) {			 
				  if (e.which === 27) {
					  close.click();
					  $(document).off('keyup.transcript_search');
				  }
				});
            })

            header_actions.find(".mejs-transcript-search-header-actions-clear").on("click", function(){
                input.val("");
                header_actions.hide();
                input.trigger("input")
            })

            var keyupTimer;
			input.on("keyup", function(e){
				clearTimeout(keyupTimer)
				keyupTimer = setTimeout(function(){
					if(e.which === 13 && input.val()){
						var text = header_actions.find(".mejs-transcript-search-header-actions-counter").text();
						var splitted = text.split(" ");
						var order = splitted[0];
						var count = splitted[splitted.length - 1];
						order = +order;
						if(order >= count) order = 0;
						splitted[0] = order + 1;

						if(count > 0){
							header_actions.find(".mejs-transcript-search-header-actions-counter").text(splitted.join(" "));
							var c = 0;
							list.find(".mejs-transcript-search-list-highlighted").each(function(){
								var highlighted_count = +($(this).attr("data-highlighted") || 0);
								c += highlighted_count;
								if(c >= order + 1){
									var elem = $(this);
									scrollToElement(elem)
									preventAutoScrool = true;
									clearTimeout(timer);
									timer = setTimeout(function(){
										preventAutoScrool = false;
										scrollToActive()
									}, 10000);
									return false;
								}
							})

							
						}
					}
				},300);
            });

            var inputTimer;
			input.on("input", function(){
				clearTimeout(inputTimer);
				var that = this;
				inputTimer = setTimeout(function(){

					var value  = $(that).val().trim();
					if(value){
						header_actions.show()
					} else {
						header_actions.hide()
					}
					var items = list.find("p");
					var counter = 0;
					items.each(function(){
						var text = $(this).html();
						text = text.replace(/<\/?span[^>]*>/g,"");
						$(this).html(text);

						if(text.toLowerCase().indexOf(value.toLowerCase()) > -1){
							var occ_count = text.toLowerCase().split(value.toLowerCase()).length - 1;
							/* 	var occ = text.substr(text.toLowerCase().indexOf(value.toLowerCase()), value.length); */							
							text = text.replace(new RegExp(value, 'gi'), function(str) {return "<span class='mejs-transcript-search-list-highlight'>" + str + "</span>"});							
							//text = text.replace(new RegExp(value, 'gi'), "<span class='mejs-transcript-search-list-highlight'>" + occ + "</span>");
							$(this).html(text);
							$(this).parent().addClass("mejs-transcript-search-list-highlighted");
							$(this).parent().attr("data-highlighted", occ_count);						
							counter +=occ_count;
							
						} else {
							$(this).html(text);
							$(this).parent().removeClass("mejs-transcript-search-list-highlighted");
							$(this).parent().attr("data-highlighted", 0)
						}

						header_actions.find(".mejs-transcript-search-header-actions-counter").text("0 / " + counter);
					});
					if(counter){
						var e = zeQuery.Event("keyup");
						e.which = 13;
						input.trigger(e);						
					}
				},250);
            })

            input.on("keydown", function(e){
                e.stopImmediatePropagation();
            })

            list.on("click", "li", function(){
                var start = + $(this).attr("data-start");
                player.setCurrentTime(start);
                media.play()
            })

            list.on("scroll", function(){
                if(!ignoreNextScrollEvent){
                    preventAutoScrool = true;
                    clearTimeout(timer);
                    timer = setTimeout(function(){
                        preventAutoScrool = false;
                        scrollToActive()
                    }, 10000)
                }
            })
            var mouseEntered = false;

            t.container.on("mouseenter", function(){
                mouseEntered = true;
                resize(true)
            }).on("mouseleave", function(){
                mouseEntered = false;
                resize(false)
            })
            var resizeTimer = null;
            $(window).on("resize."+player.options.galleryId, function(){

                if(isVisible){
                    clearTimeout(resizeTimer)
                    resizeTimer = setTimeout(function(){
                        resize(mouseEntered);
                    }, 400)
                    
                }
                
            })

            function resize(entered) {
                if(entered){
                    var listHeight = t.container.height() - parseInt(content.css("padding-top")) - header.height() - parseInt(list.css("margin-top")) - controls.height();
                } else {
                    var listHeight = t.container.height() - parseInt(content.css("padding-top")) - header.height() - parseInt(list.css("margin-top"));
                }
                list.css("max-height", listHeight);
            }

            function show(){
                buildList();
                layers.addClass("mejs-transcript-search-overlay-active");
                isVisible = true;
                resize(true)
            }

            function hide(){
                layers.removeClass("mejs-transcript-search-overlay-active");
                isVisible = false;
            }

            function buildList(){
                var texts = [];
                var times = [];
                if(t.selectedTrack && t.selectedTrack.entries){
                    texts = t.selectedTrack.entries.text;
                    times = t.selectedTrack.entries.times;
                }


                var htm = "";
                for(var i = 0; i < texts.length; i++){
                    htm += "<li data-start='" + times[i].start + "' data-stop='" + times[i].stop + "'><p>" + texts[i] + "</p></li>";
                }

                list.empty();
                list.html(htm);
            }

            media.cincopaAddEventListener('timeupdate', function (e) {
                if(isVisible){
                    var time = media.currentTime;
                    var listItems = list.find("li");
                    listItems.each(function(){
                        var start = + $(this).attr("data-start") ;
                        var stop = + $(this).attr("data-stop") ;
                        if(start < time && time < stop){
                            if(!$(this).hasClass("mejs-transcript-search-list-active")){
                                $(this).addClass("mejs-transcript-search-list-active");
                                scrollToActive();
                            }
                        } else {
                            $(this).removeClass("mejs-transcript-search-list-active")
                        }
                    });
                }
                
            })

            function scrollToActive(){
                var active_item = list.find(".mejs-transcript-search-list-active");
                if(active_item.length){
                    var active_item_top = active_item.position().top;
                    if(!preventAutoScrool){
                        ignoreNextScrollEvent = true;
                        list.animate({
                            scrollTop: active_item_top + list.scrollTop()
                        }, 100, function() {
                            setTimeout(function(){
                                ignoreNextScrollEvent = false;
                            }, 100)
                        });
                    }
                }
            }

            function scrollToElement(elem){
                if(elem.length){
                    var top = elem.position().top;
                    ignoreNextScrollEvent = true;
                    list.animate({
                        scrollTop: top + list.scrollTop()
                    }, 100, function() {
                        setTimeout(function(){
                            ignoreNextScrollEvent = false;
                        }, 100)
                    });
                }
            }
        }
    })

})(zeQuery);


/* upnext */
(function ($) {

    $.extend(CincopaMediaElementPlayer.prototype, {
        buildupnext: function (player, controls, layers, media) {
            var layer = $("<div>").addClass("mejs-layer mejs-overlay mejs-layer-upnext");
            layer.appendTo(layers);
        
            media.cincopaAddEventListener('play', function (e) {
                var activePlaylistItem = layers.find('.mejs-playlist li.current');
                var next = activePlaylistItem.next();
                layer.find(".mejs-upnext-inner").remove();
                if(next.length){
                    var inner = $("<div>").addClass("mejs-upnext-inner");
                    var title = next.attr("title");
                    var thumbnail = next.attr("data-thumbnail");
                    inner.html("<span class='mejs-upnext-title'>" + title + "</span><div class='mejs-upnext-thumbnail-wrapper'><img class='mejs-upnext-thumbnail' src='" + thumbnail + "' alt='" + title+ "' /></div>")
                    inner.appendTo(layer);
                    inner.on("click", function(){
                        next.trigger("click");
                    })
                } 
            })

            media.cincopaAddEventListener('timeupdate', function (e) {
                var ct = ~~media.currentTime;
                var duration = e.target.duration;
                var precent = Math.round(duration * 5/100);
                precent = Math.min(precent, 10);
                if(precent < 2 && duration > 2){
                    precent = 2;
                }
                if(ct > duration - precent){
                    layer.show();
                } else {
                    layer.hide();
                }
            })
        }
    })

})(zeQuery);



/* storyboard plugin */
(function ($) {

    $.extend(CincopaMediaElementPlayer.prototype,{
        buildstoryboard: function (player,controls,layers,media) {
            var that = this;
            var isMobile = {
                Android: function () {
                    return navigator.userAgent.match(/Android/i);
                },
                BlackBerry: function () {
                    return navigator.userAgent.match(/BlackBerry/i);
                },
                iOS: function () {
                    return navigator.userAgent.match(/iPhone|iPad|iPod/i) || ((/iPad|iPhone|iPod/.test(navigator.platform) ||
                        (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) &&
                        !window.MSStream);
                },
                Opera: function () {
                    return navigator.userAgent.match(/Opera Mini/i);
                },
                Windows: function () {
                    return navigator.userAgent.match(/IEMobile/i) || navigator.userAgent.match(/WPDesktop/i);
                },
                any: function () {
                    return (this.Android() || this.BlackBerry() || this.iOS() || this.Opera() || this.Windows());
                }
            };

            var storyBoard_max_size = {
                'small':75,
                'medium':150
            }

            /* REQUIRED media must have data-index to allow get current item */
            var current_url;
             if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                current_url = media.src;
            }else{
                current_url = $(media).data(player.options.dataCollector);
            }

            var currentItem = player.options.skinObject.sendDataCollector(current_url || 0 ).item;
            
            if (!currentItem) {
                return;
            }

            var sb_arg = player.options.skinObject.go.args.storyboard;
            /* add storyboard class to gallery container */
            $('#' + player.options.galleryId).addClass('storyboard').addClass(sb_arg);
            $('body').addClass('cp_storyboard');

            /* append storyboard container */
            var timelineThumb = $('<div class="time-rail-thumbnails thumbnails-loading"><div  class="thumbImage preview" style="text-align: center;">Processing...</div></div>');
            $(controls).find('.mejs-time-rail').prepend(timelineThumb);

            //var thumbPreview = $(controls).find('.thumbImage.preview');
            var timelineThumbPreview = $(timelineThumb).find('.thumbImage.preview');

            media.cincopaAddEventListener('loadedmetadata',function (e) { 
              
                if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                    current_url = media.src;
                }else{
                    current_url = $(media).data(player.options.dataCollector);
                }

              currentItem = player.options.skinObject.sendDataCollector(current_url || 0 ).item;
              
              if (!currentItem) {
                  return;
              }
                
                /*  use current element ratio for corrections */
                var currentElementRatio = currentItem.aspect_ratio;
                var calcWidth = sb_arg == 'small' ? 100 : 200;
                var timelineThumbH = parseInt(calcWidth / currentElementRatio);

                var heightToCompare = storyBoard_max_size[sb_arg] ? storyBoard_max_size[sb_arg] : 150;
                timelineThumbH = Math.min(heightToCompare,timelineThumbH)

                if (currentElementRatio > 1) {
                    var diff = 0;
                    if (sb_arg == 'small') {
                        diff = (75 - timelineThumbH) / 2;

                    } else {
                        diff = (150 - timelineThumbH) / 2;
                    }
                    timelineThumbPreview.css({
                        'width': calcWidth,
                        'height': timelineThumbH + 'px',
                        'line-height': timelineThumbH + 'px'
                    });
                }else {
                    var diff = 0;
                    var calcHeight = sb_arg == 'small' ? 75 : 150;
                    var timelineThumbW = parseInt(calcHeight * currentElementRatio);
                    if (sb_arg == 'small') {
                        diff = (100 - timelineThumbW) / 2;
                    } else {
                        diff = (200 - timelineThumbW) / 2;
                    }
                    timelineThumbPreview.css({
                        'height': calcHeight,
                        'line-height': calcHeight + 'px',
                        'width': timelineThumbW + 'px'
                    });
                }
                timelineThumbPreview.attr('data-fix',diff);
                timelineThumbPreview.attr('data-ratio',currentElementRatio);

                var mejsTimeRail = $(controls).find('.mejs-time-rail');


                mejsTimeRail.find('.mejs-time-total').on('click',function () {
                    mejsTimeRail.find('.mejs-time-total').mouseenter();
                });
                mejsTimeRail.find('.mejs-time-total').on('mousemove touchmove',function (e) {
                    onMouseMove(e);
                });

                mejsTimeRail.find('.mejs-slider-unvisible').on('click',function (e) {
                    mejsTimeRail.find('.mejs-slider-unvisible-total').mouseenter();
                });
                mejsTimeRail.find('.mejs-slider-unvisible').on('mousemove touchmove',function (e) {
                    onMouseMove(e,'mejs-slider-unvisible');
                });


                mejsTimeRail.find('.mejs-time-total').mouseleave(function () {
                    $(controls).find('.time-rail-thumbnails').hide();
                    $(controls).removeClass('time-rail-thumbnails-visible');
                });


                $(player.container).parent().on("touchend", function(e){
                    var target = $(e.target);

                    /* to fix issue with sb on toch devices */
                    if( target.closest(".mejs-time-rail").length  && sb_arg != 'off') {
                        onMouseMove(e);
                    }
                
                });

                hoverHandler(timelineThumbPreview,sb_arg);

                var mouseX;
                function onMouseMove(e,selector) {                   
                    if (e) {
                        var duration = media.duration;
                        var frameK;
                        if (duration <= 120) {  // video duration < 2 min, frame for every sec
                            frameK = 1;
                        } else if (duration > 120 && duration <= 300) { // video 2min < duration < 5 min, frame for every 2 sec
                            frameK = 2;
                        } else if (duration > 300 && duration <= 900) { //video 5min < duration < 15 min, frame for every 5 sec
                            frameK = 5;
                        } else { //video  duration > 15 min, frame for every 10 sec
                            frameK = 10;
                        }
                        if (isMobile.any()) {
                            var offset;
                            if (selector === 'mejs-slider-unvisible') {
                                offset = mejsTimeRail.find('.mejs-slider-unvisible-total').offset();
                            } else {
                                offset = mejsTimeRail.offset();
                            }
                            var pageX;
                            try {
                                pageX = e.pageX || e.originalEvent.pageX || e.originalEvent.changedTouches[0].pageX;
                            } catch (ex) {
                            }
                            mouseX = pageX - offset.left;
                        } else {
                            if (selector === 'mejs-slider-unvisible') {
                                mejsTimeRail.find('.mejs-slider-unvisible-total').off('mousemove').on('mousemove',function (e) {
                                    var offset = $(this).offset();
                                    mouseX = e.pageX - offset.left;
                                });
                                mejsTimeRail.off('mousemove');
                            } else {
                                mejsTimeRail.off('mousemove').on('mousemove',function (e) {
                                    var offset = $(this).offset();
                                    mouseX = e.pageX - offset.left;
                                });
                                mejsTimeRail.find('.mejs-slider-unvisible-total').off('mousemove');
                            }
                        }
                    }

                    if (!mouseX) return;
                    var timeText = $(controls).find('.mejs-time-float-current').text();
                    /* calculate curroct possition */
                    var timebarLeft = 0;
                    var minusWidth = parseInt(timelineThumb.width()) / 2;
                    var timebarTop;
                    if ($(controls).find('.mejs-time-rail').css('position') == 'absolute') {
                        timebarTop = mejsTimeRail.position().top;
                    } else {
                        timebarTop = mejsTimeRail.height();
                    }
                    var thumbLeft = mouseX + timebarLeft - minusWidth;
                    thumbLeft = Math.min(mejsTimeRail.width() - timelineThumb.width(),thumbLeft);
                    thumbLeft = Math.max(0,thumbLeft);
                    timelineThumb.css({ 'left': thumbLeft,'bottom': timebarTop });

                    /* end of calculation */
                    var seconds = hmsToSecondsOnly(timeText);

                    var row,col;
                    
                    var frameVal = parseInt(seconds / frameK);
                    if (frameVal < 10) {
                        col = frameVal;
                    } else {
                        col = frameVal % 10;
                    }
                    row = parseInt(frameVal / 10);
                    var calcWidth = sb_arg == 'small' ? 100 : 200;
                    var calcHeight = sb_arg == 'small' ? 75 : 150;
                    var thumbRatio = parseFloat(timelineThumbPreview.attr('data-ratio'));
                    var diff = parseInt(timelineThumbPreview.attr('data-fix'));
                    if (thumbRatio > 1) {
                        var positionY = -diff + (-row * calcHeight);
                        
                        timelineThumbPreview.css({
                            'background-position': (-col * calcWidth) + 'px ' + positionY + 'px',
                            'background-repeat': 'no-repeat'
                        });
                    } else {
                        var positionX = -diff + (-col * calcWidth);
                        timelineThumbPreview.css({
                            'background-position': positionX + 'px ' + (-row * calcHeight) + 'px',
                            'background-repeat': 'no-repeat'
                        });
                    }

                    $(controls).find('.time-rail-thumbnails').show();
                    $(controls).addClass('time-rail-thumbnails-visible');

                    if (isMobile.any()) {
                        clearTimeout(that.mobileSBTimer);
                        that.mobileSBTimer = setTimeout(function () {
                            $(controls).find('.time-rail-thumbnails').hide();
                            $(controls).removeClass('time-rail-thumbnails-visible');
                        },2000);
                    }
                }
            });

            function hoverHandler(thumbnailObj,size) {

                if (typeof size == 'undefined' || size == 'small') {
                    size = '3sb';
                } else {
                    size = '2sb';
                }


                var tmbUrl = "";
                tmbUrl = player.options.skinObject.getThumbnailUrl(currentItem,size === "3sb" ? 5 : 6);

                if (!tmbUrl) tmbUrl = '';
                var ni = new Image();
                ni.src = tmbUrl;
                ni.onload = function () {
                    $(controls).find('.time-rail-thumbnails').removeClass('thumbnails-loading');
                    $(controls).find('.time-rail-thumbnails .thumbImage.preview').removeClass('thumbnails-loading-text');
                    thumbnailObj.html('');
                    thumbnailObj.css({
                        'background-image': 'url(' + tmbUrl.replace(/\(|\)/g,"") + ')',
                        'background-repeat': 'no-repeat'
                    });
                    ni = null;
                }
                ni.onerror = function () {
                    console.log('story board issue',tmbUrl);
                }
            }

            function hmsToSecondsOnly(str) {
                if (typeof str == 'undefined') {
                    return '';
                }
                var p = str.split(':'),
                    s = 0,m = 1;

                while (p.length > 0) {
                    s += m * parseInt(p.pop(),10);
                    m *= 60;
                }

                return s;
            }

        }
    })

})(zeQuery);

(function ($) {
    $.extend(CincopaMediaElementPlayer.prototype,{
        buildvideotrim: function (player,controls,layers,media) {
            var current_url;
            if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                current_url = media.src;
            }else{
                current_url = $(media).data(player.options.dataCollector);
            }


            media.setCurrentTime = function(time) {
                    var t = time;
                    if(media.getAttribute("area-startTime")){
                        t = Math.max(parseInt(media.getAttribute("area-startTime")), t)
                    }
                    if(media.getAttribute("area-endTime")){
                        t = Math.min(parseInt(media.getAttribute("area-endTime")), t)
                    }
                    this.currentTime = t;
                }

            var galleryItems = player.options.skinObject.go.MediaJSON.items;
            player.options.skinObject.sendDataCollector
            var sendData = player.options.skinObject.sendDataCollector(current_url || 0);
            var cincoObj = (player.options.skinObject.go.args.iframe) ? parent.cincopa : cincopa;
            for (var i = 0; i < galleryItems.length; i++) {
                if(galleryItems[i].timeline){
                    var timeLineObject = cincoObj.json_parse(galleryItems[i].timeline);
                    var start = 0, end = null;
                    if(typeof timeLineObject.start_end != "undefined"){
                        if(timeLineObject.start_end.start){
                            if(timeLineObject.start_end.start.type == "second"){
                                if(timeLineObject.start_end.start.second > 0 && timeLineObject.start_end.start.second < hmsToSecondsOnly(galleryItems[i].duration)){
                                    start = timeLineObject.start_end.start.second;
                                }
                            } else if(timeLineObject.start_end.start.type == "chapter"){
                                start = getChapterTimeByName(timeLineObject.chapter, timeLineObject.start_end.start.name);
                            }
                        }

                        if(timeLineObject.start_end.end){
                            if(timeLineObject.start_end.end.type == "second"){
                                if(timeLineObject.start_end.end.second > 0 && timeLineObject.start_end.end.second <= hmsToSecondsOnly(galleryItems[i].duration) && timeLineObject.start_end.end.second > start){
                                    end = timeLineObject.start_end.end.second;
                                }
                            } else if(timeLineObject.start_end.end.type == "chapter"){
                                end = getChapterTimeByName(timeLineObject.chapter, timeLineObject.start_end.end.name);
                            }
                        }

                    }
                    if(start) galleryItems[i].startTime = start;
                    if(end) galleryItems[i].endTime = end;
                    if(start && end && end <= start && galleryItems[i].endTime){
                        delete galleryItems[i].endTime
                    }

                    // vr(360 video)
                    if(typeof timeLineObject.isVR != "undefined"){
                        if(timeLineObject.isVR){
                        galleryItems[i].isVR = true;
                        }
                    }
                }
            }

            media.cincopaAddEventListener('loadedmetadata', function (e) {

                    if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                        current_url = media.src;
                    }else{
                        current_url = $(media).data(player.options.dataCollector);
                    }

                    var sendData = player.options.skinObject.sendDataCollector(current_url || 0);
                        if(player.options.skinObject.go.args.videoTrim){

                            /* clean timeline from prev videos data */
                            media.removeAttribute("area-startTime");
                            $(".mejs-time-blocker-start",controls).remove();

                            media.removeAttribute("area-endTime");

                            $(".mejs-time-blocker-end",controls).remove();

                            /* end of clean */
                            if(sendData.item && sendData.item.startTime && sendData.item.startTime > 0){                                
                                media.setAttribute("area-startTime", sendData.item.startTime);
                                if($(".mejs-time-blocker-start", controls).length === 0){
                                    var timeRial = $(".mejs-time-rail", controls)
                                    var blocker = $("<span>").addClass("mejs-time-blocker mejs-time-blocker-start");
                                    var sbBlockerLeft = $("<span>").addClass("mejs-time-blocker mejs-storyboardy-blocker mejs-time-blocker-start");
                                    blocker.appendTo(timeRial);
                                    sbBlockerLeft.prependTo(controls);
                                    blocker.css({
                                        width:(100 * sendData.item.startTime)/media.duration + "%",
                                    });
                                    sbBlockerLeft.css({
                                        width:(100 * sendData.item.startTime)/media.duration + "%",
                                        bottom: $(controls).height()
                                    });
        
                                    sbBlockerLeft.on("mousemove touchmove mouseup touchend touchstart mouseenter mouseleave mouseout mouseover click", function(e){
                                        e.stopPropagation();
                                        e.preventDefault();
                                        return false;
                                    })
                                    blocker.on("mousemove touchmove mouseup touchend mouseenter mouseleave mouseout mouseover click", function(e){
                                        e.stopPropagation();
                                        e.preventDefault();
                                        return false;
                                    })
                                }                            
                            }

                            if(sendData.item && sendData.item.endTime && sendData.item.endTime < Math.round(media.duration)){                                
                                media.setAttribute("area-endTime", sendData.item.endTime);
                                if($(".mejs-time-blocker-end", controls).length === 0){
                                    var timeRial = $(".mejs-time-rail", controls)
                                    var blocker = $("<span>").addClass("mejs-time-blocker mejs-time-blocker-end");
                                    var sbBlockerRight = $("<span>").addClass("mejs-time-blocker mejs-storyboardy-blocker mejs-time-blocker-end");
                                    blocker.appendTo(timeRial);
                                    sbBlockerRight.prependTo(controls);
                                    blocker.css({
                                        width:(100 * (media.duration - sendData.item.endTime))/media.duration + "%",
                                        position: "absolute",
                                        top: "0",
                                        right: 0,
                                        background: "#fff",
                                        opacity: "0.7"
                                    });
                                    sbBlockerRight.css({
                                        width:(100 * (media.duration - sendData.item.endTime))/media.duration + "%",
                                        bottom: $(controls).height()
                                    });

                                    sbBlockerRight.on("mousemove touchmove mouseup touchend touchstart mouseenter mouseleave mouseout mouseover click", function(e){
                                        e.stopPropagation();
                                        e.preventDefault();
                                        return false;
                                    })        
                                    blocker.on("mousemove touchmove mouseup touchend mouseenter mouseleave mouseout mouseover click", function(e){
                                        e.stopPropagation();
                                        e.preventDefault();
                                        return false;
                                    })
                                }
                            } 
                        }
            })

            media.cincopaAddEventListener('timeupdate', function (e) {
                if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                    current_url = media.src;
                }else{
                    current_url = $(media).data(player.options.dataCollector);
                }
                var sendData = player.options.skinObject.sendDataCollector(current_url || 0);
                var ct = ~~media.currentTime;

                if (ct % 1 == 0) {
                    if(sendData.item && sendData.item.endTime && ct >= sendData.item.endTime){
                        stopHLS(media, sendData.item.startTime)
                        return                       
                    } else if(sendData.item && sendData.item.startTime && ct < sendData.item.startTime){
                        // media.setCurrentTime(sendData.item.startTime);
                    }
                }

            });
            function getChapterTimeByName(chapters, name){
                if(!chapters) return 0;
                var time = 0;
                for(var chapter in chapters){
                    if(chapters[chapter].title == name){
                        time = hmsToSecondsOnly(chapter)
                    }
                }
                return time;
            }
            function stopHLS(mediaElement, startTime){
                mediaElement.setCurrentTime(startTime || 0)
                mediaElement.dispatchEvent(new Event("pause"));
                mediaElement.dispatchEvent(new Event("ended"));
            }

            function hmsToSecondsOnly(str) {
                if(typeof str == 'undefined'){
                    return '';
                }
                var p = str.split(':'),
                        s = 0, m = 1;
    
                while (p.length > 0) {
                    s += m * parseInt(p.pop(), 10);
                    m *= 60;
                }
    
                return s;
            }
        }
    })

})(zeQuery);



/* upnext */
(function ($) {

    $.extend(CincopaMediaElementPlayer.prototype, {
        
        buildcontrolscontrol: function (player, controls, layers, media) {
                var isMobile = {
                    Android: function () {
                        return navigator.userAgent.match(/Android/i);
                    },
                    BlackBerry: function () {
                        return navigator.userAgent.match(/BlackBerry/i);
                    },
                    iOS: function () {
                        return navigator.userAgent.match(/iPhone|iPad|iPod/i) || ((/iPad|iPhone|iPod/.test(navigator.platform) ||
                            (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) &&
                            !window.MSStream);
                    },
                    Opera: function () {
                        return navigator.userAgent.match(/Opera Mini/i);
                    },
                    Windows: function () {
                        return navigator.userAgent.match(/IEMobile/i) || navigator.userAgent.match(/WPDesktop/i);
                    },
                    any: function () {
                        return (this.Android() || this.BlackBerry() || this.iOS() || this.Opera() || this.Windows());
                    }
                };                
                // if(iosTrimmedVideo){
                //     cincopa_mejs.MediaFeatures.hasTrueNativeFullScreen = false;
                //     cincopa_mejs.MediaFeatures.hasiOSFullScreen = false;
                // }

                if(isMobile.any()){                    
                    $(controls).addClass("ze-show-mobile-controls");

                    $('.mejs-overlay-play',layers).on('touchend',function(e){

                        if (isMobile.iOS() == true) { /* on ios overlay-play event doesnt working */
                            if(!media.paused){
                                        clearTimeout(timeout);
                                        var timeout = setTimeout(function() {
                                            if(!player.jumping){
                                media.pause();
                                            }
                                        },200);
                                        
                            }else if(media.readyState >= 2){
                                media.play();
                                        $(layers[0]).find('.mejs-video-jump').addClass('cp-hide');
                            }

                        }
                        /* need this to hide controls */
                        $(player.container).trigger('touchstart');
                    });
                    $(player.domNode).on('touchend',function(){
                        if(!media.paused){
                            $(".netflix_close_btn", player.container.parentElement).show()
                            if($(player.domNode).hasClass('showControls')){
                                            clearTimeout(timeout);
                                            var timeout = setTimeout(function() {

                                                if(!player.jumping){
                                                    if(!media.activeMobileControl) {
                                media.pause();
                                                    }
                                                    $(layers[0]).find('.mejs-video-jump').addClass('cp-hide');
                                                }
                                            },300);

                            }else {
                                        $(player.domNode).addClass('showControls');
                                        clearTimeout(timer)

                                        var timer = setTimeout(function() {
                                            if(player.jumping){
                                                return
                            }               
                                            $(layers[0]).find('.mejs-video-jump').removeClass('cp-hide');
                                        },600)
                                    }

                                    
                            
                        }else if(media.readyState >= 2){
                                    var timer = setTimeout (function() {
                            $(player.domNode).removeClass('showControls');
                                        $(layers[0]).find('.mejs-video-jump').addClass('cp-hide');
                            media.play();
                                    },600)
                                   
                        }
                        $(player.container).trigger('touchstart');
                    });
                    media.cincopaAddEventListener('timeupdate', function () {
                        if(!controls.hasClass('fadeafterseconds') || !controls.hasClass('removeCotrols')) {
                            player.updateCurrent();
                        }
                    }, false);

                    /* when trimming is enabled and IOS, then fullscreen button is hidden */
                    media.cincopaAddEventListener('loadeddata', function () {  
                        var iosTrimmedVideo = false;
                        var current_url;          
                        if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                            current_url = media.src;
                        }else{
                            current_url = $(media).data(player.options.dataCollector);
                        }
                        var sendData = player.options.skinObject.sendDataCollector(current_url || 0);  

                        if(isMobile.iOS() && sendData.item && ( (sendData.item.startTime && sendData.item.startTime) > 0 ||  (sendData.item.endTime && sendData.item.endTime > 0))){
                            iosTrimmedVideo = true;
                        }
                        
                        var objectContainer = $('#'+player.options.skinObject.go.loaderParams["_object"]);
                        if(iosTrimmedVideo){
                            objectContainer.addClass('cp-fullscreen-ios-hide');
                            player.options.skinObject.go.playerAPI.exitFullScreen();
                            // if(player.isFullScreen) {
                            //     player.exitFullScreen();
                            // }
                            $(window).trigger('resize');
                        }else{
                            objectContainer.removeClass('cp-fullscreen-ios-hide');                        
                        }
                    })
                    
                    /* rotate screen if possible on fullscreen */ 
                    
                    if(isMobile.iOS()){ 
                        $(player.media).on('webkitfullscreenchange fullscreenchange', function(){
                            if (document.fullscreenElement || document.webkitFullscreenElement ) {
                                /* in */
                                fullScreenEnter();
                            } else {
                                /* out */
                                fullScreenExit();
                            }
                        });
                        if(player.options.skinObject.go.args.forceNativeFullScreen == 'true' || player.options.skinObject.go.args.forceNativeFullScreen == true) {
                            $(player.media).on('webkitendfullscreen', function() {
                                player.exitFullScreen();
                                $(".mejs-fullscreen").removeClass('mejs-fullscreen');
                                $(".mejs-container-fullscreen").removeClass('mejs-container-fullscreen');
                                player.pause();
                                $(window).trigger('resize')
                                fullScreenExit();
                            })
                        }
                        /* for ios trimmed vidoes always yse triggered functions */

                        // if(iosTrimmedVideo){                            
                        //     $(player.container).on('enteredfullscreen', fullScreenEnter);
                        //     $(player.container).on('exitedfullscreen', fullScreenExit); 
                        // }else{                            
                            if((navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1) && !window.MSStream){

                                $(player.container).on('enteredfullscreen', fullScreenEnter);
    
                                $(player.container).on('exitedfullscreen', fullScreenExit); 
                                
                            }else{
                                $(player.container).on('webkitbeginfullscreen', fullScreenEnter) ;
                                $(player.container).on('webkitendfullscreen', fullScreenExit);
                            }  
                        // }
                    }else{                        
                        $(player.container).on('enteredfullscreen', fullScreenEnter);
                        $(player.container).on('exitedfullscreen', fullScreenExit); 
                    
                    }
                    /* end fullscreen rotate */
                    function fullScreenEnter(){    
                        // if(iosTrimmedVideo){
                        //     $('#'+player.options.skinObject.go.loaderParams["_object"]).addClass('cp-fullscreen-ios')
                        // }

                        try{
                            var orientPromiseLand =  window.screen.orientation.lock('landscape');
                            orientPromiseLand['catch'](function(reason) {
                                if(cincopa.trace) cincopa.trace("SKIN: fullScreenEnter "+ reason);
                            });
                        }catch(ex){
                            if(cincopa.trace) cincopa.trace("SKIN: fullScreenEnter error "+ ex);
                        }
                        $('#'+player.options.skinObject.go.loaderParams["_object"]).addClass('cp-fullscreen-entered');                       
                       

                        /* send event */
                        var current_url;
                        if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                           current_url = media.src;
                        }else{
                           current_url = $(media).data(player.options.dataCollector);
                        }                        
                        var currentData = player.options.skinObject.sendDataCollector(current_url || 0);
                        player.options.skinObject.go.onSkinEvent('video.fullscreenenter', currentData);
                    }

                    function fullScreenExit(){
                        // if(iosTrimmedVideo){
                        //     $('#'+player.options.skinObject.go.loaderParams["_object"]).removeClass('cp-fullscreen-ios')
                        // }
                        try{
                            var orientPromiseOut = window.screen.orientation.unlock();
                            if(orientPromiseOut != undefined){
                                orientPromiseOut['catch'](function(reason) {
                                    if(cincopa.trace) cincopa.trace("SKIN: fullScreenExit "+ reason);
                                });
                            }                       
                        }catch(ex){
                            if(cincopa.trace) cincopa.trace("SKIN: fullScreenExit error "+ ex);
                        }
                        $('#'+player.options.skinObject.go.loaderParams["_object"]).removeClass('cp-fullscreen-entered');

                        /* send event */
                        var current_url;
                        if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                           current_url = media.src;
                        }else{
                           current_url = $(media).data(player.options.dataCollector);
                        }                        
                        var currentData = player.options.skinObject.sendDataCollector(current_url || 0);
                        player.options.skinObject.go.onSkinEvent('video.fullscreenexit', currentData);
                        
                    }
                }
            

            /* hide controls functionality */
            
            //this fix is for mozilla when pressing esc 
              if(typeof document.mozFullScreenElement != 'undefined'){
                $(document).off('fullscreenchange.cpmedia  mozfullscreenchange.cpmedia').on('fullscreenchange.cpmedia.'+player.options.galleryId+' mozfullscreenchange.cpmedia.'+player.options.galleryId, function (e) {
                    var fullscreenElement = document.fullscreenElement || document.mozFullscreenElement ;
                        if (!fullscreenElement) {
                            console.log("exit")
                            $(".mejs-fullscreen").removeClass('mejs-fullscreen');
                            $(".mejs-container-fullscreen").removeClass('mejs-container-fullscreen');
                            $(window).trigger('resize.responsiveslider')
                            setTimeout(function(){
                                var esc = $.Event("keydown", { keyCode: 27 });
                                $("body").trigger(esc) 
                            },0);
                        } else{
                            console.log("enter")
                          
                        }
                    });
                }
                /* fix for hide controls pause */
                // if(isMobile.any()){
                //     $(player.domNode).on('click',function(e){
                //         if(!media.paused){
                //             media.pause();
                //         }
                //     });
                // }
                
                 if(isMobile.any()){
                    $(player.container).parent().on("touchend", function(e){
                        var target = $(e.target);
                        
                        if(target.closest(".mejs-controls").length > 0) return true;
                        if(target.closest(".mejs-container").length > 0){
                            if($(player.container).hasClass('status-play') || $(player.container).hasClass('status-pause')){
                                if($(controls).hasClass("ze-show-mobile-controls")){
                                    $(controls).removeClass("ze-show-mobile-controls");

                                    player.container.trigger('mobilecontrolshidden');
                                    fadeAfterCallback();
                                } else {
                                    $(controls).addClass("ze-show-mobile-controls");
                                    clearTimeout(timer);

                                   var timer = setTimeout(function() {
                                       if(player.jumping){
                                        return
                                    }
                                        $(layers[0]).find('.mejs-video-jump').removeClass('cp-hide');
                                    },600)

                                    player.container.trigger('mobilecontrolsshown');
                                }
                            }
                        } else {
                            $(controls).removeClass("ze-show-mobile-controls");
                            player.container.trigger('mobilecontrolshidden');
                            fadeAfterCallback();
                        }

                    })
                }
                var fadeafterseconds;
                var touchstart;
                $(player.container).on('mousemove', function (e) {                   
                    if(!touchstart){
                        clearTimeout(fadeafterseconds);
                        clearTimeout(hideControls);
                            var hideControls = setTimeout(function() {
                                if(player.jumping){
                                    return
                                }
                        $(controls).removeClass("fadeafterseconds").removeClass('removeCotrols');
                        $(".mejs-captions-position", player.container).removeClass("movetobottom");

                            },600)
                        if(!$('.mejs-chapters-button',  player.container).hasClass("mejs-chapters-off")){
                            $(layers).addClass("mejs-show-chapters");
                        }

                        fadeafterseconds=setTimeout(function(){
                            fadeAfterCallback();
                        },4000)
                    }
                    if(!$(e.target).parents(".mejs-controls").length && !$(e.target).hasClass("mejs-controls")){
                      $(controls).find('.time-rail-thumbnails').hide();
                      $(controls).removeClass('time-rail-thumbnails-visible');
                    }else if( !$(e.target).parents(".mejs-time-rail").length && !$(e.target).hasClass("mejs-time-rail") ){
                      $(controls).find('.time-rail-thumbnails').hide();
                      $(controls).removeClass('time-rail-thumbnails-visible');
                    }
                 
                })
                // check
                $(player.container).on('touchstart', function(e){
                    clearTimeout(fadeafterseconds);
                    touchstart=true;
                    clearTimeout(hideControls);
                    var hideControls = setTimeout(function() {
                        if(player.jumping){
                            return
                        }
                        if(!media.paused){
                            $(layers[0]).find('.mejs-video-jump').removeClass('cp-hide');
                            // display: block !important;
                            // z-index: 99999999999999999 !important;
                            // opacity: 1 !important;
                            // visibility: visible !important;
                            $(controls).attr('style', "display: block !important; z-index: 99999999999999999 !important; opacity: 1 !important; 'visibility': visible !important");
                        }else{
                            $(layers).find('.mejs-overlay-play').show();
                        }
                        $(controls).removeClass("fadeafterseconds")
                                .removeClass("ze-show-mobile-controls")
                                .removeClass('removeCotrols')
                        $(".mejs-captions-position", player.container).removeClass("movetobottom");
                    },400)

                    
                    if(!$('.mejs-chapters-button', player.container).hasClass("mejs-chapters-off")){
                        $(layers).addClass("mejs-show-chapters");
                    }
                    fadeafterseconds=setTimeout(function(){

                        fadeAfterCallback();
                    },4000)
                });

                $(player.container).on('mouseenter', function () {
                    clearTimeout(hideControls);

                    var hideControls = setTimeout(function() {
                        if(player.jumping){
                            return
                        }
                    $(controls).removeClass("fadeafterseconds")
                                .removeClass("ze-show-mobile-controls")
                                .removeClass('removeCotrols');
                        // $(".mejs-captions-position", player.container).removeClass("movetobottom");
                    },600)
                    
                    if(!$('.mejs-chapters-button', player.container).hasClass("mejs-chapters-off")){
                        $(layers).addClass("mejs-show-chapters");
                    }
                      
                   if(!touchstart)
                   {
                    clearTimeout( fadeafterseconds);
                    // $(".mejs-captions-position", player.container).removeClass("movetobottom");
                    if(!$('.mejs-chapters-button', player.container).hasClass("mejs-chapters-off")){
                        $(layers).addClass("mejs-show-chapters");
                    }
                    if(!player.jumping){

                    $(controls).removeClass("fadeafterseconds").removeClass('removeCotrols');
                    }
                        fadeafterseconds=setTimeout(function(){
                        fadeAfterCallback();
                    },4000)
                   }
                    
                });
                $(player.container).on('mouseleave', function () {
                    if(!touchstart){							   
                        clearTimeout(fadeafterseconds);
                        if(!$(player.container).parent().hasClass('isAudio')){
                            $(".mejs-captions-position", player.container).addClass("movetobottom");  
                        }
                        if($(player.container).hasClass('status-play') || $(player.container).hasClass('status-pause')){
                            $(layers).removeClass("mejs-show-chapters");
                        }
                    }
           
                });
                function fadeAfterCallback(){
                    $(player.domNode).removeClass('showControls');
                    if( player.options.skinObject.go.args.cincopaTV){
                        setTimeout(function(){
                            $(".netflix_close_btn", player.container.parentElement).hide()
                        },100)
                    }

                    if(!$(player.container).parent().hasClass('isAudio') && !player.jumping ){
                        $(controls).addClass("fadeafterseconds")
                               .addClass('removeCotrols').attr('style', '');
                    $(".mejs-captions-position", player.container).addClass("movetobottom");
                    }


                    if(!$(player.container).hasClass('status-pause') && !$(player.container).hasClass('status-ended')){
                        $(layers).removeClass("mejs-show-chapters");
                    }else{
                        $('#' + player.options.galleryId).addClass("ze-mouseleave");
                        $(player.container).addClass("ze-mouseleave");
                    }
                    player.container.trigger('fadeafterseconds')
                    
                }
                var  currentbody =  player.options.skinObject.go.args.iframe ?   $(window.parent.document) : $('body');
                currentbody.on('touchstart.'+player.options.galleryId, function(e){
                     var target = $(e.target);

                     if(!target.closest(player.container) ) {
                        
                        clearTimeout(fadeafterseconds);
                        $(".mejs-captions-position", player.container).addClass("movetobottom");  
                        if($(e.target).closest('.mejs-chapters-wrap').length <= 0 || $(e.target).hasClass('mejs-chapters-wrap')) {
                                $(layers).removeClass("mejs-show-chapters");
                            
                        }
                    }
         
                });

                
            /* end hide controls functionality */

            /* video ads events */
            player.container.on('mejsprerollstarted', function() {
                player.container.addClass('mejsprerollstarted');
            });

            player.container.on('mejsprerolladsmainvideorestored', function() {
                player.container.removeClass('mejsprerollstarted');
            });

            media.cincopaAddEventListener('play', function (e) {
                $(player.containerr).addClass('status-play');
            })
            media.cincopaAddEventListener('pause', function (e) {
                $(player.containerr).removeClass('status-play');
            })
            

        }
    })

})(zeQuery);
(function ($) {

    $.extend(CincopaMediaElementPlayer.prototype, {
        buildadjustplayerfontsize: function (player, controls, layers, media) {
            var winSelector,resizeTimer;
            if (player.options.skinObject.go.args.iframe) {
                winSelector = parent.window;
            } else {
                winSelector = window;
            }

            if(!!navigator.userAgent.match(' Safari/') && !navigator.userAgent.match(' Chrom') && !!navigator.userAgent.match(' Version/5.')){
                winSelector = window;
            }
            $(winSelector).on('resize.mediaelement.'+player.options.galleryId, function () {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function () {
                    adjustPlayerFontSize();
                }, 100);
            });
            $('.mejs-overlay-button', player.container).addClass('mejs-overlay-button-hidden');
            adjustPlayerFontSize();
            function adjustPlayerFontSize(){

                var calculate = function(num, in_min, in_max, out_min, out_max) {
                    var res = (num - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
                    return Math.max(out_min, Math.min(out_max, res));
                } 
                
                // if(player.options.skinObject.go.args.css_version != '1.1'){
                //     $('.mejs-overlay-button', player.container).removeClass('mejs-overlay-button-hidden');
                //     return;
                // } 
                var container = player.container
                var width =  container.width();
    
                // play button
    
                // for cincopa design video player skin which use font for icons - calculate play and loading buttons size dynamically
                if( $('.mejs-overlay-button', player.container).css("background-image") == "none"){
                    var fs = calculate(width, 100, 1300, 26, 100); 
                    $('.mejs-overlay-button', player.container).css({"width": fs, "height": fs, "font-size": fs, "margin-top" : -fs/2});
                    $('.mejs-overlay-loading', player.container).css({"width": fs, "height": fs});
                    $('.mejs-overlay-loading span', player.container).css({"width": fs, "height": fs});
                    $('.mejs-overlay-button', player.container).removeClass('mejs-overlay-button-hidden');
                }else {
                    /* fallback for old controls play button on smalls creen */
                    if(player.container.width() < 768){
                        player.container.addClass('adjustplayerfontsize--small');
                    }else{
                        player.container.removeClass('adjustplayerfontsize--small');
                    }
                }

                $('.mejs-overlay-button', player.container).removeClass('mejs-overlay-button-hidden');

                if(!player.options.skinObject.go.args.auto_resize){
                    return;    
                }

                container.addClass("mejs-auto-resize");
                controls.find(".mejs-player-logo-button").css({display: "none"})
                var controlFS = calculate(width, 100, 1200, 6, 28); 
                var controlW = calculate(width, 100, 1200, 10, 55);
                var controlP = 0;
                controls.find(".mejs-button").css({
                    "width": controlW + "px",
                    "padding-top": controlP + "px",
                    "padding-bottom": controlP + "px"
                });
    
                container.find(".share-button").css({"width": controlW + "px"});
                container.find(".share-close").css({"width": controlW + "px"});
                
                controls.find(".mejs-button button").css({
                    "font-size" : controlFS + "px",
                    "line-height": controlFS + "px",
                    "padding-top": "12px",
                    "padding-bottom": "12px"
                });
                container.find(".share-button").css("font-size", controlFS + "px");
                container.find(".share-button").css("line-height", controlFS + "px");
                container.find(".share-close").css("font-size", controlFS + "px");
                container.find(".share-close").css("line-height", controlFS + "px");
    
                var mejs_time_elem = controls.find(".mejs-time");
                mejs_time_elem.css("padding-top", ((2*controlP + controlFS + parseInt(controls.find(".mejs-button button").css("padding-top")) + parseInt(controls.find(".mejs-button button").css("padding-bottom")))  - mejs_time_elem.height())/2 + "px");
                
                
                controls.find(".mejs-player-logo-button").css({
                    "width": controlW + "px",
                    "padding-top": controlP + "px",
                    "padding-bottom": controlP + "px",
                    "height": controls.height() + "px",
                    "display": "block",
                    "line-height": "0"
                });
                // chapters
    
                var chaptersWidth = calculate(width, 380, 1000, 120, 240); 
                var chaptersFontSize = calculate(width, 380, 1000, 12, 16); 
                var chaptersPadding = calculate(width, 380, 1000, 5, 30); 
                container.find(".mejs-chapters-list").css({
                    width: chaptersWidth + "px",
                    "font-size": chaptersFontSize + "px"
                })
    
                container.find(".mejs-chapters-list li").css({
                    "padding-left": chaptersPadding +"px",
                    "padding-right": chaptersPadding/2 +"px"
                })
    
                container.find(".mejs-chapters-list li span:last-child").css({
                    "white-space": width > 600 ? "normal" : "nowrap"
                })
    
                container.find(".mejs-chapters-wrap").height(container.height() - controls.height())
    
                // lead gen form
    
                var form = $('.ze_htmloverlay_form', container);
                form.css("padding", "4px")
                form.find("#ze_htmloverlay_form_upper").css({
                    "font-size": calculate(width, 350, 1000, 8, 22) + "px",
                    "margin-bottom": calculate(width, 350, 1000, 4, 20) + "px"
                })
                form.find("#ze_htmloverlay_form_lower").css({
                    "font-size": calculate(width, 350, 1000, 8, 18) + "px",
                    "margin-top": calculate(width, 350, 1000, 3, 15) + "px",
                    "margin-bottom": 0
                })
                form.find(".error-message").css({
                    "font-size": calculate(width, 350, 1000, 8, 12) + "px"
                })
                form.find("input").css({
                    "font-size": calculate(width, 350, 1000, 8, 18) + "px",
                    "padding": "6px 8px",
                    "padding-top": calculate(width, 350, 1000, 4, 6) + "px",
                    "padding-bottom": calculate(width, 350, 1000, 4, 6) + "px",
                    "line-height": "1.3"
                })
    
                form.find(".text-label").each(function(){
                    var label = zeQuery(this);
                    if(label.html() === ""){
                        label.css({
                            "overflow": "hidden",
                            "height": 0,
                            "margin-bottom": 0,
                            "margin-top": calculate(width, 350, 1000, 10, 26) + "px",
                        })
                    } else {
                        label.css({
                            "margin-top": calculate(width, 350, 1000, 6.6, 12) + "px",
                            "font-size": calculate(width, 350, 1000, 10, 14) + "px",
                            "line-height": "1",
                            "margin-bottom": calculate(width, 350, 1000, 6.6, 12) + "px",
                        })
                    }
                })
    
                // share block
                var share_block = $('.share-wrap', container);
                share_block.find(".share-title").css({
                    "font-size": calculate(width, 350, 1200, 16, 36) + "px"
                })
    
                share_block.find(".share-link").css({
                    "font-size": calculate(width, 350, 1200, 10, 15) + "px",
                    "padding-top": calculate(width, 350, 1000, 6, 12) + "px",
                    "padding-bottom": calculate(width, 350, 1000, 6, 12) + "px",
                })
    
                share_block.find(".share-icons i").css({
                    "font-size": calculate(width, 350, 1200, 12, 24) + "px",
                    "width": calculate(width, 350, 1000, 20, 40) + "px",
                    "height": calculate(width, 350, 1000, 20, 40) + "px",
                    "line-height": calculate(width, 350, 1000, 20, 40) + "px",
                    "padding": "0",
                })
            }

        }
    })

})(zeQuery);

/* show last frame before next video plugin */

(function ($) {

    $.extend(CincopaMediaElementPlayer.prototype, {
        buildsmoothvideochange: function (player, controls, layers, media) {

            function isAudio(){
                var current_url;
                if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                    current_url = media.src;
                }else{
                    current_url = $(media).data(player.options.dataCollector);
                }
    
                var currentData = player.options.skinObject.sendDataCollector(current_url || 0);
                var currentItem = currentData.item;
                

                if(currentItem && currentItem.content_type && currentItem.content_type.indexOf('audio') > -1){
                   return true;
                }else {
                    return false;
                }
            }

            media.cincopaAddEventListener('onclickevent', function(e) {
              var smoothPoster = layers.find('.mejs-smoothvideochange');
                if(smoothPoster.length){
                    return;
                }

                if(smoothPoster){
                  smoothPoster.remove();
                }

                if(isAudio() ) {
                    return;
                }
                ///disable test
              // var img = capture(media);
              var layer = $("<div>").addClass("mejs-layer mejs-smoothvideochange");
              // layer.append(img);
              layers.append(layer);

            },true);

            media.cincopaAddEventListener('timeupdate', function(e) {
              var ct = ~~media.currentTime;
              var duration = parseInt(e.target.duration);
              if(ct >= duration && layers.find('.mejs-smoothvideochange').length == 0 ){
                  var smoothPoster = layers.find('.mejs-smoothvideochange');
                  if(smoothPoster){
                    smoothPoster.remove();
                  }
                  
                  if(isAudio() ) {
                      return;
                  }
                  var img = capture(media);
                  var layer = $("<div>").addClass("mejs-layer mejs-smoothvideochange");
                  layer.append(img);
                  layers.append(layer);                
                  
              };
            }, true);

            media.cincopaAddEventListener('playing', function(e) {
               var smoothPoster = layers.find('.mejs-smoothvideochange');
               if(smoothPoster){
                   smoothPoster.fadeOut(0,function(){
                       zeQuery(this).remove();
                   });
               }
            }, true);


            function capture(video) {
                var canvas = document.createElement('canvas');
                //var video = document.getElementById('video');
                canvas.width = video.videoWidth; 
                canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0, video.videoWidth, video.videoHeight);  
                var imgURl = canvas.toDataURL();
                var img = new Image();
                img.src = imgURl;
                return img;
            }
           
        },
        buildaudio_jump: function (player, controls, layers, media) {

            $('<div class="mejs-button audio-jump mejs-jump-back">' +
            '<button type="button" aria-controls="mep_0" title="-10 sec"></button>'+
            '</div>'+
            '<div class=" audio-jump mejs-button mejs-jump-forward " >' +
            '<button type="button" aria-controls="mejs-button mep_0" title="+10 sec"></button>'+
                '</div>')
            .appendTo(controls);

            $(".mejs-jump-forward").on('click', function() {
                media.currentTime = media.currentTime+10;
            })
            $(".mejs-jump-back").on('click', function() {
                media.currentTime = media.currentTime-10;
            })



        },
        buildcp_media_helper: function (player, controls, layers, media) {
            //for native full screen player  fix ios 13 and higher
            if((navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)){
                zeQuery('body').addClass('cp-ipad13fix');
            }
    
        },
    })


})(zeQuery);



/* show last frame before next video plugin */

(function ($) {

    $.extend(CincopaMediaElementPlayer.prototype, {
        buildvideodecrypt: function (player, controls, layers, media) {
            function fProcess(payload,context) {
                var key = getParamFromUrl('key', '?'+inBetween(context.url, '?',''));
                if(!key || key == 'AAAAAAA'){
                    return payload;
                }

                var newdata = new Uint8Array(payload);
                var keys = new Uint8Array(_base64ToArrayBuffer(key));
                for(var i = 0,j=0; i < newdata.length; i++,j++){
                    if(j >= keys.length){
                        j = 0;
                    }
                    newdata[i] = newdata[i] ^ keys[j];
                }
                function _base64ToArrayBuffer(base64) {
                    var binary_string = window.atob(base64);
                    var len = binary_string.length;
                    var bytes = new Uint8Array(len);
                    for (var i = 0; i < len; i++) {
                        bytes[i] = binary_string.charCodeAt(i);
                    }
                    return bytes.buffer;
                }
                return newdata.buffer;
            }
            function pProcess(payload,context) {
                var key = getParamFromUrl('key', '?'+inBetween(context.url, '?',''));
                if(!key || key == 'AAAAAAA'){
                    return payload;
                }
                if(payload.indexOf('.key') > -1){
                    var url = new URL(context.url);
                    var urlParams = new URLSearchParams(url.search);
                    var myParam = urlParams.get('token');

                    payload = payload.replace('key','key?token=' +myParam)
                  }

                return payload;

            }
            try{
                "use strict";

                function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
                
                function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }
                
                var fLoader = /*#__PURE__*/function (_Hls$DefaultConfig$lo) {
                  _inheritsLoose(fLoader, _Hls$DefaultConfig$lo);
                
                  function fLoader(config) {
                    var _this;
                
                    _this = _Hls$DefaultConfig$lo.call(this, config) || this;
                
                    var load = _this.load.bind(_assertThisInitialized(_this));
                
                    _this.load = function (context, config, callbacks) {
                      if (context.responseType == "arraybuffer") {
                        var onSuccess = callbacks.onSuccess;
                
                        callbacks.onSuccess = function (response, stats, context) {
                          response.data = fProcess(response.data, context);
                          if(callbacks.onProgress) { callbacks.onProgress(stats, context, response.data) }
                          onSuccess(response, stats, context);
                        };
                      }
                
                      load(context, config, callbacks);
                    };
                
                    return _this;
                  }
                
                  return fLoader;
                }(Hls.DefaultConfig.loader);
                
                var pLoader = /*#__PURE__*/function (_Hls$DefaultConfig$lo) {
                    _inheritsLoose(pLoader, _Hls$DefaultConfig$lo);
                  
                    function pLoader(config) {
                      var _this;
                  
                      _this = _Hls$DefaultConfig$lo.call(this, config) || this;
                  
                      var load = _this.load.bind(_assertThisInitialized(_this));
                  
                      _this.load = function (context, config, callbacks) {
                        if (context.type == "manifest" || context.type == "level" ) {
                          var onSuccess = callbacks.onSuccess;
                  
                          callbacks.onSuccess = function (response, stats, context) {
  
                            response.data = pProcess(response.data, context);
                            if(callbacks.onProgress) { callbacks.onProgress(stats, context, response.data) }
                            onSuccess(response, stats, context);
                          };
                        }
                  
                        load(context, config, callbacks);
                      };
                  
                      return _this;
                    }
                  
                    return pLoader;
                  }(Hls.DefaultConfig.loader);                
                   player.options.skinObject.pLoader = pLoader;
                 player.options.skinObject.fLoader = fLoader;
            }catch(ex){
                console.log(ex)
            } 


            function inBetween (str, start, end){
                var i = 0;
                if (start != null && start != "")
                {
                    i = str.indexOf(start);
                    if (i == -1)
                        return "";
                }
                else
                    start = "";

                var x = str.indexOf(end, i + start.length);
                if (x == -1 || end == null || end == "")
                    return str.substr(i + start.length);

                return str.substr(i + start.length, x - i - start.length);
            }

            function getParamFromUrl(parameterName,url){			
                var result = null,
                tmp = [],
                items;
                if(typeof url !='undefined'){
                    items  = url.substr(1).split("&")
                }else{
                    items = location.search.substr(1).split("&");
                }			
                for (var index = 0; index < items.length; index++) {
                    tmp = items[index].split("=");
                    if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
                }
                return result;
                
            }
            
           
        }
    })


})(zeQuery);

(function ($) {

    $.extend(CincopaMediaElementPlayer.prototype, {
        buildmobilevideocontrols: function (player, controls, layers, media) {

            var isMobile = {
                Android: function () {
                    return navigator.userAgent.match(/Android/i);
                },
                BlackBerry: function () {
                    return navigator.userAgent.match(/BlackBerry/i);
                },
                iOS: function () {
                    return navigator.userAgent.match(/iPhone|iPad|iPod/i) || ((/iPad|iPhone|iPod/.test(navigator.platform) ||
                        (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) &&
                        !window.MSStream);
                },
                Opera: function () {
                    return navigator.userAgent.match(/Opera Mini/i);
                },
                Windows: function () {
                    return navigator.userAgent.match(/IEMobile/i) || navigator.userAgent.match(/WPDesktop/i);
                },
                any: function () {
                    return (this.Android() || this.BlackBerry() || this.iOS() || this.Opera() || this.Windows());
                }
            }; 
            if(isMobile.any()) {
                media.activeMobileControl = true;

                $('.mediaElementVideoContainer').addClass('mobile');
                $( '<div  class="mejs-overlay mejs-layer mejs-video-jump cp-hide">\
                    <div class="mejs-video-jump-left">\
                    <button type="button"  ></button>\
                    </div>\
                    <div class="mejs-button mejs-pause-button mejs-pause">\
                        <button type="button"  title="PAUSE" ></button>\
                    </div>\
                    <div class="mejs-video-jump-right">\
                    <button type="button"  ></button>\
                    </div>\
                    </div>')
                    .appendTo(layers);
                $( '<div  class="mejs-overlay mejs-layer mejs-jump-icons cp-hide">\
                    <div class="mejs-jump-icon-left "><div class="mejs-time cp-hide"></div></div>\
                    <div class="mejs-jump-icon-right"><div class="mejs-time cp-hide"></div></div>\
                    </div>')
                    .appendTo(layers);

                    var rightJump = 0;
                    var leftJump = 0;
                    var leftJumpTimer
                    $('.mejs-jump-icon-right',player.container).on('touchend',function(e) {
                        $('.mejs-jump-icon-left').find('.mejs-time').addClass('cp-hide');
                        media.currentTime = media.currentTime + 10;
                        $(this).find('.mejs-time ').removeClass('cp-hide');
                        var self = this;
                        clearTimeout(leftJumpTimer);
                        leftJumpTimer = setTimeout(function(){
                            $(self).find('.mejs-time ').addClass('cp-hide');
                            $(controls).removeClass('cp-hide-force');
                            player.jumping = false;
                            leftJump = 0;
                            rightJump = 0;
                            
                            $('.mejs-jump-icons').addClass('cp-hide');
                        },500)
                    });

                    $('.mejs-jump-icon-left',player.container).on('touchend',function(e) {
                        media.currentTime = media.currentTime - 10;
                        $('.mejs-jump-icon-right').find('.mejs-time').addClass('cp-hide');
                        $(this).find('.mejs-time ').removeClass('cp-hide');
                        var self = this;
                        clearTimeout(leftJumpTimer);
                        leftJumpTimer = setTimeout(function(){
                            $(controls).removeClass('cp-hide-force');
                            $(self).find('.mejs-time').addClass('cp-hide');
                            player.jumping = false;
                            leftJump = 0;
                            rightJump = 0;
                            
                            $('.mejs-jump-icons').addClass('cp-hide');
                        },500)
                    });
                    // LEFT
                    $(media).on('touchend',function(e) {
                        var pageX = e.pageX || e.originalEvent.pageX || e.originalEvent.changedTouches[0].pageX;
                        $('.mediaElementVideoContainer').addClass('hideControls');

                        if(e.target.clientWidth/2 < pageX ) {
                            rightJump++;
                        }else {
                            leftJump++;
                        }
                        if(rightJump > 1 ) {
                            $(".mejs-captions-position", player.container).addClass("movetobottom");
                            $('.mejs-video-jump').addClass('cp-hide');
                            $('.mejs-jump-icon-right .mejs-time ').removeClass('cp-hide');
                            $('.mejs-jump-icons').removeClass('cp-hide');
                            if(!$(player.container).parent().hasClass('isAudio')  ){
                                $(controls).addClass("fadeafterseconds")
                                .addClass('removeCotrols');
                            }
                            $(controls).addClass('cp-hide-force');
                            player.jumping = true;
                            media.currentTime = media.currentTime + 10*(rightJump-1);

                        }
                        if(leftJump > 1){
                        $(".mejs-captions-position", player.container).addClass("movetobottom");
                            $('.mejs-jump-icon-left .mejs-time ').removeClass('cp-hide');
                            $('.mejs-video-jump').addClass('cp-hide');
                            if(!$(player.container).parent().hasClass('isAudio') ){
                                $(controls).addClass("fadeafterseconds")
                                .addClass('removeCotrols');
                            }
                            $('.mejs-jump-icons').removeClass('cp-hide');

                            $(controls).addClass('cp-hide-force');
                            player.jumping = true;
                            media.currentTime = media.currentTime - 10 * (leftJump-1);
                        }
                        clearTimeout(leftJumpTimer);
                        leftJumpTimer = setTimeout(function() {
                            $('.mejs-jump-icon-right .mejs-time ').addClass('cp-hide');
                            $('.mejs-jump-icon-left .mejs-time ').addClass('cp-hide');
                            // $('.mediaElementVideoContainer').removeClass('hideControls');
                            $(controls).removeClass('cp-hide-force');
                            player.jumping = false;
                            leftJump = 0;
                            rightJump = 0;
                            
                            $('.mejs-jump-icons').addClass('cp-hide');
                        },500)
                    })

                $(".mejs-video-jump-right button",player.container).on('touchend', function(e) {
                    e.preventDefault();
                    media.currentTime = media.currentTime+10;
                })
                $(".mejs-video-jump-left button",player.container).on('touchend', function(e) {
                    e.preventDefault();
                    media.currentTime = media.currentTime - 10 ;
                })
                $('.mejs-video-jump .mejs-pause-button',player.container).on('touchend', function(e){
                    clearTimeout(timeout);
                    var timeout = setTimeout(function() {
                    
                        if(!player.jumping){
                            media.pause();
                        }
                    },200);
                })



                // media.cincopaAddEventListener('play', function (e) {
                    // if(!$(player.controls).hasClass('removeCotrols') && !$(player.controls).hasClass('fadeafterseconds')){
                    //     $(layers[0]).find('.mejs-video-jump').removeClass('cp-hide');
                    // }else {
                    //     $(layers[0]).find('.mejs-video-jump').addClass('cp-hide');
                    // }
                // })
                media.cincopaAddEventListener('pause', function (e) {
                    $(layers[0]).find('.mejs-video-jump').addClass('cp-hide');
                })
                player.container.on('fadeafterseconds',function(){
                    if(player.jumping){
                        return
                    }
                    $(layers[0]).find('.mejs-video-jump').addClass('cp-hide');
                });

                $(window).on('touchend.'+player.options.galleryId, function(e) {
                    if($(player.container).find(e.target).length == 0) {
                        if(!$(player.container).parent().hasClass('isAudio')  ){
                            $(controls).addClass("fadeafterseconds")
                            .addClass('removeCotrols');
                            $('.mejs-video-jump').addClass('cp-hide');
                            $(".mejs-captions-position", player.container).addClass("movetobottom");
                        }
                    }
                })

                
            }else {
                media.activeMobileControl = false;
            }
        }
    })

})(zeQuery);

(function ($) {

    $.extend(CincopaMediaElementPlayer.prototype,{
        buildtrackshelper: function (player,controls,layers,media) {

            var isMobile = {
                Android: function () {
                    return navigator.userAgent.match(/Android/i);
                },
                BlackBerry: function () {
                    return navigator.userAgent.match(/BlackBerry/i);
                },
                iOS: function () {
                    return navigator.userAgent.match(/iPhone|iPad|iPod/i) || ((/iPad|iPhone|iPod/.test(navigator.platform) ||
                        (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) &&
                        !window.MSStream);
                },
                Opera: function () {
                    return navigator.userAgent.match(/Opera Mini/i);
                },
                Windows: function () {
                    return navigator.userAgent.match(/IEMobile/i) || navigator.userAgent.match(/WPDesktop/i);
                },
                any: function () {
                    return (this.Android() || this.BlackBerry() || this.iOS() || this.Opera() || this.Windows());
                }
            };
            
            if (is_safari() || (isMobile.any() && (player.options.iPadUseNativeControls || player.options.iPhoneUseNativeControls || player.options.AndroidUseNativeControls))) {
                for (var i = 0; i < player.tracks.length; i++) {
                    var src = player.tracks[i]['data-src']
                    if(src){
                        player.tracks[i].src = src;
                        zeQuery(player.container.find('track[data-src="'+src+'"]')).attr('src',src);
                    }                    
                }
            }

            function is_safari() {
                var isSafari = navigator.vendor && navigator.vendor.indexOf('Apple') > -1 &&
                    navigator.userAgent &&
                    navigator.userAgent.indexOf('CriOS') == -1 &&
                    navigator.userAgent.indexOf('FxiOS') == -1;
                return isSafari;
            }

        },
        rebuildtrackshelper:function(){
            var t = this;
			t.buildtrackshelper(t, t.controls, t.layers, t.media);
        }
    })
})(zeQuery);


(function ($) {

    $.extend(CincopaMediaElementPlayer.prototype, {
        buildeventscontrol: function (player, controls, layers, media) {
            var isMobile = {
                Android: function () {
                    return navigator.userAgent.match(/Android/i);
                },
                BlackBerry: function () {
                    return navigator.userAgent.match(/BlackBerry/i);
                },
                iOS: function () {
                    return navigator.userAgent.match(/iPhone|iPad|iPod/i) || ((/iPad|iPhone|iPod/.test(navigator.platform) ||
                        (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) &&
                        !window.MSStream);
                },
                Opera: function () {
                    return navigator.userAgent.match(/Opera Mini/i);
                },
                Windows: function () {
                    return navigator.userAgent.match(/IEMobile/i) || navigator.userAgent.match(/WPDesktop/i);
                },
                any: function () {
                    return (this.Android() || this.BlackBerry() || this.iOS() || this.Opera() || this.Windows());
                }
            }; 
            media.cincopaAddEventListener('ended', async function (e) {
                if(player.options.skinObject.go.skin.isLive && isMobile.iOS()) {
                    e.stopPropagation();
                    e.preventDefault();
                    $('.mejs-overlay-play', player.options.skinObject.$gallery).hide();
                    $('.mejs-overlay-loading', player.options.skinObject.$gallery).parent().show()
                    await player.load();
                    setTimeout(function() {
                        player.play();
                    }, 1000);
                }
                var current_url;
                if (typeof $(media).data(player.options.dataCollector) == 'undefined') {
                    current_url = media.src;
                } else {
                    current_url = $(media).data(player.options.dataCollector);
                }

                var sendData = player.options.skinObject.sendDataCollector(current_url || 0);
                if (!player.options.skinObject.advertising) {
                    player.options.skinObject.go.onSkinEvent('video.ended', sendData);
                }
            }, false);

        }
    })

})(zeQuery);


(function ($) {

    $.extend(CincopaMediaElementPlayer.prototype, {
        buildfullScreenCotrols: function (player, controls, layers, media) {
            $(player.container).on('enteredfullscreen', function(){
                $(document).off('keydown.enteredfullscreen');
                $(document).on('keydown.enteredfullscreen.'+player.options.galleryId, function (e) {
                    var keyCode = e.keyCode;
                    var duration = player.media.duration,
                        seekTime = player.media.currentTime;
                    switch (keyCode) {
                        case 39: 
                            seekTime += 10;
                            break;
                        case 37:
                            seekTime -= 10;                           
                            break;
                        default:
                            return true;
                    }

                    seekTime = seekTime <= 0 ? 0 : (seekTime >= duration ? duration : Math.floor(seekTime));         
                    player.media.setCurrentTime(seekTime);
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }) 
            });

            $(player.container).on('exitedfullscreen', function(){
                $(document).off('keydown.enteredfullscreen');
            }); 
        }
    })

})(zeQuery);
////videoMenu////
(function ($) {

    $.extend(CincopaMediaElementPlayer.prototype, {
        buildvideoMenu: function (player, controls, layers, media) {
            var t = this;

            var menuOverlay = $('<div class="mejs-overlay mejs-like-controls mejs-menu-overlay"></div>');
            var menuIcon = $('<a class="mejs-menu__icon"></a>');
            var menuBlock = $('<div class="mejs-layer mejs-menu-icon__block"></div>');
            var notesBtn = $('<a class="mejs-menu-btns mejs-menu-notes__btn" data-block="notes"></a>');
            var searchSrtBtn = $('<a class="mejs-menu-btns mejs-menu-searchSrt__btn" data-block="search"></a>');
            var shareBtn = $('<a class="mejs-menu-btns  mejs-menu-share__btn" data-block="share"></a>');
            var attachmentBtn = $('<a class="mejs-menu-btns mejs-menu-attachment__btn" data-block="attachment"></a>');
            var menu = $('<div class="mejs-layer mejs-menu"></div>');
            var menuContainer = $('<div class="mejs-menu-container"></div>');
            var menuBtns = $('<div class="mejs-menu-btns-block"></div>')
            
            menuBlock.append(menuIcon);
            menu.append(menuBlock).append(menuContainer).append(menuBtns);
            menuBtns.append(notesBtn).append(searchSrtBtn).append(shareBtn).append(attachmentBtn);
            layers.append(menuOverlay).append(menuBlock).append(menu);

            function getItem() {
                var current_url;
                if(typeof $(media).data(player.options.dataCollector) == 'undefined'){
                   current_url = media.src;
                }else{
                   current_url = $(media).data(player.options.dataCollector);
                }                        
                var currentData = player.options.skinObject.sendDataCollector(current_url || 0);
                return currentData.item;
            };

            function executeCopy(text, onlyText) {    
                function onCopy(event) {
                    console.log(event)
                    event.preventDefault();
                    var clipboardData = event.clipboardData || window.clipboardData || event.originalEvent.clipboardData;
                    event.clipboardData.setData('text/plain', text);
                    if(!onlyText){
                        event.clipboardData.setData('text/html', text);    
                    }                    
                    document.removeEventListener('copy', onCopy,true);
                }; 
                document.cincopaAddEventListener('copy', onCopy, true);               
                document.execCommand("copy");
            };

            function drawNotes() {
                var item = getItem();
                var htm =   '<div class="mejs-menu-notes">\
                                <p class="menu-notes-description__title">Description</p>\
                                <p class="menu-notes-description__txt">' + item.description + '</p>\
                            </div>';
                return htm;
            };
            
            function buildList(){
                var texts = [];
                var times = [];
                if(t.selectedTrack && t.selectedTrack.entries){
                    texts = t.selectedTrack.entries.text;
                    times = t.selectedTrack.entries.times;
                }

                var htm = "<ul class='mejs-search-list'>";
                for(var i = 0; i < texts.length; i++){
                    htm += "<li class='mejs-search-list__item' data-start='" + times[i].start + "' data-stop='" + times[i].stop + "'><p>" + texts[i] + "</p></li>";
                }
                htm += "</ul>";
                return htm;
            };
           
            function drawSearch() {
                var srtBlock = '<div class="mejs-menu-search">\
                    <div class="mejs-search-inp__block">\
                        <input type="text" class="mejs-search__inp">\
                        <div class="menu-search-header-section">\
                            <span class="menu-search-counter">0 / 0</span>\
                            <span class="menu-search-clear"></span>\
                        </div>\
                    </div>\
                    <div class="mejs-search-srt">'
                        + buildList() + 
                    '</div>\
                </div>' 
        
                return srtBlock;
            };

            function drawShare() {
                var item = getItem();

                var embedCode = '<div id="{ID}">...</div><script type="text/javascript">\
                                var cpo = []; cpo["_object"] ="{ID}"; cpo["_fid"] = "{FID}";\
                                var _cpmp = _cpmp || []; _cpmp.push(cpo);\
                                (function() { var cp = document.createElement("script"); cp.type = "text/javascript";\
                                cp.async = true; cp.src = "https://rtcdn.cincopa.com/libasync.js";\
                                var c = document.getElementsByTagName("script")[0];\
                                c.parentNode.insertBefore(cp, c); })(); </script>'

                    embedCode = embedCode
                        .replaceAll("{ID}", 'cincopa_'+item.rid)
                        .replace("{FID}", 'A4HAcLOLOO68!'+item.rid)


                var gifCode = '<a href="{link}"  target="_blank"><img src="{src}" width="400" height="225" alt="{title}" /></a>';
                var imageUrl;
                if(item.content_url){
                    imageUrl  = item.content_url.slice(0, -4) + ".gif?t=y&force=y&args=start_sec," + 0 + ",duration," + 5 + ",fps,10"
                }

                gifCode = gifCode
                        .replace("{src}", imageUrl)
                        .replace("{link}",item.link)
                        .replace("{title}",item.title || '');
                

                var htm = '<div class="mejs-menu-share">\
                                <div class="menu-share-accountsite">\
                                    <p class="accountsite__share">\
                                        <a class="accountsite__url copyArea">https://www.cincopa.com/media-platform/wizard2/library15</a>\
                                    </p>\
                                    <a class="mejs-accountsite__btn--copy">Copy Url </a>\
                                </div>\
                                <div class="menu-share-embed">\
                                    <textarea rows="10" class="embed__txtArea copyArea">' + embedCode + '</textarea>\
                                    <a class="mejs-share__btn--copy">Copy Embed Code </a>\
                                </div>\
                                <div class="menu-share-gif">\
                                    <textarea rows="5" class="gif__txtArea copyArea">' + gifCode + '</textarea>\
                                    <a class="mejs-gif__btn--copy">Copy Gif </a>\
                                </div>\
                            </div>';
                            
                return htm;
            };
           
            function drawTitle() {
                var item = getItem();
                return $('<p class="menu-overlay__title">' + item.title + '</p>');
            };

            function drawAttachment() {
                var item = getItem();
                var attachmets = item.extra_files;
                var htm = '<div class="menu-attachements-block">';
                if (attachmets && attachmets.length) {
                    for(var i = 0; i < attachmets.length; i++) {
                        var param = attachmets[i].url.indexOf('?') > - 1 ? '&m=y' : '?m=y'
                        htm += '<a class="mejs-menu-attachements" href="' + attachmets[i].url + param + '" target="_blank">\
                        <div class="menu-attachements-container">\
                        <div class="menu-attachements-info">\
                                            <p class="attachements-info__name">' + attachmets[i].filename + '</p>\
                                            <p class="attachements-info__url">' + attachmets[i].url + '</p>\
                                        </div>\
                                        <p class="menu-attachements__download"></p>\
                                    </div>\
                                </a>'
                    }
                }
                htm+='</div>'
                return htm;
            };

            function drawSubMenus () {
                var oldBlocks = $('.mejs-menu-blocks', menu);
                var oldTitle = $('.menu-overlay__title', menuOverlay);

                if(oldBlocks.length){
                    oldBlocks.remove();
                }

                if(oldTitle) {
                    oldTitle.remove()
                }

                var $title = drawTitle();
                menuOverlay.append($title)                        
                var $notesBlock =  $('<div class="mejs-menu-blocks mejs-menu-notes__block">\
                                        <div class="mejs-menu-blocks__header">Notes</div>\
                                        <div class="mejs-menu-blocks__main">'+ drawNotes() + '</div>\
                                    </div>');

                var $searchBlock = $('<div class="mejs-menu-blocks mejs-menu-search__block cp-hide">\
                                        <div class="mejs-menu-blocks__header">Search</div>\
                                        <div class="mejs-menu-blocks__main"></div>\
                                    </div>');

                var $shareBlock = $('<div class="mejs-menu-blocks mejs-menu-share__block cp-hide">\
                                        <div class="mejs-menu-blocks__header">Share</div>\
                                        <div class="mejs-menu-blocks__main">'+ drawShare() + '</div>\
                                    </div>');

                var $attachmentBlock =  $('<div class="mejs-menu-blocks mejs-menu-attachment__block cp-hide">\
                                            <div class="mejs-menu-blocks__header">Attachment</div>\
                                            <div class="mejs-menu-blocks__main">'+ drawAttachment() + '</div>\
                                        </div>'); 
                
                

                menuContainer.append($notesBlock).append($searchBlock).append($shareBlock).append($attachmentBlock);
                $('.mejs-menu-btns').removeClass('mejs-menu-btns--active');
                notesBtn.addClass('mejs-menu-btns--active');

                $('.mejs-accountsite__btn--copy, .mejs-share__btn--copy, .mejs-gif__btn--copy').on('click', function(){
                    var copiedText = $(this).parent().find('.copyArea').html()
                    console.log(copiedText)
                    executeCopy(copiedText)
                });
            };

            media.cincopaAddEventListener('loadeddata', function (e) {
                drawSubMenus();                  
            });
            
           
            media.cincopaAddEventListener('selectedTrack', function(){
                var htm = drawSearch();
                $('.mejs-menu-search').remove();
                $('.mejs-menu-search__block .mejs-menu-blocks__main').append($(htm));

                var input = $('.mejs-search__inp');
                var list = $('.mejs-search-list');
                var headerSection = $('.menu-search-header-section');

                var inputTimer;
                var keyupTimer;
                var isVisible = false;
                var ignoreNextScrollEvent = false;
                var preventAutoScrool = false;
                var timer = null;

                media.cincopaAddEventListener('timeupdate', function (e) {
                    var time = media.currentTime;
                    var listItems = list.find("li");
                    listItems.each(function(){
                        var start = + $(this).attr("data-start") ;
                        var stop = + $(this).attr("data-stop") ;
                        if(start < time && time < stop){
                            if(!$(this).hasClass("mejs-search-list-active")){
                                $(this).addClass("mejs-search-list-active");
                                scrollToActive();
                            }
                        } else {
                            $(this).removeClass("mejs-search-list-active")
                        }
                    });
                });

                function scrollToActive(){
                    var active_item = list.find(".mejs-search-list-active");
                    if(active_item.length){
                        var active_item_top = active_item.position().top;
                        if(!preventAutoScrool){
                            ignoreNextScrollEvent = true;
                            $('.mejs-menu-search__block .mejs-menu-blocks__main').animate({
                                scrollTop: 100
                            }, 100, function() {
                                setTimeout(function(){
                                    ignoreNextScrollEvent = false;
                                }, 100)
                            });
                        }
                    }
                };

                function scrollToElement(elem){
                    if(elem.length){
                        var top = elem.position().top;
                        ignoreNextScrollEvent = true;
                        $('.mejs-menu-search__block .mejs-menu-blocks__main').animate({
                            scrollTop: 100
                        }, 100, function() {
                            setTimeout(function(){
                                ignoreNextScrollEvent = false;
                            }, 100)
                        });
                    }
                }

                list.on("click", "li", function(){
                    var start = + $(this).attr("data-start");
                    player.setCurrentTime(start);
                    media.play()
                });

                $('.mejs-menu-search__block .mejs-menu-blocks__main').on("scroll", function(){
                    if(!ignoreNextScrollEvent){
                        preventAutoScrool = true;
                        clearTimeout(timer);
                        timer = setTimeout(function(){
                            preventAutoScrool = false;
                            scrollToActive()
                        }, 10000)
                    }
                });

                input.on("keydown", function(e){
                    e.stopImmediatePropagation();
                });

                input.on("input", function(){
                    clearTimeout(inputTimer);
                    var that = this;
                    inputTimer = setTimeout(function(){

                        var value  = $(that).val().trim();
                        if(value){
                            headerSection.show()
                        } else {
                            headerSection.hide()
                        }
                        var items = list.find("p");
                        var counter = 0;
                        items.each(function(){
                            var text = $(this).html();
                            text = text.replace(/<\/?span[^>]*>/g,"");
                            $(this).html(text);

                            if(text.toLowerCase().indexOf(value.toLowerCase()) > -1){
                                var occ_count = text.toLowerCase().split(value.toLowerCase()).length - 1;
                                text = text.replace(new RegExp(value, 'gi'), function(str) {return "<span class='mejs-transcript-search-list-highlight'>" + str + "</span>"});							
                                $(this).html(text);
                                $(this).parent().addClass("mejs-transcript-search-list-highlighted");
                                $(this).parent().attr("data-highlighted", occ_count);						
                                counter +=occ_count;
                                
                            } else {
                                $(this).html(text);
                                $(this).parent().removeClass("mejs-transcript-search-list-highlighted");
                                $(this).parent().attr("data-highlighted", 0)
                            }

                            headerSection.find(".menu-search-counter").text("0 / " + counter);
                        });
                        if(counter){
                            var e = zeQuery.Event("keyup");
                            e.which = 13;
                            input.trigger(e);						
                        }
                    },250);
                });

                input.on("keyup", function(e){
                    clearTimeout(keyupTimer)
                    var that = this;
                    keyupTimer = setTimeout(function(){
                        if(e.which === 13 && input.val()){
                            var text = headerSection.find(".menu-search-counter").text();
                            var splitted = text.split(" ");
                            var order = splitted[0];
                            var count = splitted[splitted.length - 1];
                            order = +order;
                            if(order >= count) order = 0;
                            splitted[0] = order + 1;

                            if(count > 0){
                                headerSection.find(".menu-search-counter").text(splitted.join(" "));
                                var c = 0;
                                list.find(".mejs-transcript-search-list-highlighted").each(function(){
                                    var highlighted_count = +($(this).attr("data-highlighted") || 0);
                                    c += highlighted_count;
                                    if(c >= order + 1){
                                        var elem = $(this);
                                        scrollToElement(elem)
                                        preventAutoScrool = true;
                                        clearTimeout(timer);
                                        timer = setTimeout(function(){
                                            preventAutoScrool = false;
                                            scrollToActive()
                                        }, 10000);
                                        return false;
                                    }
                                })

                                
                            }
                        }
                    },300);
                });
            });

            menu.find('.mejs-menu-btns').on('click', function(){
                 if( $(this).hasClass('mejs-menu-btns--active') )  return;

                 menu.find('.mejs-menu-btns').removeClass('mejs-menu-btns--active');
                 $(this).addClass('mejs-menu-btns--active');

                 var dataBlock = $(this).data('block');
                 menu.find('.mejs-menu-blocks').addClass('cp-hide');
                 menu.find('.mejs-menu-'+dataBlock+'__block').removeClass('cp-hide');
            });

            var playerContainer = player.container;
            menuBlock.on('click', function() {
                $(window).trigger('resize');
                notesBtn.trigger('click');
                playerContainer.toggleClass('mejs-container-animation');
                
                if(playerContainer.hasClass('mejs-container-animation')) {
                    playerContainer.removeClass('mejs-container-animation--remove').addClass('mejs-container-animation--add');
                } else {
                    playerContainer.removeClass('mejs-container-animation--add').addClass('mejs-container-animation--remove');
                }
            });
        }
    })

})(zeQuery);
////videoMenu////
/* exception2 //rtcdn.cincopa.com/fpskins/mediaelement/1/js/zequery-mediaelement-universal.js - err missing ; after for-loop initializer */
// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/js/zequery.flexslider.js  D:\WebSites\tmpCincopaAppsV2\_cms/fpskins/mediaelement/1/js/zequery.flexslider.js   3/21/2022 9:13:17 AM 
_cp_preloaded_files["/fpskins/mediaelement/1/js/zequery.flexslider.js"] = true;
(function(a){a.flexslider=function(d,k){var m=a(d);m.vars=a.extend({},a.flexslider.defaults,k);var j=m.vars.namespace,i=window.navigator&&window.navigator.msPointerEnabled&&window.MSGesture,n=(("ontouchstart" in window)||i||window.DocumentTouch&&document instanceof DocumentTouch)&&m.vars.touch,e="click touchend MSPointerUp keyup",p="",q,o=m.vars.direction==="vertical",l=m.vars.reverse,c=(m.vars.itemWidth>0),f=m.vars.animation==="fade",b=m.vars.asNavFor!=="",h={},g=true;a.data(d,"flexslider",m);h={init:function(){m.animating=false;m.currentSlide=parseInt((m.vars.startAt?m.vars.startAt:0),10);if(isNaN(m.currentSlide)){m.currentSlide=0}m.animatingTo=m.currentSlide;m.atEnd=(m.currentSlide===0||m.currentSlide===m.last);m.containerSelector=m.vars.selector.substr(0,m.vars.selector.search(" "));m.slides=a(m.vars.selector,m);m.container=a(m.containerSelector,m);m.count=m.slides.length;m.syncExists=a(m.vars.sync).length>0;if(m.vars.animation==="slide"){m.vars.animation="swing"}m.prop=(o)?"top":"marginLeft";m.args={};m.manualPause=false;m.stopped=false;m.started=false;m.startTimeout=null;m.transitions=!m.vars.video&&!f&&m.vars.useCSS&&(function(){var s=document.createElement("div"),t=["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"];for(var r in t){if(s.style[t[r]]!==undefined){m.pfx=t[r].replace("Perspective","").toLowerCase();m.prop="-"+m.pfx+"-transform";return true}}return false}());m.ensureAnimationEnd="";if(m.vars.controlsContainer!==""){m.controlsContainer=a(m.vars.controlsContainer).length>0&&a(m.vars.controlsContainer)}if(m.vars.manualControls!==""){m.manualControls=a(m.vars.manualControls).length>0&&a(m.vars.manualControls)}if(m.vars.randomize){m.slides.sort(function(){return(Math.round(Math.random())-0.5)});m.container.empty().append(m.slides)}m.doMath();m.setup("init");if(m.vars.controlNav){h.controlNav.setup()}if(m.vars.directionNav){h.directionNav.setup()}if(m.vars.keyboard&&(a(m.containerSelector).length===1||m.vars.multipleKeyboard)){a(document).bind("keyup",function(r){var s=r.keyCode;if(!m.animating&&(s===39||s===37)){var t=(s===39)?m.getTarget("next"):(s===37)?m.getTarget("prev"):false;m.flexAnimate(t,m.vars.pauseOnAction)}})}if(m.vars.mousewheel){m.bind("mousewheel",function(u,r,s,t){u.preventDefault();var v=(r<0)?m.getTarget("next"):m.getTarget("prev");m.flexAnimate(v,m.vars.pauseOnAction)})}if(m.vars.pausePlay){h.pausePlay.setup()}if(m.vars.slideshow&&m.vars.pauseInvisible){h.pauseInvisible.init()}if(m.vars.slideshow){if(m.vars.pauseOnHover){m.hover(function(){if(!m.manualPlay&&!m.manualPause){m.pause()}},function(){if(!m.manualPause&&!m.manualPlay&&!m.stopped){m.play()}})}if(!m.vars.pauseInvisible||!h.pauseInvisible.isHidden()){(m.vars.initDelay>0)?m.startTimeout=setTimeout(m.play,m.vars.initDelay):m.play()}}if(b){h.asNav.setup()}if(n&&m.vars.touch){h.touch()}if(!f||(f&&m.vars.smoothHeight)){a(window).bind("resize orientationchange focus",h.resize)}m.find("img").attr("draggable","false");setTimeout(function(){m.vars.start(m)},200)},asNav:{setup:function(){m.asNav=true;m.animatingTo=Math.floor(m.currentSlide/m.move);m.currentItem=m.currentSlide;m.slides.removeClass(j+"active-slide").eq(m.currentItem).addClass(j+"active-slide");if(!i){m.slides.on(e,function(s){s.preventDefault();var r=a(this),u=r.index();var t=r.offset().left-a(m).scrollLeft();if(t<=0&&r.hasClass(j+"active-slide")){m.flexAnimate(m.getTarget("prev"),true)}else{if(!a(m.vars.asNavFor).data("flexslider").animating&&!r.hasClass(j+"active-slide")){m.direction=(m.currentItem<u)?"next":"prev";m.flexAnimate(u,m.vars.pauseOnAction,false,true,true)}}})}else{d._slider=m;m.slides.each(function(){var r=this;r._gesture=new MSGesture();r._gesture.target=r;r.cincopaAddEventListener("MSPointerDown",function(s){s.preventDefault();if(s.currentTarget._gesture){s.currentTarget._gesture.addPointer(s.pointerId)}},false);r.cincopaAddEventListener("MSGestureTap",function(t){t.preventDefault();var s=a(this),u=s.index();if(!a(m.vars.asNavFor).data("flexslider").animating&&!s.hasClass("active")){m.direction=(m.currentItem<u)?"next":"prev";m.flexAnimate(u,m.vars.pauseOnAction,false,true,true)}})})}}},controlNav:{setup:function(){if(!m.manualControls){h.controlNav.setupPaging()}else{h.controlNav.setupManual()}},setupPaging:function(){var w=(m.vars.controlNav==="thumbnails")?"control-thumbs":"control-paging",u=1,t,v;m.controlNavScaffold=a('<ol class="'+j+"control-nav "+j+w+'"></ol>');if(m.pagingCount>1){for(var s=0;s<m.pagingCount;s++){v=m.slides.eq(s);t=(m.vars.controlNav==="thumbnails")?'<img src="'+v.attr("data-thumb")+'"/>':"<a>"+u+"</a>";if("thumbnails"===m.vars.controlNav&&true===m.vars.thumbCaptions){var r=v.attr("data-thumbcaption");if(""!=r&&undefined!=r){t+='<span class="'+j+'caption">'+r+"</span>"}}m.controlNavScaffold.append("<li>"+t+"</li>");u++}}(m.controlsContainer)?a(m.controlsContainer).append(m.controlNavScaffold):m.append(m.controlNavScaffold);h.controlNav.set();h.controlNav.active();m.controlNavScaffold.delegate("a, img",e,function(y){y.preventDefault();if(p===""||p===y.type){var x=a(this),z=m.controlNav.index(x);if(!x.hasClass(j+"active")){m.direction=(z>m.currentSlide)?"next":"prev";m.flexAnimate(z,m.vars.pauseOnAction)}}if(p===""){p=y.type}h.setToClearWatchedEvent()})},setupManual:function(){m.controlNav=m.manualControls;h.controlNav.active();m.controlNav.bind(e,function(s){s.preventDefault();if(p===""||p===s.type){var r=a(this),t=m.controlNav.index(r);if(!r.hasClass(j+"active")){(t>m.currentSlide)?m.direction="next":m.direction="prev";m.flexAnimate(t,m.vars.pauseOnAction)}}if(p===""){p=s.type}h.setToClearWatchedEvent()})},set:function(){var r=(m.vars.controlNav==="thumbnails")?"img":"a";m.controlNav=a("."+j+"control-nav li "+r,(m.controlsContainer)?m.controlsContainer:m)},active:function(){m.controlNav.removeClass(j+"active").eq(m.animatingTo).addClass(j+"active")},update:function(r,s){if(m.pagingCount>1&&r==="add"){m.controlNavScaffold.append(a("<li><a>"+m.count+"</a></li>"))}else{if(m.pagingCount===1){m.controlNavScaffold.find("li").remove()}else{m.controlNav.eq(s).closest("li").remove()}}h.controlNav.set();(m.pagingCount>1&&m.pagingCount!==m.controlNav.length)?m.update(s,r):h.controlNav.active()}},directionNav:{setup:function(){var r=a('<ul class="'+j+'direction-nav"><li><a class="'+j+'prev" href="#">'+m.vars.prevText+'</a></li><li><a class="'+j+'next" href="#">'+m.vars.nextText+"</a></li></ul>");if(m.controlsContainer){a(m.controlsContainer).append(r);m.directionNav=a("."+j+"direction-nav li a",m.controlsContainer)}else{m.append(r);m.directionNav=a("."+j+"direction-nav li a",m)}h.directionNav.update();m.directionNav.bind(e,function(s){s.preventDefault();var t;if(p===""||p===s.type){t=(a(this).hasClass(j+"next"))?m.getTarget("next"):m.getTarget("prev");m.flexAnimate(t,m.vars.pauseOnAction)}if(p===""){p=s.type}h.setToClearWatchedEvent()})},update:function(){var r=j+"disabled";if(m.pagingCount===1){m.directionNav.addClass(r).attr("tabindex","-1")}else{if(!m.vars.animationLoop){if(m.animatingTo===0){m.directionNav.removeClass(r).filter("."+j+"prev").addClass(r).attr("tabindex","-1")}else{if(m.animatingTo===m.last){m.directionNav.removeClass(r).filter("."+j+"next").addClass(r).attr("tabindex","-1")}else{m.directionNav.removeClass(r).removeAttr("tabindex")}}}else{m.directionNav.removeClass(r).removeAttr("tabindex")}}}},pausePlay:{setup:function(){var r=a('<div class="'+j+'pauseplay"><a></a></div>');if(m.controlsContainer){m.controlsContainer.append(r);m.pausePlay=a("."+j+"pauseplay a",m.controlsContainer)}else{m.append(r);m.pausePlay=a("."+j+"pauseplay a",m)}h.pausePlay.update((m.vars.slideshow)?j+"pause":j+"play");m.pausePlay.bind(e,function(s){s.preventDefault();if(p===""||p===s.type){if(a(this).hasClass(j+"pause")){m.manualPause=true;m.manualPlay=false;m.pause()}else{m.manualPause=false;m.manualPlay=true;m.play()}}if(p===""){p=s.type}h.setToClearWatchedEvent()})},update:function(r){(r==="play")?m.pausePlay.removeClass(j+"pause").addClass(j+"play").html(m.vars.playText):m.pausePlay.removeClass(j+"play").addClass(j+"pause").html(m.vars.pauseText)}},touch:function(){var F,G,w,s,t,E,D=false,u=0,v=0,r=0;if(!i){d.cincopaAddEventListener("touchstart",C,false);function C(H){if(m.animating){H.preventDefault()}else{if((window.navigator.msPointerEnabled)||H.touches.length===1){m.pause();s=(o)?m.h:m.w;E=Number(new Date());u=H.touches[0].pageX;v=H.touches[0].pageY;w=(c&&l&&m.animatingTo===m.last)?0:(c&&l)?m.limit-(((m.itemW+m.vars.itemMargin)*m.move)*m.animatingTo):(c&&m.currentSlide===m.last)?m.limit:(c)?((m.itemW+m.vars.itemMargin)*m.move)*m.currentSlide:(l)?(m.last-m.currentSlide+m.cloneOffset)*s:(m.currentSlide+m.cloneOffset)*s;F=(o)?v:u;G=(o)?u:v;d.cincopaAddEventListener("touchmove",B,false);d.cincopaAddEventListener("touchend",A,false)}}}function B(H){u=H.touches[0].pageX;v=H.touches[0].pageY;t=(o)?F-v:F-u;D=(o)?(Math.abs(t)<Math.abs(u-G)):(Math.abs(t)<Math.abs(v-G));var I=500;if(!D||Number(new Date())-E>I){H.preventDefault();if(!f&&m.transitions){if(!m.vars.animationLoop){t=t/((m.currentSlide===0&&t<0||m.currentSlide===m.last&&t>0)?(Math.abs(t)/s+2):1)}m.setProps(w+t,"setTouch")}}}function A(H){d.removeEventListener("touchmove",B,false);if(m.animatingTo===m.currentSlide&&!D&&!(t===null)){var J=(l)?-t:t,I=(J>0)?m.getTarget("next"):m.getTarget("prev");if(m.canAdvance(I)&&(Number(new Date())-E<550&&Math.abs(J)>50||Math.abs(J)>s/2)){m.flexAnimate(I,m.vars.pauseOnAction)}else{if(!f){m.flexAnimate(m.currentSlide,m.vars.pauseOnAction,true)}}}d.removeEventListener("touchend",A,false);F=null;G=null;t=null;w=null}}else{d.style.msTouchAction="none";d._gesture=new MSGesture();d._gesture.target=d;d.cincopaAddEventListener("MSPointerDown",z,false);d._slider=m;d.cincopaAddEventListener("MSGestureChange",x,false);d.cincopaAddEventListener("MSGestureEnd",y,false);function z(H){H.stopPropagation();if(m.animating){H.preventDefault()}else{m.pause();d._gesture.addPointer(H.pointerId);r=0;s=(o)?m.h:m.w;E=Number(new Date());w=(c&&l&&m.animatingTo===m.last)?0:(c&&l)?m.limit-(((m.itemW+m.vars.itemMargin)*m.move)*m.animatingTo):(c&&m.currentSlide===m.last)?m.limit:(c)?((m.itemW+m.vars.itemMargin)*m.move)*m.currentSlide:(l)?(m.last-m.currentSlide+m.cloneOffset)*s:(m.currentSlide+m.cloneOffset)*s}}function x(H){H.stopPropagation();var I=H.target._slider;if(!I){return}var J=-H.translationX,K=-H.translationY;r=r+((o)?K:J);t=r;D=(o)?(Math.abs(r)<Math.abs(-J)):(Math.abs(r)<Math.abs(-K));if(H.detail===H.MSGESTURE_FLAG_INERTIA){setImmediate(function(){d._gesture.stop()});return}if(!D||Number(new Date())-E>500){H.preventDefault();if(!f&&I.transitions){if(!I.vars.animationLoop){t=r/((I.currentSlide===0&&r<0||I.currentSlide===I.last&&r>0)?(Math.abs(r)/s+2):1)}I.setProps(w+t,"setTouch")}}}function y(H){H.stopPropagation();var I=H.target._slider;if(!I){return}if(I.animatingTo===I.currentSlide&&!D&&!(t===null)){var K=(l)?-t:t,J=(K>0)?I.getTarget("next"):I.getTarget("prev");if(I.canAdvance(J)&&(Number(new Date())-E<550&&Math.abs(K)>50||Math.abs(K)>s/2)){I.flexAnimate(J,I.vars.pauseOnAction)}else{if(!f){I.flexAnimate(I.currentSlide,I.vars.pauseOnAction,true)}}}F=null;G=null;t=null;w=null;r=0}}},resize:function(){if(!m.animating&&m.is(":visible")){if(!c){m.doMath()}if(f){h.smoothHeight()}else{if(c){m.slides.width(m.computedW);m.update(m.pagingCount);m.setProps()}else{if(o){m.viewport.height(m.h);m.setProps(m.h,"setTotal")}else{if(m.vars.smoothHeight){h.smoothHeight()}m.newSlides.width(m.computedW);m.setProps(m.computedW,"setTotal")}}}}},smoothHeight:function(s){if(!o||f){var r=(f)?m:m.viewport;(s)?r.animate({height:m.slides.eq(m.animatingTo).height()},s):r.height(m.slides.eq(m.animatingTo).height())}},sync:function(s){var r=a(m.vars.sync).data("flexslider"),t=m.animatingTo;switch(s){case"animate":r.flexAnimate(t,m.vars.pauseOnAction,false,true);break;case"play":if(!r.playing&&!r.asNav){r.play()}break;case"pause":r.pause();break}},uniqueID:function(r){r.filter("[id]").add(r.find("[id]")).each(function(){var s=a(this);s.attr("id",s.attr("id")+"_clone")});return r},pauseInvisible:{visProp:null,init:function(){var t=["webkit","moz","ms","o"];if("hidden" in document){return"hidden"}for(var s=0;s<t.length;s++){if((t[s]+"Hidden") in document){h.pauseInvisible.visProp=t[s]+"Hidden"}}if(h.pauseInvisible.visProp){var r=h.pauseInvisible.visProp.replace(/[H|h]idden/,"")+"visibilitychange";document.cincopaAddEventListener(r,function(){if(h.pauseInvisible.isHidden()){if(m.startTimeout){clearTimeout(m.startTimeout)}else{m.pause()}}else{if(m.started){m.play()}else{(m.vars.initDelay>0)?setTimeout(m.play,m.vars.initDelay):m.play()}}})}},isHidden:function(){return document[h.pauseInvisible.visProp]||false}},setToClearWatchedEvent:function(){clearTimeout(q);q=setTimeout(function(){p=""},3000)}};m.flexAnimate=function(z,x,w,A,t){if(!m.vars.animationLoop&&z!==m.currentSlide){m.direction=(z>m.currentSlide)?"next":"prev"}if(b&&m.pagingCount===1){m.direction=(m.currentItem<z)?"next":"prev"}if(!m.animating&&(m.canAdvance(z,t)||w)&&m.is(":visible")){if(b&&A){var v=a(m.vars.asNavFor).data("flexslider");m.atEnd=z===0||z===m.count-1;v.flexAnimate(z,true,false,true,t);m.direction=(m.currentItem<z)?"next":"prev";v.direction=m.direction;if(Math.ceil((z+1)/m.visible)-1!==m.currentSlide&&z!==0){m.currentItem=z;m.slides.removeClass(j+"active-slide").eq(z).addClass(j+"active-slide");z=Math.floor(z/m.visible)}else{m.currentItem=z;m.slides.removeClass(j+"active-slide").eq(z).addClass(j+"active-slide");return false}}m.animating=true;m.animatingTo=z;if(x){m.pause()}m.vars.before(m);if(m.syncExists&&!t){h.sync("animate")}if(m.vars.controlNav){h.controlNav.active()}if(!c){m.slides.removeClass(j+"active-slide").eq(z).addClass(j+"active-slide")}m.atEnd=z===0||z===m.last;if(m.vars.directionNav){h.directionNav.update()}if(z===m.last){m.vars.end(m);if(!m.vars.animationLoop){m.pause()}}if(!f){var s=(o)?m.slides.filter(":first").height():m.computedW,u,y,r;if(c){u=m.vars.itemMargin;r=((m.itemW+u)*m.move)*m.animatingTo;y=(r>m.limit&&m.visible!==1)?m.limit:r}else{if(m.currentSlide===0&&z===m.count-1&&m.vars.animationLoop&&m.direction!=="next"){y=(l)?(m.count+m.cloneOffset)*s:0}else{if(m.currentSlide===m.last&&z===0&&m.vars.animationLoop&&m.direction!=="prev"){y=(l)?0:(m.count+1)*s}else{y=(l)?((m.count-1)-z+m.cloneOffset)*s:(z+m.cloneOffset)*s}}}m.setProps(y,"",m.vars.animationSpeed);if(m.transitions){if(!m.vars.animationLoop||!m.atEnd){m.animating=false;m.currentSlide=m.animatingTo}m.container.unbind("webkitTransitionEnd transitionend");m.container.bind("webkitTransitionEnd transitionend",function(){clearTimeout(m.ensureAnimationEnd);m.wrapup(s)});clearTimeout(m.ensureAnimationEnd);m.ensureAnimationEnd=setTimeout(function(){m.wrapup(s)},m.vars.animationSpeed+100)}else{m.container.animate(m.args,m.vars.animationSpeed,m.vars.easing,function(){m.wrapup(s)})}}else{if(!n){m.slides.eq(m.currentSlide).css({zIndex:1}).animate({opacity:0},m.vars.animationSpeed,m.vars.easing);m.slides.eq(z).css({zIndex:2}).animate({opacity:1},m.vars.animationSpeed,m.vars.easing,m.wrapup)}else{m.slides.eq(m.currentSlide).css({opacity:0,zIndex:1});m.slides.eq(z).css({opacity:1,zIndex:2});m.wrapup(s)}}if(m.vars.smoothHeight){h.smoothHeight(m.vars.animationSpeed)}}};m.wrapup=function(r){if(!f&&!c){if(m.currentSlide===0&&m.animatingTo===m.last&&m.vars.animationLoop){m.setProps(r,"jumpEnd")}else{if(m.currentSlide===m.last&&m.animatingTo===0&&m.vars.animationLoop){m.setProps(r,"jumpStart")}}}m.animating=false;m.currentSlide=m.animatingTo;m.vars.after(m)};m.animateSlides=function(){if(!m.animating&&g){m.flexAnimate(m.getTarget("next"))}};m.pause=function(){clearInterval(m.animatedSlides);m.animatedSlides=null;m.playing=false;if(m.vars.pausePlay){h.pausePlay.update("play")}if(m.syncExists){h.sync("pause")}};m.play=function(){if(m.playing){clearInterval(m.animatedSlides)}m.animatedSlides=m.animatedSlides||setInterval(m.animateSlides,m.vars.slideshowSpeed);m.started=m.playing=true;if(m.vars.pausePlay){h.pausePlay.update("pause")}if(m.syncExists){h.sync("play")}};m.stop=function(){m.pause();m.stopped=true};m.canAdvance=function(t,r){var s=(b)?m.pagingCount-1:m.last;return(r)?true:(b&&m.currentItem===m.count-1&&t===0&&m.direction==="prev")?true:(b&&m.currentItem===0&&t===m.pagingCount-1&&m.direction!=="next")?false:(t===m.currentSlide&&!b)?false:(m.vars.animationLoop)?true:(m.atEnd&&m.currentSlide===0&&t===s&&m.direction!=="next")?false:(m.atEnd&&m.currentSlide===s&&t===0&&m.direction==="next")?false:true};m.getTarget=function(r){m.direction=r;if(r==="next"){return(m.currentSlide===m.last)?0:m.currentSlide+1}else{return(m.currentSlide===0)?m.last:m.currentSlide-1}};m.setProps=function(s,t,r){var u=(function(){var w=(s)?s:((m.itemW+m.vars.itemMargin)*m.move)*m.animatingTo,v=(function(){if(c){return(t==="setTouch")?s:(l&&m.animatingTo===m.last)?0:(l)?m.limit-(((m.itemW+m.vars.itemMargin)*m.move)*m.animatingTo):(m.animatingTo===m.last)?m.limit:w}else{switch(t){case"setTotal":return(l)?((m.count-1)-m.currentSlide+m.cloneOffset)*s:(m.currentSlide+m.cloneOffset)*s;case"setTouch":return(l)?s:s;case"jumpEnd":return(l)?s:m.count*s;case"jumpStart":return(l)?m.count*s:s;default:return s}}}());return(v*-1)+"px"}());if(m.transitions){u=(o)?"translate3d(0,"+u+",0)":"translate3d("+u+",0,0)";r=(r!==undefined)?(r/1000)+"s":"0s";m.container.css("-"+m.pfx+"-transition-duration",r);m.container.css("transition-duration",r)}m.args[m.prop]=u;if(m.transitions||r===undefined){m.container.css(m.args)}m.container.css("transform",u)};m.setup=function(t){if(!f){var s,r;if(t==="init"){m.viewport=a('<div class="'+j+'viewport"></div>').css({overflow:"hidden",position:"relative"}).appendTo(m).append(m.container);m.cloneCount=0;m.cloneOffset=0;if(l){r=a.makeArray(m.slides).reverse();m.slides=a(r);m.container.empty().append(m.slides)}}if(m.vars.animationLoop&&!c){m.cloneCount=2;m.cloneOffset=1;if(t!=="init"){m.container.find(".clone").remove()}m.container.append(h.uniqueID(m.slides.first().clone().addClass("clone")).attr("aria-hidden","true")).prepend(h.uniqueID(m.slides.last().clone().addClass("clone")).attr("aria-hidden","true"))}m.newSlides=a(m.vars.selector,m);s=(l)?m.count-1-m.currentSlide+m.cloneOffset:m.currentSlide+m.cloneOffset;if(o&&!c){m.container.height((m.count+m.cloneCount)*200+"%").css("position","absolute").width("100%");setTimeout(function(){m.newSlides.css({display:"block"});m.doMath();m.viewport.height(m.h);m.setProps(s*m.h,"init")},(t==="init")?100:0)}else{m.container.width((m.count+m.cloneCount)*200+"%");m.setProps(s*m.computedW,"init");setTimeout(function(){m.doMath();m.newSlides.css({width:m.computedW,"float":"left",display:"block"});if(m.vars.smoothHeight){h.smoothHeight()}},(t==="init")?100:0)}}else{m.slides.css({width:"100%","float":"left",marginRight:"-100%",position:"relative"});if(t==="init"){if(!n){if(m.vars.fadeFirstSlide==false){m.slides.css({opacity:0,display:"block",zIndex:1}).eq(m.currentSlide).css({zIndex:2}).css({opacity:1})}else{m.slides.css({opacity:0,display:"block",zIndex:1}).eq(m.currentSlide).css({zIndex:2}).animate({opacity:1},m.vars.animationSpeed,m.vars.easing)}}else{m.slides.css({opacity:0,display:"block",webkitTransition:"opacity "+m.vars.animationSpeed/1000+"s ease",zIndex:1}).eq(m.currentSlide).css({opacity:1,zIndex:2})}}if(m.vars.smoothHeight){h.smoothHeight()}}if(!c){m.slides.removeClass(j+"active-slide").eq(m.currentSlide).addClass(j+"active-slide")}m.vars.init(m)};m.doMath=function(){var t=m.slides.first(),u=m.vars.itemMargin,s=m.vars.minItems,r=m.vars.maxItems;m.w=(m.viewport===undefined)?m.width():m.viewport.width();m.h=t.height();m.boxPadding=t.outerWidth()-t.width();if(c){m.itemT=m.vars.itemWidth+u;m.minW=(s)?s*m.itemT:m.w;m.maxW=(r)?(r*m.itemT)-u:m.w;m.itemW=(m.minW>m.w)?(m.w-(u*(s-1)))/s:(m.maxW<m.w)?(m.w-(u*(r-1)))/r:(m.vars.itemWidth>m.w)?m.w:m.vars.itemWidth;m.visible=Math.floor(m.w/(m.itemW));m.move=(m.vars.move>0&&m.vars.move<m.visible)?m.vars.move:m.visible;m.pagingCount=Math.ceil(((m.count-m.visible)/m.move)+1);m.last=m.pagingCount-1;m.limit=(m.pagingCount===1)?0:(m.vars.itemWidth>m.w)?(m.itemW*(m.count-1))+(u*(m.count-1)):((m.itemW+u)*m.count)-m.w-u}else{m.itemW=m.w;m.pagingCount=m.count;m.last=m.count-1}m.computedW=m.itemW-m.boxPadding};m.update=function(s,r){m.doMath();if(!c){if(s<m.currentSlide){m.currentSlide+=1}else{if(s<=m.currentSlide&&s!==0){m.currentSlide-=1}}m.animatingTo=m.currentSlide}if(m.vars.controlNav&&!m.manualControls){if((r==="add"&&!c)||m.pagingCount>m.controlNav.length){h.controlNav.update("add")}else{if((r==="remove"&&!c)||m.pagingCount<m.controlNav.length){if(c&&m.currentSlide>m.last){m.currentSlide-=1;m.animatingTo-=1}h.controlNav.update("remove",m.last)}}}if(m.vars.directionNav){h.directionNav.update()}};m.addSlide=function(s,t){var r=a(s);m.count+=1;m.last=m.count-1;if(o&&l){(t!==undefined)?m.slides.eq(m.count-t).after(r):m.container.prepend(r)}else{(t!==undefined)?m.slides.eq(t).before(r):m.container.append(r)}m.update(t,"add");m.slides=a(m.vars.selector+":not(.clone)",m);m.setup();m.vars.added(m)};m.removeSlide=function(r){var s=(isNaN(r))?m.slides.index(a(r)):r;m.count-=1;m.last=m.count-1;if(isNaN(r)){a(r,m.slides).remove()}else{(o&&l)?m.slides.eq(m.last).remove():m.slides.eq(r).remove()}m.doMath();m.update(s,"remove");m.slides=a(m.vars.selector+":not(.clone)",m);m.setup();m.vars.removed(m)};h.init()};a.flexslider.defaults={namespace:"flex-",selector:".slides > li",animation:"fade",easing:"swing",direction:"horizontal",reverse:false,animationLoop:true,smoothHeight:false,startAt:0,slideshow:true,slideshowSpeed:7000,animationSpeed:600,initDelay:0,randomize:false,fadeFirstSlide:true,thumbCaptions:false,pauseOnAction:true,pauseOnHover:false,pauseInvisible:true,useCSS:true,touch:true,video:false,controlNav:true,directionNav:true,prevText:"Previous",nextText:"Next",keyboard:true,multipleKeyboard:false,mousewheel:false,pausePlay:false,pauseText:"Pause",playText:"Play",controlsContainer:"",manualControls:"",sync:"",asNavFor:"",itemWidth:0,itemMargin:0,minItems:1,maxItems:0,move:0,allowOneSlide:true,start:function(){},before:function(){},after:function(){},end:function(){},added:function(){},removed:function(){},init:function(){}};a.flexslider.destroy=function(b){b=b?"."+b:".cincopanamespace";a(window).off("blur"+b);a(window).off("focus"+b)};a.fn.flexslider=function(c){if(c===undefined){c={}}if(typeof c==="object"){return this.each(function(){var e=a(this),f=(c.selector)?c.selector:".slides > li",d=e.find(f);if((d.length===1&&c.allowOneSlide===true)||d.length===0){d.fadeIn(400);if(c.start){c.start(e)}}else{if(e.data("flexslider")===undefined){a(window).off("blur"+c.galleryId);a(window).off("focus"+c.galleryId);a(window).on("blur"+c.galleryId,function(g){focused=false}).off("focus"+c.galleryId).on("focus"+c.galleryId,function(g){focused=true});new a.flexslider(this,c)}}})}else{var b=a(this).data("flexslider");switch(c){case"play":b.play();break;case"pause":b.pause();break;case"stop":b.stop();break;case"next":b.flexAnimate(b.getTarget("next"),true);break;case"prev":case"previous":b.flexAnimate(b.getTarget("prev"),true);break;default:if(typeof c==="number"){b.flexAnimate(c,true)}}}}})(zeQuery);
// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/js/nativeLanguages.js  D:\WebSites\tmpCincopaAppsV2\_cms/fpskins/mediaelement/1/js/nativeLanguages.js   3/21/2022 9:13:17 AM 
_cp_preloaded_files["/fpskins/mediaelement/1/js/nativeLanguages.js"] = true;
function get_zeNativeLanguagesArray(){return[{code:"ab",name:"Abkhaz",nativeName:"\u0430\u04A7\u0441\u0443\u0430"},{code:"aa",name:"Afar",nativeName:"Afaraf"},{code:"af",name:"Afrikaans",nativeName:"Afrikaans"},{code:"ak",name:"Akan",nativeName:"Akan"},{code:"sq",name:"Albanian",nativeName:"Shqip"},{code:"am",name:"Amharic",nativeName:"\u12A0\u121B\u122D\u129B"},{code:"ar",name:"Arabic",nativeName:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629"},{code:"an",name:"Aragonese",nativeName:"Aragon\u00E9s"},{code:"hy",name:"Armenian",nativeName:"\u0540\u0561\u0575\u0565\u0580\u0565\u0576"},{code:"as",name:"Assamese",nativeName:"\u0985\u09B8\u09AE\u09C0\u09AF\u09BC\u09BE"},{code:"av",name:"Avaric",nativeName:"\u0430\u0432\u0430\u0440 \u043C\u0430\u0446\u04C0"},{code:"ae",name:"Avestan",nativeName:"avesta"},{code:"ay",name:"Aymara",nativeName:"aymar aru"},{code:"az",name:"Azerbaijani",nativeName:"az\u0259rbaycan dili"},{code:"bm",name:"Bambara",nativeName:"bamanankan"},{code:"ba",name:"Bashkir",nativeName:"\u0431\u0430\u0448\u04A1\u043E\u0440\u0442 \u0442\u0435\u043B\u0435"},{code:"eu",name:"Basque",nativeName:"euskara"},{code:"be",name:"Belarusian",nativeName:"\u0411\u0435\u043B\u0430\u0440\u0443\u0441\u043A\u0430\u044F"},{code:"bn",name:"Bengali",nativeName:"\u09AC\u09BE\u0982\u09B2\u09BE"},{code:"bh",name:"Bihari",nativeName:"\u092D\u094B\u091C\u092A\u0941\u0930\u0940"},{code:"bi",name:"Bislama",nativeName:"Bislama"},{code:"bs",name:"Bosnian",nativeName:"bosanski jezik"},{code:"br",name:"Breton",nativeName:"brezhoneg"},{code:"bg",name:"Bulgarian",nativeName:"\u0431\u044A\u043B\u0433\u0430\u0440\u0441\u043A\u0438 \u0435\u0437\u0438\u043A"},{code:"my",name:"Burmese",nativeName:"\u1017\u1019\u102C\u1005\u102C"},{code:"ca",name:"Catalan; Valencian",nativeName:"Catal\u00E0"},{code:"ch",name:"Chamorro",nativeName:"Chamoru"},{code:"ce",name:"Chechen",nativeName:"\u043D\u043E\u0445\u0447\u0438\u0439\u043D \u043C\u043E\u0442\u0442"},{code:"ny",name:"Chichewa; Chewa; Nyanja",nativeName:"chiChe\u0175a"},{code:"zh",name:"Chinese",nativeName:"\u4E2D\u6587 (Zh\u014Dngw\u00E9n)"},{code:"cv",name:"Chuvash",nativeName:"\u0447\u04D1\u0432\u0430\u0448 \u0447\u04D7\u043B\u0445\u0438"},{code:"kw",name:"Cornish",nativeName:"Kernewek"},{code:"co",name:"Corsican",nativeName:"corsu"},{code:"cr",name:"Cree",nativeName:"\u14C0\u1426\u1403\u152D\u140D\u140F\u1423"},{code:"hr",name:"Croatian",nativeName:"hrvatski"},{code:"cs",name:"Czech",nativeName:"\u010Desky"},{code:"da",name:"Danish",nativeName:"dansk"},{code:"dv",name:"Divehi; Dhivehi; Maldivian;",nativeName:"\u078B\u07A8\u0788\u07AC\u0780\u07A8"},{code:"nl",name:"Dutch",nativeName:"Nederlands"},{code:"en",name:"English",nativeName:"English"},{code:"eo",name:"Esperanto",nativeName:"Esperanto"},{code:"et",name:"Estonian",nativeName:"eesti"},{code:"ee",name:"Ewe",nativeName:"E\u028Begbe"},{code:"fo",name:"Faroese",nativeName:"f\u00F8royskt"},{code:"fj",name:"Fijian",nativeName:"vosa Vakaviti"},{code:"fi",name:"Finnish",nativeName:"suomi"},{code:"fr",name:"French",nativeName:"fran\u00E7ais"},{code:"ff",name:"Fula; Fulah; Pulaar; Pular",nativeName:"Fulfulde"},{code:"gl",name:"Galician",nativeName:"Galego"},{code:"ka",name:"Georgian",nativeName:"\u10E5\u10D0\u10E0\u10D7\u10E3\u10DA\u10D8"},{code:"de",name:"German",nativeName:"Deutsch"},{code:"el",name:"Greek, Modern",nativeName:"\u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC"},{code:"gn",name:"Guaran",nativeName:"Ava\u00F1e\u1EBD"},{code:"gu",name:"Gujarati",nativeName:"\u0A97\u0AC1\u0A9C\u0AB0\u0ABE\u0AA4\u0AC0"},{code:"ht",name:"Haitian",nativeName:"Krey\u00F2l ayisyen"},{code:"ha",name:"Hausa",nativeName:"Hausa, \u0647\u064E\u0648\u064F\u0633\u064E"},{code:"he",name:"Hebrew (modern)",nativeName:"\u05E2\u05D1\u05E8\u05D9\u05EA"},{code:"hz",name:"Herero",nativeName:"Otjiherero"},{code:"hi",name:"Hindi",nativeName:"\u0939\u093F\u0928\u094D\u0926\u0940, \u0939\u093F\u0902\u0926\u0940"},{code:"ho",name:"Hiri Motu",nativeName:"Hiri Motu"},{code:"hu",name:"Hungarian",nativeName:"Magyar"},{code:"ia",name:"Interlingua",nativeName:"Interlingua"},{code:"id",name:"Indonesian",nativeName:"Bahasa Indonesia"},{code:"ie",name:"Interlingue",nativeName:"Originally called Occidental; then Interlingue after WWII"},{code:"ga",name:"Irish",nativeName:"Gaeilge"},{code:"ig",name:"Igbo",nativeName:"As\u1EE5s\u1EE5 Igbo"},{code:"ik",name:"Inupiaq",nativeName:"I\u00F1upiaq"},{code:"io",name:"Ido",nativeName:"Ido"},{code:"is",name:"Icelandic",nativeName:"\u00CDslenska"},{code:"it",name:"Italian",nativeName:"Italiano"},{code:"iu",name:"Inuktitut",nativeName:"\u1403\u14C4\u1483\u144E\u1450\u1466"},{code:"ja",name:"Japanese",nativeName:"\u65E5\u672C\u8A9E (\u306B\u307B\u3093\u3054\uFF0F\u306B\u3063\u307D\u3093\u3054)"},{code:"jv",name:"Javanese",nativeName:"basa Jawa"},{code:"kl",name:"Kalaallisut, Greenlandic",nativeName:"kalaallisut"},{code:"kn",name:"Kannada",nativeName:"\u0C95\u0CA8\u0CCD\u0CA8\u0CA1"},{code:"kr",name:"Kanuri",nativeName:"Kanuri"},{code:"ks",name:"Kashmiri",nativeName:"\u0915\u0936\u094D\u092E\u0940\u0930\u0940, \u0643\u0634\u0645\u064A\u0631\u064A\u200E"},{code:"kk",name:"Kazakh",nativeName:"\u049A\u0430\u0437\u0430\u049B \u0442\u0456\u043B\u0456"},{code:"km",name:"Khmer",nativeName:"\u1797\u17B6\u179F\u17B6\u1781\u17D2\u1798\u17C2\u179A"},{code:"ki",name:"Kikuyu, Gikuyu",nativeName:"G\u0129k\u0169y\u0169"},{code:"rw",name:"Kinyarwanda",nativeName:"Ikinyarwanda"},{code:"ky",name:"Kirghiz, Kyrgyz",nativeName:"\u043A\u044B\u0440\u0433\u044B\u0437 \u0442\u0438\u043B\u0438"},{code:"kv",name:"Komi",nativeName:"\u043A\u043E\u043C\u0438 \u043A\u044B\u0432"},{code:"kg",name:"Kongo",nativeName:"KiKongo"},{code:"ko",name:"Korean",nativeName:"\uD55C\uAD6D\uC5B4 (\u97D3\u570B\u8A9E), \uC870\uC120\uB9D0 (\u671D\u9BAE\u8A9E)"},{code:"ku",name:"Kurdish",nativeName:"Kurd\u00EE, \u0643\u0648\u0631\u062F\u06CC\u200E?"},{code:"kj",name:"Kwanyama, Kuanyama",nativeName:"Kuanyama"},{code:"la",name:"Latin",nativeName:"latine"},{code:"lb",name:"Luxembourgish, Letzeburgesch",nativeName:"L\u00EBtzebuergesch"},{code:"lg",name:"Luganda",nativeName:"Luganda"},{code:"li",name:"Limburgish, Limburgan, Limburger",nativeName:"Limburgs"},{code:"ln",name:"Lingala",nativeName:"Ling\u00E1la"},{code:"lo",name:"Lao",nativeName:"\u0E9E\u0EB2\u0EAA\u0EB2\u0EA5\u0EB2\u0EA7"},{code:"lt",name:"Lithuanian",nativeName:'nativeName":"lietuvi\u0173 kalba'},{code:"lu",name:"Luba-Katanga",nativeName:""},{code:"lv",name:"Latvian",nativeName:"latvie\u0161u valoda"},{code:"gv",name:"Manx",nativeName:"Gaelg"},{code:"mk",name:"Macedonian",nativeName:"\u043C\u0430\u043A\u0435\u0434\u043E\u043D\u0441\u043A\u0438 \u0458\u0430\u0437\u0438\u043A"},{code:"mg",name:"Malagasy",nativeName:"Malagasy fiteny"},{code:"ms",name:"Malay",nativeName:"bahasa Melayu"},{code:"ml",name:"Malayalam",nativeName:"\u0D2E\u0D32\u0D2F\u0D3E\u0D33\u0D02"},{code:"mt",name:"Maltese",nativeName:"Malti"},{code:"mi",name:"Maori",nativeName:"te reo M\u0101ori"},{code:"mr",name:"Marathi (Mara?hi)",nativeName:"\u092E\u0930\u093E\u0920\u0940"},{code:"mh",name:"Marshallese",nativeName:"Kajin M\u0327aje\u013C"},{code:"mn",name:"Mongolian",nativeName:"\u043C\u043E\u043D\u0433\u043E\u043B"},{code:"na",name:"Nauru",nativeName:"Ekakair\u0169 Naoero"},{code:"nv",name:"Navajo, Navaho",nativeName:"Din\u00E9 bizaad"},{code:"nb",name:"Norwegian Bokml",nativeName:"Norsk bokm\u00E5l"},{code:"nd",name:"North Ndebele",nativeName:"isiNdebele"},{code:"ne",name:"Nepali",nativeName:"\u0928\u0947\u092A\u093E\u0932\u0940"},{code:"ng",name:"Ndonga",nativeName:"Owambo"},{code:"nn",name:"Norwegian Nynorsk",nativeName:"Norsk nynorsk"},{code:"no",name:"Norwegian",nativeName:"Norsk"},{code:"ii",name:"Nuosu",nativeName:"\uA188\uA320\uA4BF Nuosuhxop"},{code:"nr",name:"South Ndebele",nativeName:"isiNdebele"},{code:"oc",name:"Occitan",nativeName:"Occitan"},{code:"oj",name:"Ojibwe, Ojibwa",nativeName:"\u140A\u14C2\u1511\u14C8\u142F\u14A7\u140E\u14D0"},{code:"cu",name:"Old Church Slavonic",nativeName:"\u0469\u0437\u044B\u043A\u044A \u0441\u043B\u043E\u0432\u0463\u043D\u044C\u0441\u043A\u044A"},{code:"om",name:"Oromo",nativeName:"Afaan Oromoo"},{code:"or",name:"Oriya",nativeName:"\u0B13\u0B21\u0B3C\u0B3F\u0B06"},{code:"os",name:"Ossetian, Ossetic",nativeName:"\u0438\u0440\u043E\u043D \u00E6\u0432\u0437\u0430\u0433"},{code:"pa",name:"Panjabi, Punjabi",nativeName:"\u0A2A\u0A70\u0A1C\u0A3E\u0A2C\u0A40"},{code:"pi",name:"Pali",nativeName:"\u092A\u093E\u0934\u093F"},{code:"fa",name:"Persian",nativeName:"\u0641\u0627\u0631\u0633\u06CC"},{code:"pl",name:"Polish",nativeName:"polski"},{code:"ps",name:"Pashto, Pushto",nativeName:"\u067E\u069A\u062A\u0648"},{code:"pt",name:"Portuguese",nativeName:"Portugu\u00EAs"},{code:"qu",name:"Quechua",nativeName:"Runa Simi, Kichwa"},{code:"rm",name:"Romansh",nativeName:"rumantsch grischun"},{code:"rn",name:"Kirundi",nativeName:"kiRundi"},{code:"ro",name:"Romanian, Moldavian, Moldovan",nativeName:"rom\u00E2n\u0103"},{code:"ru",name:"Russian",nativeName:"\u0440\u0443\u0441\u0441\u043A\u0438\u0439 \u044F\u0437\u044B\u043A"},{code:"sa",name:"Sanskrit (Sa?sk?ta)",nativeName:"\u0938\u0902\u0938\u094D\u0915\u0943\u0924\u092E\u094D"},{code:"sc",name:"Sardinian",nativeName:"sardu"},{code:"sd",name:"Sindhi",nativeName:"\u0938\u093F\u0928\u094D\u0927\u0940"},{code:"se",name:"Northern Sami",nativeName:"Davvis\u00E1megiella"},{code:"sm",name:"Samoan",nativeName:"gagana faa Samoa"},{code:"sg",name:"Sango",nativeName:"y\u00E2ng\u00E2 t\u00EE s\u00E4ng\u00F6"},{code:"sr",name:"Serbian",nativeName:"\u0441\u0440\u043F\u0441\u043A\u0438 \u0458\u0435\u0437\u0438\u043A"},{code:"gd",name:"Scottish Gaelic; Gaelic",nativeName:"G\u00E0idhlig"},{code:"sn",name:"Shona",nativeName:"chiShona"},{code:"si",name:"Sinhala, Sinhalese",nativeName:"\u0DC3\u0DD2\u0D82\u0DC4\u0DBD"},{code:"sk",name:"Slovak",nativeName:"sloven\u010Dina"},{code:"sl",name:"Slovene",nativeName:"sloven\u0161\u010Dina"},{code:"so",name:"Somali",nativeName:"Soomaaliga"},{code:"st",name:"Southern Sotho",nativeName:"Sesotho"},{code:"es",name:"Spanish",nativeName:"espa\u00F1ol"},{code:"su",name:"Sundanese",nativeName:"Basa Sunda"},{code:"sw",name:"Swahili",nativeName:"Kiswahili"},{code:"ss",name:"Swati",nativeName:"SiSwati"},{code:"sv",name:"Swedish",nativeName:"svenska"},{code:"ta",name:"Tamil",nativeName:"\u0BA4\u0BAE\u0BBF\u0BB4\u0BCD"},{code:"te",name:"Telugu",nativeName:"\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41"},{code:"tg",name:"Tajik",nativeName:"\u0442\u043E\u04B7\u0438\u043A\u04E3"},{code:"th",name:"Thai",nativeName:"\u0E44\u0E17\u0E22"},{code:"ti",name:"Tigrinya",nativeName:"\u1275\u130D\u122D\u129B"},{code:"bo",name:"Tibetan Standard, Tibetan, Central",nativeName:"\u0F56\u0F7C\u0F51\u0F0B\u0F61\u0F72\u0F42"},{code:"tk",name:"Turkmen",nativeName:"T\u00FCrkmen, \u0422\u04AF\u0440\u043A\u043C\u0435\u043D"},{code:"tl",name:"Tagalog",nativeName:"Wikang Tagalog, \u170F\u1712\u1703\u1705\u1714 \u1706\u1704\u170E\u1713\u1704\u1714"},{code:"tn",name:"Tswana",nativeName:"Setswana"},{code:"to",name:"Tonga (Tonga Islands)",nativeName:"faka Tonga"},{code:"tr",name:"Turkish",nativeName:"T\u00FCrk\u00E7e"},{code:"ts",name:"Tsonga",nativeName:"Xitsonga"},{code:"tt",name:"Tatar",nativeName:"\u0442\u0430\u0442\u0430\u0440\u0447\u0430"},{code:"tw",name:"Twi",nativeName:"Twi"},{code:"ty",name:"Tahitian",nativeName:"Reo Tahiti"},{code:"ug",name:"Uighur",nativeName:"Uy\u01A3urq\u0259, \u0626\u06C7\u064A\u063A\u06C7\u0631\u0686\u06D5\u200E"},{code:"uk",name:"Ukrainian",nativeName:"\u0443\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430"},{code:"ur",name:"Urdu",nativeName:"\u0627\u0631\u062F\u0648"},{code:"uz",name:"Uzbek",nativeName:"zbek, \u040E\u0437\u0431\u0435\u043A"},{code:"ve",name:"Venda",nativeName:"Tshiven\u1E13a"},{code:"vi",name:"Vietnamese",nativeName:"Ti\u1EBFng Vi\u1EC7t"},{code:"vo",name:"Volapk",nativeName:"Volap\u00FCk"},{code:"wa",name:"Walloon",nativeName:"Walon"},{code:"cy",name:"Welsh",nativeName:"Cymraeg"},{code:"wo",name:"Wolof",nativeName:"Wollof"},{code:"fy",name:"Western Frisian",nativeName:"Frysk"},{code:"xh",name:"Xhosa",nativeName:"isiXhosa"},{code:"yi",name:"Yiddish",nativeName:"\u05D9\u05D9\u05B4\u05D3\u05D9\u05E9"},{code:"yo",name:"Yoruba",nativeName:"Yor\u00F9b\u00E1"},{code:"za",name:"Zhuang, Chuang",nativeName:"Sa\u026F cue\u014B\u0185"}]};
// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/js/zequery.cookie.js  D:\WebSites\tmpCincopaAppsV2\_cms/fpskins/mediaelement/1/js/zequery.cookie.js   3/21/2022 9:13:17 AM 
_cp_preloaded_files["/fpskins/mediaelement/1/js/zequery.cookie.js"] = true;
(function(a){a.cookie=function(d,i,e){if(arguments.length>1&&String(i)!=="[object Object]"){e=a.extend({},e);if(i===null||i===undefined){e.expires=-1}if(typeof e.expires==="number"){var b=e.expires,h=e.expires=new Date();h.setDate(h.getDate()+b)}i=String(i);var g=[encodeURIComponent(d),"=",e.raw?i:encodeURIComponent(i),e.expires?"; expires="+e.expires.toUTCString():"",e.path?"; path="+e.path:"",e.domain?"; domain="+e.domain:"",e.secure?"; secure":""].join("");if(cincopa&&cincopa.setCookie){return(cincopa.setCookie(g))}else{return false}}e=i||{};var f,c=e.raw?function(j){return j}:decodeURIComponent;return(f=new RegExp("(?:^|; )"+encodeURIComponent(d)+"=([^;]*)").exec(document.cookie))?c(f[1]):null}}(zeQuery));
// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/js/mep-feature-ads.js  D:\WebSites\tmpCincopaAppsV2\_cms/fpskins/mediaelement/1/js/mep-feature-ads.js   3/21/2022 9:13:17 AM 
_cp_preloaded_files["/fpskins/mediaelement/1/js/mep-feature-ads.js"] = true;
(function(a){a("head").append(a("<style>.mejs-ads a {	display: block; 	position: absolute;	right: 0;	top: 0;	width: 100%; 	height: 100%; 	display: block; }.mejs-ads a.ads-image {	background-color: black !important; 	background-size: contain !important; 	background-position: center center !important; 	background-repeat: no-repeat !important; }.mejs-ads a img {	display: block; 	width: 100%; 	height: 100%; 	max-width: 100%; 	max-height: 100%; }.mejs-ads .mejs-ads-skip-block {	display: block; 	position: absolute;	right: 0;	top: 0;	padding: 10px; 	background: #000; 	background: rgba(0,0,0,0.5); 	color: #fff; }.mejs-ads .mejs-ads-skip-button {	cursor: pointer; }.mejs-ads .mejs-ads-skip-button:hover {	text-decoration: underline; }</style>"));a.extend(cincopa_mejs.MepDefaults,{adsPrerollMediaUrl:"",adsPrerollAdUrl:"",adsPrerollAdEnableSkip:true,adsPrerollAdSkipSeconds:-1,adsClickUrl:"#"});a.extend(CincopaMediaElementPlayer.prototype,{adsLoaded:false,adsDataIsLoading:false,adsCurrentMediaUrl:"",adsCurrentMediaDuration:0,adsPlayerHasStarted:false,skipTimeForImage:0,buildads:function(e,b,c,d){var f=this;f.player=e;f.layers=c;if(f.adsLoaded){return}else{f.adsLoaded=true}e.adsLayer=a('<div class="mejs-layer mejs-overlay mejs-ads"><a href="#" target="_blank">&nbsp;</a><div class="mejs-ads-skip-block"><span class="mejs-ads-skip-message"></span><span class="mejs-ads-skip-button">Skip Ad &raquo;</span></div></div>').insertBefore(c.find(".mejs-overlay-play")).hide();f.adsAdClickProxy=a.proxy(f.adsAdClick,f);e.adsLayer.find("a").on("click",f.adsAdClickProxy);e.adsSkipBlock=e.adsLayer.find(".mejs-ads-skip-block").hide();e.adsSkipMessage=e.adsLayer.find(".mejs-ads-skip-message").hide();e.adsSkipButton=e.adsLayer.find(".mejs-ads-skip-button").on("click",a.proxy(f.adsSkipClick,f));f.adsMediaTryingToStartProxy=a.proxy(f.adsMediaTryingToStart,f);f.adsPrerollStartedProxy=a.proxy(f.adsPrerollStarted,f);f.adsPrerollMetaProxy=a.proxy(f.adsPrerollMeta,f);f.adsPrerollUpdateProxy=a.proxy(f.adsPrerollUpdate,f);f.adsPrerollEndedProxy=a.proxy(f.adsPrerollEnded,f);f.media.cincopaAddEventListener("play",f.adsMediaTryingToStartProxy);f.media.cincopaAddEventListener("playing",f.adsMediaTryingToStartProxy);f.media.cincopaAddEventListener("canplay",f.adsMediaTryingToStartProxy);f.media.cincopaAddEventListener("loadedmetadata",f.adsMediaTryingToStartProxy);if(f.options.adsPrerollMediaUrl!=""){f.adsStartPreroll()}},adsMediaTryingToStart:function(){var b=this;if(b.adsDataIsLoading&&!b.media.paused){b.media.pause()}b.adsPlayerHasStarted=true},adsStartPreroll:function(){var b=this;b.media.cincopaAddEventListener("loadedmetadata",b.adsPrerollMetaProxy);b.media.cincopaAddEventListener("playing",b.adsPrerollStartedProxy);b.media.cincopaAddEventListener("ended",b.adsPrerollEndedProxy);b.media.cincopaAddEventListener("timeupdate",b.adsPrerollUpdateProxy);b.adsCurrentMediaUrl=b.media.src;b.adsCurrentMediaDuration=b.media.duration;var d=b.vastAdTags[b.options.currentAdsIndex].mediaFiles[b.options.currentIndex].url;var c=b.vastAdTags[b.options.currentAdsIndex].mediaFiles[b.options.currentIndex].type;b.container.trigger("mejsprerollimpresions");b.skin.advertising=true;if(b.media.canPlayType(c)!=""){b.adsPlayVideo(d)}else{if(b.adsIsImage(c)){b.adsPlayImage(d)}else{b.adsPrerollEndedProxy()}}},adsPrerollMeta:function(){var d=this,c=0;var b=d.vastAdTags[d.options.currentAdsIndex].mediaFiles[d.options.currentIndex].duration;if(b&&b>0){c=b}else{if(!isNaN(d.adsCurrentMediaDuration)){c=d.adsCurrentMediaDuration}}setTimeout(function(){d.controls.find(".mejs-duration").html(cincopa_mejs.Utility.secondsToTimeCode(c,d.options.alwaysShowHours||c>3600,d.options.showTimecodeFrameCount,d.options.framesPerSecond||25))},250)},adsPrerollStarted:function(){var b=this;b.eventsTime=0;if(b.vastAdTags[b.options.currentAdsIndex].mediaFiles[b.options.currentIndex].skipoffset){b.options.adsPrerollAdSkipSeconds=parseInt(b.adsConvertTimeToSeconds(b.vastAdTags[b.options.currentAdsIndex].mediaFiles[b.options.currentIndex].skipoffset))}else{if(b.vastAdTags[b.options.currentAdsIndex].mediaFiles[b.options.currentIndex].duration){b.options.adsPrerollAdSkipSeconds=parseInt(b.adsConvertTimeToSeconds(b.vastAdTags[b.options.currentAdsIndex].mediaFiles[b.options.currentIndex].duration))}else{b.options.adsPrerollAdSkipSeconds=20}}b.eventsInterval=setInterval(function(){b.eventsTime++;if(b.options.adsPrerollAdSkipSeconds/4<=b.eventsTime&&!b.triggeredfirstQuartile){b.triggeredfirstQuartile=true;b.container.trigger("mejsprerollfirstQuartile")}else{if(b.options.adsPrerollAdSkipSeconds/2<=b.eventsTime&&!b.triggeredmidpoint){b.triggeredmidpoint=true;b.container.trigger("mejsprerollmidpoint")}else{if(b.options.adsPrerollAdSkipSeconds*0.75<=b.eventsTime&&!b.triggeredthirdQuartile){b.triggeredthirdQuartile=true;b.container.trigger("mejsprerollthirdQuartile")}}}},1000);if(b.isImage){b.media.pause();a(b.container[0]).find(".mejs-overlay-button").hide();b.skipTimeForImage=0;b.interval=setInterval(function(){if(b.skipTimeForImage>0&&b.skipTimeForImage<=b.options.adsPrerollAdSkipSeconds){b.adsPrerollUpdateProxy()}else{if(b.skipTimeForImage>b.options.adsPrerollAdSkipSeconds){clearInterval(b.interval);b.adsPrerollEndedProxy()}}b.skipTimeForImage++},1000)}b.media.removeEventListener("playing",b.adsPrerollStartedProxy);b.disableControls();b.hideControls();b.container.find(".share-button").hide();b.container.addClass("cp-hidecontrols");b.adsLayer.show();if(b.vastAdTags[b.options.currentAdsIndex].mediaFiles[b.options.currentIndex].clickThrough!=""){b.adsLayer.find("a").attr("href",b.vastAdTags[b.options.currentAdsIndex].mediaFiles[b.options.currentIndex].clickThrough)}if(b.options.adsPrerollAdEnableSkip){b.adsSkipBlock.show();if(b.options.adsPrerollAdSkipSeconds>0){b.adsSkipMessage.html("Skip in "+(b.options.adsPrerollAdSkipSeconds).toString()+" seconds.").show();b.adsSkipButton.hide()}else{b.adsSkipMessage.hide();b.adsSkipButton.show()}}else{b.adsSkipBlock.hide()}b.container.trigger("mejsprerollstarted")},adsPrerollUpdate:function(b){if(b&&b.paused){return}var c=this;if(c.options.adsPrerollAdEnableSkip&&c.options.adsPrerollAdSkipSeconds>0){if(!c.isImage&&c.media.currentTime>c.options.adsPrerollAdSkipSeconds){c.adsSkipButton.show();c.adsSkipMessage.hide()}else{if(c.isImage){c.adsSkipMessage.html("Skip in "+Math.round(c.options.adsPrerollAdSkipSeconds-c.skipTimeForImage).toString()+" seconds.")}else{c.adsSkipMessage.html("Skip in "+Math.round(c.options.adsPrerollAdSkipSeconds-c.media.currentTime).toString()+" seconds.")}}}},adsPrerollEnded:function(){var b=this;b.isImage=false;b.isVideo=false;b.container.trigger("mejsprerollended");b.triggeredfirstQuartile=false;b.triggeredmidpoint=false;b.triggeredthirdQuartile=false;clearInterval(b.eventsInterval);b.options.currentIndex++;if(b.options.currentIndex>=b.vastAdTags[b.options.currentAdsIndex].mediaFiles.length){b.options.currentAdsIndex++;if(b.options.currentAdsIndex>=b.vastAdTags.length){b.adRestoreMainMedia()}else{b.options.currentIndex=0;var d=b.vastAdTags[b.options.currentAdsIndex].mediaFiles[b.options.currentIndex].url;var c=b.vastAdTags[b.options.currentAdsIndex].mediaFiles[b.options.currentIndex].type;if(b.media.canPlayType(c)!=""){b.adsPlayVideo(d)}else{if(b.adsIsImage(c)){b.adsPlayImage(d)}else{b.adsPrerollEndedProxy()}}}}else{var d=b.vastAdTags[b.options.currentAdsIndex].mediaFiles[b.options.currentIndex].url;var c=b.vastAdTags[b.options.currentAdsIndex].mediaFiles[b.options.currentIndex].type;if(b.media.canPlayType(c)!=""){b.adsPlayVideo(d)}else{if(b.adsIsImage(c)){b.adsPlayImage(d)}else{b.adsPrerollEndedProxy()}}}},adRestoreMainMedia:function(){var c=this;clearInterval(c.interval);c.skin.advertising=false;c.enableControls();c.showControls();c.container.find(".share-button").show();c.container.removeClass("cp-hidecontrols");c.adsLayer.hide();a(c.container[0]).find(".mejs-overlay-button").show();c.media.removeEventListener("playing",c.adsPrerollStartedProxy);c.media.removeEventListener("ended",c.adsPrerollEndedProxy);c.media.removeEventListener("loadedmetadata",c.adsPrerollMetaProxy);c.media.removeEventListener("timeupdate",c.adsPrerollUpdateProxy);var b=c.layers.find(".mejs-playlist > ul li.current");if(!b.length){b=c.layers.find(".mejs-playlist > ul li:first-child")}b.removeClass("current");c.container.trigger("mejsprerolladsmainvideorestored");c.player.playTrack(b,"",c.player,false,true)},adsAdClick:function(b){var c=this;if(c.isVideo){if(c.media.paused){c.media.play()}else{c.media.pause()}}c.container.trigger("mejsprerolladsclicked")},adsSkipClick:function(){var b=this;b.container.trigger("mejsprerollskipclicked");b.container.trigger("mejsprerollended");b.adRestoreMainMedia()},adsLoadUrl:function(d){var b=new Image(),c=Math.round(Math.random()*100000);b.src=d+((d.indexOf("?")>0)?"&":"?")+"random"+c+"="+c;b.loaded=function(){b=null}},adsPlayVideo:function(d){var c=this;c.isVideo=true;c.container.trigger("mejsprerollcreativeveiw");a(c.container[0]).find(".mejs-ads a").removeClass("ads-image");a(c.container[0]).find(".mejs-ads a").css("background","none");if(c.media.paused){c.media.play()}else{c.media.pause()}c.media.setSrc(d);function b(){if(c.media.error.code==4){c.adsSkipClick();c.media.removeEventListener("error",b,true)}}c.media.cincopaAddEventListener("error",b,true);c.media.load();if(c.adsPlayerHasStarted){c.media.play()}},adsPlayImage:function(c){var b=this;b.isImage=true;b.container.trigger("mejsprerollcreativeveiw");b.media.pause();a(b.container[0]).find(".mejs-ads a").addClass("ads-image");a(b.container[0]).find(".mejs-ads a").css("background","url("+c+")");if(b.adsPlayerHasStarted){b.adsPrerollStartedProxy()}},adsIsImage:function(b){return b.indexOf("image")>-1},adsConvertTimeToSeconds:function(e){var f=e.split(":");var b=f[0]*60*60;var c=f[1]*60;var d=f[2];var g=b+c+d;return g}})})(cincopa_mejs.$);
// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/js/mep-feature-ads-vast.js  D:\WebSites\tmpCincopaAppsV2\_cms/fpskins/mediaelement/1/js/mep-feature-ads-vast.js   3/21/2022 9:13:17 AM 
_cp_preloaded_files["/fpskins/mediaelement/1/js/mep-feature-ads-vast.js"] = true;
(function(a){a.extend(cincopa_mejs.MepDefaults,{vastAdTagUrl:""});a.extend(CincopaMediaElementPlayer.prototype,{buildvast:function(e,b,c,d){var f=this;f.skin=e.options.skinObject;if(e.options.skinObject.Vastloaded){return false}e.options.skinObject.Vastloaded=true;if(f.options.vastAdTagUrl!=""){f.vastLoadAdTagInfo()}f.buildads(e,b,c,d);f.vastSetupEvents()},vastAdTagIsLoading:false,vastAdTagIsLoaded:false,vastStartedPlaying:false,vastAdTags:[],vastSetupEvents:function(){var h=this;h.container.on("mejsprerollimpresions",function(){if(h.vastAdTags.length>0&&h.vastAdTags[h.options.currentAdsIndex].impressions.length>0){for(var j=0,k=h.vastAdTags[h.options.currentAdsIndex].impressions.length;j<k;j++){h.adsLoadUrl(h.vastAdTags[h.options.currentAdsIndex].impressions[j])}}});h.container.on("mejsprerollcreativeveiw",function(){if(h.vastAdTags.length>0&&h.vastAdTags[h.options.currentAdsIndex].mediaFiles[h.options.currentIndex].trackingEvents.creativeView){h.adsLoadUrl(h.vastAdTags[h.options.currentAdsIndex].mediaFiles[h.options.currentIndex].trackingEvents.creativeView)}});h.container.on("mejsprerollstarted",function(){if(h.vastAdTags.length>0){var i=h.vastAdTags[h.options.currentAdsIndex].mediaFiles[h.options.currentIndex];if(i.trackingEvents.start){h.adsLoadUrl(i.trackingEvents.start)}}});h.container.on("mejsprerollfirstQuartile",function(){if(h.vastAdTags.length>0&&h.vastAdTags[h.options.currentAdsIndex]&&h.vastAdTags[h.options.currentAdsIndex].mediaFiles[h.options.currentIndex].trackingEvents.firstQuartile){h.adsLoadUrl(h.vastAdTags[h.options.currentAdsIndex].mediaFiles[h.options.currentIndex].trackingEvents.firstQuartile)}});h.container.on("mejsprerollmidpoint",function(){if(h.vastAdTags.length>0&&h.vastAdTags[h.options.currentAdsIndex]&&h.vastAdTags[h.options.currentAdsIndex].mediaFiles[h.options.currentIndex].trackingEvents.midpoint){h.adsLoadUrl(h.vastAdTags[h.options.currentAdsIndex].mediaFiles[h.options.currentIndex].trackingEvents.midpoint)}});h.container.on("mejsprerollthirdQuartile",function(){if(h.vastAdTags.length>0&&h.vastAdTags[h.options.currentAdsIndex]&&h.vastAdTags[h.options.currentAdsIndex].mediaFiles[h.options.currentIndex].trackingEvents.thirdQuartile){h.adsLoadUrl(h.vastAdTags[h.options.currentAdsIndex].mediaFiles[h.options.currentIndex].trackingEvents.thirdQuartile)}});h.container.on("mejsprerollended",function(){if(h.vastAdTags.length>0&&h.vastAdTags[h.options.currentAdsIndex]&&h.vastAdTags[h.options.currentAdsIndex].mediaFiles[h.options.currentIndex].trackingEvents.complete){h.adsLoadUrl(h.vastAdTags[h.options.currentAdsIndex].mediaFiles[h.options.currentIndex].trackingEvents.complete)}});var g=false;var c=true;var f=true;h.container.on("mejsprerollskipclicked",function(){g=true});h.container.on("mejsprerolladsmainvideorestored",function(){g=false;c=true});var d=0;try{d=h.layers.find(".mejs-playlist > ul li.current").data("index")||0}catch(b){console.log(b)}h.media.cincopaAddEventListener("loadedmetadata",e,true);function e(){if(c==false&&g==false){if(h.media.src!=h.options.adsPrerollMediaUrl){var i=0;try{i=h.layers.find(".mejs-playlist > ul li.current").data("index")||0}catch(j){console.log(j)}if(h.options.vastpreroll=="on_each"){if(i!=d){h.vastLoadAdTagInfo();d=i}else{}}else{if(h.options.vastpreroll=="only_once"){if(f){h.vastContinuePreroll()}else{h.media.removeEventListener("loadedmetadata",e);h.adsSkipClick()}f=false}}g=false}}c=false}},vastSetAdTagUrl:function(c){var b=this;b.options.vastAdTagUrl=c;b.vastAdTagIsLoaded=false;b.vastAdTags=[]},vastLoadAdTagInfo:function(){var b=this;b.adsDataIsLoading=true;b.vastAdTagIsLoading=true;b.loadAdTagInfoDirect()},loadAdTagInfoDirect:function(){var b=this;a.ajax({url:b.options.vastAdTagUrl,crossDomain:true,success:function(c){b.vastParseVastData(c)},error:function(c){b.loadAdTagInfoProxy()}})},loadAdTagInfoProxy:function(){var f=this,d=location.protocol,c=location.hostname,b=RegExp(d+"//"+c),e='select * from xml where url="'+encodeURI(f.options.vastAdTagUrl)+'"',g="http"+(/^https/.test(d)?"s":"")+"://query.yahooapis.com/v1/public/yql?format=xml&q="+e;a.ajax({url:g,crossDomain:true,success:function(h){f.vastParseVastData(h)},error:function(h){f.vastError()}})},vastParseVastData:function(b){var c=this;c.vastAdTags=[];a(b).find("Ad").each(function(f,g){var d=a(g),e={id:d.attr("id"),title:a.trim(d.find("AdTitle").text()),description:a.trim(d.find("Description").text()),impressions:[],mediaFiles:[],shown:false};c.vastAdTags.push(e);d.find("Impression").each(function(){e.impressions.push(a.trim(a(this).text()))});d.find("Creative").each(function(){var h=a(this);h.find("Linear").each(function(){var k=a(this);var j=k.find("Duration").text();var l=k.attr("skipoffset");var i=k.find("ClickThrough").text();var m={};k.find("Tracking").each(function(n,o){m[a(o).attr("event")]=a.trim(a(o).text())});k.find("MediaFile").each(function(n,p){var o=a(p);type=o.attr("type");e.mediaFiles.push({id:o.attr("id"),delivery:o.attr("delivery"),type:o.attr("type"),bitrate:o.attr("bitrate"),width:o.attr("width"),height:o.attr("height"),url:a.trim(o.text()),duration:j,clickThrough:i,trackingEvents:m,skipoffset:l})})});h.find("CompanionAds").each(function(){var i=a(this);i.find("Companion").each(function(){var k=a(this);var n=k.attr("width");var l=k.attr("height");var j=k.find("CompanionClickThrough").text();var m={};k.find("Tracking").each(function(o,p){m[a(p).attr("event")]=a.trim(a(p).text())});k.find("StaticResource").each(function(o,q){var p=a(q);e.mediaFiles.push({type:p.attr("creativeType"),width:n,height:l,url:a.trim(p.text()),clickThrough:j,trackingEvents:m})})})});h.find("NonLinearAds").each(function(){var i=a(this);var j={};i.find("Tracking").each(function(k,l){j[a(l).attr("event")]=a.trim(a(l).text())});i.find("NonLinear").each(function(){var n=a(this);var o=n.attr("width");var m=n.attr("height");var l=n.attr("minSuggestedDuration");var k=n.find("NonLinearClickThrough").text();n.find("StaticResource").each(function(p,r){var q=a(r);e.mediaFiles.push({type:q.attr("creativeType"),width:o,height:m,url:a.trim(q.text()),duration:l,clickThrough:k,trackingEvents:j})})})})})});c.vastLoaded()},vastLoaded:function(){var b=this;b.vastAdTagIsLoaded=true;b.vastAdTagIsLoading=false;b.adsDataIsLoading=false;b.vastStartPreroll()},vastStartPreroll:function(){var b=this;b.options.currentAdsIndex=0;if(b.vastAdTags.length>0&&b.vastAdTags[b.options.currentAdsIndex].mediaFiles.length>0){b.options.currentIndex=0;b.options.adsPrerollMediaUrl=b.vastAdTags[b.options.currentAdsIndex].mediaFiles[b.options.currentIndex].url;b.adsStartPreroll()}},vastContinuePreroll:function(){var b=this;if(b.vastAdTags.length>0&&b.vastAdTags[b.options.currentAdsIndex]&&b.vastAdTags[b.options.currentAdsIndex].mediaFiles.length>0){b.options.adsPrerollMediaUrl=b.vastAdTags[b.options.currentAdsIndex].mediaFiles[b.options.currentIndex].url;b.adsStartPreroll()}},vastError:function(){var b=this;b.media.removeEventListener("play",b.adsMediaTryingToStartProxy);b.media.removeEventListener("playing",b.adsMediaTryingToStartProxy);b.media.removeEventListener("canplay",b.adsMediaTryingToStartProxy);b.media.removeEventListener("loadedmetadata",b.adsMediaTryingToStartProxy);b.skin.advertising=false;b.enableControls();b.showControls();b.container.find(".share-button").show();b.container.removeClass("cp-hidecontrols");b.adsLayer.hide();b.container.find(".mejs-overlay-button").show();if(b.options.skinObject.go.args.autostart){setTimeout(function(){b.media.play()},400)}}})})(cincopa_mejs.$);
// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/js/hls.min.js  D:\WebSites\tmpCincopaAppsV2\_cms/fpskins/mediaelement/1/js/hls.min.js   12/22/2022 5:23:39 AM 
_cp_preloaded_files["/fpskins/mediaelement/1/js/hls.min.js"] = true;
"undefined"!=typeof window&&function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Hls=e():t.Hls=e()}(this,function(){return i={},n.m=r={"./node_modules/eventemitter3/index.js":function(t,e,r){"use strict";var i=Object.prototype.hasOwnProperty,f="~";function n(){}function s(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function a(t,e,r,i,n){if("function"!=typeof r)throw new TypeError("The listener must be a function");n=new s(r,i||t,n),e=f?f+e:e;return t._events[e]?t._events[e].fn?t._events[e]=[t._events[e],n]:t._events[e].push(n):(t._events[e]=n,t._eventsCount++),t}function l(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(f=!1)),o.prototype.eventNames=function(){var t,e,r=[];if(0===this._eventsCount)return r;for(e in t=this._events)i.call(t,e)&&r.push(f?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},o.prototype.listeners=function(t){var t=f?f+t:t,e=this._events[t];if(!e)return[];if(e.fn)return[e.fn];for(var r=0,i=e.length,n=new Array(i);r<i;r++)n[r]=e[r].fn;return n},o.prototype.listenerCount=function(t){t=f?f+t:t,t=this._events[t];return t?t.fn?1:t.length:0},o.prototype.emit=function(t,e,r,i,n,s){var a=f?f+t:t;if(!this._events[a])return!1;var o,l=this._events[a],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,r),!0;case 4:return l.fn.call(l.context,e,r,i),!0;case 5:return l.fn.call(l.context,e,r,i,n),!0;case 6:return l.fn.call(l.context,e,r,i,n,s),!0}for(h=1,o=new Array(u-1);h<u;h++)o[h-1]=arguments[h];l.fn.apply(l.context,o)}else for(var c,d=l.length,h=0;h<d;h++)switch(l[h].once&&this.removeListener(t,l[h].fn,void 0,!0),u){case 1:l[h].fn.call(l[h].context);break;case 2:l[h].fn.call(l[h].context,e);break;case 3:l[h].fn.call(l[h].context,e,r);break;case 4:l[h].fn.call(l[h].context,e,r,i);break;default:if(!o)for(c=1,o=new Array(u-1);c<u;c++)o[c-1]=arguments[c];l[h].fn.apply(l[h].context,o)}return!0},o.prototype.on=function(t,e,r){return a(this,t,e,r,!1)},o.prototype.once=function(t,e,r){return a(this,t,e,r,!0)},o.prototype.removeListener=function(t,e,r,i){t=f?f+t:t;if(!this._events[t])return this;if(!e)return l(this,t),this;var n=this._events[t];if(n.fn)n.fn!==e||i&&!n.once||r&&n.context!==r||l(this,t);else{for(var s=0,a=[],o=n.length;s<o;s++)(n[s].fn!==e||i&&!n[s].once||r&&n[s].context!==r)&&a.push(n[s]);a.length?this._events[t]=1===a.length?a[0]:a:l(this,t)}return this},o.prototype.removeAllListeners=function(t){return t?(t=f?f+t:t,this._events[t]&&l(this,t)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=f,o.EventEmitter=o,t.exports=o},"./node_modules/url-toolkit/src/url-toolkit.js":function(t,e,r){var i,s,n,a,o;i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,s=/^([^\/?#]*)([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(t,e,r){if(r=r||{},t=t.trim(),!(e=e.trim())){if(!r.alwaysNormalize)return t;var i=o.parseURL(t);if(!i)throw new Error("Error trying to parse base URL.");return i.path=o.normalizePath(i.path),o.buildURLFromParts(i)}i=o.parseURL(e);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=o.normalizePath(i.path),o.buildURLFromParts(i)):e;e=o.parseURL(t);if(!e)throw new Error("Error trying to parse base URL.");!e.netLoc&&e.path&&"/"!==e.path[0]&&(n=s.exec(e.path),e.netLoc=n[1],e.path=n[2]),e.netLoc&&!e.path&&(e.path="/");var n,t={scheme:e.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};return i.netLoc||(t.netLoc=e.netLoc,"/"!==i.path[0]&&(i.path?(n=(n=e.path).substring(0,n.lastIndexOf("/")+1)+i.path,t.path=o.normalizePath(n)):(t.path=e.path,i.params||(t.params=e.params,i.query||(t.query=e.query))))),null===t.path&&(t.path=r.alwaysNormalize?o.normalizePath(i.path):i.path),o.buildURLFromParts(t)},parseURL:function(t){t=i.exec(t);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(n,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=o},"./node_modules/webworkify-webpack/index.js":function(t,e,d){function s(r){var i={};function n(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}n.m=r,n.c=i,n.i=function(t){return t},n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n.oe=function(t){throw console.error(t),t};var t=n(n.s=ENTRY_MODULE);return t.default||t}var h="[\\.|\\-|\\+|\\w|/|@]+",f="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+h+").*?\\)";function g(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function v(t,e,r){var i={};i[r]=[];var n=e.toString(),e=n.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!e)return i;for(var s,e=e[1],a=new RegExp("(\\\\n|\\W)"+g(e)+f,"g");s=a.exec(n);)"dll-reference"!==s[3]&&i[r].push(s[3]);for(a=new RegExp("\\("+g(e)+'\\("(dll-reference\\s('+h+'))"\\)\\)'+f,"g");s=a.exec(n);)t[s[2]]||(i[r].push(s[1]),t[s[2]]=d(s[1]).m),i[s[2]]=i[s[2]]||[],i[s[2]].push(s[4]);for(var o,l=Object.keys(i),u=0;u<l.length;u++)for(var c=0;c<i[l[u]].length;c++)o=i[l[u]][c],isNaN(+o)||(i[l[u]][c]=+i[l[u]][c]);return i}function a(t,e){for(var r={main:[e]},i={main:[]},n={main:{}};function(r){return Object.keys(r).reduce(function(t,e){return t||0<r[e].length},!1)}(r);)for(var s=Object.keys(r),a=0;a<s.length;a++){var o=s[a],l=r[o].pop();if(n[o]=n[o]||{},!n[o][l]&&t[o][l]){n[o][l]=!0,i[o]=i[o]||[],i[o].push(l);for(var u=v(t,t[o][l],o),c=Object.keys(u),d=0;d<c.length;d++)r[c[d]]=r[c[d]]||[],r[c[d]]=r[c[d]].concat(u[c[d]])}}return i}t.exports=function(t,e){e=e||{};var r={main:d.m},i=e.all?{main:Object.keys(r.main)}:a(r,t),n="";Object.keys(i).filter(function(t){return"main"!==t}).forEach(function(e){for(var t=0;i[e][t];)t++;i[e].push(t),r[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",n=n+"var "+e+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+i[e].map(function(t){return JSON.stringify(t)+": "+r[e][t].toString()}).join(",")+"});\n"}),n=n+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+i.main.map(function(t){return JSON.stringify(t)+": "+r.main[t].toString()}).join(",")+"}))(self);";t=new window.Blob([n],{type:"text/javascript"});if(e.bare)return t;e=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(t),t=new window.Worker(e);return t.objectURL=e,t}},"./src/config.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"hlsDefaultConfig",function(){return S}),r.d(e,"mergeConfig",function(){return b}),r.d(e,"enableStreamingMode",function(){return L});var i=r("./src/controller/abr-controller.ts"),n=r("./src/controller/audio-stream-controller.ts"),s=r("./src/controller/audio-track-controller.ts"),a=r("./src/controller/subtitle-stream-controller.ts"),o=r("./src/controller/subtitle-track-controller.ts"),l=r("./src/controller/buffer-controller.ts"),u=r("./src/controller/timeline-controller.ts"),c=r("./src/controller/cap-level-controller.ts"),d=r("./src/controller/fps-controller.ts"),h=r("./src/controller/eme-controller.ts"),f=r("./src/controller/cmcd-controller.ts"),g=r("./src/utils/xhr-loader.ts"),v=r("./src/utils/fetch-loader.ts"),p=r("./src/utils/cues.ts"),e=r("./src/utils/mediakeys-helper.ts"),m=r("./src/utils/logger.ts");function y(){return(y=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,i=arguments[e];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}function E(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function T(i){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach(function(t){var e,r;e=i,t=n[r=t],r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(n,t))})}return i}var S=T(T({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:g.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:i.default,bufferController:l.default,capLevelController:c.default,fpsController:d.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},{cueHandler:p.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:a.SubtitleStreamController,subtitleTrackController:o.default,timelineController:u.TimelineController,audioStreamController:n.default,audioTrackController:s.default,emeController:h.default,cmcdController:f.default});function b(t,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return y({},t,e)}function L(t){var e=t.loader;e!==v.default&&e!==g.default?(m.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):Object(v.fetchSupported)()&&(t.loader=v.default,t.progressive=!0,t.enableSoftwareAES=!0,m.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(t,e,r){"use strict";r.r(e);var m=r("./src/polyfills/number.ts"),n=r("./src/utils/ewma-bandwidth-estimator.ts"),y=r("./src/events.ts"),E=r("./src/utils/buffer-helper.ts"),s=r("./src/errors.ts"),o=r("./src/types/loader.ts"),T=r("./src/utils/logger.ts");function a(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}r=function(){function t(t){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0;t=(this.hls=t).config;this.bwEstimator=new n.default(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var e,r,i=t.prototype;return i.registerListeners=function(){var t=this.hls;t.on(y.Events.FRAG_LOADING,this.onFragLoading,this),t.on(y.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(y.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.Events.ERROR,this.onError,this)},i.unregisterListeners=function(){var t=this.hls;t.off(y.Events.FRAG_LOADING,this.onFragLoading,this),t.off(y.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(y.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.Events.ERROR,this.onError,this)},i.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},i.onFragLoading=function(t,e){var r=e.frag;r.type===o.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=r,this.partCurrent=null!=(e=e.part)?e:null,this.timer=self.setInterval(this.onCheck,100)))},i.onLevelLoaded=function(t,e){var r=this.hls.config;e.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},i._abandonRulesCheck=function(){var t=this.fragCurrent,e=this.partCurrent,r=this.hls,i=r.autoLevelEnabled,n=r.config,s=r.media;if(t&&s){var a=(e||t).stats,o=(e||t).duration;if(a.aborted)return T.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!s.paused&&s.playbackRate&&s.readyState){var l=performance.now()-a.loading.start,u=Math.abs(s.playbackRate);if(!(l<=500*o/u)){var c=r.levels,d=r.minAutoLevel,h=c[t.level],i=a.total||Math.max(a.loaded,Math.round(o*h.maxBitrate/8)),f=Math.max(1,a.bwEstimate?a.bwEstimate/8:1e3*a.loaded/l),h=(i-a.loaded)/f,i=s.currentTime,g=(E.BufferHelper.bufferInfo(s,i,n.maxBufferHole).end-i)/u;if(!(2*o/u<=g||h<=g)){for(var v=Number.POSITIVE_INFINITY,p=t.level-1;d<p;p--)if((v=o*c[p].maxBitrate/(6.4*f))<g)break;h<=v||(u=this.bwEstimator.getEstimate(),T.logger.warn("Fragment "+t.sn+(e?" part "+e.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+p+"\n      Current BW estimate: "+(Object(m.isFiniteNumber)(u)?(u/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+h.toFixed(3)+" s\n      Estimated load time for the next fragment: "+v.toFixed(3)+" s\n      Time to underbuffer: "+g.toFixed(3)+" s"),r.nextLoadLevel=p,this.bwEstimator.sample(l,a.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),r.trigger(y.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:a}))}}}}},i.onFragLoaded=function(t,e){var r,i,n,s=e.frag,a=e.part;s.type===o.PlaylistLevelType.MAIN&&Object(m.isFiniteNumber)(s.sn)&&(r=(a||s).stats,n=(a||s).duration,this.clearTimer(),this.lastLoadedFragLevel=s.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate&&(e=((i=this.hls.levels[s.level]).loaded?i.loaded.bytes:0)+r.loaded,n=(i.loaded?i.loaded.duration:0)+n,i.loaded={bytes:e,duration:n},i.realBitrate=Math.round(8*e/n)),s.bitrateTest&&(a={stats:r,frag:s,part:a,id:s.type},this.onFragBuffered(y.Events.FRAG_BUFFERED,a),s.bitrateTest=!1))},i.onFragBuffered=function(t,e){var r=e.frag,i=e.part,e=(i||r).stats;e.aborted||r.type===o.PlaylistLevelType.MAIN&&"initSegment"!==r.sn&&(i=e.parsing.end-e.loading.start,this.bwEstimator.sample(i,e.loaded),e.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0)},i.onError=function(t,e){switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},i.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},i.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,r=this.hls,i=r.maxAutoLevel,n=r.config,s=r.minAutoLevel,a=r.media,o=e?e.duration:t?t.duration:0,l=a?a.currentTime:0,u=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,c=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,r=(E.BufferHelper.bufferInfo(a,l,n.maxBufferHole).end-l)/u,e=this.findBestLevel(c,s,i,r,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(0<=e)return e;T.logger.trace((r?"rebuffering expected":"buffer is empty")+", finding optimal quality level");t=o?Math.min(o,n.maxStarvationDelay):n.maxStarvationDelay,a=n.abrBandWidthFactor,l=n.abrBandWidthUpFactor;return r||(u=this.bitrateTestDelay)&&(t=(o?Math.min(o,n.maxLoadingDelay):n.maxLoadingDelay)-u,T.logger.trace("bitrate test took "+Math.round(1e3*u)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*t)+" ms"),a=l=1),e=this.findBestLevel(c,s,i,r+t,a,l),Math.max(e,0)},i.findBestLevel=function(t,e,r,i,n,s){for(var a,o=this.fragCurrent,l=this.partCurrent,u=this.lastLoadedFragLevel,c=this.hls.levels,d=c[u],h=!(null==d||null===(a=d.details)||void 0===a||!a.live),f=null==d?void 0:d.codecSet,g=l?l.duration:o?o.duration:0,v=r;e<=v;v--){var p=c[v];if(p&&(!f||p.codecSet===f)){var m=p.details,y=(l?null==m?void 0:m.partTarget:null==m?void 0:m.averagetargetduration)||g,E=void 0,E=v<=u?n*t:s*t,p=c[v].maxBitrate,m=p*y/E;if(T.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+v+"/"+Math.round(E)+"/"+p+"/"+y+"/"+i+"/"+m),p<E&&(!m||h&&!this.bitrateTestDelay||m<i))return v}}return-1},e=t,(i=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this.bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;e=this.getNextABRAutoLevel();return-1!==t&&(e=Math.min(t,e)),e},set:function(t){this._nextAutoLevel=t}}])&&a(e.prototype,i),r&&a(e,r),t}();e.default=r},"./src/controller/audio-stream-controller.ts":function(t,e,r){"use strict";r.r(e);var n=r("./src/polyfills/number.ts"),f=r("./src/controller/base-stream-controller.ts"),g=r("./src/events.ts"),l=r("./src/utils/buffer-helper.ts"),s=r("./src/controller/fragment-tracker.ts"),i=r("./src/types/level.ts"),d=r("./src/types/loader.ts"),v=r("./src/loader/fragment.ts"),h=r("./src/demux/chunk-cache.ts"),p=r("./src/demux/transmuxer-interface.ts"),m=r("./src/types/transmuxer.ts"),u=r("./src/controller/fragment-finders.ts"),a=r("./src/utils/discontinuities.ts"),c=r("./src/errors.ts"),y=r("./src/utils/logger.ts");function E(){return(E=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,i=arguments[e];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}function T(t,e){return(T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}r=function(o){var t;function e(t,e){e=o.call(this,t,e,"[audio-stream-controller]")||this;return e.videoBuffer=null,e.videoTrackCC=-1,e.waitingVideoCC=-1,e.audioSwitch=!1,e.trackId=-1,e.waitingData=null,e.mainDetails=null,e.bufferFlushed=!1,e._registerListeners(),e}r=o,(t=e).prototype=Object.create(r.prototype),T(t.prototype.constructor=t,r);var r=e.prototype;return r.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},r._registerListeners=function(){var t=this.hls;t.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(g.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(g.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(g.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(g.Events.ERROR,this.onError,this),t.on(g.Events.BUFFER_RESET,this.onBufferReset,this),t.on(g.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(g.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(g.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(g.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var t=this.hls;t.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(g.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(g.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(g.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(g.Events.ERROR,this.onError,this),t.off(g.Events.BUFFER_RESET,this.onBufferReset,this),t.off(g.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(g.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(g.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(g.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r.onInitPtsFound=function(t,e){var r=e.frag,i=e.id,e=e.initPTS;"main"===i&&(i=r.cc,this.initPTS[r.cc]=e,this.log("InitPTS for cc: "+i+" found from main: "+e),this.videoTrackCC=i,this.state===f.State.WAITING_INIT_PTS&&this.tick())},r.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=f.State.STOPPED);var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),(this.fragLoadError=0)<e&&-1===t?(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=f.State.IDLE):(this.loadedmetadata=!1,this.state=f.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},r.doTick=function(){switch(this.state){case f.State.IDLE:this.doTickIdle();break;case f.State.WAITING_TRACK:var t=this.levels,e=this.trackId,r=null==t||null===(r=t[e])||void 0===r?void 0:r.details;if(r){if(this.waitForCdnTuneIn(r))break;this.state=f.State.WAITING_INIT_PTS}break;case f.State.FRAG_LOADING_WAITING_RETRY:var i=performance.now(),n=this.retryDate;(!n||n<=i||null!==(s=this.media)&&void 0!==s&&s.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=f.State.IDLE);break;case f.State.WAITING_INIT_PTS:var s,a,r=this.waitingData;r?(n=r.frag,i=r.part,s=r.cache,r=r.complete,void 0!==this.initPTS[n.cc]?(this.waitingData=null,this.waitingVideoCC=-1,this.state=f.State.FRAG_LOADING,a={frag:n,part:i,payload:s.flush(),networkDetails:null},this._handleFragmentLoadProgress(a),r&&o.prototype._handleFragmentLoadComplete.call(this,a)):this.videoTrackCC!==this.waitingVideoCC?(y.logger.log("Waiting fragment cc ("+n.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment()):(a=this.getLoadPosition(),a=l.BufferHelper.bufferInfo(this.mediaBuffer,a,this.config.maxBufferHole),Object(u.fragmentWithinToleranceTest)(a.end,this.config.maxFragLookUpTolerance,n)<0&&(y.logger.log("Waiting fragment cc ("+n.cc+") @ "+n.start+" cancelled because another fragment at "+a.end+" is needed"),this.clearWaitingFragment()))):this.state=f.State.IDLE}this.onTickEnd()},r.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=f.State.IDLE)},r.onTickEnd=function(){var t,e=this.media;e&&e.readyState&&(t=(this.mediaBuffer||e).buffered,!this.loadedmetadata&&t.length&&(this.loadedmetadata=!0),this.lastCurrentTime=e.currentTime)},r.doTickIdle=function(){var t=this.hls,e=this.levels,r=this.media,i=this.trackId,n=t.config;if(e&&e[i]&&(r||!this.startFragRequested&&n.startFragPrefetch)){var s=e[i].details;if(!s||s.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(s))this.state=f.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer||this.media,v.ElementaryStreamTypes.AUDIO,d.PlaylistLevelType.AUDIO));var a=this.getFwdBufferInfo(this.mediaBuffer||this.media,d.PlaylistLevelType.AUDIO);if(null!==a){var n=a.len,e=this.getMaxBufferLength(),i=this.audioSwitch;if(!(e<=n)||i){if(!i&&this._streamEnded(a,s))return t.trigger(g.Events.BUFFER_EOS,{type:"audio"}),void(this.state=f.State.ENDED);var n=s.fragments[0].start,t=a.end;i&&(t=i=this.getLoadPosition(),s.PTSKnown&&i<n&&(a.end>n||a.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=n+.05));r=this.getNextFragment(t,s);r?"identity"!==(null===(n=r.decryptdata)||void 0===n?void 0:n.keyFormat)||null!==(n=r.decryptdata)&&void 0!==n&&n.key?this.loadFragment(r,s,t):this.loadKey(r,s):this.bufferFlushed=!0}}}}},r.getMaxBufferLength=function(){var t=o.prototype.getMaxBufferLength.call(this),e=this.getFwdBufferInfo(this.videoBuffer||this.media,d.PlaylistLevelType.MAIN);return null===e?t:Math.max(t,e.len)},r.onMediaDetaching=function(){this.videoBuffer=null,o.prototype.onMediaDetaching.call(this)},r.onAudioTracksUpdated=function(t,e){e=e.audioTracks;this.resetTransmuxer(),this.levels=e.map(function(t){return new i.Level(t)})},r.onAudioTrackSwitching=function(t,e){var r=!!e.url;this.trackId=e.id;e=this.fragCurrent;null!=e&&e.loader&&e.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.audioSwitch=!0,this.state=f.State.IDLE):this.state=f.State.STOPPED,this.tick()},r.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},r.onLevelLoaded=function(t,e){this.mainDetails=e.details},r.onAudioTrackLoaded=function(t,e){var r=this.levels,i=e.details,n=e.id;if(r){this.log("Track "+n+" loaded ["+i.startSN+","+i.endSN+"],duration:"+i.totalduration);e=r[n],r=0;if(i.live||null!==(s=e.details)&&void 0!==s&&s.live){var s=this.mainDetails;if(i.fragments[0]||(i.deltaUpdateFailed=!0),i.deltaUpdateFailed||!s)return;r=!e.details&&i.hasProgramDateTime&&s.hasProgramDateTime?(Object(a.alignMediaPlaylistByPDT)(i,s),i.fragments[0].start):this.alignPlaylists(i,e.details)}e.details=i,this.levelLastLoaded=n,this.startFragRequested||!this.mainDetails&&i.live||this.setStartPosition(e.details,r),this.state!==f.State.WAITING_TRACK||this.waitForCdnTuneIn(i)||(this.state=f.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+n)},r._handleFragmentLoadProgress=function(t){var e,r,i,n,s=t.frag,a=t.part,o=t.payload,l=this.config,u=this.trackId,c=this.levels;c?(n=c[u],console.assert(n,"Audio track is defined on fragment load progress"),e=n.details,console.assert(e,"Audio track details are defined on fragment load progress"),r=l.defaultAudioCodec||n.audioCodec||"mp4a.40.2",i=(i=this.transmuxer)||(this.transmuxer=new p.default(this.hls,d.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this))),t=this.initPTS[s.cc],l=null===(c=s.initSegment)||void 0===c?void 0:c.data,void 0!==t?(c=-1!==(n=a?a.index:-1),c=new m.ChunkMetadata(s.level,s.sn,s.stats.chunkCount,o.byteLength,n,c),i.push(o,l,r,"",s,a,e.totalduration,!1,c,t)):(y.logger.log("Unknown video PTS for cc "+s.cc+", waiting for video PTS before demuxing audio frag "+s.sn+" of ["+e.startSN+" ,"+e.endSN+"],track "+u),(this.waitingData=this.waitingData||{frag:s,part:a,cache:new h.default,complete:!1}).cache.push(new Uint8Array(o)),this.waitingVideoCC=this.videoTrackCC,this.state=f.State.WAITING_INIT_PTS)):this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+s.sn+" of level "+s.level+" will not be buffered")},r._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:o.prototype._handleFragmentLoadComplete.call(this,t)},r.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},r.onBufferCreated=function(t,e){var r=e.tracks.audio;r&&(this.mediaBuffer=r.buffer),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},r.onFragBuffered=function(t,e){var r=e.frag,e=e.part;r.type===d.PlaylistLevelType.AUDIO&&(this.fragContextChanged(r)?this.warn("Fragment "+r.sn+(e?" p: "+e.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==r.sn&&(this.fragPrevious=r,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(g.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(r,e)))},r.onError=function(t,e){switch(e.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(d.PlaylistLevelType.AUDIO,e);break;case c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case c.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==f.State.ERROR&&this.state!==f.State.STOPPED&&(this.state=e.fatal?f.State.ERROR:f.State.IDLE,this.warn(e.details+" while loading frag, switching to "+this.state+" state"));break;case c.ErrorDetails.BUFFER_FULL_ERROR:var r,i;"audio"!==e.parent||this.state!==f.State.PARSING&&this.state!==f.State.PARSED||(r=!0,(i=this.getFwdBufferInfo(this.mediaBuffer,d.PlaylistLevelType.AUDIO))&&.5<i.len&&(r=!this.reduceMaxBufferLength(i.len)),r&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState())}},r.onBufferFlushed=function(t,e){e.type===v.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},r._handleTransmuxComplete=function(t){var e,r="audio",i=this.hls,n=t.remuxResult,s=t.chunkMeta,a=this.getCurrentContext(s);if(!a)return this.warn("The loading context changed while buffering fragment "+s.sn+" of level "+s.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(s.level);var o=a.frag,l=a.part,u=n.audio,c=n.text,d=n.id3,h=n.initSegment;this.fragContextChanged(o)||(this.state=f.State.PARSING,this.audioSwitch&&u&&this.completeAudioSwitch(),null!=h&&h.tracks&&(this._bufferInitSegment(h.tracks,o,s),i.trigger(g.Events.FRAG_PARSING_INIT_SEGMENT,{frag:o,id:r,tracks:h.tracks})),u&&(t=u.startPTS,a=u.endPTS,n=u.startDTS,h=u.endDTS,l&&(l.elementaryStreams[v.ElementaryStreamTypes.AUDIO]={startPTS:t,endPTS:a,startDTS:n,endDTS:h}),o.setElementaryStreamInfo(v.ElementaryStreamTypes.AUDIO,t,a,n,h),this.bufferFragmentData(u,o,l,s)),null!=d&&null!==(e=d.samples)&&void 0!==e&&e.length&&(d=E({frag:o,id:r},d),i.trigger(g.Events.FRAG_PARSING_METADATA,d)),c&&(c=E({frag:o,id:r},c),i.trigger(g.Events.FRAG_PARSING_USERDATA,c)))},r._bufferInitSegment=function(t,e,r){var i;this.state===f.State.PARSING&&(t.video&&delete t.video,(i=t.audio)&&(i.levelCodec=i.codec,i.id="audio",this.log("Init audio buffer, container:"+i.container+", codecs[parsed]=["+i.codec+"]"),this.hls.trigger(g.Events.BUFFER_CODECS,t),null!=(i=i.initSegment)&&i.byteLength&&(i={type:"audio",frag:e,part:null,chunkMeta:r,parent:e.type,data:i},this.hls.trigger(g.Events.BUFFER_APPENDING,i)),this.tick()))},r.loadFragment=function(t,e,r){var i=this.fragmentTracker.getState(t);this.fragCurrent=t,!this.audioSwitch&&i!==s.FragmentState.NOT_LOADED&&i!==s.FragmentState.PARTIAL||("initSegment"===t.sn?this._loadInitSegment(t):e.live&&!Object(n.isFiniteNumber)(this.initPTS[t.cc])?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=f.State.WAITING_INIT_PTS):(this.startFragRequested=!0,o.prototype.loadFragment.call(this,t,e,r)))},r.completeAudioSwitch=function(){var t=this.hls,e=this.media,r=this.trackId;e&&(this.log("Switching audio track : flushing all audio"),o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,t.trigger(g.Events.AUDIO_TRACK_SWITCHED,{id:r})},e}(f.default);e.default=r},"./src/controller/audio-track-controller.ts":function(t,e,r){"use strict";r.r(e);var l=r("./src/events.ts"),s=r("./src/errors.ts"),i=r("./src/controller/base-playlist-controller.ts"),a=r("./src/types/loader.ts");function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}i=function(r){function t(t){t=r.call(this,t,"[audio-track-controller]")||this;return t.tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.trackName="",t.selectDefaultTrack=!0,t.registerListeners(),t}e=r,(n=t).prototype=Object.create(e.prototype),u(n.prototype.constructor=n,e);var e,i,n=t.prototype;return n.registerListeners=function(){var t=this.hls;t.on(l.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(l.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(l.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(l.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(l.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(l.Events.ERROR,this.onError,this)},n.unregisterListeners=function(){var t=this.hls;t.off(l.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(l.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(l.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(l.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(l.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(l.Events.ERROR,this.onError,this)},n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,r.prototype.destroy.call(this)},n.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},n.onManifestParsed=function(t,e){this.tracks=e.audioTracks||[]},n.onAudioTrackLoaded=function(t,e){var r,i=e.id,n=e.details,s=this.tracksInGroup[i];s?(r=s.details,s.details=e.details,this.log("audioTrack "+i+" loaded ["+n.startSN+"-"+n.endSN+"]"),i===this.trackId&&(this.retryCount=0,this.playlistLoaded(i,e,r))):this.warn("Invalid audio track id "+i)},n.onLevelLoading=function(t,e){this.switchLevel(e.level)},n.onLevelSwitching=function(t,e){this.switchLevel(e.level)},n.switchLevel=function(t){var e,r=this.hls.levels[t];null!=r&&r.audioGroupIds&&(e=r.audioGroupIds[r.urlId],this.groupId!==e&&(this.groupId=e,t=this.tracks.filter(function(t){return!e||t.groupId===e}),this.selectDefaultTrack&&!t.some(function(t){return t.default})&&(this.selectDefaultTrack=!1),r={audioTracks:this.tracksInGroup=t},this.log("Updating audio tracks, "+t.length+' track(s) found in "'+e+'" group-id'),this.hls.trigger(l.Events.AUDIO_TRACKS_UPDATED,r),this.selectInitialTrack()))},n.onError=function(t,e){r.prototype.onError.call(this,t,e),!e.fatal&&e.context&&e.context.type===a.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},n.setAudioTrack=function(t){var e,r,i,n,s,a,o=this.tracksInGroup;t<0||t>=o.length?this.warn("Invalid id passed to audio-track controller"):(this.clearTimer(),a=o[this.trackId],this.log("Now switching to audio-track index "+t),r=(e=o[t]).id,i=void 0===(s=e.groupId)?"":s,n=e.name,o=e.type,s=e.url,this.trackId=t,this.trackName=n,this.selectDefaultTrack=!1,this.hls.trigger(l.Events.AUDIO_TRACK_SWITCHING,{id:r,groupId:i,name:n,type:o,url:s}),e.details&&!e.details.live||(a=this.switchParams(e.url,null==a?void 0:a.details),this.loadPlaylist(a)))},n.selectInitialTrack=function(){var t=this.tracksInGroup;console.assert(t.length,"Initial audio track should be selected when tracks are known");t=this.trackName,t=this.findTrackId(t)||this.findTrackId();-1!==t?this.setAudioTrack(t):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(l.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},n.findTrackId=function(t){for(var e=this.tracksInGroup,r=0;r<e.length;r++){var i=e[r];if((!this.selectDefaultTrack||i.default)&&(!t||t===i.name))return i.id}return-1},n.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var r=e.id,i=e.groupId,n=e.url;if(t)try{n=t.addDirectives(n)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("loading audio-track playlist for id: "+r),this.clearTimer(),this.hls.trigger(l.Events.AUDIO_TRACK_LOADING,{url:n,id:r,groupId:i,deliveryDirectives:t||null})}},e=t,(n=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}])&&o(e.prototype,n),i&&o(e,i),t}(i.default);e.default=i},"./src/controller/base-playlist-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return s});var o=r("./src/polyfills/number.ts"),l=r("./src/types/level.ts"),g=r("./src/controller/level-helper.ts"),i=r("./src/utils/logger.ts"),n=r("./src/errors.ts"),s=function(){function t(t,e){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=i.logger.log.bind(i.logger,e+":"),this.warn=i.logger.warn.bind(i.logger,e+":"),this.hls=t}var e=t.prototype;return e.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},e.onError=function(t,e){e.fatal&&e.type===n.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},e.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},e.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},e.stopLoad=function(){this.canLoad=!1,this.clearTimer()},e.switchParams=function(t,e){var r=null==e?void 0:e.renditionReports;if(r)for(var i=0;i<r.length;i++){var n=r[i],s=""+n.URI;if(s===t.substr(-s.length)){var a=parseInt(n["LAST-MSN"]),s=parseInt(n["LAST-PART"]);if(e&&this.hls.config.lowLatencyMode&&(n=Math.min(e.age-e.partTarget,e.targetduration),void 0!==s&&n>e.partTarget&&(s+=1)),Object(o.isFiniteNumber)(a))return new l.HlsUrlParameters(a,Object(o.isFiniteNumber)(s)?s:void 0,l.HlsSkip.No)}}},e.loadPlaylist=function(t){},e.shouldLoadTrack=function(t){return this.canLoad&&t&&!!t.url&&(!t.details||t.details.live)},e.playlistLoaded=function(t,e,r){var i=this,n=e.details,s=e.stats,a=s.loading.end?Math.max(0,self.performance.now()-s.loading.end):0;if(n.advancedDateTime=Date.now()-a,n.live||null!=r&&r.live){if(n.reloaded(r),r&&this.log("live playlist "+t+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),r&&0<n.fragments.length&&Object(g.mergeDetails)(r,n),this.canLoad&&n.live){var o,l=void 0,u=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var c=this.hls.config.lowLatencyMode,d=n.lastPartSn,h=n.endSN,f=n.lastPartIndex,a=d===h;-1!==f?(l=a?h+1:d,u=a?c?0:f:f+1):l=h+1;f=n.age,h=f+n.ageHeader,h=Math.min(h-n.partTarget,1.5*n.targetduration);if(0<h&&(r&&h>r.tuneInGoal?(this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+h+" with playlist age: "+n.age),h=0):(l+=r=Math.floor(h/n.targetduration),void 0!==u&&(u+=Math.round(h%n.targetduration/n.partTarget)),this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+f.toFixed(2)+"s goal: "+h+" skip sn "+r+" to part "+u)),n.tuneInGoal=h),o=this.getDeliveryDirectives(n,e.deliveryDirectives,l,u),c||!a)return void this.loadPlaylist(o)}else o=this.getDeliveryDirectives(n,e.deliveryDirectives,l,u);s=Object(g.computeReloadInterval)(n,s);void 0!==l&&n.canBlockReload&&(s-=n.partTarget||1),this.log("reload live playlist "+t+" in "+Math.round(s)+" ms"),this.timer=self.setTimeout(function(){return i.loadPlaylist(o)},s)}}else this.clearTimer()},e.getDeliveryDirectives=function(t,e,r,i){var n=Object(l.getSkipValue)(t,r);return null!=e&&e.skip&&t.deltaUpdateFailed&&(r=e.msn,i=e.part,n=l.HlsSkip.No),new l.HlsUrlParameters(r,i,n)},e.retryLoadingOrFail=function(t){var e,r=this,i=this.hls.config,n=this.retryCount<i.levelLoadingMaxRetry;return n?(this.retryCount++,-1<t.details.indexOf("LoadTimeOut")&&null!==(e=t.context)&&void 0!==e&&e.deliveryDirectives?(this.warn("retry playlist loading #"+this.retryCount+' after "'+t.details+'"'),this.loadPlaylist()):(i=Math.min(Math.pow(2,this.retryCount)*i.levelLoadingRetryDelay,i.levelLoadingMaxRetryTimeout),this.timer=self.setTimeout(function(){return r.loadPlaylist()},i),this.warn("retry playlist loading #"+this.retryCount+" in "+i+' ms after "'+t.details+'"'))):(this.warn('cannot recover from error "'+t.details+'"'),this.clearTimer(),t.fatal=!0),n},t}()},"./src/controller/base-stream-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"State",function(){return b}),r.d(e,"default",function(){return i});var l=r("./src/polyfills/number.ts"),e=r("./src/task-loop.ts"),h=r("./src/controller/fragment-tracker.ts"),a=r("./src/utils/buffer-helper.ts"),s=r("./src/utils/logger.ts"),d=r("./src/events.ts"),o=r("./src/errors.ts"),u=r("./src/types/transmuxer.ts"),c=r("./src/utils/mp4-tools.ts"),f=r("./src/utils/discontinuities.ts"),g=r("./src/controller/fragment-finders.ts"),v=r("./src/controller/level-helper.ts"),p=r("./src/loader/fragment-loader.ts"),m=r("./src/crypt/decrypter.ts"),y=r("./src/utils/time-ranges.ts"),E=r("./src/types/loader.ts");function T(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function S(t,e){return(S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var b={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},i=function(n){function t(t,e,r){var i=n.call(this)||this;return i.hls=void 0,i.fragPrevious=null,i.fragCurrent=null,i.fragmentTracker=void 0,i.transmuxer=null,i._state=b.STOPPED,i.media=void 0,i.mediaBuffer=void 0,i.config=void 0,i.bitrateTest=!1,i.lastCurrentTime=0,i.nextLoadPosition=0,i.startPosition=0,i.loadedmetadata=!1,i.fragLoadError=0,i.retryDate=0,i.levels=null,i.fragmentLoader=void 0,i.levelLastLoaded=null,i.startFragRequested=!1,i.decrypter=void 0,i.initPTS=[],i.onvseeking=null,i.onvended=null,i.logPrefix="",i.log=void 0,i.warn=void 0,i.logPrefix=r,i.log=s.logger.log.bind(s.logger,r+":"),i.warn=s.logger.warn.bind(s.logger,r+":"),i.hls=t,i.fragmentLoader=new p.default(t.config),i.fragmentTracker=e,i.config=t.config,i.decrypter=new m.default(t,t.config),t.on(d.Events.KEY_LOADED,i.onKeyLoaded,function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(i)),i}e=n,(i=t).prototype=Object.create(e.prototype),S(i.prototype.constructor=i,e);var e,r,i=t.prototype;return i.doTick=function(){this.onTickEnd()},i.onTickEnd=function(){},i.startLoad=function(t){},i.stopLoad=function(){this.fragmentLoader.abort();var t=this.fragCurrent;t&&this.fragmentTracker.removeFragment(t),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=b.STOPPED},i._streamEnded=function(t,e){var r=this.fragCurrent,i=this.fragmentTracker;if(e.live||!r||r.sn!==e.endSN||t.nextStart)return!1;r=i.getState(r);return r===h.FragmentState.PARTIAL||r===h.FragmentState.OK},i.onMediaAttached=function(t,e){e=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.cincopaAddEventListener("seeking",this.onvseeking),e.cincopaAddEventListener("ended",this.onvended);e=this.config;this.levels&&e.autoStartLoad&&this.state===b.STOPPED&&this.startLoad(e.startPosition)},i.onMediaDetaching=function(){var t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},i.onMediaSeeking=function(){var t=this.config,e=this.fragCurrent,r=this.media,i=this.mediaBuffer,n=this.state,s=r?r.currentTime:0,i=a.BufferHelper.bufferInfo(i||r,s,t.maxBufferHole);this.log("media seeking to "+(Object(l.isFiniteNumber)(s)?s.toFixed(3):s)+", state: "+n),n===b.ENDED?this.resetLoadingState():e&&!i.len&&(n=t.maxFragLookUpTolerance,t=e.start-n,n=e.start+e.duration+n<s,(s<t||n)&&(n&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.loader.abort()),this.resetLoadingState())),r&&(this.lastCurrentTime=s),this.loadedmetadata||i.len||(this.nextLoadPosition=this.startPosition=s),this.tickImmediate()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onKeyLoaded=function(t,e){var r;this.state===b.KEY_LOADING&&e.frag===this.fragCurrent&&this.levels&&(this.state=b.IDLE,(r=this.levels[e.frag.level].details)&&this.loadFragment(e.frag,r,e.frag.start))},i.onHandlerDestroying=function(){this.stopLoad(),n.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=b.STOPPED,this.hls.off(d.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,n.prototype.onHandlerDestroyed.call(this)},i.loadKey=function(t,e){this.log("Loading key for "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level),this.state=b.KEY_LOADING,this.fragCurrent=t,this.hls.trigger(d.Events.KEY_LOADING,{frag:t})},i.loadFragment=function(t,e,r){this._loadFragForPlayback(t,e,r)},i._loadFragForPlayback=function(r,t,e){var i=this;this._doFragLoad(r,t,e,function(t){if(i.fragContextChanged(r))return i.warn("Fragment "+r.sn+(t.part?" p: "+t.part.index:"")+" of level "+r.level+" was dropped during download."),void i.fragmentTracker.removeFragment(r);r.stats.chunkCount++,i._handleFragmentLoadProgress(t)}).then(function(t){if(t){i.fragLoadError=0;var e=i.state;if(!i.fragContextChanged(r))return"payload"in t&&(i.log("Loaded fragment "+r.sn+" of level "+r.level),i.hls.trigger(d.Events.FRAG_LOADED,t),i.state===b.BACKTRACKING)?(i.fragmentTracker.backtrack(r,t),void i.resetFragmentLoading(r)):void i._handleFragmentLoadComplete(t);e!==b.FRAG_LOADING&&e!==b.BACKTRACKING&&(i.fragCurrent||e!==b.PARSING)||(i.fragmentTracker.removeFragment(r),i.state=b.IDLE)}}).catch(function(t){i.warn(t),i.resetFragmentLoading(r)})},i.flushMainBuffer=function(t,e,r){void 0===r&&(r=null),t-e&&(r={startOffset:t,endOffset:e,type:r},this.fragLoadError=0,this.hls.trigger(d.Events.BUFFER_FLUSHING,r))},i._loadInitSegment=function(s){var a=this;this._doFragLoad(s).then(function(t){if(!t||a.fragContextChanged(s)||!a.levels)throw new Error("init load aborted");return t}).then(function(r){var i=a.hls,t=r.payload,e=s.decryptdata;if(t&&0<t.byteLength&&e&&e.key&&e.iv&&"AES-128"===e.method){var n=self.performance.now();return a.decrypter.webCryptoDecrypt(new Uint8Array(t),e.key.buffer,e.iv.buffer).then(function(t){var e=self.performance.now();return i.trigger(d.Events.FRAG_DECRYPTED,{frag:s,payload:t,stats:{tstart:n,tdecrypt:e}}),r.payload=t,r})}return r}).then(function(t){var e=a.fragCurrent,r=a.hls,i=a.levels;if(!i)throw new Error("init load aborted, missing levels");i=i[s.level].details;console.assert(i,"Level details are defined when init segment is loaded");i=s.stats;a.state=b.IDLE,a.fragLoadError=0,s.data=new Uint8Array(t.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),t.frag===e&&r.trigger(d.Events.FRAG_BUFFERED,{stats:i,frag:e,part:null,id:s.type}),a.tick()}).catch(function(t){a.warn(t),a.resetFragmentLoading(s)})},i.fragContextChanged=function(t){var e=this.fragCurrent;return!t||!e||t.level!==e.level||t.sn!==e.sn||t.urlId!==e.urlId},i.fragBufferedComplete=function(t,e){var r=this.mediaBuffer||this.media;this.log("Buffered "+t.type+" sn: "+t.sn+(e?" part: "+e.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level+" "+y.default.toString(a.BufferHelper.getBuffered(r))),this.state=b.IDLE,this.tick()},i._handleFragmentLoadComplete=function(t){var e,r,i=this.transmuxer;i&&(e=t.frag,r=t.part,t=!(t=t.partsLoaded)||0===t.length||t.some(function(t){return!t}),t=new u.ChunkMetadata(e.level,e.sn,e.stats.chunkCount+1,0,r?r.index:-1,!t),i.flush(t))},i._handleFragmentLoadProgress=function(t){},i._doFragLoad=function(t,e,r,i){var n=this;if(void 0===r&&(r=null),!this.levels)throw new Error("frag load aborted, missing levels");if(r=Math.max(t.start,r||0),this.config.lowLatencyMode&&e){var s=e.partList;if(s&&i){r>t.end&&e.fragmentHint&&(t=e.fragmentHint);var a=this.getNextPart(s,t,r);if(-1<a){var o=s[a];return this.log("Loading part sn: "+t.sn+" p: "+o.index+" cc: "+t.cc+" of playlist ["+e.startSN+"-"+e.endSN+"] parts [0-"+a+"-"+(s.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(r.toFixed(3))),this.nextLoadPosition=o.start+o.duration,this.state=b.FRAG_LOADING,this.hls.trigger(d.Events.FRAG_LOADING,{frag:t,part:s[a],targetBufferTime:r}),this.doFragPartsLoad(t,s,a,i).catch(function(t){return n.handleFragLoadError(t)})}if(!t.url||this.loadedEndOfParts(s,r))return Promise.resolve(null)}}return this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(e?"of ["+e.startSN+"-"+e.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(r.toFixed(3))),Object(l.isFiniteNumber)(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=b.FRAG_LOADING,this.hls.trigger(d.Events.FRAG_LOADING,{frag:t,targetBufferTime:r}),this.fragmentLoader.load(t,i).catch(function(t){return n.handleFragLoadError(t)})},i.doFragPartsLoad=function(o,l,e,u){var c=this;return new Promise(function(s,t){var a=[];(function r(i){var n=l[i];c.fragmentLoader.loadPart(o,n,u).then(function(t){var e=(a[n.index]=t).part;c.hls.trigger(d.Events.FRAG_LOADED,t);t=l[i+1];if(!t||t.fragment!==o)return s({frag:o,part:e,partsLoaded:a});r(i+1)}).catch(t)})(e)})},i.handleFragLoadError=function(t){t=t.data;return t&&t.details===o.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(d.Events.ERROR,t),null},i._handleTransmuxerFlush=function(t){var e,r,i,n=this.getCurrentContext(t);n&&this.state===b.PARSING?(e=n.frag,r=n.part,i=n.level,n=self.performance.now(),e.stats.parsing.end=n,r&&(r.stats.parsing.end=n),this.updateLevelTiming(e,r,i,t.partial)):this.fragCurrent||(this.state=b.IDLE)},i.getCurrentContext=function(t){var e=this.levels,r=t.level,i=t.sn,t=t.part;if(!e||!e[r])return this.warn("Levels object was unset while buffering fragment "+i+" of level "+r+". The current chunk will not be buffered."),null;r=e[r],t=-1<t?Object(v.getPartWith)(r,i,t):null,i=t?t.fragment:Object(v.getFragmentWithSN)(r,i,this.fragCurrent);return i?{frag:i,part:t,level:r}:null},i.bufferFragmentData=function(t,e,r,i){var n,s,a;t&&this.state===b.PARSING&&(n=t.data1,s=t.data2,(a=n)&&s&&(a=Object(c.appendUint8Array)(n,s)),a&&a.length&&(a={type:t.type,frag:e,part:r,chunkMeta:i,parent:e.type,data:a},this.hls.trigger(d.Events.BUFFER_APPENDING,a),t.dropped&&t.independent&&!r&&this.flushBufferGap(e)))},i.flushBufferGap=function(t){var e,r,i=this.media;i&&(a.BufferHelper.isBuffered(i,i.currentTime)?(r=i.currentTime,e=a.BufferHelper.bufferInfo(i,r,0),i=t.duration,i=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),r=Math.max(Math.min(t.start-i,e.end-i),r+i),t.start-r>i&&this.flushMainBuffer(r,t.start)):this.flushMainBuffer(0,t.start))},i.getFwdBufferInfo=function(t,e){var r=this.config,i=this.getLoadPosition();if(!Object(l.isFiniteNumber)(i))return null;var n=a.BufferHelper.bufferInfo(t,i,r.maxBufferHole);if(0===n.len&&void 0!==n.nextStart){e=this.fragmentTracker.getBufferedFrag(i,e);if(e&&n.nextStart<e.end)return a.BufferHelper.bufferInfo(t,i,Math.max(n.nextStart,r.maxBufferHole))}return n},i.getMaxBufferLength=function(t){var e=this.config,t=t?Math.max(8*e.maxBufferSize/t,e.maxBufferLength):e.maxBufferLength;return Math.min(t,e.maxMaxBufferLength)},i.reduceMaxBufferLength=function(t){var e=this.config,t=t||e.maxBufferLength;return e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},i.getNextFragment=function(t,e){var r=e.fragments,i=r.length;if(!i)return null;var n,s=this.config,a=r[0].start;if(e.live){var o=s.initialLiveManifestSize;if(i<o)return this.warn("Not enough fragments to start playback (have: "+i+", need: "+o+")"),null;e.PTSKnown||this.startFragRequested||-1!==this.startPosition||(n=this.getInitialLiveFragment(e,r),this.startPosition=n?this.hls.liveSyncPosition||n.start:t)}else t<=a&&(n=r[0]);return n||(s=s.lowLatencyMode?e.partEnd:e.fragmentEnd,n=this.getFragmentAtPosition(t,s,e)),null===n||void 0===n||!n.initSegment||null!==n&&void 0!==n&&n.initSegment.data||this.bitrateTest||(n=n.initSegment),n},i.getNextPart=function(t,e,r){for(var i=-1,n=!1,s=!0,a=0,o=t.length;a<o;a++){var l=t[a],s=s&&!l.independent;if(-1<i&&r<l.start)break;var u=l.loaded;!u&&(n||l.independent||s)&&l.fragment===e&&(i=a),n=u}return i},i.loadedEndOfParts=function(t,e){t=t[t.length-1];return t&&e>t.start&&t.loaded},i.getInitialLiveFragment=function(t,e){var r,i=this.fragPrevious,n=null;return i?(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),n=Object(g.findFragmentByPDT)(e,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),n||((r=i.sn+1)>=t.startSN&&r<=t.endSN&&(r=e[r-t.startSN],i.cc===r.cc&&(n=r,this.log("Live playlist, switching playlist, load frag with next SN: "+n.sn))),n||(n=Object(g.findFragWithCC)(e,i.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+n.sn))):null!==(i=this.hls.liveSyncPosition)&&(n=this.getFragmentAtPosition(i,this.bitrateTest?t.fragmentEnd:t.edge,t)),n},i.getFragmentAtPosition=function(t,e,r){var i,n=this.config,s=this.fragPrevious,a=r.fragments,o=r.endSN,l=r.fragmentHint,u=n.maxFragLookUpTolerance,n=!!(n.lowLatencyMode&&r.partList&&l);if(n&&l&&!this.bitrateTest&&(a=a.concat(l),o=l.sn),i=t<e?(c=e-u<t?0:u,Object(g.findFragmentByPTS)(s,a,t,c)):a[a.length-1]){var t=i.sn-r.startSN,c=s&&i.level===s.level,r=a[1+t];if(this.fragmentTracker.getState(i)===h.FragmentState.BACKTRACKED){i=null;for(var d=t;a[d]&&this.fragmentTracker.getState(a[d])===h.FragmentState.BACKTRACKED;)i=s?a[d--]:a[--d];i=i||r}else s&&i.sn===s.sn&&!n&&c&&(i=i.sn<o&&this.fragmentTracker.getState(r)!==h.FragmentState.OK?(this.log("SN "+i.sn+" just loaded, load next one: "+r.sn),r):null)}return i},i.synchronizeToLiveEdge=function(t){var e,r,i,n,s=this.config,a=this.media;a&&(e=this.hls.liveSyncPosition,r=a.currentTime,n=t.fragments[0].start,i=t.edge,n=r>=n-s.maxFragLookUpTolerance&&r<=i,null!==e&&a.duration>e&&(r<e||!n)&&(t=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*t.targetduration,(!n&&a.readyState<4||r<i-t)&&(this.loadedmetadata||(this.nextLoadPosition=e),a.readyState&&(this.warn("Playback: "+r.toFixed(3)+" is located too far from the end of live sliding playlist: "+i+", reset currentTime to : "+e.toFixed(3)),a.currentTime=e))))},i.alignPlaylists=function(t,e){var r=this.levels,i=this.levelLastLoaded,n=this.fragPrevious,s=null!==i?r[i]:null,a=t.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;var o=t.fragments[0].start,r=!e,i=t.alignedSliding&&Object(l.isFiniteNumber)(o);if(r||!i&&!o){Object(f.alignStream)(n,s,t);s=t.fragments[0].start;return this.log("Live playlist sliding: "+s.toFixed(2)+" start-sn: "+(e?e.startSN:"na")+"->"+t.startSN+" prev-sn: "+(n?n.sn:"na")+" fragments: "+a),s}return o},i.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},i.setStartPosition=function(t,e){var r,i=this.startPosition;i<e&&(i=-1),-1!==i&&-1!==this.lastCurrentTime||(r=t.startTimeOffset,Object(l.isFiniteNumber)(r)?(i=e+r,r<0&&(i+=t.totalduration),i=Math.min(Math.max(e,i),e+t.totalduration),this.log("Start time offset "+r+" found in playlist, adjust startPosition to "+i),this.startPosition=i):t.live?i=this.hls.liveSyncPosition||e:this.startPosition=i=0,this.lastCurrentTime=i),this.nextLoadPosition=i},i.getLoadPosition=function(){var t=this.media,e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e},i.handleFragLoadAborted=function(t,e){this.transmuxer&&"initSegment"!==t.sn&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(e?" part"+e.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},i.resetFragmentLoading=function(t){this.fragCurrent&&this.fragContextChanged(t)||(this.state=b.IDLE)},i.onFragmentOrKeyLoadError=function(t,e){var r,i;e.fatal||(r=e.frag)&&r.type===t&&(i=this.fragCurrent,console.assert(i&&r.sn===i.sn&&r.level===i.level&&r.urlId===i.urlId,"Frag load error must match current frag to retry"),i=this.config,this.fragLoadError+1<=i.fragLoadingMaxRetry?this.resetLiveStartWhenNotLoaded(r.level)||(i=Math.min(Math.pow(2,this.fragLoadError)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout),this.warn("Fragment "+r.sn+" of "+t+" "+r.level+" failed to load, retrying in "+i+"ms"),this.retryDate=self.performance.now()+i,this.fragLoadError++,this.state=b.FRAG_LOADING_WAITING_RETRY):e.levelRetry?(t===E.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=b.IDLE):(s.logger.error(e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.stopLoad(),this.state=b.ERROR))},i.afterBufferFlushed=function(t,e,r){t&&(t=a.BufferHelper.getBuffered(t),this.fragmentTracker.detectEvictedFragments(e,t,r),this.state===b.ENDED&&this.resetLoadingState())},i.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=b.IDLE},i.resetLiveStartWhenNotLoaded=function(t){if(!this.loadedmetadata){this.startFragRequested=!1;t=this.levels?this.levels[t].details:null;if(null!=t&&t.live)return this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},i.updateLevelTiming=function(n,t,s,a){var o=this,l=s.details;console.assert(!!l,"level.details must be defined"),Object.keys(n.elementaryStreams).reduce(function(t,e){var r=n.elementaryStreams[e];if(r){var i=r.endPTS-r.startPTS;if(i<=0)return o.warn("Could not parse fragment "+n.sn+" "+e+" duration reliably ("+i+") resetting transmuxer to fallback to playlist timing"),o.resetTransmuxer(),t||!1;i=a?0:Object(v.updateFragPTSDTS)(l,n,r.startPTS,r.endPTS,r.startDTS,r.endDTS);return o.hls.trigger(d.Events.LEVEL_PTS_UPDATED,{details:l,level:s,drift:i,type:e,frag:n,start:r.startPTS,end:r.endPTS}),!0}return t},!1)?(this.state=b.PARSED,this.hls.trigger(d.Events.FRAG_PARSED,{frag:n,part:t})):this.resetLoadingState()},i.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},e=t,(i=[{key:"state",get:function(){return this._state},set:function(t){var e=this._state;e!==t&&(this._state=t,this.log(e+"->"+t))}}])&&T(e.prototype,i),r&&T(e,r),t}(e.default)},"./src/controller/buffer-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return s});var l=r("./src/polyfills/number.ts"),v=r("./src/events.ts"),p=r("./src/utils/logger.ts"),m=r("./src/errors.ts"),y=r("./src/utils/buffer-helper.ts"),e=r("./src/utils/mediasource-helper.ts"),a=r("./src/loader/fragment.ts"),i=r("./src/controller/buffer-operation-queue.ts"),n=Object(e.getMediaSource)(),u=/([ha]vc.)(?:\.[^.,]+)+/,s=function(){function t(t){var i=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=i.hls,e=i.media,r=i.mediaSource;p.logger.log("[buffer-controller]: Media source opened"),e&&(i.updateMediaElementDuration(),t.trigger(v.Events.MEDIA_ATTACHED,{media:e})),r&&r.removeEventListener("sourceopen",i._onMediaSourceOpen),i.checkPendingTracks()},this._onMediaSourceClose=function(){p.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){p.logger.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var e=t.prototype;return e.hasSourceTypes=function(){return 0<this.getSourceBufferTypes().length||0<Object.keys(this.pendingTracks).length},e.destroy=function(){this.unregisterListeners(),this.details=null},e.registerListeners=function(){var t=this.hls;t.on(v.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(v.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(v.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(v.Events.BUFFER_RESET,this.onBufferReset,this),t.on(v.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(v.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(v.Events.BUFFER_EOS,this.onBufferEos,this),t.on(v.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(v.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(v.Events.FRAG_PARSED,this.onFragParsed,this),t.on(v.Events.FRAG_CHANGED,this.onFragChanged,this)},e.unregisterListeners=function(){var t=this.hls;t.off(v.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(v.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(v.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(v.Events.BUFFER_RESET,this.onBufferReset,this),t.off(v.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(v.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(v.Events.BUFFER_EOS,this.onBufferEos,this),t.off(v.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(v.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(v.Events.FRAG_PARSED,this.onFragParsed,this),t.off(v.Events.FRAG_CHANGED,this.onFragChanged,this)},e._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new i.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},e.onManifestParsed=function(t,e){var r=2;(!e.audio||e.video)&&e.altAudio||(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,p.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},e.onMediaAttaching=function(t,e){var r=this.media=e.media;r&&n&&((e=this.mediaSource=new n).cincopaAddEventListener("sourceopen",this._onMediaSourceOpen),e.cincopaAddEventListener("sourceended",this._onMediaSourceEnded),e.cincopaAddEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(e),this._objectUrl=r.src)},e.onMediaDetaching=function(){var t=this.media,e=this.mediaSource,r=this._objectUrl;if(e){if(p.logger.log("[buffer-controller]: media source detaching"),"open"===e.readyState)try{e.endOfStream()}catch(t){p.logger.warn("[buffer-controller]: onMediaDetaching: "+t.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(r&&self.URL.revokeObjectURL(r),t.src===r?(t.removeAttribute("src"),t.load()):p.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(v.Events.MEDIA_DETACHED,void 0)},e.onBufferReset=function(){var r=this;this.getSourceBufferTypes().forEach(function(e){var t=r.sourceBuffer[e];try{t&&(r.removeBufferListeners(e),r.mediaSource&&r.mediaSource.removeSourceBuffer(t),r.sourceBuffer[e]=void 0)}catch(t){p.logger.warn("[buffer-controller]: Failed to reset the "+e+" buffer",t)}}),this._initSourceBuffer()},e.onBufferCodecs=function(t,s){var a=this,o=this.getSourceBufferTypes().length;Object.keys(s).forEach(function(t){var e,r,i,n;o?(e=a.tracks[t])&&"function"==typeof e.buffer.changeType&&(n=(i=s[t]).codec,r=i.levelCodec,i=i.container,(e.levelCodec||e.codec).replace(u,"$1")!==(r||n).replace(u,"$1")&&(n=i+";codecs="+(r||n),a.appendChangeType(t,n))):a.pendingTracks[t]=s[t]}),o||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},e.appendChangeType=function(e,r){var i=this,n=this.operationQueue,t={execute:function(){var t=i.sourceBuffer[e];t&&(p.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+r),t.changeType(r)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){p.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",t)}};n.append(t,e)},e.onBufferAppending=function(t,e){var n=this,r=this.hls,i=this.operationQueue,s=this.tracks,a=e.data,o=e.type,l=e.frag,u=e.part,c=e.chunkMeta,d=c.buffering[o],e=self.performance.now();d.start=e;var h=l.stats.buffering,f=u?u.stats.buffering:null;0===h.start&&(h.start=e),f&&0===f.start&&(f.start=e);var s=s.audio,g="audio"===o&&1===c.id&&"audio/mpeg"===(null==s?void 0:s.container),s={execute:function(){var t,e;d.executeStart=self.performance.now(),!g||(t=n.sourceBuffer[o])&&(e=l.start-t.timestampOffset,.1<=Math.abs(e)&&(p.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+l.start+" (delta: "+e+") sn: "+l.sn+")"),t.timestampOffset=l.start)),n.appendExecutor(a,o)},onStart:function(){},onComplete:function(){var t=self.performance.now();d.executeEnd=d.end=t,0===h.first&&(h.first=t),f&&0===f.first&&(f.first=t);var e,r=n.sourceBuffer,i={};for(e in r)i[e]=y.BufferHelper.getBuffered(r[e]);n.appendError=0,n.hls.trigger(v.Events.BUFFER_APPENDED,{type:o,frag:l,part:u,chunkMeta:c,parent:l.type,timeRanges:i})},onError:function(t){p.logger.error("[buffer-controller]: Error encountered while trying to append to the "+o+" SourceBuffer",t);var e={type:m.ErrorTypes.MEDIA_ERROR,parent:l.type,details:m.ErrorDetails.BUFFER_APPEND_ERROR,err:t,fatal:!1};t.code===DOMException.QUOTA_EXCEEDED_ERR?e.details=m.ErrorDetails.BUFFER_FULL_ERROR:(n.appendError++,e.details=m.ErrorDetails.BUFFER_APPEND_ERROR,n.appendError>r.config.appendErrorMaxRetry&&(p.logger.error("[buffer-controller]: Failed "+r.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),e.fatal=!0)),r.trigger(v.Events.ERROR,e)}};i.append(s,o)},e.onBufferFlushing=function(t,r){function e(e){return{execute:i.removeExecutor.bind(i,e,r.startOffset,r.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(v.Events.BUFFER_FLUSHED,{type:e})},onError:function(t){p.logger.warn("[buffer-controller]: Failed to remove from "+e+" SourceBuffer",t)}}}var i=this,n=this.operationQueue;r.type?n.append(e(r.type),r.type):this.getSourceBufferTypes().forEach(function(t){n.append(e(t),t)})},e.onFragParsed=function(t,e){var r=this,i=e.frag,n=e.part,s=[],e=(n||i).elementaryStreams;e[a.ElementaryStreamTypes.AUDIOVIDEO]?s.push("audiovideo"):(e[a.ElementaryStreamTypes.AUDIO]&&s.push("audio"),e[a.ElementaryStreamTypes.VIDEO]&&s.push("video"));0===s.length&&p.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+i.type+" level: "+i.level+" sn: "+i.sn),this.blockBuffers(function(){var t=self.performance.now();i.stats.buffering.end=t,n&&(n.stats.buffering.end=t);t=(n||i).stats;r.hls.trigger(v.Events.FRAG_BUFFERED,{frag:i,part:n,stats:t,id:i.type})},s)},e.onFragChanged=function(t,e){this.flushBackBuffer()},e.onBufferEos=function(t,i){var n=this;this.getSourceBufferTypes().reduce(function(t,e){var r=n.sourceBuffer[e];return i.type&&i.type!==e||r&&!r.ended&&(r.ended=!0,p.logger.log("[buffer-controller]: "+e+" sourceBuffer now EOS")),t&&!(r&&!r.ended)},!0)&&this.blockBuffers(function(){var t=n.mediaSource;t&&"open"===t.readyState&&t.endOfStream()})},e.onLevelUpdated=function(t,e){e=e.details;e.fragments.length&&(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},e.flushBackBuffer=function(){var t,e,r,i,n=this.hls,s=this.details,a=this.media,o=this.sourceBuffer;!a||null===s||(t=this.getSourceBufferTypes()).length&&(r=s.live&&null!==n.config.liveBackBufferLength?n.config.liveBackBufferLength:n.config.backBufferLength,!Object(l.isFiniteNumber)(r)||r<0||(e=a.currentTime,a=s.levelTargetDuration,r=Math.max(r,a),i=Math.floor(e/a)*a-r,t.forEach(function(t){var e=o[t];!e||0<(e=y.BufferHelper.getBuffered(e)).length&&i>e.start(0)&&(n.trigger(v.Events.BACK_BUFFER_REACHED,{bufferEnd:i}),s.live&&n.trigger(v.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i}),n.trigger(v.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:t}))})))},e.updateMediaElementDuration=function(){var t,e,r,i,n,s;this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState&&(t=this.details,e=this.hls,s=this.media,r=this.mediaSource,i=t.fragments[0].start+t.totalduration,n=s.duration,s=Object(l.isFiniteNumber)(r.duration)?r.duration:0,t.live&&e.config.liveDurationInfinity?(p.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),r.duration=1/0,this.updateSeekableRange(t)):(s<i&&n<i||!Object(l.isFiniteNumber)(n))&&(p.logger.log("[buffer-controller]: Updating Media Source duration to "+i.toFixed(3)),r.duration=i))},e.updateSeekableRange=function(t){var e=this.mediaSource,r=t.fragments;r.length&&t.live&&null!=e&&e.setLiveSeekableRange&&(r=Math.max(0,r[0].start),t=Math.max(r,r+t.totalduration),e.setLiveSeekableRange(r,t))},e.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,r=this.pendingTracks,i=Object.keys(r).length;(i&&!t||2===i)&&(this.createSourceBuffers(r),this.pendingTracks={},0!==(r=this.getSourceBufferTypes()).length?r.forEach(function(t){e.executeNext(t)}):this.hls.trigger(v.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"}))},e.createSourceBuffers=function(t){var e=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");var i,n=0;for(i in t)if(!e[i]){var s=t[i];if(!s)throw Error("source buffer exists for track "+i+", however track does not");var a=s.levelCodec||s.codec,o=s.container+";codecs="+a;p.logger.log("[buffer-controller]: creating sourceBuffer("+o+")");try{var l=e[i]=r.addSourceBuffer(o),u=i;this.addBufferListener(u,"updatestart",this._onSBUpdateStart),this.addBufferListener(u,"updateend",this._onSBUpdateEnd),this.addBufferListener(u,"error",this._onSBUpdateError),this.tracks[i]={buffer:l,codec:a,container:s.container,levelCodec:s.levelCodec,id:s.id},n++}catch(t){p.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(v.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:o})}}n&&this.hls.trigger(v.Events.BUFFER_CREATED,{tracks:this.tracks})},e._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},e._onSBUpdateEnd=function(t){var e=this.operationQueue;e.current(t).onComplete(),e.shiftAndExecuteNext(t)},e._onSBUpdateError=function(t,e){p.logger.error("[buffer-controller]: "+t+" SourceBuffer error",e),this.hls.trigger(v.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});t=this.operationQueue.current(t);t&&t.onError(e)},e.removeExecutor=function(t,e,r){var i=this.media,n=this.mediaSource,s=this.operationQueue,a=this.sourceBuffer[t];if(!i||!n||!a)return p.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void s.shiftAndExecuteNext(t);i=Object(l.isFiniteNumber)(i.duration)?i.duration:1/0,n=Object(l.isFiniteNumber)(n.duration)?n.duration:1/0,e=Math.max(0,e),n=Math.min(r,i,n);e<n?(p.logger.log("[buffer-controller]: Removing ["+e+","+n+"] from the "+t+" SourceBuffer"),console.assert(!a.updating,t+" sourceBuffer must not be updating"),a.remove(e,n)):s.shiftAndExecuteNext(t)},e.appendExecutor=function(t,e){var r=this.operationQueue,i=this.sourceBuffer[e];if(!i)return p.logger.warn("[buffer-controller]: Attempting to append to the "+e+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(e);i.ended=!1,console.assert(!i.updating,e+" sourceBuffer must not be updating"),i.appendBuffer(t)},e.blockBuffers=function(t,e){var r=this;if(void 0===e&&(e=this.getSourceBufferTypes()),!e.length)return p.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(t);var i=this.operationQueue,n=e.map(function(t){return i.appendBlocker(t)});Promise.all(n).then(function(){t(),e.forEach(function(t){var e=r.sourceBuffer[t];e&&e.updating||i.shiftAndExecuteNext(t)})})},e.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},e.addBufferListener=function(t,e,r){var i=this.sourceBuffer[t];i&&(r=r.bind(this,t),this.listeners[t].push({event:e,listener:r}),i.cincopaAddEventListener(e,r))},e.removeBufferListeners=function(t){var e=this.sourceBuffer[t];e&&this.listeners[t].forEach(function(t){e.removeEventListener(t.event,t.listener)})},t}()},"./src/controller/buffer-operation-queue.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var s=r("./src/utils/logger.ts"),i=function(){function t(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}var e=t.prototype;return e.append=function(t,e){var r=this.queues[e];r.push(t),1===r.length&&this.buffers[e]&&this.executeNext(e)},e.insertAbort=function(t,e){this.queues[e].unshift(t),this.executeNext(e)},e.appendBlocker=function(t){var e,r=new Promise(function(t){e=t}),i={execute:e,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,t),r},e.executeNext=function(e){var r=this.buffers,i=this.queues,r=r[e],i=i[e];if(i.length){var n=i[0];try{n.execute()}catch(t){s.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),n.onError(t),r&&r.updating||(i.shift(),this.executeNext(e))}}},e.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},e.current=function(t){return this.queues[t][0]},t}()},"./src/controller/cap-level-controller.ts":function(t,e,r){"use strict";r.r(e);var i=r("./src/events.ts");function s(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}r=function(){function n(t){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var t,e,r=n.prototype;return r.setStreamController=function(t){this.streamController=t},r.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},r.registerListeners=function(){var t=this.hls;t.on(i.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},r.unregisterListener=function(){var t=this.hls;t.off(i.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},r.onFpsDropLevelCapping=function(t,e){n.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},r.onMediaAttaching=function(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null},r.onManifestParsed=function(t,e){var r=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,r.config.capLevelToPlayerSize&&e.video&&this.startCapping()},r.onBufferCodecs=function(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},r.onMediaDetaching=function(){this.stopCapping()},r.detectPlayerSize=function(){var t,e;this.media&&0<this.mediaHeight&&0<this.mediaWidth&&((t=this.hls.levels).length&&((e=this.hls).autoLevelCapping=this.getMaxLevel(t.length-1),e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping))},r.getMaxLevel=function(r){var i=this,t=this.hls.levels;if(!t.length)return-1;t=t.filter(function(t,e){return n.isLevelAllowed(e,i.restrictedLevels)&&e<=r});return this.clientRect=null,n.getMaxLevelByMediaSize(t,this.mediaWidth,this.mediaHeight)},r.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},r.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},r.getDimensions=function(){if(this.clientRect)return this.clientRect;var t,e=this.media,r={width:0,height:0};return e&&(t=e.getBoundingClientRect(),r.width=t.width,r.height=t.height,r.width||r.height||(r.width=t.right-t.left||e.width||0,r.height=t.bottom-t.top||e.height||0)),this.clientRect=r},n.isLevelAllowed=function(t,e){return void 0===e&&(e=[]),-1===e.indexOf(t)},n.getMaxLevelByMediaSize=function(t,e,r){if(!t||!t.length)return-1;for(var i,n,s=t.length-1,a=0;a<t.length;a+=1){var o=t[a];if((o.width>=e||o.height>=r)&&(i=o,!(n=t[a+1])||(i.width!==n.width||i.height!==n.height))){s=a;break}}return s},t=n,e=[{key:"contentScaleFactor",get:function(){var t=1;try{t=self.devicePixelRatio}catch(t){}return t}}],(r=[{key:"mediaWidth",get:function(){return this.getDimensions().width*n.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*n.contentScaleFactor}}])&&s(t.prototype,r),e&&s(t,e),n}();e.default=r},"./src/controller/cmcd-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return c});var i=r("./src/events.ts"),s=r("./src/types/cmcd.ts"),n=r("./src/utils/buffer-helper.ts"),a=r("./src/utils/logger.ts");function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),t}function d(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function h(){return(h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,i=arguments[e];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}var c=function(){function c(t){var n=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){n.initialized&&(n.starved=!0),n.buffering=!0},this.onPlaying=function(){n.initialized||(n.initialized=!0),n.buffering=!1},this.applyPlaylistData=function(t){try{n.apply(t,{ot:s.CMCDObjectType.MANIFEST,su:!n.initialized})}catch(t){a.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=function(t){try{var e=t.frag,r=n.hls.levels[e.level],i=n.getObjectType(e),e={d:1e3*e.duration,ot:i};i!==s.CMCDObjectType.VIDEO&&i!==s.CMCDObjectType.AUDIO&&i!=s.CMCDObjectType.MUXED||(e.br=r.bitrate/1e3,e.tb=n.getTopBandwidth(i),e.bl=n.getBufferLength(i)),n.apply(t,e)}catch(t){a.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=t;var e=this.config=t.config,t=e.cmcd;null!=t&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=t.sessionId||c.uuid(),this.cid=t.contentId,this.useHeaders=!0===t.useHeaders,this.registerListeners())}var t=c.prototype;return t.registerListeners=function(){var t=this.hls;t.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(i.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.on(i.Events.BUFFER_CREATED,this.onBufferCreated,this)},t.unregisterListeners=function(){var t=this.hls;t.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(i.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.off(i.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},t.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},t.onMediaAttached=function(t,e){this.media=e.media,this.media.cincopaAddEventListener("waiting",this.onWaiting),this.media.cincopaAddEventListener("playing",this.onPlaying)},t.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},t.onBufferCreated=function(t,e){var r;this.audioBuffer=null===(r=e.tracks.audio)||void 0===r?void 0:r.buffer,this.videoBuffer=null===(e=e.tracks.video)||void 0===e?void 0:e.buffer},t.createData=function(){var t;return{v:s.CMCDVersion,sf:s.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:null===(t=this.media)||void 0===t?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},t.apply=function(t,e){void 0===e&&(e={}),h(e,this.createData());var r=e.ot===s.CMCDObjectType.INIT||e.ot===s.CMCDObjectType.VIDEO||e.ot===s.CMCDObjectType.MUXED;this.starved&&r&&(e.bs=!0,e.su=!0,this.starved=!1),null==e.su&&(e.su=this.buffering),this.useHeaders?(r=c.toHeaders(e),Object.keys(r).length&&(t.headers||(t.headers={}),h(t.headers,r))):(e=c.toQuery(e))&&(t.url=c.appendQueryToUri(t.url,e))},t.getObjectType=function(t){var e=t.type;return"subtitle"===e?s.CMCDObjectType.TIMED_TEXT:"initSegment"===t.sn?s.CMCDObjectType.INIT:"audio"===e?s.CMCDObjectType.AUDIO:"main"===e?this.hls.audioTracks.length?s.CMCDObjectType.VIDEO:s.CMCDObjectType.MUXED:void 0},t.getTopBandwidth=function(t){for(var e=0,r=d(t===s.CMCDObjectType.AUDIO?this.hls.audioTracks:this.hls.levels);!(i=r()).done;){var i=i.value;i.bitrate>e&&(e=i.bitrate)}return 0<e?e:NaN},t.getBufferLength=function(t){var e=this.hls.media,t=t===s.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return t&&e?1e3*n.BufferHelper.bufferInfo(t,e.currentTime,this.config.maxBufferHole).len:NaN},t.createPlaylistLoader=function(){var t=this.config.pLoader,i=this.applyPlaylistData,r=t||this.config.loader;return function(){function t(t){this.loader=void 0,this.loader=new r(t)}var e=t.prototype;return e.destroy=function(){this.loader.destroy()},e.abort=function(){this.loader.abort()},e.load=function(t,e,r){i(t),this.loader.load(t,e,r)},l(t,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),t}()},t.createFragmentLoader=function(){var t=this.config.fLoader,i=this.applyFragmentData,r=t||this.config.loader;return function(){function t(t){this.loader=void 0,this.loader=new r(t)}var e=t.prototype;return e.destroy=function(){this.loader.destroy()},e.abort=function(){this.loader.abort()},e.load=function(t,e,r){i(t),this.loader.load(t,e,r)},l(t,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),t}()},c.uuid=function(){var t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.substr(e.lastIndexOf("/")+1)},c.serialize=function(t){for(var e,r=[],i=function(t){return Math.round(t)},n=function(t){return 100*i(t/100)},s={br:i,d:i,bl:n,dl:n,mtp:n,nor:function(t){return encodeURIComponent(t)},rtp:n,tb:i},a=d(Object.keys(t||{}).sort());!(o=a()).done;){var o,l,u=o.value,c=t[u];e=c,Number.isNaN(e)||null==e||""===e||!1===e||("v"===u&&1===c||"pr"==u&&1===c||((l=s[u])&&(c=l(c)),o=typeof c,l=void 0,l="ot"===u||"sf"===u||"st"===u?u+"="+c:"boolean"==o?u:"number"==o?u+"="+c:u+"="+JSON.stringify(c),r.push(l)))}return r.join(",")},c.toHeaders=function(t){for(var e={},r=["Object","Request","Session","Status"],i=[{},{},{},{}],n={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},s=0,a=Object.keys(t);s<a.length;s++){var o=a[s];i[null!=n[o]?n[o]:1][o]=t[o]}for(var l=0;l<i.length;l++){var u=c.serialize(i[l]);u&&(e["CMCD-"+r[l]]=u)}return e},c.toQuery=function(t){return"CMCD="+encodeURIComponent(c.serialize(t))},c.appendQueryToUri=function(t,e){if(!e)return t;var r=t.includes("?")?"&":"?";return t+r+e},c}()},"./src/controller/eme-controller.ts":function(t,e,r){"use strict";r.r(e);var o=r("./src/events.ts"),l=r("./src/errors.ts"),u=r("./src/utils/logger.ts"),a=r("./src/utils/mediakeys-helper.ts");function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}r=function(){function t(t){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=t,this._config=t.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var e,r,i=t.prototype;return i.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},i._registerListeners=function(){this.hls.on(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(o.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(o.Events.MANIFEST_PARSED,this.onManifestParsed,this)},i._unregisterListeners=function(){this.hls.off(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(o.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(o.Events.MANIFEST_PARSED,this.onManifestParsed,this)},i.getLicenseServerUrl=function(t){switch(t){case a.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')},i._attemptKeySystemAccess=function(e,t,r){var i=this,r=function(t,e,r,i){if(t!==a.KeySystems.WIDEVINE)throw new Error("Unknown key-system: "+t);return r=r,n=i,s={audioCapabilities:[],videoCapabilities:[]},e.forEach(function(t){s.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:n.audioRobustness||""})}),r.forEach(function(t){s.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:n.videoRobustness||""})}),[s];var n,s}(e,t,r,this._drmSystemOptions);u.logger.log("Requesting encrypted media key-system access");r=this.requestMediaKeySystemAccess(e,r);this.mediaKeysPromise=r.then(function(t){return i._onMediaKeySystemAccessObtained(e,t)}),r.catch(function(t){u.logger.error('Failed to obtain key-system "'+e+'" access:',t)})},i._onMediaKeySystemAccessObtained=function(e,t){var r=this;u.logger.log('Access for key-system "'+e+'" obtained');var i={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(i);var n=Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(t){return i.mediaKeys=t,u.logger.log('Media-keys created for key-system "'+e+'"'),r._onMediaKeysCreated(),t});return n.catch(function(t){u.logger.error("Failed to create media-keys:",t)}),n},i._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},i._onNewMediaKeySession=function(e){var r=this;u.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",function(t){r._onKeySessionMessage(e,t.message)},!1)},i._onKeySessionMessage=function(e,t){u.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(t){u.logger.log("Received license data (length: "+(t&&t.byteLength)+"), updating key-session"),e.update(t)})},i.onMediaEncrypted=function(e){var r=this;if(u.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),!this.mediaKeysPromise)return u.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(o.Events.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});function t(t){r._media&&(r._attemptSetMediaKeys(t),r._generateRequestWithPreferredKeySession(e.initDataType,e.initData))}this.mediaKeysPromise.then(t).catch(t)},i._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return u.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(o.Events.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});u.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},i._generateRequestWithPreferredKeySession=function(t,e){var r=this,i=this._mediaKeysList[0];if(!i)return u.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(o.Events.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(!i.mediaKeysSessionInitialized){var n=i.mediaKeysSession;return n?e?(u.logger.log('Generating key-session request for "'+t+'" init data type'),i.mediaKeysSessionInitialized=!0,void n.generateRequest(t,e).then(function(){u.logger.debug("Key-session generation succeeded")}).catch(function(t){u.logger.error("Error generating key-session request:",t),r.hls.trigger(o.Events.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})):(u.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(o.Events.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0})):(u.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(o.Events.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}))}u.logger.warn("Key-Session already initialized but requested again")},i._createLicenseXhr=function(t,e,r){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,i,t,e,r);var n=this._licenseXhrSetup;if(n)try{n.call(this.hls,i,t),n=void 0}catch(t){u.logger.error(t)}try{i.readyState||i.open("POST",t,!0),n&&n.call(this.hls,i,t)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return i},i._onLicenseRequestReadyStageChange=function(t,e,r,i){if(4===t.readyState)if(200===t.status){this._requestLicenseFailureCount=0,u.logger.log("License request succeeded");var n=t.response,s=this._licenseResponseCallback;if(s)try{n=s.call(this.hls,t,e)}catch(t){u.logger.error(t)}i(n)}else{if(u.logger.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,3<this._requestLicenseFailureCount)return void this.hls.trigger(o.Events.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var a=3-this._requestLicenseFailureCount+1;u.logger.warn("Retrying license request, "+a+" attempts left"),this._requestLicense(r,i)}},i._generateLicenseRequestChallenge=function(t,e){if(t.mediaKeySystemDomain===a.KeySystems.WIDEVINE)return e;throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},i._requestLicense=function(t,e){u.logger.log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r)return u.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(o.Events.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var i=this.getLicenseServerUrl(r.mediaKeySystemDomain),n=this._createLicenseXhr(i,t,e);u.logger.log("Sending license request to URL: "+i);i=this._generateLicenseRequestChallenge(r,t);n.send(i)}catch(t){u.logger.error("Failure requesting DRM license: "+t),this.hls.trigger(o.Events.ERROR,{type:l.ErrorTypes.KEY_SYSTEM_ERROR,details:l.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},i.onMediaAttached=function(t,e){this._emeEnabled&&(e=e.media,(this._media=e).cincopaAddEventListener("encrypted",this._onMediaEncrypted))},i.onMediaDetached=function(){var t=this._media,e=this._mediaKeysList;t&&(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(t){if(t.mediaKeysSession)return t.mediaKeysSession.close().catch(function(){})})).then(function(){return t.setMediaKeys(null)}).catch(function(){}))},i.onManifestParsed=function(t,e){var r;this._emeEnabled&&(r=e.levels.map(function(t){return t.audioCodec}).filter(function(t){return!!t}),e=e.levels.map(function(t){return t.videoCodec}).filter(function(t){return!!t}),this._attemptKeySystemAccess(a.KeySystems.WIDEVINE,r,e))},e=t,(i=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&n(e.prototype,i),r&&n(e,r),t}();e.default=r},"./src/controller/fps-controller.ts":function(t,e,r){"use strict";r.r(e);var l=r("./src/events.ts"),u=r("./src/utils/logger.ts"),r=function(){function t(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}var e=t.prototype;return e.setStreamController=function(t){this.streamController=t},e.registerListeners=function(){this.hls.on(l.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},e.unregisterListeners=function(){this.hls.off(l.Events.MEDIA_ATTACHING,this.onMediaAttaching)},e.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},e.onMediaAttaching=function(t,e){var r=this.hls.config;r.capLevelOnFPSDrop&&(e=e.media instanceof self.HTMLVideoElement?e.media:null,(this.media=e)&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod))},e.checkFPS=function(t,e,r){var i,n,s,a,o=performance.now();e&&(this.lastTime&&(s=o-this.lastTime,i=r-this.lastDroppedFrames,a=e-this.lastDecodedFrames,n=1e3*i/s,(s=this.hls).trigger(l.Events.FPS_DROP,{currentDropped:i,currentDecoded:a,totalDroppedFrames:r}),0<n&&i>s.config.fpsDroppedMonitoringThreshold*a&&(a=s.currentLevel,u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+a),0<a&&(-1===s.autoLevelCapping||s.autoLevelCapping>=a)&&(--a,s.trigger(l.Events.FPS_DROP_LEVEL_CAPPING,{level:a,droppedLevel:s.currentLevel}),s.autoLevelCapping=a,this.streamController.nextLevelSwitch()))),this.lastTime=o,this.lastDroppedFrames=r,this.lastDecodedFrames=e)},e.checkFPSInterval=function(){var t,e=this.media;e&&(this.isVideoPlaybackQualityAvailable?(t=e.getVideoPlaybackQuality(),this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)):this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount))},t}();e.default=r},"./src/controller/fragment-finders.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"findFragmentByPDT",function(){return i}),r.d(e,"findFragmentByPTS",function(){return n}),r.d(e,"fragmentWithinToleranceTest",function(){return o}),r.d(e,"pdtWithinToleranceTest",function(){return l}),r.d(e,"findFragWithCC",function(){return u});var s=r("./src/polyfills/number.ts"),a=r("./src/utils/binary-search.ts");function i(t,e,r){if(null===e||!Array.isArray(t)||!t.length||!Object(s.isFiniteNumber)(e))return null;if(e<(t[0].programDateTime||0))return null;if((t[t.length-1].endProgramDateTime||0)<=e)return null;r=r||0;for(var i=0;i<t.length;++i){var n=t[i];if(l(e,r,n))return n}return null}function n(t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=null;if(t?n=e[t.sn-e[0].sn+1]||null:0===r&&0===e[0].start&&(n=e[0]),n&&0===o(r,i,n))return n;i=a.default.search(e,o.bind(null,r,i));return i||n}function o(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0);e=Math.min(e,r.duration+(r.deltaPTS||0));return r.start+r.duration-e<=t?1:r.start-e>t&&r.start?-1:0}function l(t,e,r){e=1e3*Math.min(e,r.duration+(r.deltaPTS||0));return t<(r.endProgramDateTime||0)-e}function u(t,e){return a.default.search(t,function(t){return t.cc<e?1:t.cc>e?-1:0})}},"./src/controller/fragment-tracker.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"FragmentState",function(){return i}),r.d(e,"FragmentTracker",function(){return s});var i,n=r("./src/events.ts"),o=r("./src/types/loader.ts");(r=i=i||{}).NOT_LOADED="NOT_LOADED",r.BACKTRACKED="BACKTRACKED",r.APPENDING="APPENDING",r.PARTIAL="PARTIAL",r.OK="OK";var s=function(){function t(t){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=t,this._registerListeners()}var e=t.prototype;return e._registerListeners=function(){var t=this.hls;t.on(n.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.on(n.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(n.Events.FRAG_LOADED,this.onFragLoaded,this)},e._unregisterListeners=function(){var t=this.hls;t.off(n.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.off(n.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(n.Events.FRAG_LOADED,this.onFragLoaded,this)},e.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},e.getAppendedFrag=function(t,e){if(e===o.PlaylistLevelType.MAIN){var r=this.activeFragment,i=this.activeParts;if(!r)return null;if(i)for(var n=i.length;n--;){var s=i[n],a=s?s.end:r.appendedPTS;if(s.start<=t&&void 0!==a&&t<=a)return 9<n&&(this.activeParts=i.slice(n-9)),s}else if(r.start<=t&&void 0!==r.appendedPTS&&t<=r.appendedPTS)return r}return this.getBufferedFrag(t,e)},e.getBufferedFrag=function(t,e){for(var r=this.fragments,i=Object.keys(r),n=i.length;n--;){var s=r[i[n]];if((null==s?void 0:s.body.type)===e&&s.buffered){s=s.body;if(s.start<=t&&t<=s.end)return s}}return null},e.detectEvictedFragments=function(r,i,n){var s=this;Object.keys(this.fragments).forEach(function(t){var e=s.fragments[t];e&&(e.buffered?(t=e.range[r])&&t.time.some(function(t){t=!s.isTimeBuffered(t.startPTS,t.endPTS,i);return t&&s.removeFragment(e.body),t}):e.body.type===n&&s.removeFragment(e.body))})},e.detectPartialFragments=function(t){var i,n=this,s=this.timeRanges,a=t.frag,o=t.part;s&&"initSegment"!==a.sn&&(t=u(a),(i=this.fragments[t])&&(Object.keys(s).forEach(function(t){var e,r=a.elementaryStreams[t];r&&(e=s[t],r=null!==o||!0===r.partial,i.range[t]=n.getBufferedTimes(a,o,r,e))}),i.backtrack=i.loaded=null,Object.keys(i.range).length?i.buffered=!0:this.removeFragment(i.body)))},e.fragBuffered=function(t){t=u(t),t=this.fragments[t];t&&(t.backtrack=t.loaded=null,t.buffered=!0)},e.getBufferedTimes=function(t,e,r,i){for(var n={time:[],partial:r},s=(e||t).start,a=(e||t).end,o=t.minEndPTS||a,l=t.maxStartPTS||s,u=0;u<i.length;u++){var c=i.start(u)-this.bufferPadding,d=i.end(u)+this.bufferPadding;if(c<=l&&o<=d){n.time.push({startPTS:Math.max(s,i.start(u)),endPTS:Math.min(a,i.end(u))});break}if(s<d&&c<a)n.partial=!0,n.time.push({startPTS:Math.max(s,i.start(u)),endPTS:Math.min(a,i.end(u))});else if(a<=c)break}return n},e.getPartialFragment=function(e){var r,i,n=null,s=0,a=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach(function(t){t=o[t];t&&l(t)&&(r=t.body.start-a,i=t.body.end+a,r<=e&&e<=i&&(i=Math.min(e-r,i-e),s<=i&&(n=t.body,s=i)))}),n},e.getState=function(t){t=u(t),t=this.fragments[t];return t?t.buffered?l(t)?i.PARTIAL:i.OK:t.backtrack?i.BACKTRACKED:i.APPENDING:i.NOT_LOADED},e.backtrack=function(t,e){t=u(t),t=this.fragments[t];if(!t||t.backtrack)return null;var r=t.backtrack=e||t.loaded;return t.loaded=null,r},e.getBacktrackData=function(t){var e=u(t),e=this.fragments[e];if(e){var r,e=e.backtrack;if(null!=e&&null!==(r=e.payload)&&void 0!==r&&r.byteLength)return e;this.removeFragment(t)}return null},e.isTimeBuffered=function(t,e,r){for(var i,n,s=0;s<r.length;s++){if(i=r.start(s)-this.bufferPadding,n=r.end(s)+this.bufferPadding,i<=t&&e<=n)return!0;if(e<=i)return!1}return!1},e.onFragLoaded=function(t,e){var r=e.frag,i=e.part;"initSegment"===r.sn||r.bitrateTest||i||(i=u(r),this.fragments[i]={body:r,loaded:e,backtrack:null,buffered:!1,range:Object.create(null)})},e.onBufferAppended=function(t,e){var i=this,n=e.frag,s=e.part,a=e.timeRanges;n.type===o.PlaylistLevelType.MAIN&&(this.activeFragment=n,s?((e=this.activeParts)||(this.activeParts=e=[]),e.push(s)):this.activeParts=null),this.timeRanges=a,Object.keys(a).forEach(function(t){var e=a[t];if(i.detectEvictedFragments(t,e),!s)for(var r=0;r<e.length;r++)n.appendedPTS=Math.max(e.end(r),n.appendedPTS||0)})},e.onFragBuffered=function(t,e){this.detectPartialFragments(e)},e.hasFragment=function(t){t=u(t);return!!this.fragments[t]},e.removeFragmentsInRange=function(e,r,i){var n=this;Object.keys(this.fragments).forEach(function(t){t=n.fragments[t];t&&(!t.buffered||(t=t.body).type===i&&t.start<r&&t.end>e&&n.removeFragment(t))})},e.removeFragment=function(t){var e=u(t);t.stats.loaded=0,t.clearElementaryStreamInfo(),delete this.fragments[e]},e.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},t}();function l(t){var e;return t.buffered&&(null!==(e=t.range.video)&&void 0!==e&&e.partial||null!==(t=t.range.audio)&&void 0!==t&&t.partial)}function u(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn}},"./src/controller/gap-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"STALL_MINIMUM_DURATION_MS",function(){return f}),r.d(e,"MAX_START_GAP_JUMP",function(){return g}),r.d(e,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return v}),r.d(e,"SKIP_BUFFER_RANGE_START",function(){return p}),r.d(e,"default",function(){return i});var d=r("./src/utils/buffer-helper.ts"),u=r("./src/errors.ts"),c=r("./src/events.ts"),h=r("./src/utils/logger.ts"),f=250,g=2,v=.1,p=.05,i=function(){function t(t,e,r,i){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=r,this.hls=i}var e=t.prototype;return e.destroy=function(){this.hls=this.fragmentTracker=this.media=null},e.poll=function(t){var e=this.config,r=this.media,i=this.stalled,n=r.currentTime,s=r.seeking,a=this.seeking&&!s,o=!this.seeking&&s;if(this.seeking=s,n!==t)return this.moved=!0,void(null!==i&&(this.stallReported&&(l=self.performance.now()-i,h.logger.warn("playback not stuck anymore @"+n+", after "+Math.round(l)+"ms"),this.stallReported=!1),this.stalled=null,this.nudgeRetry=0));if((o||a)&&(this.stalled=null),!r.paused&&!r.ended&&0!==r.playbackRate&&d.BufferHelper.getBuffered(r).length){var t=d.BufferHelper.bufferInfo(r,n,0),l=0<t.len,o=t.nextStart||0;if(l||o){if(s){a=t.len>g,l=!o||g<o-n&&!this.fragmentTracker.getPartialFragment(n);if(a||l)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var u,o=Math.max(o,t.start||0)-n,c=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,c=(null==c||null===(u=c.details)||void 0===u?void 0:u.live)?2*c.details.targetduration:g;if(0<o&&o<=c)return void this._trySkipBufferHole(null)}c=self.performance.now();null!==i?(i=c-i,!s&&f<=i&&this._reportStall(t.len),e=d.BufferHelper.bufferInfo(r,n,e.maxBufferHole),this._tryFixBufferStall(e,i)):this.stalled=c}}},e._tryFixBufferStall=function(t,e){var r=this.config,i=this.fragmentTracker,n=this.media.currentTime,n=i.getPartialFragment(n);if(n&&this._trySkipBufferHole(n))return;t.len>r.maxBufferHole&&e>1e3*r.highBufferWatchdogPeriod&&(h.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},e._reportStall=function(t){var e=this.hls,r=this.media;this.stallReported||(this.stallReported=!0,h.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer (buffer="+t+")"),e.trigger(c.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},e._trySkipBufferHole=function(t){for(var e=this.config,r=this.hls,i=this.media,n=i.currentTime,s=0,a=d.BufferHelper.getBuffered(i),o=0;o<a.length;o++){var l=a.start(o);if(n+e.maxBufferHole>=s&&n<l){l=Math.max(l+p,i.currentTime+v);return h.logger.warn("skipping hole, adjusting currentTime from "+n+" to "+l),this.moved=!0,this.stalled=null,i.currentTime=l,t&&r.trigger(c.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+l,frag:t}),l}s=a.end(o)}return 0},e._tryNudgeBuffer=function(){var t=this.config,e=this.hls,r=this.media,i=r.currentTime,n=(this.nudgeRetry||0)+1;(this.nudgeRetry=n)<t.nudgeMaxRetry?(n=i+n*t.nudgeOffset,h.logger.warn("Nudging 'currentTime' from "+i+" to "+n),r.currentTime=n,e.trigger(c.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})):(h.logger.error("Playhead still not moving while enough data buffered @"+i+" after "+t.nudgeMaxRetry+" nudges"),e.trigger(c.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0}))},t}()},"./src/controller/id3-track-controller.ts":function(t,e,r){"use strict";r.r(e);var i=r("./src/events.ts"),n=r("./src/utils/texttrack-utils.ts"),h=r("./src/demux/id3.ts"),r=function(){function t(t){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=t,this._registerListeners()}var e=t.prototype;return e.destroy=function(){this._unregisterListeners()},e._registerListeners=function(){var t=this.hls;t.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(i.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},e._unregisterListeners=function(){var t=this.hls;t.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(i.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},e.onMediaAttached=function(t,e){this.media=e.media},e.onMediaDetaching=function(){this.id3Track&&(Object(n.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},e.getID3Track=function(t){if(this.media){for(var e=0;e<t.length;e++){var r=t[e];if("metadata"===r.kind&&"id3"===r.label)return Object(n.sendAddTrackEvent)(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},e.onFragParsingMetadata=function(t,e){if(this.media){var r=e.frag,i=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var n=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,s=0;s<i.length;s++){var a=h.getID3Frames(i[s].data);if(a){var o=i[s].pts,l=s<i.length-1?i[s+1].pts:r.end;l-o<=0&&(l=o+.25);for(var u=0;u<a.length;u++){var c,d=a[u];h.isTimeStampFrame(d)||((c=new n(o,l,"")).value=d,this.id3Track.addCue(c))}}}}},e.onBufferFlushing=function(t,e){var r=e.startOffset,i=e.endOffset,e=e.type;e&&"audio"!==e||(e=this.id3Track)&&Object(n.removeCuesInRange)(e,r,i)},t}();e.default=r},"./src/controller/latency-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var n=r("./src/errors.ts"),s=r("./src/events.ts"),a=r("./src/utils/logger.ts");function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var i=function(){function t(t){var e=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return e.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}var e,r,i=t.prototype;return i.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},i.registerListeners=function(){this.hls.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(s.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(s.Events.ERROR,this.onError,this)},i.unregisterListeners=function(){this.hls.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(s.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(s.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(s.Events.ERROR,this.onError)},i.onMediaAttached=function(t,e){this.media=e.media,this.media.cincopaAddEventListener("timeupdate",this.timeupdateHandler)},i.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},i.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},i.onLevelUpdated=function(t,e){e=e.details;(this.levelDetails=e).advanced&&this.timeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},i.onError=function(t,e){e.details===n.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,a.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},i.timeupdate=function(){var t,e,r,i=this.media,n=this.levelDetails;i&&n&&(this.currentTime=i.currentTime,null!==(r=this.computeLatency())&&(this._latency=r,t=(e=this.config).lowLatencyMode,e=e.maxLiveSyncPlaybackRate,!t||1===e||null!==(t=this.targetLatency)&&(t=(r=r-t)<Math.min(this.maxLatency,t+n.targetduration),n.live&&t&&.05<r&&1<this.forwardBufferLength?(e=Math.min(2,Math.max(1,e)),r=Math.round(2/(1+Math.exp(-.75*r-this.edgeStalled))*20)/20,i.playbackRate=Math.min(e,Math.max(1,r))):1!==i.playbackRate&&0!==i.playbackRate&&(i.playbackRate=1))))},i.estimateLiveEdge=function(){var t=this.levelDetails;return null===t?null:t.edge+t.age},i.computeLatency=function(){var t=this.estimateLiveEdge();return null===t?null:t-this.currentTime},e=t,(i=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var t=this.config,e=this.levelDetails;return void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var t=this.levelDetails;if(null===t)return null;var e=t.holdBack,r=t.partHoldBack,i=t.targetduration,n=this.config,s=n.liveSyncDuration,a=n.liveSyncDurationCount,t=n.lowLatencyMode,n=this.hls.userConfig,e=t&&r||e;(n.liveSyncDuration||n.liveSyncDurationCount||0===e)&&(e=void 0!==s?s:a*i);return e+Math.min(+this.stallCount,i)}},{key:"liveSyncPosition",get:function(){var t=this.estimateLiveEdge(),e=this.targetLatency,r=this.levelDetails;if(null===t||null===e||null===r)return null;var i=r.edge,t=t-e-this.edgeStalled,e=i-r.totalduration,r=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(e,t),r)}},{key:"drift",get:function(){var t=this.levelDetails;return null===t?1:t.drift}},{key:"edgeStalled",get:function(){var t=this.levelDetails;if(null===t)return 0;var e=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.max(t.age-e,0)}},{key:"forwardBufferLength",get:function(){var t=this.media,e=this.levelDetails;if(!t||!e)return 0;var r=t.buffered.length;return r?t.buffered.end(r-1):e.edge-this.currentTime}}])&&o(e.prototype,i),r&&o(e,r),t}()},"./src/controller/level-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var f=r("./src/types/level.ts"),g=r("./src/events.ts"),v=r("./src/errors.ts"),p=r("./src/utils/codecs.ts"),m=r("./src/controller/level-helper.ts"),e=r("./src/controller/base-playlist-controller.ts"),l=r("./src/types/loader.ts");function n(){return(n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,i=arguments[e];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}function s(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var y=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),i=function(o){function t(t){t=o.call(this,t,"[level-controller]")||this;return t._levels=[],t._firstLevel=-1,t._startLevel=void 0,t.currentLevelIndex=-1,t.manualLevelIndex=-1,t.onParsedComplete=void 0,t._registerListeners(),t}e=o,(i=t).prototype=Object.create(e.prototype),a(i.prototype.constructor=i,e);var e,r,i=t.prototype;return i._registerListeners=function(){var t=this.hls;t.on(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(g.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(g.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(g.Events.ERROR,this.onError,this)},i._unregisterListeners=function(){var t=this.hls;t.off(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(g.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(g.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(g.Events.ERROR,this.onError,this)},i.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,o.prototype.destroy.call(this)},i.startLoad=function(){this._levels.forEach(function(t){t.loadError=0}),o.prototype.startLoad.call(this)},i.onManifestLoaded=function(t,e){var r,i,n=[],s=[],a=[],o={},l=!1,u=!1,c=!1;if(e.levels.forEach(function(t){var e=t.attrs;l=l||!(!t.width||!t.height),u=u||!!t.videoCodec,c=c||!!t.audioCodec,y&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0);var r=t.bitrate+"-"+t.attrs.RESOLUTION+"-"+t.attrs.CODECS;(i=o[r])?i.url.push(t.url):(i=new f.Level(t),o[r]=i,n.push(i)),e&&(e.AUDIO&&Object(m.addGroupId)(i,"audio",e.AUDIO),e.SUBTITLES&&Object(m.addGroupId)(i,"text",e.SUBTITLES))}),(l||u)&&c&&(n=n.filter(function(t){var e=t.videoCodec,r=t.width,t=t.height;return!!e||!(!r||!t)})),n=n.filter(function(t){var e=t.audioCodec,t=t.videoCodec;return(!e||Object(p.isCodecSupportedInMp4)(e,"audio"))&&(!t||Object(p.isCodecSupportedInMp4)(t,"video"))}),e.audioTracks&&(s=e.audioTracks.filter(function(t){return!t.audioCodec||Object(p.isCodecSupportedInMp4)(t.audioCodec,"audio")}),Object(m.assignTrackIdsByGroup)(s)),e.subtitles&&(a=e.subtitles,Object(m.assignTrackIdsByGroup)(a)),0<n.length){r=n[0].bitrate,n.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=n;for(var d=0;d<n.length;d++)if(n[d].bitrate===r){this._firstLevel=d,this.log("manifest loaded, "+n.length+" level(s) found, first bitrate: "+r);break}var h=c&&!u,s={levels:n,audioTracks:s,subtitleTracks:a,firstLevel:this._firstLevel,stats:e.stats,audio:c,video:u,altAudio:!h&&s.some(function(t){return!!t.url})};this.hls.trigger(g.Events.MANIFEST_PARSED,s),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(g.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,reason:"no level with compatible codecs found in manifest"})},i.onError=function(t,e){if(o.prototype.onError.call(this,t,e),!e.fatal){var r=e.context,t=this._levels[this.currentLevelIndex];if(r&&(r.type===l.PlaylistContextType.AUDIO_TRACK&&t.audioGroupIds&&r.groupId===t.audioGroupIds[t.urlId]||r.type===l.PlaylistContextType.SUBTITLE_TRACK&&t.textGroupIds&&r.groupId===t.textGroupIds[t.urlId]))this.redundantFailover(this.currentLevelIndex);else{var i,n,s=!1,a=!0;switch(e.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:case v.ErrorDetails.KEY_LOAD_ERROR:case v.ErrorDetails.KEY_LOAD_TIMEOUT:e.frag&&((n=this._levels[e.frag.level])?(n.fragmentError++,n.fragmentError>this.hls.config.fragLoadingMaxRetry&&(i=e.frag.level)):i=e.frag.level);break;case v.ErrorDetails.LEVEL_LOAD_ERROR:case v.ErrorDetails.LEVEL_LOAD_TIMEOUT:r&&(r.deliveryDirectives&&(a=!1),i=r.level),s=!0;break;case v.ErrorDetails.REMUX_ALLOC_ERROR:i=e.level,s=!0}void 0!==i&&this.recoverLevel(e,i,s,a)}}},i.recoverLevel=function(t,e,r,i){var n=t.details,s=this._levels[e];if(s.loadError++,r){if(!this.retryLoadingOrFail(t))return void(this.currentLevelIndex=-1);t.levelRetry=!0}i&&(1<(i=s.url.length)&&s.loadError<i?(t.levelRetry=!0,this.redundantFailover(e)):-1===this.manualLevelIndex&&(e=0===e?this._levels.length-1:e-1,this.currentLevelIndex!==e&&0===this._levels[e].loadError&&(this.warn(n+": switch to "+e),t.levelRetry=!0,this.hls.nextAutoLevel=e)))},i.redundantFailover=function(t){var e,r=this._levels[t],i=r.url.length;1<i&&(e=(r.urlId+1)%i,this.warn("Switching to redundant URL-id "+e),this._levels.forEach(function(t){t.urlId=e}),this.level=t)},i.onFragLoaded=function(t,e){e=e.frag;void 0===e||e.type!==l.PlaylistLevelType.MAIN||void 0!==(e=this._levels[e.level])&&(e.fragmentError=0,e.loadError=0)},i.onLevelLoaded=function(t,e){var r,i=e.level,n=e.details,s=this._levels[i];if(!s)return this.warn("Invalid level index "+i),void(null!==(r=e.deliveryDirectives)&&void 0!==r&&r.skip&&(n.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===s.fragmentError&&(s.loadError=0,this.retryCount=0),this.playlistLoaded(i,e,s.details)):null!==(e=e.deliveryDirectives)&&void 0!==e&&e.skip&&(n.deltaUpdateFailed=!0)},i.onAudioTrackSwitched=function(t,e){var r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){for(var i=-1,n=this.hls.audioTracks[e.id].groupId,s=0;s<r.audioGroupIds.length;s++)if(r.audioGroupIds[s]===n){i=s;break}i!==r.urlId&&(r.urlId=i,this.startLoad())}},i.loadPlaylist=function(t){var e=this.currentLevelIndex,r=this._levels[e];if(this.canLoad&&r&&0<r.url.length){var i=r.urlId,n=r.url[i];if(t)try{n=t.addDirectives(n)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Attempt loading level index "+e+(t?" at sn "+t.msn+" part "+t.part:"")+" with URL-id "+i+" "+n),this.clearTimer(),this.hls.trigger(g.Events.LEVEL_LOADING,{url:n,level:e,id:i,deliveryDirectives:t||null})}},i.removeLevel=function(r,i){function n(t,e){return e!==i}var t=this._levels.filter(function(t,e){return e!==r||1<t.url.length&&void 0!==i&&(t.url=t.url.filter(n),t.audioGroupIds&&(t.audioGroupIds=t.audioGroupIds.filter(n)),t.textGroupIds&&(t.textGroupIds=t.textGroupIds.filter(n)),!(t.urlId=0))}).map(function(t,e){var r=t.details;return null!=r&&r.fragments&&r.fragments.forEach(function(t){t.level=e}),t});this._levels=t,this.hls.trigger(g.Events.LEVELS_UPDATED,{levels:t})},e=t,(i=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;if(0!==e.length&&(this.currentLevelIndex!==t||null===(i=e[t])||void 0===i||!i.details)){if(t<0||t>=e.length){var r=t<0;if(this.hls.trigger(g.Events.ERROR,{type:v.ErrorTypes.OTHER_ERROR,details:v.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:r,reason:"invalid level idx"}),r)return;t=Math.min(t,e.length-1)}this.clearTimer();var i=this.currentLevelIndex,r=e[i],e=e[t];this.log("switching to level "+t+" from "+i);t=n({},e,{level:this.currentLevelIndex=t,maxBitrate:e.maxBitrate,uri:e.uri,urlId:e.urlId});delete t._urlId,this.hls.trigger(g.Events.LEVEL_SWITCHING,t);t=e.details;t&&!t.live||(r=this.switchParams(e.uri,null==r?void 0:r.details),this.loadPlaylist(r))}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0!==this._startLevel)return this._startLevel;var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}])&&s(e.prototype,i),r&&s(e,r),t}(e.default)},"./src/controller/level-helper.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"addGroupId",function(){return i}),r.d(e,"assignTrackIdsByGroup",function(){return n}),r.d(e,"updatePTS",function(){return s}),r.d(e,"updateFragPTSDTS",function(){return p}),r.d(e,"mergeDetails",function(){return a}),r.d(e,"mapPartIntersection",function(){return m}),r.d(e,"mapFragmentIntersection",function(){return y}),r.d(e,"adjustSliding",function(){return E}),r.d(e,"addSliding",function(){return o}),r.d(e,"computeReloadInterval",function(){return l}),r.d(e,"getFragmentWithSN",function(){return u}),r.d(e,"getPartWith",function(){return c});var f=r("./src/polyfills/number.ts"),g=r("./src/utils/logger.ts");function i(t,e,r){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(r);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(r)}}function n(t){var r={};t.forEach(function(t){var e=t.groupId||"";t.id=r[e]=r[e]||0,r[e]++})}function s(t,e,r){v(t[e],t[r])}function v(t,e){var r,i=e.startPTS;Object(f.isFiniteNumber)(i)?(r=0,(i=e.sn>t.sn?(r=i-t.start,t):(r=t.start-i,e)).duration!==r&&(i.duration=r)):e.sn>t.sn?t.cc===e.cc&&t.minEndPTS?e.start=t.start+(t.minEndPTS-t.start):e.start=t.start+t.duration:e.start=Math.max(t.start-e.duration,0)}function p(t,e,r,i,n,s){i-r<=0&&(g.logger.warn("Fragment should have a positive duration",e),i=r+e.duration,s=n+e.duration);var a,o=r,l=i,u=e.startPTS,c=e.endPTS;Object(f.isFiniteNumber)(u)&&(a=Math.abs(u-r),Object(f.isFiniteNumber)(e.deltaPTS)?e.deltaPTS=Math.max(a,e.deltaPTS):e.deltaPTS=a,o=Math.max(r,u),r=Math.min(r,u),n=Math.min(n,e.startDTS),l=Math.min(i,c),i=Math.max(i,c),s=Math.max(s,e.endDTS)),e.duration=i-r;c=r-e.start;e.appendedPTS=i,e.start=e.startPTS=r,e.maxStartPTS=o,e.startDTS=n,e.endPTS=i,e.minEndPTS=l,e.endDTS=s;var d,s=e.sn;if(!t||s<t.startSN||s>t.endSN)return 0;var s=s-t.startSN,h=t.fragments;for(h[s]=e,d=s;0<d;d--)v(h[d],h[d-1]);for(d=s;d<h.length-1;d++)v(h[d],h[d+1]);return t.fragmentHint&&v(h[h.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,c}function a(t,r){for(var i=null,e=t.fragments,n=e.length-1;0<=n;n--){var s=e[n].initSegment;if(s){i=s;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var a,o=0;if(y(t,r,function(t,e){t.relurl&&(o=t.cc-e.cc),Object(f.isFiniteNumber)(t.startPTS)&&Object(f.isFiniteNumber)(t.endPTS)&&(e.start=e.startPTS=t.startPTS,e.startDTS=t.startDTS,e.appendedPTS=t.appendedPTS,e.maxStartPTS=t.maxStartPTS,e.endPTS=t.endPTS,e.endDTS=t.endDTS,e.minEndPTS=t.minEndPTS,e.duration=t.endPTS-t.startPTS,e.duration&&(a=e),r.PTSKnown=r.alignedSliding=!0),e.elementaryStreams=t.elementaryStreams,e.loader=t.loader,e.stats=t.stats,e.urlId=t.urlId,t.initSegment?(e.initSegment=t.initSegment,i=t.initSegment):e.initSegment&&e.initSegment.relurl!=(null===i||void 0===i?void 0:i.relurl)||(e.initSegment=i)}),r.skippedSegments&&(r.deltaUpdateFailed=r.fragments.some(function(t){return!t}),r.deltaUpdateFailed)){g.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var l=r.skippedSegments;l--;)r.fragments.shift();r.startSN=r.fragments[0].sn,r.startCC=r.fragments[0].cc}var u=r.fragments;if(o){g.logger.warn("discontinuity sliding from playlist, take drift into account");for(var c=0;c<u.length;c++)u[c].cc+=o}r.skippedSegments&&(r.startCC=r.fragments[0].cc),m(t.partList,r.partList,function(t,e){e.elementaryStreams=t.elementaryStreams,e.stats=t.stats}),a?p(r,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS):E(t,r),u.length&&(r.totalduration=r.edge-u[0].start),r.driftStartTime=t.driftStartTime,r.driftStart=t.driftStart;var d,h=r.advancedDateTime;r.advanced&&h?(d=r.edge,r.driftStart||(r.driftStartTime=h,r.driftStart=d),r.driftEndTime=h,r.driftEnd=d):(r.driftEndTime=t.driftEndTime,r.driftEnd=t.driftEnd,r.advancedDateTime=t.advancedDateTime)}function m(t,e,r){if(t&&e)for(var i=0,n=0,s=t.length;n<=s;n++){var a=t[n],o=e[n+i];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?r(a,o):i--}}function y(t,e,r){for(var i=e.skippedSegments,n=Math.max(t.startSN,e.startSN)-e.startSN,s=(t.fragmentHint?1:0)+(i?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,a=e.startSN-t.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,u=n;u<=s;u++){var c=l[a+u],d=o[u];i&&!d&&u<i&&(d=e.fragments[u]=c),c&&d&&r(c,d)}}function E(t,e){var r=e.startSN+e.skippedSegments-t.startSN,t=t.fragments;r<0||r>=t.length||o(e,t[r].start)}function o(t,e){if(e){for(var r=t.fragments,i=t.skippedSegments;i<r.length;i++)r[i].start+=e;t.fragmentHint&&(t.fragmentHint.start+=e)}}function l(t,e){var r,i=1e3*t.levelTargetDuration,n=i/2,s=t.age,a=0<s&&s<3*i,o=e.loading.end-e.loading.start,e=t.availabilityDelay;return!1===t.updated?a?(r=333*t.misses,r=Math.max(Math.min(n,2*o),r),t.availabilityDelay=(t.availabilityDelay||0)+r):r=n:r=a?(e=Math.min(e||i/2,s),(t.availabilityDelay=e)+i-s):i-o,Math.round(r)}function u(t,e,r){if(!t||!t.details)return null;var i=t.details,t=i.fragments[e-i.startSN];return t||((t=i.fragmentHint)&&t.sn===e?t:e<i.startSN&&r&&r.sn===e?r:null)}function c(t,e,r){if(!t||!t.details)return null;var i=t.details.partList;if(i)for(var n=i.length;n--;){var s=i[n];if(s.index===r&&s.fragment.sn===e)return s}return null}},"./src/controller/stream-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var m=r("./src/polyfills/number.ts"),y=r("./src/controller/base-stream-controller.ts"),a=r("./src/is-supported.ts"),E=r("./src/events.ts"),n=r("./src/utils/buffer-helper.ts"),l=r("./src/controller/fragment-tracker.ts"),d=r("./src/types/loader.ts"),T=r("./src/loader/fragment.ts"),h=r("./src/demux/transmuxer-interface.ts"),f=r("./src/types/transmuxer.ts"),o=r("./src/controller/gap-controller.ts"),u=r("./src/errors.ts"),c=r("./src/utils/logger.ts");function g(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var i=function(s){function t(t,e){e=s.call(this,t,e,"[stream-controller]")||this;return e.audioCodecSwap=!1,e.gapController=null,e.level=-1,e._forceStartLoad=!1,e.altAudio=!1,e.audioOnly=!1,e.fragPlaying=null,e.onvplaying=null,e.onvseeked=null,e.fragLastKbps=0,e.stalled=!1,e.couldBacktrack=!1,e.audioCodecSwitch=!1,e.videoBuffer=null,e._registerListeners(),e}e=s,(i=t).prototype=Object.create(e.prototype),v(i.prototype.constructor=i,e);var e,r,i=t.prototype;return i._registerListeners=function(){var t=this.hls;t.on(E.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(E.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(E.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(E.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(E.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(E.Events.ERROR,this.onError,this),t.on(E.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(E.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(E.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(E.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(E.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(E.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var t=this.hls;t.off(E.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(E.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(E.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(E.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(E.Events.ERROR,this.onError,this),t.off(E.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(E.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(E.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(E.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(E.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(E.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},i.startLoad=function(t){var e,r,i;this.levels?(e=this.lastCurrentTime,r=this.hls,this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,this.startFragRequested||(-1===(i=r.startLevel)&&(r.config.testBandwidth?(i=0,this.bitrateTest=!0):i=r.nextAutoLevel),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1),0<e&&-1===t&&(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=y.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()):(this._forceStartLoad=!0,this.state=y.State.STOPPED)},i.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case y.State.IDLE:this.doTickIdle();break;case y.State.WAITING_LEVEL:var t=this.levels,e=this.level,e=null==t||null===(r=t[e])||void 0===r?void 0:r.details;if(!e||e.live&&this.levelLastLoaded!==this.level)break;if(this.waitForCdnTuneIn(e))break;this.state=y.State.IDLE;break;case y.State.FRAG_LOADING_WAITING_RETRY:var r=self.performance.now(),e=this.retryDate;(!e||e<=r||null!==(r=this.media)&&void 0!==r&&r.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=y.State.IDLE)}this.onTickEnd()},i.onTickEnd=function(){s.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},i.doTickIdle=function(){var t=this.hls,e=this.levelLastLoaded,r=this.levels,i=this.media,n=t.config,s=t.nextLoadLevel;if(null!==e&&(i||!this.startFragRequested&&n.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&r&&r[s]){n=r[s];this.level=t.nextLoadLevel=s;r=n.details;if(!r||this.state===y.State.WAITING_LEVEL||r.live&&this.levelLastLoaded!==s)this.state=y.State.WAITING_LEVEL;else{t=this.getFwdBufferInfo(this.mediaBuffer||i,d.PlaylistLevelType.MAIN);if(null!==t){s=t.len;if(!(this.getMaxBufferLength(n.maxBitrate)<=s)){if(this._streamEnded(t,r)){var a={};return this.altAudio&&(a.type="video"),this.hls.trigger(E.Events.BUFFER_EOS,a),void(this.state=y.State.ENDED)}var o,s=t.end,a=this.getNextFragment(s,r);!this.couldBacktrack||this.fragPrevious||!a||"initSegment"===a.sn||1<(t=a.sn-r.startSN)&&(a=r.fragments[t-1],this.fragmentTracker.removeFragment(a)),a&&this.fragmentTracker.getState(a)===l.FragmentState.OK&&this.nextLoadPosition>s&&(o=this.audioOnly&&!this.altAudio?T.ElementaryStreamTypes.AUDIO:T.ElementaryStreamTypes.VIDEO,this.afterBufferFlushed(i,o,d.PlaylistLevelType.MAIN),a=this.getNextFragment(this.nextLoadPosition,r)),a&&(!a.initSegment||a.initSegment.data||this.bitrateTest||(a=a.initSegment),"identity"!==(null===(o=a.decryptdata)||void 0===o?void 0:o.keyFormat)||null!==(o=a.decryptdata)&&void 0!==o&&o.key?this.loadFragment(a,r,s):this.loadKey(a,r))}}}}},i.loadFragment=function(t,e,r){var i=this.fragmentTracker.getState(t);if(this.fragCurrent=t,i===l.FragmentState.BACKTRACKED){var n=this.fragmentTracker.getBacktrackData(t);if(n)return this._handleFragmentLoadProgress(n),void this._handleFragmentLoadComplete(n);i=l.FragmentState.NOT_LOADED}i===l.FragmentState.NOT_LOADED||i===l.FragmentState.PARTIAL?"initSegment"===t.sn?this._loadInitSegment(t):this.bitrateTest?(t.bitrateTest=!0,this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t)):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,t,e,r)):i===l.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):0===(null===(t=this.media)||void 0===t?void 0:t.buffered.length)&&this.fragmentTracker.removeAllFragments()},i.getAppendedFrag=function(t){t=this.fragmentTracker.getAppendedFrag(t,d.PlaylistLevelType.MAIN);return t&&"fragment"in t?t.fragment:t},i.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,d.PlaylistLevelType.MAIN)},i.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},i.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.nextLevelSwitch=function(){var t,e,r,i=this.levels,n=this.media;null!=n&&n.readyState&&((t=this.getAppendedFrag(n.currentTime))&&1<t.start&&this.flushMainBuffer(0,t.start-1),r=!n.paused&&i?(r=i[this.hls.nextLoadLevel],(e=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*r.maxBitrate/(1e3*e)+1:0):0,!(e=this.getBufferedFrag(n.currentTime+r))||(n=this.followingBufferedFrag(e))&&(this.abortCurrentFrag(),r=n.maxStartPTS||n.start,n=n.duration,n=Math.max(e.end,r+Math.min(Math.max(n-this.config.maxFragLookUpTolerance,.5*n),.75*n)),this.flushMainBuffer(n,Number.POSITIVE_INFINITY)))},i.abortCurrentFrag=function(){var t=this.fragCurrent;(this.fragCurrent=null)!=t&&t.loader&&t.loader.abort(),this.state===y.State.KEY_LOADING&&(this.state=y.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},i.flushMainBuffer=function(t,e){s.prototype.flushMainBuffer.call(this,t,e,this.altAudio?"video":null)},i.onMediaAttached=function(t,e){s.prototype.onMediaAttached.call(this,t,e);e=e.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),e.cincopaAddEventListener("playing",this.onvplaying),e.cincopaAddEventListener("seeked",this.onvseeked),this.gapController=new o.default(this.config,e,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var t=this.media;t&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s.prototype.onMediaDetaching.call(this)},i.onMediaPlaying=function(){this.tick()},i.onMediaSeeked=function(){var t=this.media,t=t?t.currentTime:null;Object(m.isFiniteNumber)(t)&&this.log("Media seeked to "+t.toFixed(3)),this.tick()},i.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(E.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},i.onManifestParsed=function(t,e){var r,i=!1,n=!1;e.levels.forEach(function(t){(r=t.audioCodec)&&(-1!==r.indexOf("mp4a.40.2")&&(i=!0),-1!==r.indexOf("mp4a.40.5")&&(n=!0))}),this.audioCodecSwitch=i&&n&&!Object(a.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1},i.onLevelLoading=function(t,e){var r=this.levels;!r||this.state!==y.State.IDLE||(!(r=r[e.level]).details||r.details.live&&this.levelLastLoaded!==e.level||this.waitForCdnTuneIn(r.details))&&(this.state=y.State.WAITING_LEVEL)},i.onLevelLoaded=function(t,e){var r=this.levels,i=e.level,n=e.details,s=n.totalduration;if(r){this.log("Level "+i+" loaded ["+n.startSN+","+n.endSN+"], cc ["+n.startCC+", "+n.endCC+"] duration:"+s);s=this.fragCurrent;!s||this.state!==y.State.FRAG_LOADING&&this.state!==y.State.FRAG_LOADING_WAITING_RETRY||s.level!==e.level&&s.loader&&(this.state=y.State.IDLE,s.loader.abort());e=r[i],s=0;if(n.live||null!==(r=e.details)&&void 0!==r&&r.live){if(n.fragments[0]||(n.deltaUpdateFailed=!0),n.deltaUpdateFailed)return;s=this.alignPlaylists(n,e.details)}if(e.details=n,this.levelLastLoaded=i,this.hls.trigger(E.Events.LEVEL_UPDATED,{details:n,level:i}),this.state===y.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(n))return;this.state=y.State.IDLE}this.startFragRequested?n.live&&this.synchronizeToLiveEdge(n):this.setStartPosition(n,s),this.tick()}else this.warn("Levels were reset while loading level "+i)},i._handleFragmentLoadProgress=function(t){var e,r,i,n,s,a,o=t.frag,l=t.part,u=t.payload,c=this.levels;c?(e=(a=c[o.level]).details)?(r=a.videoCodec,i=e.PTSKnown||!e.live,n=null===(s=o.initSegment)||void 0===s?void 0:s.data,t=this._getAudioCodec(a),c=this.transmuxer=this.transmuxer||new h.default(this.hls,d.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),a=-1!==(s=l?l.index:-1),s=new f.ChunkMetadata(o.level,o.sn,o.stats.chunkCount,u.byteLength,s,a),a=this.initPTS[o.cc],c.push(u,n,t,r,o,l,e.totalduration,i,s,a)):this.warn("Dropping fragment "+o.sn+" of level "+o.level+" after level details were reset"):this.warn("Levels were reset while fragment load was in progress. Fragment "+o.sn+" of level "+o.level+" will not be buffered")},i.onAudioTrackSwitching=function(t,e){var r,i=this.altAudio,n=!!e.url,e=e.id;n||(this.mediaBuffer!==this.media?(this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,null!=(r=this.fragCurrent)&&r.loader&&(this.log("Switching to main audio track, cancel main fragment load"),r.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()):this.audioOnly&&this.resetTransmuxer(),r=this.hls,i&&r.trigger(E.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),r.trigger(E.Events.AUDIO_TRACK_SWITCHED,{id:e}))},i.onAudioTrackSwitched=function(t,e){var r=e.id,e=!!this.hls.audioTracks[r].url;!e||(r=this.videoBuffer)&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r),this.altAudio=e,this.tick()},i.onBufferCreated=function(t,e){var r,i=e.tracks,n=!1;for(r in i){var s,a,o=i[r];"main"===o.id?(a=o,"video"!==(s=r)||(o=i[r])&&(this.videoBuffer=o.buffer)):n=!0}n&&a?(this.log("Alternate track found, use "+s+".buffered to schedule main fragment loading"),this.mediaBuffer=a.buffer):this.mediaBuffer=this.media},i.onFragBuffered=function(t,e){var r=e.frag,i=e.part;if(!r||r.type===d.PlaylistLevelType.MAIN){if(this.fragContextChanged(r))return this.warn("Fragment "+r.sn+(i?" p: "+i.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===y.State.PARSED&&(this.state=y.State.IDLE));e=(i||r).stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}},i.onError=function(t,e){switch(e.details){case u.ErrorDetails.FRAG_LOAD_ERROR:case u.ErrorDetails.FRAG_LOAD_TIMEOUT:case u.ErrorDetails.KEY_LOAD_ERROR:case u.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(d.PlaylistLevelType.MAIN,e);break;case u.ErrorDetails.LEVEL_LOAD_ERROR:case u.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==y.State.ERROR&&(e.fatal?(this.warn(""+e.details),this.state=y.State.ERROR):e.levelRetry||this.state!==y.State.WAITING_LEVEL||(this.state=y.State.IDLE));break;case u.ErrorDetails.BUFFER_FULL_ERROR:var r,i;"main"!==e.parent||this.state!==y.State.PARSING&&this.state!==y.State.PARSED||(r=!0,(i=this.getFwdBufferInfo(this.media,d.PlaylistLevelType.MAIN))&&.5<i.len&&(r=!this.reduceMaxBufferLength(i.len)),r&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState())}},i.checkBuffer=function(){var t,e=this.media,r=this.gapController;e&&r&&e.readyState&&(t=n.BufferHelper.getBuffered(e),!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this.seekToStartPos()):r.poll(this.lastCurrentTime),this.lastCurrentTime=e.currentTime)},i.onFragLoadEmergencyAborted=function(){this.state=y.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},i.onBufferFlushed=function(t,e){var r=e.type;(r!==T.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio)&&(e=(r===T.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,this.afterBufferFlushed(e,r,d.PlaylistLevelType.MAIN))},i.onLevelsUpdated=function(t,e){this.levels=e.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i.seekToStartPos=function(){var t,e=this.media,r=e.currentTime,i=this.startPosition;0<=i&&r<i&&(e.seeking?c.logger.log("could not seek to "+i+", already seeking at "+r):(0<(t=((t=n.BufferHelper.getBuffered(e)).length?t.start(0):0)-i)&&(t<this.config.maxBufferHole||t<this.config.maxFragLookUpTolerance)&&(c.logger.log("adjusting start position by "+t+" to match buffer start"),i+=t,this.startPosition=i),this.log("seek to target start position "+i+" from current time "+r),e.currentTime=i))},i._getAudioCodec=function(t){t=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t},i._loadBitrateTestFrag=function(i){var n=this;this._doFragLoad(i).then(function(t){var e,r=n.hls;!t||r.nextLoadLevel||n.fragContextChanged(i)||(n.fragLoadError=0,n.state=y.State.IDLE,n.startFragRequested=!1,n.bitrateTest=!1,(e=i.stats).parsing.start=e.parsing.end=e.buffering.start=e.buffering.end=self.performance.now(),r.trigger(E.Events.FRAG_LOADED,t))})},i._handleTransmuxComplete=function(t){var e,r="main",i=this.hls,n=t.remuxResult,s=t.chunkMeta,a=this.getCurrentContext(s);if(!a)return this.warn("The loading context changed while buffering fragment "+s.sn+" of level "+s.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(s.level);var o=a.frag,l=a.part,u=a.level,c=n.video,d=n.text,h=n.id3,f=n.initSegment,t=this.altAudio?void 0:n.audio;if(!this.fragContextChanged(o)){if(this.state=y.State.PARSING,f&&(f.tracks&&(this._bufferInitSegment(u,f.tracks,o,s),i.trigger(E.Events.FRAG_PARSING_INIT_SEGMENT,{frag:o,id:r,tracks:f.tracks})),a=f.initPTS,g=f.timescale,Object(m.isFiniteNumber)(a)&&(this.initPTS[o.cc]=a,i.trigger(E.Events.INIT_PTS_FOUND,{frag:o,id:r,initPTS:a,timescale:g}))),c&&!1!==n.independent){if(u.details){var g=c.startPTS,u=c.endPTS,v=c.startDTS,p=c.endDTS;if(l)l.elementaryStreams[c.type]={startPTS:g,endPTS:u,startDTS:v,endDTS:p};else if(c.firstKeyFrame&&c.independent&&(this.couldBacktrack=!0),c.dropped&&c.independent){if(this.getLoadPosition()+this.config.maxBufferHole<g)return void this.backtrack(o);o.setElementaryStreamInfo(c.type,o.start,u,o.start,p,!0)}o.setElementaryStreamInfo(c.type,g,u,v,p),this.bufferFragmentData(c,o,l,s)}}else if(!1===n.independent)return void this.backtrack(o);t&&(v=t.startPTS,p=t.endPTS,c=t.startDTS,n=t.endDTS,l&&(l.elementaryStreams[T.ElementaryStreamTypes.AUDIO]={startPTS:v,endPTS:p,startDTS:c,endDTS:n}),o.setElementaryStreamInfo(T.ElementaryStreamTypes.AUDIO,v,p,c,n),this.bufferFragmentData(t,o,l,s)),null!=h&&null!==(e=h.samples)&&void 0!==e&&e.length&&(h={frag:o,id:r,samples:h.samples},i.trigger(E.Events.FRAG_PARSING_METADATA,h)),d&&(d={frag:o,id:r,samples:d.samples},i.trigger(E.Events.FRAG_PARSING_USERDATA,d))}},i._bufferInitSegment=function(t,r,i,n){var e,s,a,o,l,u=this;this.state===y.State.PARSING&&(this.audioOnly=!!r.audio&&!r.video,this.altAudio&&!this.audioOnly&&delete r.audio,e=r.audio,s=r.video,a=r.audiovideo,e&&(o=t.audioCodec,l=navigator.userAgent.toLowerCase(),this.audioCodecSwitch&&(o=o&&(-1!==o.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==e.metadata.channelCount&&-1===l.indexOf("firefox")&&(o="mp4a.40.5")),-1!==l.indexOf("android")&&"audio/mpeg"!==e.container&&(o="mp4a.40.2",this.log("Android: force audio codec to "+o)),t.audioCodec&&t.audioCodec!==o&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+o+'"'),e.levelCodec=o,e.id="main",this.log("Init audio buffer, container:"+e.container+", codecs[selected/level/parsed]=["+(o||"")+"/"+(t.audioCodec||"")+"/"+e.codec+"]")),s&&(s.levelCodec=t.videoCodec,s.id="main",this.log("Init video buffer, container:"+s.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+s.codec+"]")),a&&this.log("Init audiovideo buffer, container:"+a.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+a.codec+"]"),this.hls.trigger(E.Events.BUFFER_CODECS,r),Object.keys(r).forEach(function(t){var e=r[t].initSegment;null!=e&&e.byteLength&&u.hls.trigger(E.Events.BUFFER_APPENDING,{type:t,data:e,frag:i,part:null,chunkMeta:n,parent:i.type})}),this.tick())},i.backtrack=function(t){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(t);var e=this.fragmentTracker.backtrack(t);this.fragPrevious=null,this.nextLoadPosition=t.start,e?this.resetFragmentLoading(t):this.state=y.State.BACKTRACKING},i.checkFragmentChanged=function(){var t,e=this.media,r=null;e&&1<e.readyState&&!1===e.seeking&&(t=e.currentTime,n.BufferHelper.isBuffered(e,t)?r=this.getAppendedFrag(t):n.BufferHelper.isBuffered(e,t+.1)&&(r=this.getAppendedFrag(t+.1)),r&&(e=this.fragPlaying,t=r.level,e&&r.sn===e.sn&&e.level===t&&r.urlId===e.urlId||(this.hls.trigger(E.Events.FRAG_CHANGED,{frag:r}),e&&e.level===t||this.hls.trigger(E.Events.LEVEL_SWITCHED,{level:t}),this.fragPlaying=r)))},e=t,(i=[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentLevel",get:function(){var t=this.media;if(t){t=this.getAppendedFrag(t.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;if(t){t=this.getAppendedFrag(t.currentTime);return this.followingBufferedFrag(t)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&g(e.prototype,i),r&&g(e,r),t}(y.default)},"./src/controller/subtitle-stream-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"SubtitleStreamController",function(){return i});var l=r("./src/events.ts"),u=r("./src/utils/logger.ts"),c=r("./src/utils/buffer-helper.ts"),d=r("./src/controller/fragment-finders.ts"),o=r("./src/utils/discontinuities.ts"),h=r("./src/controller/level-helper.ts"),f=r("./src/controller/fragment-tracker.ts"),g=r("./src/controller/base-stream-controller.ts"),v=r("./src/types/loader.ts"),s=r("./src/types/level.ts");function a(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var i=function(i){function t(t,e){e=i.call(this,t,e,"[subtitle-stream-controller]")||this;return e.levels=[],e.currentTrackId=-1,e.tracksBuffered=[],e.mainDetails=null,e._registerListeners(),e}e=i,(n=t).prototype=Object.create(e.prototype),p(n.prototype.constructor=n,e);var e,r,n=t.prototype;return n.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},n._registerListeners=function(){var t=this.hls;t.on(l.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(l.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(l.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(l.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(l.Events.ERROR,this.onError,this),t.on(l.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(l.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(l.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(l.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(l.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},n._unregisterListeners=function(){var t=this.hls;t.off(l.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(l.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(l.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(l.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(l.Events.ERROR,this.onError,this),t.off(l.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(l.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(l.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(l.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(l.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},n.startLoad=function(){this.stopLoad(),this.state=g.State.IDLE,this.setInterval(500),this.tick()},n.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},n.onLevelLoaded=function(t,e){this.mainDetails=e.details},n.onSubtitleFragProcessed=function(t,e){var r=e.frag,e=e.success;if(this.fragPrevious=r,this.state=g.State.IDLE,e){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var n,s=r.start,a=0;a<i.length;a++)if(s>=i[a].start&&s<=i[a].end){n=i[a];break}e=r.start+r.duration;n?n.end=e:(n={start:s,end:e},i.push(n)),this.fragmentTracker.fragBuffered(r)}}},n.onBufferFlushing=function(t,e){var r,i,n,s=e.startOffset,a=e.endOffset;0===s&&a!==Number.POSITIVE_INFINITY&&(r=this.currentTrackId,(i=this.levels).length&&i[r]&&i[r].details&&((n=a-i[r].details.targetduration)<=0||(e.endOffsetSubtitles=Math.max(0,n),this.tracksBuffered.forEach(function(t){for(var e=0;e<t.length;)if(t[e].end<=n)t.shift();else{if(!(t[e].start<n))break;t[e].start=n,e++}}),this.fragmentTracker.removeFragmentsInRange(s,n,v.PlaylistLevelType.SUBTITLE))))},n.onError=function(t,e){var e=e.frag;e&&e.type===v.PlaylistLevelType.SUBTITLE&&(null!==(e=this.fragCurrent)&&void 0!==e&&e.loader&&this.fragCurrent.loader.abort(),this.state=g.State.IDLE)},n.onSubtitleTracksUpdated=function(t,e){var r=this,e=e.subtitleTracks;this.tracksBuffered=[],this.levels=e.map(function(t){return new s.Level(t)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(t){r.tracksBuffered[t.id]=[]}),this.mediaBuffer=null},n.onSubtitleTrackSwitch=function(t,e){this.currentTrackId=e.id,this.levels.length&&-1!==this.currentTrackId?null!=(e=this.levels[this.currentTrackId])&&e.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null:this.clearInterval()},n.onSubtitleTrackLoaded=function(t,e){var r=e.details,i=e.id,n=this.currentTrackId,s=this.levels;if(s.length){e=s[n];if(!(i>=s.length||i!==n)&&e){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||null!==(a=e.details)&&void 0!==a&&a.live){n=this.mainDetails;if(r.deltaUpdateFailed||!n)return;var a=n.fragments[0];e.details?0===this.alignPlaylists(r,e.details)&&a&&Object(h.addSliding)(r,a.start):r.hasProgramDateTime&&n.hasProgramDateTime?Object(o.alignMediaPlaylistByPDT)(r,n):a&&Object(h.addSliding)(r,a.start)}e.details=r,this.levelLastLoaded=i,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===g.State.IDLE&&(Object(d.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),e.details=void 0))}}},n._handleFragmentLoadComplete=function(t){var r,i=t.frag,e=t.payload,t=i.decryptdata,n=this.hls;this.fragContextChanged(i)||e&&0<e.byteLength&&t&&t.key&&t.iv&&"AES-128"===t.method&&(r=performance.now(),this.decrypter.webCryptoDecrypt(new Uint8Array(e),t.key.buffer,t.iv.buffer).then(function(t){var e=performance.now();n.trigger(l.Events.FRAG_DECRYPTED,{frag:i,payload:t,stats:{tstart:r,tdecrypt:e}})}))},n.doTick=function(){var t,e,r,i,n,s,a,o;this.media?this.state===g.State.IDLE&&(a=this.currentTrackId,(e=this.levels).length&&e[a]&&e[a].details&&(n=(t=e[a].details).targetduration,o=this.config,r=this.media,e=(i=c.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,r.currentTime-n,o.maxBufferHole)).end,a=i.len,this.getMaxBufferLength()+n<a||(console.assert(t,"Subtitle track details are defined on idle subtitle stream controller tick"),i=(r=t.fragments).length,n=t.edge,a=this.fragPrevious,e<n?(o=o.maxFragLookUpTolerance,a&&t.hasProgramDateTime&&(s=Object(d.findFragmentByPDT)(r,a.endProgramDateTime,o)),s||!(s=Object(d.findFragmentByPTS)(a,r,e,o))&&a&&a.start<r[0].start&&(s=r[0])):s=r[i-1],null!==s&&void 0!==s&&s.encrypted?(u.logger.log("Loading key for "+s.sn),this.state=g.State.KEY_LOADING,this.hls.trigger(l.Events.KEY_LOADING,{frag:s})):s&&this.fragmentTracker.getState(s)===f.FragmentState.NOT_LOADED&&this.loadFragment(s,t,e)))):this.state=g.State.IDLE},n.loadFragment=function(t,e,r){this.fragCurrent=t,i.prototype.loadFragment.call(this,t,e,r)},e=t,(n=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&a(e.prototype,n),r&&a(e,r),t}(g.default)},"./src/controller/subtitle-track-controller.ts":function(t,e,r){"use strict";r.r(e);var l=r("./src/events.ts"),s=r("./src/utils/texttrack-utils.ts"),i=r("./src/controller/base-playlist-controller.ts"),a=r("./src/types/loader.ts");function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}i=function(r){function t(t){var e=r.call(this,t,"[subtitle-track-controller]")||this;return e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e.subtitleDisplay=!0,e.registerListeners(),e}e=r,(n=t).prototype=Object.create(e.prototype),u(n.prototype.constructor=n,e);var e,i,n=t.prototype;return n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,r.prototype.destroy.call(this)},n.registerListeners=function(){var t=this.hls;t.on(l.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(l.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(l.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(l.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(l.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(l.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(l.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(l.Events.ERROR,this.onError,this)},n.unregisterListeners=function(){var t=this.hls;t.off(l.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(l.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(l.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(l.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(l.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(l.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(l.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(l.Events.ERROR,this.onError,this)},n.onMediaAttached=function(t,e){this.media=e.media,this.media&&(-1<this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.cincopaAddEventListener("change",this.asyncPollTrackChange))},n.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},n.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),-1<this.trackId&&(this.queuedDefaultTrack=this.trackId),c(this.media.textTracks).forEach(function(t){Object(s.clearCurrentCues)(t)}),this.subtitleTrack=-1,this.media=null)},n.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},n.onManifestParsed=function(t,e){this.tracks=e.subtitleTracks},n.onSubtitleTrackLoaded=function(t,e){var r=e.id,i=e.details,n=this.trackId,s=this.tracksInGroup[n];s?(n=s.details,s.details=e.details,this.log("subtitle track "+r+" loaded ["+i.startSN+"-"+i.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,e,n))):this.warn("Invalid subtitle track id "+r)},n.onLevelLoading=function(t,e){this.switchLevel(e.level)},n.onLevelSwitching=function(t,e){this.switchLevel(e.level)},n.switchLevel=function(t){var e,r,i,n=this.hls.levels[t];null!=n&&n.textGroupIds&&(e=n.textGroupIds[n.urlId],this.groupId!==e&&(r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,i=this.tracks.filter(function(t){return!e||t.groupId===e}),this.tracksInGroup=i,t=this.findTrackId(null==r?void 0:r.name)||this.findTrackId(),this.groupId=e,n={subtitleTracks:i},this.log("Updating subtitle tracks, "+i.length+' track(s) found in "'+e+'" group-id'),this.hls.trigger(l.Events.SUBTITLE_TRACKS_UPDATED,n),-1!==t&&this.setSubtitleTrack(t,r)))},n.findTrackId=function(t){for(var e=this.tracksInGroup,r=0;r<e.length;r++){var i=e[r];if((!this.selectDefaultTrack||i.default)&&(!t||t===i.name))return i.id}return-1},n.onError=function(t,e){r.prototype.onError.call(this,t,e),!e.fatal&&e.context&&e.context.type===a.PlaylistContextType.SUBTITLE_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},n.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var r=e.id,i=e.groupId,n=e.url;if(t)try{n=t.addDirectives(n)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Loading subtitle playlist for id "+r),this.hls.trigger(l.Events.SUBTITLE_TRACK_LOADING,{url:n,id:r,groupId:i,deliveryDirectives:t||null})}},n.toggleTrackModes=function(t){var e,r=this,i=this.media,n=this.subtitleDisplay,s=this.trackId;i&&(i=(e=c(i.textTracks)).filter(function(t){return t.groupId===r.groupId}),-1===t?[].slice.call(e).forEach(function(t){t.mode="disabled"}):(s=i[s])&&(s.mode="disabled"),(t=i[t])&&(t.mode=n?"showing":"hidden"))},n.setSubtitleTrack=function(t,e){var r,i,n,s,a,o=this.tracksInGroup;this.media?(this.trackId!==t&&this.toggleTrackModes(t),this.trackId===t&&(-1===t||null!==(s=o[t])&&void 0!==s&&s.details)||t<-1||t>=o.length||(this.clearTimer(),r=o[t],this.log("Switching to subtitle track "+t),this.trackId=t,r?(i=r.id,n=void 0===(a=r.groupId)?"":a,s=r.name,o=r.type,a=r.url,this.hls.trigger(l.Events.SUBTITLE_TRACK_SWITCH,{id:i,groupId:n,name:s,type:o,url:a}),e=this.switchParams(r.url,null==e?void 0:e.details),this.loadPlaylist(e)):this.hls.trigger(l.Events.SUBTITLE_TRACK_SWITCH,{id:t}))):this.queuedDefaultTrack=t},n.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,e=c(this.media.textTracks),r=0;r<e.length;r++)if("hidden"===e[r].mode)t=r;else if("showing"===e[r].mode){t=r;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},e=t,(n=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,e)}}])&&o(e.prototype,n),i&&o(e,i),t}(i.default);function c(t){for(var e=[],r=0;r<t.length;r++){var i=t[r];"subtitles"===i.kind&&i.label&&e.push(t[r])}return e}e.default=i},"./src/controller/timeline-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"TimelineController",function(){return i});var a=r("./src/polyfills/number.ts"),f=r("./src/events.ts"),s=r("./src/utils/cea-608-parser.ts"),o=r("./src/utils/output-filter.ts"),l=r("./src/utils/webvtt-parser.ts"),u=r("./src/utils/texttrack-utils.ts"),c=r("./src/utils/imsc1-ttml-parser.ts"),d=r("./src/types/loader.ts"),h=r("./src/utils/logger.ts"),i=function(){function t(t){var e,r,i,n;this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs=g(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions&&(e=new o.default(this,"textTrack1"),r=new o.default(this,"textTrack2"),i=new o.default(this,"textTrack3"),n=new o.default(this,"textTrack4"),this.cea608Parser1=new s.default(1,e,r),this.cea608Parser2=new s.default(3,i,n)),t.on(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(f.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(f.Events.FRAG_LOADING,this.onFragLoading,this),t.on(f.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(f.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(f.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(f.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(f.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=t.prototype;return e.destroy=function(){var t=this.hls;t.off(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(f.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(f.Events.FRAG_LOADING,this.onFragLoading,this),t.off(f.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(f.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(f.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(f.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(f.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},e.addCues=function(t,e,r,i,n){for(var s,a,o,l,u=!1,c=n.length;c--;){var d=n[c],h=(s=d[0],a=d[1],h=e,o=r,Math.min(a,o)-Math.max(s,h));if(0<=h&&(d[0]=Math.min(d[0],e),d[1]=Math.max(d[1],r),u=!0,.5<h/(r-e)))return}u||n.push([e,r]),this.config.renderTextTracksNatively?(l=this.captionsTracks[t],this.Cues.newCue(l,e,r,i)):(i=this.Cues.newCue(null,e,r,i),this.hls.trigger(f.Events.CUES_PARSED,{type:"captions",cues:i,track:t}))},e.onInitPtsFound=function(t,e){var r=this,i=e.frag,n=e.id,s=e.initPTS,a=e.timescale,e=this.unparsedVttFrags;"main"===n&&(this.initPTS[i.cc]=s,this.timescale[i.cc]=a),e.length&&(this.unparsedVttFrags=[],e.forEach(function(t){r.onFragLoaded(f.Events.FRAG_LOADED,t)}))},e.getExistingTrack=function(t){var e=this.media;if(e)for(var r=0;r<e.textTracks.length;r++){var i=e.textTracks[r];if(i[t])return i}return null},e.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},e.createNativeTrack=function(t){var e,r,i,n,s;this.captionsTracks[t]||(s=this.captionsProperties,e=this.captionsTracks,r=this.media,i=(n=s[t]).label,s=n.languageCode,(n=this.getExistingTrack(t))?(e[t]=n,Object(u.clearCurrentCues)(e[t]),Object(u.sendAddTrackEvent)(e[t],r)):(s=this.createTextTrack("captions",i,s))&&(s[t]=!0,e[t]=s))},e.createNonNativeTrack=function(t){var e;this.nonNativeCaptionsTracks[t]||(e=this.captionsProperties[t])&&(e={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media},this.nonNativeCaptionsTracks[t]=e,this.hls.trigger(f.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[e]}))},e.createTextTrack=function(t,e,r){var i=this.media;if(i)return i.addTextTrack(t,e,r)},e.onMediaAttaching=function(t,e){this.media=e.media,this._cleanTracks()},e.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){Object(u.clearCurrentCues)(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=g(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var r=0;r<e.length;r++)Object(u.clearCurrentCues)(e[r])}},e.onSubtitleTracksUpdated=function(t,e){var o=this;this.textTracks=[];var l,r=e.subtitleTracks||[],e=r.some(function(t){return t.textCodec===c.IMSC1_CODEC});(this.config.enableWebVTT||e&&this.config.enableIMSC1)&&(e=this.tracks&&r&&this.tracks.length===r.length,this.tracks=r||[],this.config.renderTextTracksNatively?(l=this.media?this.media.textTracks:[],this.tracks.forEach(function(t,e){var r,i,n;if(e<l.length){for(var s=null,a=0;a<l.length;a++)if(i=l[a],n=t,i&&i.label===n.name&&!(i.textTrack1||i.textTrack2)){s=l[a];break}s&&(r=s)}r?Object(u.clearCurrentCues)(r):(r=o.createTextTrack("subtitles",t.name,t.lang))&&(r.mode="disabled"),r&&(r.groupId=t.groupId,o.textTracks.push(r))})):!e&&this.tracks&&this.tracks.length&&(e=this.tracks.map(function(t){return{label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}}),this.hls.trigger(f.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})))},e.onManifestLoaded=function(t,e){var r=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(t){var e=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);e&&(e="textTrack"+e[1],(e=r.captionsProperties[e])&&(e.label=t.name,t.lang&&(e.languageCode=t.lang),e.media=t))})},e.onFragLoading=function(t,e){var r=this.cea608Parser1,i=this.cea608Parser2,n=this.lastSn;this.enabled&&r&&i&&e.frag.type===d.PlaylistLevelType.MAIN&&((e=e.frag.sn)!==n+1&&(r.reset(),i.reset()),this.lastSn=e)},e.onFragLoaded=function(t,e){var r=e.frag,i=e.payload,n=this.initPTS,s=this.unparsedVttFrags;if(r.type===d.PlaylistLevelType.SUBTITLE)if(i.byteLength){if(!Object(a.isFiniteNumber)(n[r.cc]))return s.push(e),void(n.length&&this.hls.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")}));e=r.decryptdata;null!=e&&null!=e.key&&"AES-128"===e.method||(n=this.tracks[r.level],(e=this.vttCCs)[r.cc]||(e[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),n&&n.textCodec===c.IMSC1_CODEC?this._parseIMSC1(r,i):this._parseVTTs(r,i,e))}else this.hls.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(e,t){var r=this,i=this.hls;Object(c.parseIMSC1)(t,this.initPTS[e.cc],this.timescale[e.cc],function(t){r._appendCues(t,e.level),i.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){h.logger.log("Failed to parse IMSC1: "+t),i.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})},e._parseVTTs=function(e,r,t){var i=this,n=this.hls;Object(l.parseWebVTT)(r,this.initPTS[e.cc],this.timescale[e.cc],t,e.cc,e.start,function(t){i._appendCues(t,e.level),n.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){i._fallbackToIMSC1(e,r),h.logger.log("Failed to parse VTT cue: "+t),n.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})},e._fallbackToIMSC1=function(t,e){var r=this,i=this.tracks[t.level];i.textCodec||Object(c.parseIMSC1)(e,this.initPTS[t.cc],this.timescale[t.cc],function(){i.textCodec=c.IMSC1_CODEC,r._parseIMSC1(t,e)},function(){i.textCodec="wvtt"})},e._appendCues=function(t,e){var r,i=this.hls;this.config.renderTextTracksNatively?"disabled"!==(r=this.textTracks[e]).mode&&t.forEach(function(t){return Object(u.addCueToTrack)(r,t)}):(e=this.tracks[e].default?"default":"subtitles"+e,i.trigger(f.Events.CUES_PARSED,{type:"subtitles",cues:t,track:e}))},e.onFragDecrypted=function(t,e){var r=e.frag;r.type===d.PlaylistLevelType.SUBTITLE&&(Object(a.isFiniteNumber)(this.initPTS[r.cc])?this.onFragLoaded(f.Events.FRAG_LOADED,e):this.unparsedVttFrags.push(e))},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(t,e){var r=this.cea608Parser1,i=this.cea608Parser2;if(this.enabled&&r&&i)for(var n=0;n<e.samples.length;n++){var s=e.samples[n].bytes;s&&(s=this.extractCea608Data(s),r.addData(e.samples[n].pts,s[0]),i.addData(e.samples[n].pts,s[1]))}},e.onBufferFlushing=function(t,e){var r,i,n=e.startOffset,s=e.endOffset,a=e.endOffsetSubtitles,o=e.type,e=this.media;!e||e.currentTime<s||(o&&"video"!==o||(r=this.captionsTracks,Object.keys(r).forEach(function(t){return Object(u.removeCuesInRange)(r[t],n,s)})),this.config.renderTextTracksNatively&&0===n&&void 0!==a&&(i=this.textTracks,Object.keys(i).forEach(function(t){return Object(u.removeCuesInRange)(i[t],n,a)})))},e.extractCea608Data=function(t){for(var e=31&t[0],r=2,i=[[],[]],n=0;n<e;n++){var s=t[r++],a=127&t[r++],o=127&t[r++],l=3&s;0==a&&0==o||0!=(4&s)&&(0!=l&&1!=l||(i[l].push(a),i[l].push(o)))}return i},t}();function g(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var i=function(){function t(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}()},"./src/crypt/aes-decryptor.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"removePadding",function(){return n}),r.d(e,"default",function(){return s});var i=r("./src/utils/typed-array.ts");function n(t){var e=t.byteLength,r=e&&new DataView(t.buffer).getUint8(e-1);return r?Object(i.sliceUint8)(t,0,e-r):t}var s=function(){function t(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var e=t.prototype;return e.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),r=new Uint32Array(4),i=0;i<4;i++)r[i]=e.getUint32(4*i);return r},e.initTable=function(){for(var t=this.sBox,e=this.invSBox,r=this.subMix,i=r[0],n=r[1],s=r[2],a=r[3],r=this.invSubMix,o=r[0],l=r[1],u=r[2],c=r[3],d=new Uint32Array(256),h=0,f=0,g=0,g=0;g<256;g++)d[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){var v=(v=f^f<<1^f<<2^f<<3^f<<4)>>>8^255&v^99,p=d[e[t[h]=v]=h],m=d[p],y=d[m],E=257*d[v]^16843008*v;i[h]=E<<24|E>>>8,n[h]=E<<16|E>>>16,s[h]=E<<8|E>>>24,a[h]=E,E=16843009*y^65537*m^257*p^16843008*h,o[v]=E<<24|E>>>8,l[v]=E<<16|E>>>16,u[v]=E<<8|E>>>24,c[v]=E,h?(h=p^d[d[d[y^p]]],f^=d[d[f]]):h=f=1}},e.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),r=!0,i=0;i<e.length&&r;)r=e[i]===this.key[i],i++;if(!r){this.key=e;var n=this.keySize=e.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);for(var s,a,o,l=this.ksRows=4*(n+6+1),u=this.keySchedule=new Uint32Array(l),c=this.invKeySchedule=new Uint32Array(l),d=this.sBox,h=this.rcon,t=this.invSubMix,f=t[0],g=t[1],v=t[2],p=t[3],m=0;m<l;m++)m<n?a=u[m]=e[m]:(o=a,m%n==0?(o=d[(o=o<<8|o>>>24)>>>24]<<24|d[o>>>16&255]<<16|d[o>>>8&255]<<8|d[255&o],o^=h[m/n|0]<<24):6<n&&m%n==4&&(o=d[o>>>24]<<24|d[o>>>16&255]<<16|d[o>>>8&255]<<8|d[255&o]),u[m]=a=(u[m-n]^o)>>>0);for(s=0;s<l;s++)m=l-s,o=3&s?u[m]:u[m-4],c[s]=s<4||m<=4?o:f[d[o>>>24]]^g[d[o>>>16&255]]^v[d[o>>>8&255]]^p[d[255&o]],c[s]=c[s]>>>0}},e.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},e.decrypt=function(t,e,r){for(var i,n,s,a,o,l,u,c,d,h,f,g,v,p,m=this.keySize+6,y=this.invKeySchedule,E=this.invSBox,T=this.invSubMix,S=T[0],b=T[1],L=T[2],A=T[3],r=this.uint8ArrayToUint32Array_(r),D=r[0],R=r[1],k=r[2],I=r[3],_=new Int32Array(t),C=new Int32Array(_.length),O=this.networkToHostOrderSwap;e<_.length;){for(d=O(_[e]),h=O(_[e+1]),f=O(_[e+2]),g=O(_[e+3]),o=d^y[0],l=g^y[1],u=f^y[2],c=h^y[3],v=4,p=1;p<m;p++)i=S[o>>>24]^b[l>>16&255]^L[u>>8&255]^A[255&c]^y[v],n=S[l>>>24]^b[u>>16&255]^L[c>>8&255]^A[255&o]^y[v+1],s=S[u>>>24]^b[c>>16&255]^L[o>>8&255]^A[255&l]^y[v+2],a=S[c>>>24]^b[o>>16&255]^L[l>>8&255]^A[255&u]^y[v+3],o=i,l=n,u=s,c=a,v+=4;i=E[o>>>24]<<24^E[l>>16&255]<<16^E[u>>8&255]<<8^E[255&c]^y[v],n=E[l>>>24]<<24^E[u>>16&255]<<16^E[c>>8&255]<<8^E[255&o]^y[v+1],s=E[u>>>24]<<24^E[c>>16&255]<<16^E[o>>8&255]<<8^E[255&l]^y[v+2],a=E[c>>>24]<<24^E[o>>16&255]<<16^E[l>>8&255]<<8^E[255&u]^y[v+3],C[e]=O(i^D),C[e+1]=O(a^R),C[e+2]=O(s^k),C[e+3]=O(n^I),D=d,R=h,k=f,I=g,e+=4}return C.buffer},t}()},"./src/crypt/decrypter.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var a=r("./src/crypt/aes-crypto.ts"),o=r("./src/crypt/fast-aes-key.ts"),l=r("./src/crypt/aes-decryptor.ts"),n=r("./src/utils/logger.ts"),u=r("./src/utils/mp4-tools.ts"),c=r("./src/utils/typed-array.ts"),i=function(){function t(t,e,r){r=(void 0===r?{}:r).removePKCS7Padding,r=void 0===r||r;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=t,this.config=e,this.removePKCS7Padding=r)try{var i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch(t){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var e=t.prototype;return e.destroy=function(){this.observer=null},e.isSync=function(){return this.config.enableSoftwareAES},e.flush=function(){var t=this.currentResult;if(t){t=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?Object(l.removePadding)(t):t}this.reset()},e.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},e.decrypt=function(t,e,r,i){var n;this.config.enableSoftwareAES?(this.softwareDecrypt(new Uint8Array(t),e,r),(n=this.flush())&&i(n.buffer)):this.webCryptoDecrypt(new Uint8Array(t),e,r).then(i)},e.softwareDecrypt=function(t,e,r){var i=this.currentIV,n=this.currentResult,s=this.remainderData;this.logOnce("JS AES decrypt"),s&&(t=Object(u.appendUint8Array)(s,t),this.remainderData=null);t=this.getValidChunk(t);if(!t.length)return null;i&&(r=i);i=this.softwareDecrypter;(i=i||(this.softwareDecrypter=new l.default)).expandKey(e);return this.currentResult=i.decrypt(t.buffer,0,r),this.currentIV=Object(c.sliceUint8)(t,-16).buffer,n||null},e.webCryptoDecrypt=function(e,r,i){var n=this,s=this.subtle;return this.key===r&&this.fastAesKey||(this.key=r,this.fastAesKey=new o.default(s,r)),this.fastAesKey.expandKey().then(function(t){return s?new a.default(s,i).decrypt(e.buffer,t):Promise.reject(new Error("web crypto not initialized"))}).catch(function(t){return n.onWebCryptoError(t,e,r,i)})},e.onWebCryptoError=function(t,e,r,i){return n.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",t),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(e,r,i)},e.getValidChunk=function(t){var e=t,r=t.length-t.length%16;return r!==t.length&&(e=Object(c.sliceUint8)(t,0,r),this.remainderData=Object(c.sliceUint8)(t,r)),e},e.logOnce=function(t){this.logEnabled&&(n.logger.log("[decrypter.ts]: "+t),this.logEnabled=!1)},t}()},"./src/crypt/fast-aes-key.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var i=function(){function t(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}()},"./src/demux/aacdemuxer.ts":function(t,e,r){"use strict";r.r(e);var i=r("./src/demux/base-audio-demuxer.ts"),n=r("./src/demux/adts.ts"),s=r("./src/utils/logger.ts"),a=r("./src/demux/id3.ts");function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}i=function(i){var t;function e(t,e){var r=i.call(this)||this;return r.observer=void 0,r.config=void 0,r.observer=t,r.config=e,r}r=i,(t=e).prototype=Object.create(r.prototype),o(t.prototype.constructor=t,r);var r=e.prototype;return r.resetInitSegment=function(t,e,r){i.prototype.resetInitSegment.call(this,t,e,r),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}},e.probe=function(t){if(!t)return!1;for(var e=(a.getID3Data(t,0)||[]).length,r=t.length;e<r;e++)if(n.probe(t,e))return s.logger.log("ADTS sync word found !"),!0;return!1},r.canParse=function(t,e){return n.canParse(t,e)},r.appendFrame=function(t,e,r){n.initTrackConfig(t,this.observer,e,r,t.manifestCodec);r=n.appendFrame(t,e,r,this.initPTS,this.frameIndex);if(r&&0===r.missing)return r},e}(i.default);i.minProbeByteLength=9,e.default=i},"./src/demux/adts.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"getAudioConfig",function(){return s}),r.d(e,"isHeaderPattern",function(){return i}),r.d(e,"getHeaderLength",function(){return a}),r.d(e,"getFullFrameLength",function(){return o}),r.d(e,"canGetFrameLength",function(){return n}),r.d(e,"isHeader",function(){return l}),r.d(e,"canParse",function(){return u}),r.d(e,"probe",function(){return c}),r.d(e,"initTrackConfig",function(){return g}),r.d(e,"getFrameDuration",function(){return v}),r.d(e,"parseFrameHeader",function(){return p}),r.d(e,"appendFrame",function(){return m});var d=r("./src/utils/logger.ts"),h=r("./src/errors.ts"),f=r("./src/events.ts");function s(t,e,r,i){var n,s,a=navigator.userAgent.toLowerCase(),o=i,l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],u=1+((192&e[r+2])>>>6),c=(60&e[r+2])>>>2;if(!(l.length-1<c))return n=(1&e[r+2])<<2,n|=(192&e[r+3])>>>6,d.logger.log("manifest codec:"+i+", ADTS type:"+u+", samplingIndex:"+c),i=/firefox/i.test(a)?6<=c?(u=5,s=new Array(4),c-3):(u=2,s=new Array(2),c):-1!==a.indexOf("android")?(u=2,s=new Array(2),c):(u=5,s=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&6<=c?c-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(6<=c&&1==n||/vivaldi/i.test(a))||!i&&1==n)&&(u=2,s=new Array(2)),c)),s[0]=u<<3,s[0]|=(14&c)>>1,s[1]|=(1&c)<<7,s[1]|=n<<3,5===u&&(s[1]|=(14&i)>>1,s[2]=(1&i)<<7,s[2]|=8,s[3]=0),{config:s,samplerate:l[c],channelCount:n,codec:"mp4a.40."+u,manifestCodec:o};t.trigger(f.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+c})}function i(t,e){return 255===t[e]&&240==(246&t[e+1])}function a(t,e){return 1&t[e+1]?7:9}function o(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function n(t,e){return e+5<t.length}function l(t,e){return e+1<t.length&&i(t,e)}function u(t,e){return n(t,e)&&i(t,e)&&o(t,e)<=t.length-e}function c(t,e){if(l(t,e)){var r=a(t,e);if(e+r>=t.length)return!1;var i=o(t,e);if(i<=r)return!1;i=e+i;return i===t.length||l(t,i)}return!1}function g(t,e,r,i,n){t.samplerate||(n=s(e,r,i,n))&&(t.config=n.config,t.samplerate=n.samplerate,t.channelCount=n.channelCount,t.codec=n.codec,t.manifestCodec=n.manifestCodec,d.logger.log("parsed codec:"+t.codec+", rate:"+n.samplerate+", channels:"+n.channelCount))}function v(t){return 9216e4/t}function p(t,e,r,i,n){var s=a(t,e),e=o(t,e);if(e-=s,0<e)return{headerLength:s,frameLength:e,stamp:r+i*n}}function m(t,e,r,i,n){var s=p(e,r,i,n,v(t.samplerate));if(s){var a,o=s.frameLength,i=s.headerLength,n=s.stamp,s=i+o,o=Math.max(0,r+s-e.length);o?(a=new Uint8Array(s-i)).set(e.subarray(r+i,e.length),0):a=e.subarray(r+i,r+s);n={unit:a,pts:n};return o||t.samples.push(n),{sample:n,length:s,missing:o}}}},"./src/demux/base-audio-demuxer.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"initPTSFn",function(){return v});var i=r("./src/polyfills/number.ts"),d=r("./src/demux/id3.ts"),h=r("./src/demux/dummy-demuxed-track.ts"),f=r("./src/utils/mp4-tools.ts"),g=r("./src/utils/typed-array.ts"),r=function(){function t(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var e=t.prototype;return e.resetInitSegment=function(t,e,r){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},e.resetTimeStamp=function(){},e.resetContiguity=function(){},e.canParse=function(t,e){return!1},e.appendFrame=function(t,e,r){},e.demux=function(t,e){this.cachedData&&(t=Object(f.appendUint8Array)(this.cachedData,t),this.cachedData=null);var r,i,n,s=d.getID3Data(t,0),a=s?s.length:0,o=this._audioTrack,l=this._id3Track,u=s?d.getTimeStamp(s):void 0,c=t.length;for(0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=v(u,e)),s&&0<s.length&&l.samples.push({pts:this.initPTS,dts:this.initPTS,data:s}),i=this.initPTS;a<c;)this.canParse(t,a)?(n=this.appendFrame(o,t,a))?(this.frameIndex++,i=n.sample.pts,r=a+=n.length):a=c:d.canParse(t,a)?(s=d.getID3Data(t,a),l.samples.push({pts:i,dts:i,data:s}),r=a+=s.length):a++,a===c&&r!==c&&(n=Object(g.sliceUint8)(t,r),this.cachedData?this.cachedData=Object(f.appendUint8Array)(this.cachedData,n):this.cachedData=n);return{audioTrack:o,avcTrack:Object(h.dummyTrack)(),id3Track:l,textTrack:Object(h.dummyTrack)()}},e.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},e.flush=function(t){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(h.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(h.dummyTrack)()}},e.destroy=function(){},t}(),v=function(t,e){return Object(i.isFiniteNumber)(t)?90*t:9e4*e};e.default=r},"./src/demux/chunk-cache.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var i=function(){function t(){this.chunks=[],this.dataLength=0}var e=t.prototype;return e.push=function(t){this.chunks.push(t),this.dataLength+=t.length},e.flush=function(){var t=this.chunks,e=this.dataLength;return t.length?(e=1===t.length?t[0]:function(t,e){for(var r=new Uint8Array(e),i=0,n=0;n<t.length;n++){var s=t[n];r.set(s,i),i+=s.length}return r}(t,e),this.reset(),e):new Uint8Array(0)},e.reset=function(){this.chunks.length=0,this.dataLength=0},t}()},"./src/demux/dummy-demuxed-track.ts":function(t,e,r){"use strict";function i(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}r.r(e),r.d(e,"dummyTrack",function(){return i})},"./src/demux/exp-golomb.ts":function(t,e,r){"use strict";r.r(e);var i=r("./src/utils/logger.ts"),r=function(){function t(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}var e=t.prototype;return e.loadWord=function(){var t=this.data,e=this.bytesAvailable,r=t.byteLength-e,i=new Uint8Array(4),e=Math.min(4,e);if(0===e)throw new Error("no bytes available");i.set(t.subarray(r,r+e)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},e.skipBits=function(t){var e;this.bitsAvailable>t||(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord()),this.word<<=t,this.bitsAvailable-=t},e.readBits=function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;return 32<t&&i.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,0<this.bitsAvailable?this.word<<=e:0<this.bytesAvailable&&this.loadWord(),0<(e=t-e)&&this.bitsAvailable?r<<e|this.readBits(e):r},e.skipLZ=function(){for(var t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},e.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.skipEG=function(){this.skipBits(1+this.skipLZ())},e.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},e.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},e.readBoolean=function(){return 1===this.readBits(1)},e.readUByte=function(){return this.readBits(8)},e.readUShort=function(){return this.readBits(16)},e.readUInt=function(){return this.readBits(32)},e.skipScalingList=function(t){for(var e=8,r=8,i=0;i<t;i++)0!==r&&(r=(e+this.readEG()+256)%256),e=0===r?e:r},e.readSPS=function(){var t,e,r,i=0,n=0,s=0,a=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),c=this.readBoolean.bind(this),d=this.skipBits.bind(this),h=this.skipEG.bind(this),f=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);o();var v=o();if(l(5),d(3),o(),f(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){var p=u();if(3===p&&d(1),f(),f(),d(1),c())for(e=3!==p?8:12,r=0;r<e;r++)c()&&g(r<6?16:64)}f();p=u();if(0===p)u();else if(1===p)for(d(1),h(),h(),t=u(),r=0;r<t;r++)h();f(),d(1);p=u(),f=u(),l=l(1);0===l&&d(1),d(1),c()&&(i=u(),n=u(),s=u(),a=u());var m=[1,1];if(c()&&c())switch(o()){case 1:m=[1,1];break;case 2:m=[12,11];break;case 3:m=[10,11];break;case 4:m=[16,11];break;case 5:m=[40,33];break;case 6:m=[24,11];break;case 7:m=[20,11];break;case 8:m=[32,11];break;case 9:m=[80,33];break;case 10:m=[18,11];break;case 11:m=[15,11];break;case 12:m=[64,33];break;case 13:m=[160,99];break;case 14:m=[4,3];break;case 15:m=[3,2];break;case 16:m=[2,1];break;case 255:m=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(p+1)-2*i-2*n),height:(2-l)*(f+1)*16-(l?2:4)*(s+a),pixelRatio:m}},e.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}();e.default=r},"./src/demux/id3.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"isHeader",function(){return l}),r.d(e,"isFooter",function(){return u}),r.d(e,"getID3Data",function(){return i}),r.d(e,"canParse",function(){return n}),r.d(e,"getTimeStamp",function(){return s}),r.d(e,"isTimeStampFrame",function(){return a}),r.d(e,"getID3Frames",function(){return o}),r.d(e,"decodeFrame",function(){return h}),r.d(e,"utf8ArrayToStr",function(){return m}),r.d(e,"testables",function(){return y});var c,l=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},u=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},i=function(t,e){for(var r=e,i=0;l(t,e);)i+=10,i+=d(t,e+6),u(t,e+10)&&(i+=10),e+=i;if(0<i)return t.subarray(r,r+i)},d=function(t,e){var r=(127&t[e])<<21;return r|=(127&t[e+1])<<14,r|=(127&t[e+2])<<7,r|=127&t[e+3]},n=function(t,e){return l(t,e)&&d(t,e+6)+10<=t.length-e},s=function(t){for(var e=o(t),r=0;r<e.length;r++){var i=e[r];if(a(i))return p(i)}},a=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},o=function(t){for(var e,r=0,i=[];l(t,r);){for(var n=d(t,r+6),s=(r+=10)+n;r+8<s;){var a=(a=t.subarray(r),o=e=void 0,e=String.fromCharCode(a[0],a[1],a[2],a[3]),o=d(a,4),{type:e,size:o,data:a.subarray(10,10+o)}),o=h(a);o&&i.push(o),r+=a.size+10}u(t,r)&&(r+=10)}return i},h=function(t){return("PRIV"===t.type?f:"W"===t.type[0]?v:g)(t)},f=function(t){if(!(t.size<2)){var e=m(t.data,!0),r=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:r.buffer}}},g=function(t){if(!(t.size<2)){if("TXXX"===t.type){var e=1,r=m(t.data.subarray(1),!0);e+=r.length+1;e=m(t.data.subarray(e));return{key:t.type,info:r,data:e}}e=m(t.data.subarray(1));return{key:t.type,data:e}}},v=function(t){if("WXXX"===t.type){if(t.size<2)return;var e=1,r=m(t.data.subarray(1),!0);e+=r.length+1;e=m(t.data.subarray(e));return{key:t.type,info:r,data:e}}e=m(t.data);return{key:t.type,data:e}},p=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),t=1&e[3],e=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return e/=45,t&&(e+=47721858.84),Math.round(e)}},m=function(t,e){void 0===e&&(e=!1);var r=function(){c||void 0===self.TextDecoder||(c=new self.TextDecoder("utf-8"));return c}();if(r){var i=r.decode(t);if(e){r=i.indexOf("\0");return-1!==r?i.substring(0,r):i}return i.replace(/\0/g,"")}for(var n,s,a,o=t.length,l="",u=0;u<o;){if(0===(n=t[u++])&&e)return l;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(n);break;case 12:case 13:s=t[u++],l+=String.fromCharCode((31&n)<<6|63&s);break;case 14:s=t[u++],a=t[u++],l+=String.fromCharCode((15&n)<<12|(63&s)<<6|(63&a)<<0)}}return l},y={decodeTextFrame:g}},"./src/demux/mp3demuxer.ts":function(t,e,r){"use strict";r.r(e);var i=r("./src/demux/base-audio-demuxer.ts"),n=r("./src/demux/id3.ts"),s=r("./src/utils/logger.ts"),a=r("./src/demux/mpegaudio.ts");function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}i=function(i){var t;function e(){return i.apply(this,arguments)||this}r=i,(t=e).prototype=Object.create(r.prototype),o(t.prototype.constructor=t,r);var r=e.prototype;return r.resetInitSegment=function(t,e,r){i.prototype.resetInitSegment.call(this,t,e,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}},e.probe=function(t){if(!t)return!1;for(var e=(n.getID3Data(t,0)||[]).length,r=t.length;e<r;e++)if(a.probe(t,e))return s.logger.log("MPEG Audio sync word found !"),!0;return!1},r.canParse=function(t,e){return a.canParse(t,e)},r.appendFrame=function(t,e,r){if(null!==this.initPTS)return a.appendFrame(t,e,r,this.initPTS,this.frameIndex)},e}(i.default);i.minProbeByteLength=4,e.default=i},"./src/demux/mp4demuxer.ts":function(t,e,r){"use strict";r.r(e);var i=r("./src/utils/mp4-tools.ts"),n=r("./src/demux/dummy-demuxed-track.ts"),r=function(){function t(t,e){this.remainderData=null,this.config=void 0,this.config=e}var e=t.prototype;return e.resetTimeStamp=function(){},e.resetInitSegment=function(){},e.resetContiguity=function(){},t.probe=function(t){return 0<Object(i.findBox)({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length},e.demux=function(t){var e=t,r=Object(n.dummyTrack)();return this.config.progressive?(this.remainderData&&(e=Object(i.appendUint8Array)(this.remainderData,t)),t=Object(i.segmentValidRange)(e),this.remainderData=t.remainder,r.samples=t.valid||new Uint8Array):r.samples=e,{audioTrack:Object(n.dummyTrack)(),avcTrack:r,id3Track:Object(n.dummyTrack)(),textTrack:Object(n.dummyTrack)()}},e.flush=function(){var t=Object(n.dummyTrack)();return t.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(n.dummyTrack)(),avcTrack:t,id3Track:Object(n.dummyTrack)(),textTrack:Object(n.dummyTrack)()}},e.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},e.destroy=function(){},t}();r.minProbeByteLength=1024,e.default=r},"./src/demux/mpegaudio.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"appendFrame",function(){return i}),r.d(e,"parseHeader",function(){return a}),r.d(e,"isHeaderPattern",function(){return n}),r.d(e,"isHeader",function(){return s}),r.d(e,"canParse",function(){return o}),r.d(e,"probe",function(){return l});var d=null,h=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],f=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],g=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],v=[0,1,1,4];function i(t,e,r,i,n){if(!(r+24>e.length)){var s=a(e,r);if(s&&r+s.frameLength<=e.length){n=i+n*(9e4*s.samplesPerFrame/s.sampleRate),n={unit:e.subarray(r,r+s.frameLength),pts:n,dts:n};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(n),{sample:n,length:s.frameLength,missing:0}}}}function a(t,e){var r=t[e+1]>>3&3,i=t[e+1]>>1&3,n=t[e+2]>>4&15,s=t[e+2]>>2&3;if(1!=r&&0!=n&&15!=n&&3!=s){var a=t[e+2]>>1&1,o=t[e+3]>>6,l=1e3*h[14*(3==r?3-i:3==i?3:4)+n-1],u=f[3*(3==r?0:2==r?1:2)+s],c=3==o?1:2,n=g[r][i],s=v[i],r=8*n*s,a=Math.floor(n*l/u+a)*s;return null===d&&(s=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),d=s?parseInt(s[1]):0),!!d&&d<=87&&2==i&&224e3<=l&&0==o&&(t[e+3]=128|t[e+3]),{sampleRate:u,channelCount:c,frameLength:a,samplesPerFrame:r}}}function n(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])}function s(t,e){return e+1<t.length&&n(t,e)}function o(t,e){return n(t,e)&&4<=t.length-e}function l(t,e){if(e+1<t.length&&n(t,e)){var r=a(t,e),i=4;null!=r&&r.frameLength&&(i=r.frameLength);i=e+i;return i===t.length||s(t,i)}return!1}},"./src/demux/sample-aes.ts":function(t,e,r){"use strict";r.r(e);var i=r("./src/crypt/decrypter.ts"),u=r("./src/demux/tsdemuxer.ts"),r=function(){function t(t,e,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new i.default(t,e,{removePKCS7Padding:!1})}var e=t.prototype;return e.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,e)},e.decryptAacSample=function(e,r,i,n){var s=e[r].unit,t=s.subarray(16,s.length-s.length%16),t=t.buffer.slice(t.byteOffset,t.byteOffset+t.length),a=this;this.decryptBuffer(t,function(t){t=new Uint8Array(t);s.set(t,16),n||a.decryptAacSamples(e,r+1,i)})},e.decryptAacSamples=function(t,e,r){for(;;e++){if(e>=t.length)return void r();if(!(t[e].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(t,e,r,i),!i)return}}},e.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e),i=0,n=32;n<=t.length-16;n+=160,i+=16)r.set(t.subarray(n,n+16),i);return r},e.getAvcDecryptedUnit=function(t,e){for(var r=new Uint8Array(e),i=0,n=32;n<=t.length-16;n+=160,i+=16)t.set(r.subarray(i,i+16),n);return t},e.decryptAvcSample=function(e,r,i,n,s,a){var o=Object(u.discardEPB)(s.data),t=this.getAvcEncryptedData(o),l=this;this.decryptBuffer(t.buffer,function(t){s.data=l.getAvcDecryptedUnit(o,t),a||l.decryptAvcSamples(e,r,i+1,n)})},e.decryptAvcSamples=function(t,e,r,i){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,r=0){if(e>=t.length)return void i();for(var n=t[e].units;!(r>=n.length);r++){var s=n[r];if(!(s.data.length<=48||1!==s.type&&5!==s.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(t,e,r,i,s,a),!a)return}}}},t}();e.default=r},"./src/demux/transmuxer-interface.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var u=r("./node_modules/webworkify-webpack/index.js"),c=r("./src/events.ts"),S=r("./src/demux/transmuxer.ts"),b=r("./src/utils/logger.ts"),d=r("./src/errors.ts"),e=r("./src/utils/mediasource-helper.ts"),h=r("./node_modules/eventemitter3/index.js"),f=Object(e.getMediaSource)()||{isTypeSupported:function(){return!1}},i=function(){function t(r,e,t,i){var n=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=r,this.id=e,this.onTransmuxComplete=t,this.onFlush=i;var s=r.config,i=function(t,e){(e=e||{}).frag=n.frag,e.id=n.id,r.trigger(t,e)};this.observer=new h.EventEmitter,this.observer.on(c.Events.FRAG_DECRYPTED,i),this.observer.on(c.Events.ERROR,i);var a,o={mp4:f.isTypeSupported("video/mp4"),mpeg:f.isTypeSupported("audio/mpeg"),mp3:f.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(s.enableWorker&&"undefined"!=typeof Worker){b.logger.log("demuxing in webworker");try{a=this.worker=u("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),a.addEventListener("message",this.onwmsg),a.onerror=function(t){r.trigger(c.Events.ERROR,{type:d.ErrorTypes.OTHER_ERROR,details:d.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(t.message+"  ("+t.filename+":"+t.lineno+")")})},a.postMessage({cmd:"init",typeSupported:o,vendor:l,id:e,config:JSON.stringify(s)})}catch(t){b.logger.warn("Error in worker:",t),b.logger.error("Error while initializing DemuxerWorker, fallback to inline"),a&&self.URL.revokeObjectURL(a.objectURL),this.transmuxer=new S.default(this.observer,o,s,l,e),this.worker=null}}else this.transmuxer=new S.default(this.observer,o,s,l,e)}var e=t.prototype;return e.destroy=function(){var t=this.worker;t?(t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null):(e=this.transmuxer)&&(e.destroy(),this.transmuxer=null);var e=this.observer;e&&e.removeAllListeners(),this.observer=null},e.push=function(t,e,r,i,n,s,a,o,l,u){var c=this;l.transmuxing.start=self.performance.now();var d=this.transmuxer,h=this.worker,f=(s||n).start,g=n.decryptdata,v=this.frag,p=!(v&&n.cc===v.cc),m=!(v&&l.level===v.level),y=v?l.sn-v.sn:-1,E=this.part?l.part-this.part.index:1,T=!m&&(1==y||0==y&&1==E),v=self.performance.now();(m||y||0===n.stats.parsing.start)&&(n.stats.parsing.start=v),!s||!E&&T||(s.stats.parsing.start=v);v=new S.TransmuxState(p,T,o,m,f);T&&!p||(b.logger.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+"\n        discontinuity: "+p+"\n        trackSwitch: "+m+"\n        contiguous: "+T+"\n        accurateTimeOffset: "+o+"\n        timeOffset: "+f),u=new S.TransmuxConfig(r,i,e,a,u),this.configureTransmuxer(u)),this.frag=n,this.part=s,h?h.postMessage({cmd:"demux",data:t,decryptdata:g,chunkMeta:l,state:v},t instanceof ArrayBuffer?[t]:[]):d&&(v=d.push(t,g,l,v),Object(S.isPromise)(v)?v.then(function(t){c.handleTransmuxComplete(t)}):this.handleTransmuxComplete(v))},e.flush=function(e){var r=this;e.transmuxing.start=self.performance.now();var t=this.transmuxer,i=this.worker;i?i.postMessage({cmd:"flush",chunkMeta:e}):t&&(t=t.flush(e),Object(S.isPromise)(t)?t.then(function(t){r.handleFlushResult(t,e)}):this.handleFlushResult(t,e))},e.handleFlushResult=function(t,e){var r=this;t.forEach(function(t){r.handleTransmuxComplete(t)}),this.onFlush(e)},e.onWorkerMessage=function(t){var e=t.data,r=this.hls;switch(e.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,r.trigger(e.event,e.data)}},e.configureTransmuxer=function(t){var e=this.worker,r=this.transmuxer;e?e.postMessage({cmd:"configure",config:t}):r&&r.configure(t)},e.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},t}()},"./src/demux/transmuxer-worker.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return s});var l=r("./src/demux/transmuxer.ts"),i=r("./src/events.ts"),u=r("./src/utils/logger.ts"),n=r("./node_modules/eventemitter3/index.js");function s(s){function a(t,e){s.postMessage({event:t,data:e})}var o=new n.EventEmitter;o.on(i.Events.FRAG_DECRYPTED,a),o.on(i.Events.ERROR,a),s.addEventListener("message",function(t){var e=t.data;switch(e.cmd){case"init":var r=JSON.parse(e.config);s.transmuxer=new l.default(o,e.typeSupported,r,e.vendor,e.id),Object(u.enableLogs)(r.debug),a("init",null);break;case"configure":s.transmuxer.configure(e.config);break;case"demux":var i=s.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);Object(l.isPromise)(i)?i.then(function(t){c(s,t)}):c(s,i);break;case"flush":var n=e.chunkMeta,i=s.transmuxer.flush(n);Object(l.isPromise)(i)?i.then(function(t){d(s,t,n)}):d(s,i,n)}})}function c(t,e){var r,i,n;((i=e.remuxResult).audio||i.video||i.text||i.id3||i.initSegment)&&(r=[],i=(n=e.remuxResult).audio,n=n.video,i&&a(r,i),n&&a(r,n),t.postMessage({event:"transmuxComplete",data:e},r))}function a(t,e){e.data1&&t.push(e.data1.buffer),e.data2&&t.push(e.data2.buffer)}function d(e,t,r){t.forEach(function(t){c(e,t)}),e.postMessage({event:"flush",data:r})}},"./src/demux/transmuxer.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return l}),r.d(e,"isPromise",function(){return h}),r.d(e,"TransmuxConfig",function(){return f}),r.d(e,"TransmuxState",function(){return g});var m,u=r("./src/events.ts"),c=r("./src/errors.ts"),i=r("./src/crypt/decrypter.ts"),n=r("./src/demux/aacdemuxer.ts"),y=r("./src/demux/mp4demuxer.ts"),s=r("./src/demux/tsdemuxer.ts"),a=r("./src/demux/mp3demuxer.ts"),e=r("./src/remux/mp4-remuxer.ts"),E=r("./src/remux/passthrough-remuxer.ts"),o=r("./src/demux/chunk-cache.ts"),T=r("./src/utils/mp4-tools.ts"),S=r("./src/utils/logger.ts");try{m=self.performance.now.bind(self.performance)}catch(t){S.logger.debug("Unable to use Performance API on this environment"),m=self.Date.now}var b=[{demux:s.default,remux:e.default},{demux:y.default,remux:E.default},{demux:n.default,remux:e.default},{demux:a.default,remux:e.default}],d=1024;b.forEach(function(t){t=t.demux;d=Math.max(d,t.minProbeByteLength)});var l=function(){function t(t,e,r,i,n){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new o.default,this.observer=t,this.typeSupported=e,this.config=r,this.vendor=i,this.id=n}var e=t.prototype;return e.configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},e.push=function(t,e,r,i){var n=this,s=r.transmuxing;s.executeStart=m();var a=new Uint8Array(t),o=this.cache,l=this.config,u=this.currentTransmuxState,c=this.transmuxConfig;i&&(this.currentTransmuxState=i);var d=function(t,e){var r=null;0<t.byteLength&&null!=e&&null!=e.key&&null!==e.iv&&null!=e.method&&(r=e);return r}(a,e);if(d&&"AES-128"===d.method){var h=this.getDecrypter();if(!l.enableSoftwareAES)return this.decryptionPromise=h.webCryptoDecrypt(a,d.key.buffer,d.iv.buffer).then(function(t){t=n.push(t,null,r);return n.decryptionPromise=null,t}),this.decryptionPromise;var f=h.softwareDecrypt(a,d.key.buffer,d.iv.buffer);if(!f)return s.executeEnd=m(),L(r);a=new Uint8Array(f)}var g=i||u,v=g.contiguous,p=g.discontinuity,t=g.trackSwitch,e=g.accurateTimeOffset,l=g.timeOffset,h=c.audioCodec,f=c.videoCodec,i=c.defaultInitPts,u=c.duration,g=c.initSegmentData;(p||t)&&this.resetInitSegment(g,h,f,u),p&&this.resetInitialTimestamp(i),v||this.resetContiguity(),this.needsProbing(a,p,t)&&(o.dataLength&&(o=o.flush(),a=Object(T.appendUint8Array)(o,a)),this.configureTransmuxer(a,c));l=this.transmux(a,d,l,e,r),e=this.currentTransmuxState;return e.contiguous=!0,e.discontinuity=!1,e.trackSwitch=!1,s.executeEnd=m(),l},e.flush=function(e){var r=this,t=e.transmuxing;t.executeStart=m();var i=this.decrypter,n=this.cache,s=this.currentTransmuxState,a=this.decryptionPromise;if(a)return a.then(function(){return r.flush(e)});var o=[],s=s.timeOffset;!i||(l=i.flush())&&o.push(this.push(l,null,e));i=n.dataLength;n.reset();var l=this.demuxer,n=this.remuxer;if(!l||!n)return d<=i&&this.observer.emit(u.Events.ERROR,u.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),t.executeEnd=m(),[L(e)];s=l.flush(s);return h(s)?s.then(function(t){return r.flushRemux(o,t,e),o}):(this.flushRemux(o,s,e),o)},e.flushRemux=function(t,e,r){var i=e.audioTrack,n=e.avcTrack,s=e.id3Track,a=e.textTrack,o=this.currentTransmuxState,e=o.accurateTimeOffset,o=o.timeOffset;S.logger.log("[transmuxer.ts]: Flushed fragment "+r.sn+(-1<r.part?" p: "+r.part:"")+" of level "+r.level);e=this.remuxer.remux(i,n,s,a,o,e,!0,this.id);t.push({remuxResult:e,chunkMeta:r}),r.transmuxing.executeEnd=m()},e.resetInitialTimestamp=function(t){var e=this.demuxer,r=this.remuxer;e&&r&&(e.resetTimeStamp(t),r.resetTimeStamp(t))},e.resetContiguity=function(){var t=this.demuxer,e=this.remuxer;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())},e.resetInitSegment=function(t,e,r,i){var n=this.demuxer,s=this.remuxer;n&&s&&(n.resetInitSegment(e,r,i),s.resetInitSegment(t,e,r))},e.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},e.transmux=function(t,e,r,i,n){n=e&&"SAMPLE-AES"===e.method?this.transmuxSampleAes(t,e,r,i,n):this.transmuxUnencrypted(t,r,i,n);return n},e.transmuxUnencrypted=function(t,e,r,i){var n=this.demuxer.demux(t,e,!1,!this.config.progressive),s=n.audioTrack,a=n.avcTrack,t=n.id3Track,n=n.textTrack;return{remuxResult:this.remuxer.remux(s,a,t,n,e,r,!1,this.id),chunkMeta:i}},e.transmuxSampleAes=function(t,e,r,i,n){var s=this;return this.demuxer.demuxSampleAes(t,e,r).then(function(t){return{remuxResult:s.remuxer.remux(t.audioTrack,t.avcTrack,t.id3Track,t.textTrack,r,i,!1,s.id),chunkMeta:n}})},e.configureTransmuxer=function(t,e){for(var r,i=this.config,n=this.observer,s=this.typeSupported,a=this.vendor,o=e.audioCodec,l=e.defaultInitPts,u=e.duration,c=e.initSegmentData,d=e.videoCodec,h=0,f=b.length;h<f;h++)if(b[h].demux.probe(t)){r=b[h];break}r||(S.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),r={demux:y.default,remux:E.default});var g=this.demuxer,v=this.remuxer,p=r.remux,e=r.demux;v&&v instanceof p||(this.remuxer=new p(n,i,s,a)),g&&g instanceof e||(this.demuxer=new e(n,i,s),this.probe=e.probe),this.resetInitSegment(c,o,d,u),this.resetInitialTimestamp(l)},e.needsProbing=function(t,e,r){return!this.demuxer||!this.remuxer||e||r},e.getDecrypter=function(){return this.decrypter||(this.decrypter=new i.default(this.observer,this.config))},t}();var L=function(t){return{remuxResult:{},chunkMeta:t}};function h(t){return"then"in t&&t.then instanceof Function}var f=function(t,e,r,i,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=r,this.duration=i,this.defaultInitPts=n},g=function(t,e,r,i,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=n}},"./src/demux/tsdemuxer.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"discardEPB",function(){return N});var f=r("./src/demux/adts.ts"),o=r("./src/demux/mpegaudio.ts"),I=r("./src/demux/exp-golomb.ts"),_=r("./src/demux/id3.ts"),i=r("./src/demux/sample-aes.ts"),k=r("./src/events.ts"),C=r("./src/utils/mp4-tools.ts"),O=r("./src/utils/logger.ts"),w=r("./src/errors.ts"),n={video:1,audio:2,id3:3,text:4},r=function(){function R(t,e,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=e,this.typeSupported=r}R.probe=function(t){t=R.syncOffset(t);return!(t<0)&&(t&&O.logger.warn("MPEG2-TS detected but first sync word found @ offset "+t+", junk ahead ?"),!0)},R.syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),r=0;r<e;){if(71===t[r]&&71===t[r+188]&&71===t[r+376])return r;r++}return-1},R.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:n[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}};var t=R.prototype;return t.resetInitSegment=function(t,e,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=R.createTrack("video",r),this._audioTrack=R.createTrack("audio",r),this._id3Track=R.createTrack("id3",r),this._txtTrack=R.createTrack("text",r),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=t,this.videoCodec=e,this._duration=r},t.resetTimeStamp=function(){},t.resetContiguity=function(){var t=this._audioTrack,e=this._avcTrack,r=this._id3Track;t&&(t.pesData=null),e&&(e.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},t.demux=function(t,e,r,i){var n;void 0===r&&(r=!1),void 0===i&&(i=!1),r||(this.sampleAes=null);var s=this._avcTrack,a=this._audioTrack,o=this._id3Track,l=s.pid,u=s.pesData,c=a.pid,d=o.pid,h=a.pesData,f=o.pesData,g=!1,v=this.pmtParsed,p=this._pmtId,m=t.length;if(this.remainderData&&(m=(t=Object(C.appendUint8Array)(this.remainderData,t)).length,this.remainderData=null),m<188&&!i)return this.remainderData=t,{audioTrack:a,avcTrack:s,id3Track:o,textTrack:this._txtTrack};var y=Math.max(0,R.syncOffset(t));(m-=(m+y)%188)<t.byteLength&&!i&&(this.remainderData=new Uint8Array(t.buffer,m,t.buffer.byteLength-m));for(var E,T=y;T<m;T+=188)if(71===t[T]){var S=!!(64&t[T+1]),b=((31&t[T+1])<<8)+t[T+2],L=void 0;if(1<(48&t[T+3])>>4){if((L=T+5+t[T+4])===T+188)continue}else L=T+4;switch(b){case l:S&&(u&&(n=P(u))&&this.parseAVCPES(n,!1),u={data:[],size:0}),u&&(u.data.push(t.subarray(L,T+188)),u.size+=T+188-L);break;case c:S&&(h&&(n=P(h))&&(a.isAAC?this.parseAACPES(n):this.parseMPEGPES(n)),h={data:[],size:0}),h&&(h.data.push(t.subarray(L,T+188)),h.size+=T+188-L);break;case d:S&&(f&&(n=P(f))&&this.parseID3PES(n),f={data:[],size:0}),f&&(f.data.push(t.subarray(L,T+188)),f.size+=T+188-L);break;case 0:S&&(L+=t[L]+1),p=this._pmtId=(31&(E=t)[(A=L)+10])<<8|E[A+11];break;case p:S&&(L+=t[L]+1);var A=function(t,e,r,i){var n={audio:-1,avc:-1,id3:-1,isAAC:!0},s=(15&t[e+1])<<8|t[e+2],a=e+3+s-4,s=(15&t[e+10])<<8|t[e+11];e+=12+s;for(;e<a;){var o=(31&t[e+1])<<8|t[e+2];switch(t[e]){case 207:if(!i){O.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===n.audio&&(n.audio=o);break;case 21:-1===n.id3&&(n.id3=o);break;case 219:if(!i){O.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===n.avc&&(n.avc=o);break;case 3:case 4:r?-1===n.audio&&(n.audio=o,n.isAAC=!1):O.logger.log("MPEG audio found, not supported in this browser");break;case 36:O.logger.warn("Unsupported HEVC stream type found")}e+=5+((15&t[e+3])<<8|t[e+4])}return n}(t,L,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,r);0<(l=A.avc)&&(s.pid=l),0<(c=A.audio)&&(a.pid=c,a.isAAC=A.isAAC),0<(d=A.id3)&&(o.pid=d),g&&!v&&(O.logger.log("reparse from beginning"),g=!1,T=y-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:g=!0}}else this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});s.pesData=u,a.pesData=h,o.pesData=f;var D={audioTrack:a,avcTrack:s,id3Track:o,textTrack:this._txtTrack};return i&&this.extractRemainingSamples(D),D},t.flush=function(){var t=this.remainderData;return this.remainderData=null,t=t?this.demux(t,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},t.extractRemainingSamples=function(t){var e,r=t.audioTrack,i=t.avcTrack,n=t.id3Track,s=i.pesData,a=r.pesData,t=n.pesData;s&&(e=P(s))?(this.parseAVCPES(e,!0),i.pesData=null):i.pesData=s,a&&(e=P(a))?(r.isAAC?this.parseAACPES(e):this.parseMPEGPES(e),r.pesData=null):(null!=a&&a.size&&O.logger.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=a),t&&(e=P(t))?(this.parseID3PES(e),n.pesData=null):n.pesData=t},t.demuxSampleAes=function(t,e,r){r=this.demux(t,r,!0,!this.config.progressive),e=this.sampleAes=new i.default(this.observer,this.config,e);return this.decrypt(r,e)},t.decrypt=function(i,n){return new Promise(function(t){var e=i.audioTrack,r=i.avcTrack;e.samples&&e.isAAC?n.decryptAacSamples(e.samples,0,function(){r.samples?n.decryptAvcSamples(r.samples,0,0,function(){t(i)}):t(i)}):r.samples&&n.decryptAvcSamples(r.samples,0,0,function(){t(i)})})},t.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},t.parseAVCPES=function(b,t){var L,A=this,D=this._avcTrack,e=this.parseAVCNALu(b.data),R=this.avcSample,k=!1;b.data=null,R&&e.length&&!D.audFound&&(F(R,D),R=this.avcSample=x(!1,b.pts,b.dts,"")),e.forEach(function(t){switch(t.type){case 1:L=!0,(R=R||(A.avcSample=x(!0,b.pts,b.dts,""))).frame=!0;var e=t.data;k&&4<e.length&&(2!==(m=new I.default(e).readSliceType())&&4!==m&&7!==m&&9!==m||(R.key=!0));break;case 5:L=!0,(R=R||(A.avcSample=x(!0,b.pts,b.dts,""))).key=!0,R.frame=!0;break;case 6:L=!0;var r=new I.default(N(t.data));r.readUByte();for(var i=0,n=0,s=!1,a=0;!s&&1<r.bytesAvailable;){for(i=0;i+=a=r.readUByte(),255===a;);for(n=0;n+=a=r.readUByte(),255===a;);if(4===i&&0!==r.bytesAvailable){s=!0;var o=r.readUByte();if(181===o)if(49===r.readUShort()){o=r.readUInt();if(1195456820===o)if(3===r.readUByte()){for(var o=r.readUByte(),l=31&o,u=[o,r.readUByte()],c=0;c<l;c++)u.push(r.readUByte()),u.push(r.readUByte()),u.push(r.readUByte());M(A._txtTrack.samples,{type:3,pts:b.pts,bytes:u})}}}else if(5===i&&0!==r.bytesAvailable){if(s=!0,16<n){for(var d=[],h=0;h<16;h++)d.push(r.readUByte().toString(16)),3!==h&&5!==h&&7!==h&&9!==h||d.push("-");for(var f=n-16,g=new Uint8Array(f),v=0;v<f;v++)g[v]=r.readUByte();M(A._txtTrack.samples,{pts:b.pts,payloadType:i,uuid:d.join(""),userData:Object(_.utf8ArrayToStr)(g),userDataBytes:g})}}else if(n<r.bytesAvailable)for(var p=0;p<n;p++)r.readUByte()}break;case 7:if(k=L=!0,!D.sps){var m=new I.default(t.data).readSPS();D.width=m.width,D.height=m.height,D.pixelRatio=m.pixelRatio,D.sps=[t.data],D.duration=A._duration;for(var y=t.data.subarray(1,4),E="avc1.",T=0;T<3;T++){var S=y[T].toString(16);S.length<2&&(S="0"+S),E+=S}D.codec=E}break;case 8:L=!0,D.pps||(D.pps=[t.data]);break;case 9:L=!1,D.audFound=!0,R&&F(R,D),R=A.avcSample=x(!1,b.pts,b.dts,"");break;case 12:L=!1;break;default:L=!1,R&&(R.debug+="unknown NAL "+t.type+" ")}R&&L&&R.units.push(t)}),t&&R&&(F(R,D),this.avcSample=null)},t.getLastNalUnit=function(){var t,e,r=this.avcSample;return r&&0!==r.units.length||(r=(t=this._avcTrack.samples)[t.length-1]),null!==r&&void 0!==r&&r.units&&(e=(e=r.units)[e.length-1]),e},t.parseAVCNALu=function(t){var e,r,i,n=t.byteLength,s=this._avcTrack,a=f=s.naluState||0,o=[],l=0,u=-1,c=0;for(-1===f&&(c=31&t[u=0],f=0,l=1);l<n;){var d,h,f,g=t[l++];f?f=1!==f?g?1===g?(0<=u?(h={data:t.subarray(u,l-f-1),type:c},o.push(h)):(d=this.getLastNalUnit())&&(a&&l<=4-a&&d.state&&(d.data=d.data.subarray(0,d.data.byteLength-a)),0<(e=l-f-1)&&((h=new Uint8Array(d.data.byteLength+e)).set(d.data,0),h.set(t.subarray(0,e),d.data.byteLength),d.data=h)),l<n?(c=31&t[u=l],0):-1):0:3:g?0:2:f=g?0:1}return 0<=u&&0<=f&&(i={data:t.subarray(u,n),type:c,state:f},o.push(i)),0!==o.length||(r=this.getLastNalUnit())&&((i=new Uint8Array(r.data.byteLength+t.byteLength)).set(r.data,0),i.set(t,r.data.byteLength),r.data=i),s.naluState=f,o},t.parseAACPES=function(t){var e,r,i,n,s=0,a=this._audioTrack,o=this.aacOverFlow,l=t.data;for(o&&(this.aacOverFlow=null,r=(r=o.sample.unit.byteLength)-(e=Math.min(o.missing,r)),o.sample.unit.set(l.subarray(0,e),r),a.samples.push(o.sample),s=o.missing),i=s,n=l.length;i<n-1&&!f.isHeader(l,i);i++);if(i!==s){var u,s=i<n-1?(u="AAC PES did not start with ADTS header,offset:"+i,!1):(u="no ADTS header found in AAC PES",!0);if(O.logger.warn("parsing error:"+u),this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.FRAG_PARSING_ERROR,fatal:s,reason:u}),s)return}if(f.initTrackConfig(a,this.observer,l,i,this.audioCodec),void 0!==t.pts)c=t.pts;else{if(!o)return void O.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var t=f.getFrameDuration(a.samplerate),c=o.sample.pts+t}for(var d=0;i<n;){if(f.isHeader(l,i)){if(i+5<n){var h=f.appendFrame(a,l,i,c,d);if(h){if(!h.missing){i+=h.length,d++;continue}this.aacOverFlow=h}}break}i++}},t.parseMPEGPES=function(t){var e=t.data,r=e.length,i=0,n=0,s=t.pts;if(void 0!==s)for(;n<r;)if(o.isHeader(e,n)){var a=o.appendFrame(this._audioTrack,e,n,s,i);if(!a)break;n+=a.length,i++}else n++;else O.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},t.parseID3PES=function(t){void 0!==t.pts?this._id3Track.samples.push(t):O.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},R}();function x(t,e,r,i){return{key:t,frame:!1,pts:e,dts:r,units:[],debug:i,length:0}}function P(t){var e,r,i,n,s=0,a=t.data;if(!t||0===t.size)return null;for(;a[0].length<19&&1<a.length;){var o=new Uint8Array(a[0].length+a[1].length);o.set(a[0]),o.set(a[1],a[0].length),a[0]=o,a.splice(1,1)}if(1!==((e=a[0])[0]<<16)+(e[1]<<8)+e[2])return null;if((r=(e[4]<<8)+e[5])&&r>t.size-6)return null;var l=e[7];192&l&&(i=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&l?54e5<i-(n=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)&&(O.logger.warn(Math.round((i-n)/9e4)+"s delta between PTS and DTS, align them"),i=n):n=i);var u=(l=e[8])+9;if(t.size<=u)return null;t.size-=u;for(var c=new Uint8Array(t.size),d=0,h=a.length;d<h;d++){var f=(e=a[d]).byteLength;if(u){if(f<u){u-=f;continue}e=e.subarray(u),f-=u,u=0}c.set(e,s),s+=f}return r&&(r-=l+3),{data:c,pts:i,dts:n,len:r}}function F(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){var r=e.samples,i=r.length;if(!i)return void e.dropped++;i=r[i-1];t.pts=i.pts,t.dts=i.dts}e.samples.push(t)}t.debug.length&&O.logger.log(t.pts+"/"+t.dts+":"+t.debug)}function M(t,e){var r=t.length;if(0<r){if(e.pts>=t[r-1].pts)t.push(e);else for(var i=r-1;0<=i;i--)if(e.pts<t[i].pts){t.splice(i,0,e);break}}else t.push(e)}function N(t){for(var e=t.byteLength,r=[],i=1;i<e-2;)0===t[i]&&0===t[i+1]&&3===t[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return t;for(var n=e-r.length,s=new Uint8Array(n),a=0,i=0;i<n;a++,i++)a===r[0]&&(a++,r.shift()),s[i]=t[a];return s}r.minProbeByteLength=188,e.default=r},"./src/errors.ts":function(t,e,r){"use strict";var i,n;r.r(e),r.d(e,"ErrorTypes",function(){return i}),r.d(e,"ErrorDetails",function(){return n}),(e=i=i||{}).NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",(e=n=n||{}).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown"},"./src/events.ts":function(t,e,r){"use strict";var i;r.r(e),r.d(e,"Events",function(){return i}),(e=i=i||{}).MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return l});var n=r("./node_modules/url-toolkit/src/url-toolkit.js"),h=r("./src/loader/playlist-loader.ts"),f=r("./src/loader/key-loader.ts"),g=r("./src/controller/id3-track-controller.ts"),v=r("./src/controller/latency-controller.ts"),p=r("./src/controller/level-controller.ts"),m=r("./src/controller/fragment-tracker.ts"),y=r("./src/controller/stream-controller.ts"),i=r("./src/is-supported.ts"),E=r("./src/utils/logger.ts"),T=r("./src/config.ts"),S=r("./node_modules/eventemitter3/index.js"),s=r("./src/events.ts"),a=r("./src/errors.ts");function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var l=function(){function d(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new S.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var e=this.config=Object(T.mergeConfig)(d.DefaultConfig,t);this.userConfig=t,Object(E.enableLogs)(e.debug),this._autoLevelCapping=-1,e.progressive&&Object(T.enableStreamingMode)(e);var r=e.abrController,i=e.bufferController,n=e.capLevelController,s=e.fpsController,a=this.abrController=new r(this),o=this.bufferController=new i(this),l=this.capLevelController=new n(this),u=new s(this),c=new h.default(this),t=new f.default(this),r=new g.default(this),i=this.levelController=new p.default(this),n=new m.FragmentTracker(this),s=this.streamController=new y.default(this,n);l.setStreamController(s),u.setStreamController(s);s=[i,s];this.networkControllers=s;r=[c,t,a,o,l,u,r,n];this.audioTrackController=this.createController(e.audioTrackController,null,s),this.createController(e.audioStreamController,n,s),this.subtitleTrackController=this.createController(e.subtitleTrackController,null,s),this.createController(e.subtitleStreamController,n,s),this.createController(e.timelineController,null,r),this.emeController=this.createController(e.emeController,null,r),this.cmcdController=this.createController(e.cmcdController,null,r),this.latencyController=this.createController(v.default,null,r),this.coreComponents=r}d.isSupported=function(){return Object(i.isSupported)()};var t,e,r=d.prototype;return r.createController=function(t,e,r){if(t){t=e?new t(this,e):new t(this);return r&&r.push(t),t}return null},r.on=function(t,e,r){void 0===r&&(r=this),this._emitter.on(t,e,r)},r.once=function(t,e,r){void 0===r&&(r=this),this._emitter.once(t,e,r)},r.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},r.off=function(t,e,r,i){void 0===r&&(r=this),this._emitter.off(t,e,r,i)},r.listeners=function(t){return this._emitter.listeners(t)},r.emit=function(t,e,r){return this._emitter.emit(t,e,r)},r.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){E.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.trigger(s.Events.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,error:t})}return!1},r.listenerCount=function(t){return this._emitter.listenerCount(t)},r.destroy=function(){E.logger.log("destroy"),this.trigger(s.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(t){return t.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(t){return t.destroy()}),this.coreComponents.length=0},r.attachMedia=function(t){E.logger.log("attachMedia"),this._media=t,this.trigger(s.Events.MEDIA_ATTACHING,{media:t})},r.detachMedia=function(){E.logger.log("detachMedia"),this.trigger(s.Events.MEDIA_DETACHING,void 0),this._media=null},r.loadSource=function(t){this.stopLoad();var e=this.media,r=this.url,i=this.url=n.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});E.logger.log("loadSource:"+i),e&&r&&r!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(e)),this.trigger(s.Events.MANIFEST_LOADING,{url:t})},r.startLoad=function(e){void 0===e&&(e=-1),E.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},r.stopLoad=function(){E.logger.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},r.swapAudioCodec=function(){E.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},r.recoverMediaError=function(){E.logger.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},r.removeLevel=function(t,e){void 0===e&&(e=0),this.levelController.removeLevel(t,e)},t=d,e=[{key:"version",get:function(){return"1.1.0"}},{key:"Events",get:function(){return s.Events}},{key:"ErrorTypes",get:function(){return a.ErrorTypes}},{key:"ErrorDetails",get:function(){return a.ErrorDetails}},{key:"DefaultConfig",get:function(){return d.defaultConfig||T.hlsDefaultConfig},set:function(t){d.defaultConfig=t}}],(r=[{key:"levels",get:function(){var t=this.levelController.levels;return t||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){E.logger.log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){E.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){E.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){E.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){E.logger.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){t=!!t;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(E.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,e=this.config.minAutoBitrate;if(!t)return 0;for(var r=t.length,i=0;i<r;i++)if(t[i].maxBitrate>e)return i;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,e=this.autoLevelCapping,e=-1===e&&t&&t.length?t.length-1:e;return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&o(t.prototype,r),e&&o(t,e),d}();l.defaultConfig=void 0},"./src/is-supported.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"isSupported",function(){return s}),r.d(e,"changeTypeSupported",function(){return a});var i=r("./src/utils/mediasource-helper.ts");function n(){return self.SourceBuffer||self.WebKitSourceBuffer}function s(){var t=Object(i.getMediaSource)();if(!t)return!1;var e=n(),t=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),e=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!t&&!!e}function a(){var t,e=n();return"function"==typeof(null==e||null===(t=e.prototype)||void 0===t?void 0:t.changeType)}},"./src/loader/fragment-loader.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return l}),r.d(e,"LoadError",function(){return v});var i=r("./src/polyfills/number.ts"),h=r("./src/errors.ts");function n(t){var i="function"==typeof Map?new Map:void 0;return(n=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,r)}function r(){return s(t,arguments,o(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a(r,t)})(t)}function s(t,e,r){return(s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var i=[null];i.push.apply(i,e);i=new(Function.bind.apply(t,i));return r&&a(i,r.prototype),i}).apply(null,arguments)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var f=Math.pow(2,17),l=function(){function t(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var e=t.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(a,o){var l=this,t=a.url;if(!t)return Promise.reject(new v({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,networkDetails:null},"Fragment does not have a "+(t?"part list":"url")));this.abort();var r=this.config,u=r.fLoader,c=r.loader;return new Promise(function(n,i){l.loader&&l.loader.destroy();var s=l.loader=a.loader=new(u||c)(r),t=g(a),e={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:f};a.stats=s.stats,s.load(t,e,{onSuccess:function(t,e,r,i){l.resetLoader(a,s),n({frag:a,part:null,payload:t.data,networkDetails:i})},onError:function(t,e,r){l.resetLoader(a,s),i(new v({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,response:t,networkDetails:r}))},onAbort:function(t,e,r){l.resetLoader(a,s),i(new v({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,networkDetails:r}))},onTimeout:function(t,e,r){l.resetLoader(a,s),i(new v({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,networkDetails:r}))},onProgress:function(t,e,r,i){o&&o({frag:a,part:null,payload:r,networkDetails:i})}})})},e.loadPart=function(a,o,l){var u=this;this.abort();var r=this.config,c=r.fLoader,d=r.loader;return new Promise(function(n,i){u.loader&&u.loader.destroy();var s=u.loader=a.loader=new(c||d)(r),t=g(a,o),e={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:f};o.stats=s.stats,s.load(t,e,{onSuccess:function(t,e,r,i){u.resetLoader(a,s),u.updateStatsFromPart(a,o);i={frag:a,part:o,payload:t.data,networkDetails:i};l(i),n(i)},onError:function(t,e,r){u.resetLoader(a,s),i(new v({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,part:o,response:t,networkDetails:r}))},onAbort:function(t,e,r){a.stats.aborted=o.stats.aborted,u.resetLoader(a,s),i(new v({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,part:o,networkDetails:r}))},onTimeout:function(t,e,r){u.resetLoader(a,s),i(new v({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,part:o,networkDetails:r}))}})})},e.updateStatsFromPart=function(t,e){var r=t.stats,i=e.stats,n=i.total;r.loaded+=i.loaded,n?(e=((e=Math.round(t.duration/e.duration))-(e=Math.min(Math.round(r.loaded/n),e)))*Math.round(r.loaded/e),r.total=r.loaded+e):r.total=Math.max(r.loaded,r.total);r=r.loading,i=i.loading;r.start?r.first+=i.first-i.start:(r.start=i.start,r.first=i.first),r.end=i.end},e.resetLoader=function(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},t}();function g(t,e){void 0===e&&(e=null);var r=e||t,t={frag:t,part:e,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},e=r.byteRangeStartOffset,r=r.byteRangeEndOffset;return Object(i.isFiniteNumber)(e)&&Object(i.isFiniteNumber)(r)&&(t.rangeStart=e,t.rangeEnd=r),t}var v=function(s){var t,e;function r(t){for(var e,r=arguments.length,i=new Array(1<r?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];return(e=s.call.apply(s,[this].concat(i))||this).data=void 0,e.data=t,e}return e=s,(t=r).prototype=Object.create(e.prototype),a(t.prototype.constructor=t,e),r}(n(Error))},"./src/loader/fragment.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"ElementaryStreamTypes",function(){return i}),r.d(e,"BaseSegment",function(){return f}),r.d(e,"Fragment",function(){return g}),r.d(e,"Part",function(){return v});var i,n=r("./src/polyfills/number.ts"),s=r("./node_modules/url-toolkit/src/url-toolkit.js"),a=r("./src/utils/logger.ts"),o=r("./src/loader/level-key.ts"),l=r("./src/loader/load-stats.ts");function u(t,e){t.prototype=Object.create(e.prototype),c(t.prototype.constructor=t,e)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e,r){return e&&d(t.prototype,e),r&&d(t,r),t}(r=i=i||{}).AUDIO="audio",r.VIDEO="video",r.AUDIOVIDEO="audiovideo";var f=function(){function t(t){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((e={})[i.AUDIO]=null,e[i.VIDEO]=null,e[i.AUDIOVIDEO]=null,e),this.baseurl=t}return t.prototype.setByteRange=function(t,e){var r=t.split("@",2),t=[];1===r.length?t[0]=e?e.byteRangeEndOffset:0:t[0]=parseInt(r[1]),t[1]=parseInt(r[0])+t[0],this._byteRange=t},h(t,[{key:"byteRange",get:function(){return this._byteRange||[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(s.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),t}(),g=function(r){function t(t,e){e=r.call(this,e)||this;return e._decryptdata=null,e.rawProgramDateTime=null,e.programDateTime=null,e.tagList=[],e.duration=0,e.sn=0,e.levelkey=void 0,e.type=void 0,e.loader=null,e.level=-1,e.cc=0,e.startPTS=void 0,e.endPTS=void 0,e.appendedPTS=void 0,e.startDTS=void 0,e.endDTS=void 0,e.start=0,e.deltaPTS=void 0,e.maxStartPTS=void 0,e.minEndPTS=void 0,e.stats=new l.LoadStats,e.urlId=0,e.data=void 0,e.bitrateTest=!1,e.title=null,e.initSegment=null,e.type=t,e}u(t,r);var e=t.prototype;return e.createInitializationVector=function(t){for(var e=new Uint8Array(16),r=12;r<16;r++)e[r]=t>>8*(15-r)&255;return e},e.setDecryptDataFromLevelKey=function(t,e){var r=t;return"AES-128"===(null==t?void 0:t.method)&&t.uri&&!t.iv&&((r=o.LevelKey.fromURI(t.uri)).method=t.method,r.iv=this.createInitializationVector(e),r.keyFormat="identity"),r},e.setElementaryStreamInfo=function(t,e,r,i,n,s){void 0===s&&(s=!1);var a=this.elementaryStreams,o=a[t];o?(o.startPTS=Math.min(o.startPTS,e),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,n)):a[t]={startPTS:e,endPTS:r,startDTS:i,endDTS:n,partial:s}},e.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[i.AUDIO]=null,t[i.VIDEO]=null,t[i.AUDIOVIDEO]=null},h(t,[{key:"decryptdata",get:function(){return this.levelkey||this._decryptdata?(!this._decryptdata&&this.levelkey&&("number"!=typeof(t=this.sn)&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&a.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),t=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,t)),this._decryptdata):null;var t}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(n.isFiniteNumber)(this.programDateTime))return null;var t=Object(n.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;return!(null===(t=this.decryptdata)||void 0===t||!t.keyFormat||!this.decryptdata.uri)}}]),t}(f),v=function(s){function t(t,e,r,i,n){r=s.call(this,r)||this;r.fragOffset=0,r.duration=0,r.gap=!1,r.independent=!1,r.relurl=void 0,r.fragment=void 0,r.index=void 0,r.stats=new l.LoadStats,r.duration=t.decimalFloatingPoint("DURATION"),r.gap=t.bool("GAP"),r.independent=t.bool("INDEPENDENT"),r.relurl=t.enumeratedString("URI"),r.fragment=e,r.index=i;t=t.enumeratedString("BYTERANGE");return t&&r.setByteRange(t,n),n&&(r.fragOffset=n.fragOffset+n.duration),r}return u(t,s),h(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),t}(f)},"./src/loader/key-loader.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return n});var a=r("./src/events.ts"),i=r("./src/errors.ts"),o=r("./src/utils/logger.ts"),n=function(){function t(t){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=t,this._registerListeners()}var e=t.prototype;return e._registerListeners=function(){this.hls.on(a.Events.KEY_LOADING,this.onKeyLoading,this)},e._unregisterListeners=function(){this.hls.off(a.Events.KEY_LOADING,this.onKeyLoading)},e.destroy=function(){for(var t in this._unregisterListeners(),this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={}},e.onKeyLoading=function(t,e){var r,i=e.frag,n=i.type,s=this.loaders[n];i.decryptdata?(r=i.decryptdata.uri)!==this.decrypturl||null===this.decryptkey?(e=this.hls.config,s&&(o.logger.warn("abort previous key loader for type:"+n),s.abort()),r?(s=e.loader,n=i.loader=this.loaders[n]=new s(e),this.decrypturl=r,this.decryptkey=null,s={url:r,frag:i,responseType:"arraybuffer"},r={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:e.fragLoadingRetryDelay,maxRetryDelay:e.fragLoadingMaxRetryTimeout,highWaterMark:0},e={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},n.load(s,r,e)):o.logger.warn("key uri is falsy")):this.decryptkey&&(i.decryptdata.key=this.decryptkey,this.hls.trigger(a.Events.KEY_LOADED,{frag:i})):o.logger.warn("Missing decryption data on fragment in onKeyLoading")},e.loadsuccess=function(t,e,r){r=r.frag;r.decryptdata?(this.decryptkey=r.decryptdata.key=new Uint8Array(t.data),r.loader=null,delete this.loaders[r.type],this.hls.trigger(a.Events.KEY_LOADED,{frag:r})):o.logger.error("after key load, decryptdata unset")},e.loaderror=function(t,e){var r=e.frag,e=r.loader;e&&e.abort(),delete this.loaders[r.type],this.hls.trigger(a.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:r,response:t})},e.loadtimeout=function(t,e){var r=e.frag,e=r.loader;e&&e.abort(),delete this.loaders[r.type],this.hls.trigger(a.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},t}()},"./src/loader/level-details.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"LevelDetails",function(){return i});var n=r("./src/polyfills/number.ts");function s(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var i=function(){function t(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=t}var e,r,i;return t.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var e=this.lastPartSn-t.lastPartSn,r=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!r||!!e,this.advanced=this.endSN>t.endSN||0<e||0==e&&0<r,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay},e=t,(r=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(n.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return 0<t?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return null!==(t=this.fragments)&&void 0!==t&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&s(e.prototype,r),i&&s(e,i),t}()},"./src/loader/level-key.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"LevelKey",function(){return i});var n=r("./node_modules/url-toolkit/src/url-toolkit.js");function s(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var i=function(){function r(t,e){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=e?Object(n.buildAbsoluteURL)(t,e,{alwaysNormalize:!0}):t}var t,e,i;return r.fromURL=function(t,e){return new r(t,e)},r.fromURI=function(t){return new r(t)},t=r,(e=[{key:"uri",get:function(){return this._uri}}])&&s(t.prototype,e),i&&s(t,i),r}()},"./src/loader/load-stats.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"LoadStats",function(){return i});var i=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var U=r("./src/polyfills/number.ts"),B=r("./node_modules/url-toolkit/src/url-toolkit.js"),G=r("./src/loader/fragment.ts"),j=r("./src/loader/level-details.ts"),K=r("./src/loader/level-key.ts"),H=r("./src/utils/attr-list.ts"),V=r("./src/utils/logger.ts"),c=r("./src/utils/codecs.ts"),d=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,l=/#EXT-X-MEDIA:(.*)/g,W=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Y=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),q=/\.(mp4|m4s|m4v|m4a)$/i;var i=function(){function u(){}return u.findGroup=function(t,e){for(var r=0;r<t.length;r++){var i=t[r];if(i.id===e)return i}},u.convertAVC1ToAVCOTI=function(t){var e=t.split(".");if(2<e.length){var r=e.shift()+".";return r+=parseInt(e.shift()).toString(16),r+=("000"+parseInt(e.shift()).toString(16)).substr(-4)}return t},u.resolve=function(t,e){return B.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},u.parseMasterPlaylist=function(t,e){var r,i,n,s,a=[],o={},l=!1;for(d.lastIndex=0;null!=(s=d.exec(t));)s[1]?(i={attrs:r=new H.AttrList(s[1]),bitrate:r.decimalInteger("AVERAGE-BANDWIDTH")||r.decimalInteger("BANDWIDTH"),name:r.NAME,url:u.resolve(s[2],e)},(n=r.decimalResolution("RESOLUTION"))&&(i.width=n.width,i.height=n.height),function(i,n){["video","audio","text"].forEach(function(e){var t,r=i.filter(function(t){return Object(c.isCodecType)(t,e)});r.length&&(t=r.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}),n[e+"Codec"]=(0<t.length?t:r)[0],i=i.filter(function(t){return-1===r.indexOf(t)}))}),n.unknownCodecs=i}((r.CODECS||"").split(/[ ,]+/).filter(function(t){return t}),i),i.videoCodec&&-1!==i.videoCodec.indexOf("avc1")&&(i.videoCodec=u.convertAVC1ToAVCOTI(i.videoCodec)),a.push(i)):!s[3]||(s=new H.AttrList(s[3]))["DATA-ID"]&&(l=!0,o[s["DATA-ID"]]=s);return{levels:a,sessionData:l?o:null}},u.parseMasterPlaylistMedia=function(t,e,r,i){void 0===i&&(i=[]);var n=[],s=0;for(l.lastIndex=0;null!==(a=l.exec(t));){var a,o=new H.AttrList(a[1]);o.TYPE===r&&(a={attrs:o,bitrate:0,id:s++,groupId:o["GROUP-ID"],instreamId:o["INSTREAM-ID"],name:o.NAME||o.LANGUAGE||"",type:r,default:o.bool("DEFAULT"),autoselect:o.bool("AUTOSELECT"),forced:o.bool("FORCED"),lang:o.LANGUAGE,url:o.URI?u.resolve(o.URI,e):""},i.length&&(h(a,o=u.findGroup(i,a.groupId)||i[0],"audioCodec"),h(a,o,"textCodec")),n.push(a))}return n},u.parseLevelPlaylist=function(t,e,r,i,n){var s,a,o,l=new j.LevelDetails(e),u=l.fragments,c=null,d=0,h=0,f=0,g=0,v=null,p=new G.Fragment(i,e),m=-1,y=!1;for(W.lastIndex=0,l.m3u8=t;null!==(s=W.exec(t));){y&&(y=!1,(p=new G.Fragment(i,e)).start=f,p.sn=d,p.cc=g,p.level=r,c&&(p.initSegment=c,p.rawProgramDateTime=c.rawProgramDateTime));var E=s[1];if(E){p.duration=parseFloat(E);var T=(" "+s[2]).slice(1);p.title=T||null,p.tagList.push(T?["INF",E,T]:["INF",E])}else if(s[3])Object(U.isFiniteNumber)(p.duration)&&(p.start=f,o&&(p.levelkey=o),p.sn=d,p.level=r,p.cc=g,p.urlId=n,u.push(p),p.relurl=(" "+s[3]).slice(1),X(p,v),f+=(v=p).duration,d++,y=!(h=0));else if(s[4]){E=(" "+s[4]).slice(1);v?p.setByteRange(E,v):p.setByteRange(E)}else if(s[5])p.rawProgramDateTime=(" "+s[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),-1===m&&(m=u.length);else if(s=s[0].match(Y)){for(a=1;a<s.length&&void 0===s[a];a++);var S=(" "+s[a]).slice(1),b=(" "+s[a+1]).slice(1),L=s[a+2]?(" "+s[a+2]).slice(1):"";switch(S){case"PLAYLIST-TYPE":l.type=b.toUpperCase();break;case"MEDIA-SEQUENCE":d=l.startSN=parseInt(b);break;case"SKIP":var A=new H.AttrList(b),D=A.decimalInteger("SKIPPED-SEGMENTS");if(Object(U.isFiniteNumber)(D)){for(var R=l.skippedSegments=D;R--;)u.unshift(null);d+=D}var k=A.enumeratedString("RECENTLY-REMOVED-DATERANGES");k&&(l.recentlyRemovedDateranges=k.split("\t"));break;case"TARGETDURATION":l.targetduration=parseFloat(b);break;case"VERSION":l.version=parseInt(b);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"#":(b||L)&&p.tagList.push(L?[b,L]:[b]);break;case"DIS":g++;case"GAP":p.tagList.push([S]);break;case"BITRATE":p.tagList.push([S,b]);break;case"DISCONTINUITY-SEQ":g=parseInt(b);break;case"KEY":var I=new H.AttrList(b),_=I.enumeratedString("METHOD"),D=I.URI,C=I.hexadecimalInteger("IV"),A=I.enumeratedString("KEYFORMATVERSIONS"),k=I.enumeratedString("KEYID"),I=null!=(I=I.enumeratedString("KEYFORMAT"))?I:"identity";if(-1<["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(I)){V.logger.warn("Keyformat "+I+" is not supported from the manifest");continue}if("identity"!==I)continue;_&&(o=K.LevelKey.fromURL(e,D),D&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(_)&&(o.method=_,o.keyFormat=I,k&&(o.keyID=k),A&&(o.keyFormatVersions=A),o.iv=C));break;case"START":C=new H.AttrList(b).decimalFloatingPoint("TIME-OFFSET");Object(U.isFiniteNumber)(C)&&(l.startTimeOffset=C);break;case"MAP":var O=new H.AttrList(b);p.relurl=O.URI,O.BYTERANGE&&p.setByteRange(O.BYTERANGE),p.level=r,p.sn="initSegment",o&&(p.levelkey=o),p.initSegment=null,c=p,y=!0;break;case"SERVER-CONTROL":var w=new H.AttrList(b);l.canBlockReload=w.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=w.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=0<l.canSkipUntil&&w.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=w.optionalFloat("PART-HOLD-BACK",0),l.holdBack=w.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var x=new H.AttrList(b);l.partTarget=x.decimalFloatingPoint("PART-TARGET");break;case"PART":O=(O=l.partList)||(l.partList=[]),w=0<h?O[O.length-1]:void 0,x=h++,w=new G.Part(new H.AttrList(b),p,e,x,w);O.push(w),p.duration+=w.duration;break;case"PRELOAD-HINT":var P=new H.AttrList(b);l.preloadHint=P;break;case"RENDITION-REPORT":P=new H.AttrList(b);l.renditionReports=l.renditionReports||[],l.renditionReports.push(P);break;default:V.logger.warn("line parsed but not handled: "+s)}}else V.logger.warn("No matches on slow regex match for level playlist!")}v&&!v.relurl?(u.pop(),f-=v.duration,l.partList&&(l.fragmentHint=v)):l.partList&&(X(p,v),p.cc=g,l.fragmentHint=p);var F=u.length,M=u[0],N=u[F-1];return 0<(f+=l.skippedSegments*l.targetduration)&&F&&N?(l.averagetargetduration=f/F,F=N.sn,l.endSN="initSegment"!==F?F:0,M&&(l.startCC=M.cc,M.initSegment||l.fragments.every(function(t){return t.relurl&&(t=t.relurl,q.test(null!=(t=null===(t=B.parseURL(t))||void 0===t?void 0:t.path)?t:""))})&&(V.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(p=new G.Fragment(i,e)).relurl=N.relurl,p.level=r,p.sn="initSegment",M.initSegment=p,l.needSidxRanges=!0))):(l.endSN=0,l.startCC=0),l.fragmentHint&&(f+=l.fragmentHint.duration),l.totalduration=f,l.endCC=g,0<m&&function(t){for(var e=t[m],r=m;r--;){var i=t[r];if(!i)return;i.programDateTime=e.programDateTime-1e3*i.duration,e=i}}(u),l},u}();function h(t,e,r){e=e[r];e&&(t[r]=e)}function X(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!=e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),Object(U.isFiniteNumber)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(t,e,r){"use strict";r.r(e);var f=r("./src/polyfills/number.ts"),g=r("./src/events.ts"),v=r("./src/errors.ts"),d=r("./src/utils/logger.ts"),n=r("./src/utils/mp4-tools.ts"),p=r("./src/loader/m3u8-parser.ts"),m=r("./src/types/loader.ts"),y=r("./src/utils/attr-list.ts");function E(t,e){t=t.url;return void 0!==t&&0!==t.indexOf("data:")||(t=e.url),t}r=function(){function t(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}var e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(g.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(g.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(g.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.unregisterListeners=function(){var t=this.hls;t.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(g.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(g.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(g.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.createInternalLoader=function(t){var e=this.hls.config,r=e.pLoader,i=e.loader,e=new(r||i)(e);return t.loader=e,this.loaders[t.type]=e},e.getInternalLoader=function(t){return this.loaders[t.type]},e.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},e.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},e.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},e.onManifestLoading=function(t,e){e=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:m.PlaylistContextType.MANIFEST,url:e,deliveryDirectives:null})},e.onLevelLoading=function(t,e){var r=e.id,i=e.level,n=e.url,e=e.deliveryDirectives;this.load({id:r,groupId:null,level:i,responseType:"text",type:m.PlaylistContextType.LEVEL,url:n,deliveryDirectives:e})},e.onAudioTrackLoading=function(t,e){var r=e.id,i=e.groupId,n=e.url,e=e.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:m.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:e})},e.onSubtitleTrackLoading=function(t,e){var r=e.id,i=e.groupId,n=e.url,e=e.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:m.PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:e})},e.load=function(t){var e,r,i,n,s,a=this.hls.config,o=this.getInternalLoader(t);if(o){var l=o.context;if(l&&l.url===t.url)return void d.logger.trace("[playlist-loader]: playlist request ongoing");d.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),o.abort()}switch(t.type){case m.PlaylistContextType.MANIFEST:e=a.manifestLoadingMaxRetry,r=a.manifestLoadingTimeOut,i=a.manifestLoadingRetryDelay,n=a.manifestLoadingMaxRetryTimeout;break;case m.PlaylistContextType.LEVEL:case m.PlaylistContextType.AUDIO_TRACK:case m.PlaylistContextType.SUBTITLE_TRACK:e=0,r=a.levelLoadingTimeOut;break;default:e=a.levelLoadingMaxRetry,r=a.levelLoadingTimeOut,i=a.levelLoadingRetryDelay,n=a.levelLoadingMaxRetryTimeout}o=this.createInternalLoader(t),null!==(l=t.deliveryDirectives)&&void 0!==l&&l.part&&(t.type===m.PlaylistContextType.LEVEL&&null!==t.level?s=this.hls.levels[t.level].details:t.type===m.PlaylistContextType.AUDIO_TRACK&&null!==t.id?s=this.hls.audioTracks[t.id].details:t.type===m.PlaylistContextType.SUBTITLE_TRACK&&null!==t.id&&(s=this.hls.subtitleTracks[t.id].details),s&&(u=s.partTarget,c=s.targetduration,u&&c&&(r=Math.min(1e3*Math.max(3*u,.8*c),r))));var u={timeout:r,maxRetry:e,retryDelay:i,maxRetryDelay:n,highWaterMark:0},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};o.load(t,u,c)},e.loadsuccess=function(t,e,r,i){if(void 0===i&&(i=null),r.isSidxRequest)return this.handleSidxRequest(t,r),void this.handlePlaylistLoaded(t,e,r,i);this.resetInternalLoader(r.type);var n=t.data;0===n.indexOf("#EXTM3U")?(e.parsing.start=performance.now(),0<n.indexOf("#EXTINF:")||0<n.indexOf("#EXT-X-TARGETDURATION:")?this.handleTrackOrLevelPlaylist(t,e,r,i):this.handleMasterPlaylist(t,e,r,i)):this.handleManifestParsingError(t,r,"no EXTM3U delimiter",i)},e.loaderror=function(t,e,r){void 0===r&&(r=null),this.handleNetworkError(e,r,!1,t)},e.loadtimeout=function(t,e,r){void 0===r&&(r=null),this.handleNetworkError(e,r,!0)},e.handleMasterPlaylist=function(t,e,r,i){var n,s=this.hls,a=t.data,o=E(t,r),l=p.default.parseMasterPlaylist(a,o),u=l.levels,c=l.sessionData;u.length?(n=u.map(function(t){return{id:t.attrs.AUDIO,audioCodec:t.audioCodec}}),l=u.map(function(t){return{id:t.attrs.SUBTITLES,textCodec:t.textCodec}}),n=p.default.parseMasterPlaylistMedia(a,o,"AUDIO",n),l=p.default.parseMasterPlaylistMedia(a,o,"SUBTITLES",l),a=p.default.parseMasterPlaylistMedia(a,o,"CLOSED-CAPTIONS"),n.length&&(n.some(function(t){return!t.url})||!u[0].audioCodec||u[0].attrs.AUDIO||(d.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),n.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new y.AttrList({}),bitrate:0,url:""}))),s.trigger(g.Events.MANIFEST_LOADED,{levels:u,audioTracks:n,subtitles:l,captions:a,url:o,stats:e,networkDetails:i,sessionData:c})):this.handleManifestParsingError(t,r,"no level found in manifest",i)},e.handleTrackOrLevelPlaylist=function(t,e,r,i){var n,s=this.hls,a=r.id,o=r.level,l=r.type,u=E(t,r),c=Object(f.isFiniteNumber)(a)?a:0,d=Object(f.isFiniteNumber)(o)?o:c,h=function(t){switch(t.type){case m.PlaylistContextType.AUDIO_TRACK:return m.PlaylistLevelType.AUDIO;case m.PlaylistContextType.SUBTITLE_TRACK:return m.PlaylistLevelType.SUBTITLE;default:return m.PlaylistLevelType.MAIN}}(r),c=p.default.parseLevelPlaylist(t.data,u,d,h,c);c.fragments.length?(l===m.PlaylistContextType.MANIFEST&&(n={attrs:new y.AttrList({}),bitrate:0,details:c,name:"",url:u},s.trigger(g.Events.MANIFEST_LOADED,{levels:[n],audioTracks:[],url:u,stats:e,networkDetails:i,sessionData:null})),e.parsing.end=performance.now(),c.needSidxRanges?(n=null===(n=c.fragments[0].initSegment)||void 0===n?void 0:n.url,this.load({url:n,isSidxRequest:!0,type:l,level:o,levelDetails:c,id:a,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})):(r.levelDetails=c,this.handlePlaylistLoaded(t,e,r,i))):s.trigger(g.Events.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:u,reason:"no fragments found in level",level:"number"==typeof r.level?r.level:void 0})},e.handleSidxRequest=function(t,e){var r,i=Object(n.parseSegmentIndex)(new Uint8Array(t.data));i&&(t=i.references,r=e.levelDetails,t.forEach(function(t,e){t=t.info,e=r.fragments[e];0===e.byteRange.length&&e.setByteRange(String(1+t.end-t.start)+"@"+String(t.start)),e.initSegment&&e.initSegment.setByteRange(String(i.moovEndOffset)+"@0")}))},e.handleManifestParsingError=function(t,e,r,i){this.hls.trigger(g.Events.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:e.type===m.PlaylistContextType.MANIFEST,url:t.url,reason:r,response:t,context:e,networkDetails:i})},e.handleNetworkError=function(t,e,r,i){void 0===r&&(r=!1),d.logger.warn("[playlist-loader]: A network "+(r?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var n=v.ErrorDetails.UNKNOWN,s=!1,a=this.getInternalLoader(t);switch(t.type){case m.PlaylistContextType.MANIFEST:n=r?v.ErrorDetails.MANIFEST_LOAD_TIMEOUT:v.ErrorDetails.MANIFEST_LOAD_ERROR,s=!0;break;case m.PlaylistContextType.LEVEL:n=r?v.ErrorDetails.LEVEL_LOAD_TIMEOUT:v.ErrorDetails.LEVEL_LOAD_ERROR,s=!1;break;case m.PlaylistContextType.AUDIO_TRACK:n=r?v.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:v.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,s=!1;break;case m.PlaylistContextType.SUBTITLE_TRACK:n=r?v.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:v.ErrorDetails.SUBTITLE_LOAD_ERROR,s=!1}a&&this.resetInternalLoader(t.type);e={type:v.ErrorTypes.NETWORK_ERROR,details:n,fatal:s,url:t.url,loader:a,context:t,networkDetails:e};i&&(e.response=i),this.hls.trigger(g.Events.ERROR,e)},e.handlePlaylistLoaded=function(t,e,r,i){var n=r.type,s=r.level,a=r.id,o=r.groupId,l=r.loader,u=r.levelDetails,c=r.deliveryDirectives;if(null!=u&&u.targetduration){if(l)switch(u.live&&(l.getCacheAge&&(u.ageHeader=l.getCacheAge()||0),l.getCacheAge&&!isNaN(u.ageHeader)||(u.ageHeader=0)),n){case m.PlaylistContextType.MANIFEST:case m.PlaylistContextType.LEVEL:this.hls.trigger(g.Events.LEVEL_LOADED,{details:u,level:s||0,id:a||0,stats:e,networkDetails:i,deliveryDirectives:c});break;case m.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(g.Events.AUDIO_TRACK_LOADED,{details:u,id:a||0,groupId:o||"",stats:e,networkDetails:i,deliveryDirectives:c});break;case m.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(g.Events.SUBTITLE_TRACK_LOADED,{details:u,id:a||0,groupId:o||"",stats:e,networkDetails:i,deliveryDirectives:c})}}else this.handleManifestParsingError(t,r,"invalid target duration",i)},t}();e.default=r},"./src/polyfills/number.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"isFiniteNumber",function(){return i}),r.d(e,"MAX_SAFE_INTEGER",function(){return n});var i=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},n=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(t,e,r){"use strict";r.r(e);r=function(){function t(){}return t.getSilentFrame=function(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},t}();e.default=r},"./src/remux/mp4-generator.ts":function(t,e,r){"use strict";r.r(e);var s=Math.pow(2,32)-1,r=function(){function d(){}return d.init=function(){for(var t in d.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})d.types.hasOwnProperty(t)&&(d.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);d.HDLR_TYPES={video:e,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);d.STTS=d.STSC=d.STCO=n,d.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),d.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),d.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),d.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);e=new Uint8Array([105,115,111,109]),r=new Uint8Array([97,118,99,49]),n=new Uint8Array([0,0,0,1]);d.FTYP=d.box(d.types.ftyp,e,n,e,r),d.DINF=d.box(d.types.dinf,d.box(d.types.dref,i))},d.box=function(t){for(var e=8,r=arguments.length,i=new Array(1<r?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];for(var s=i.length,a=s;s--;)e+=i[s].byteLength;var o=new Uint8Array(e);for(o[0]=e>>24&255,o[1]=e>>16&255,o[2]=e>>8&255,o[3]=255&e,o.set(t,4),s=0,e=8;s<a;s++)o.set(i[s],e),e+=i[s].byteLength;return o},d.hdlr=function(t){return d.box(d.types.hdlr,d.HDLR_TYPES[t])},d.mdat=function(t){return d.box(d.types.mdat,t)},d.mdhd=function(t,e){e*=t;var r=Math.floor(e/(1+s)),e=Math.floor(e%(1+s));return d.box(d.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))},d.mdia=function(t){return d.box(d.types.mdia,d.mdhd(t.timescale,t.duration),d.hdlr(t.type),d.minf(t))},d.mfhd=function(t){return d.box(d.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},d.minf=function(t){return"audio"===t.type?d.box(d.types.minf,d.box(d.types.smhd,d.SMHD),d.DINF,d.stbl(t)):d.box(d.types.minf,d.box(d.types.vmhd,d.VMHD),d.DINF,d.stbl(t))},d.moof=function(t,e,r){return d.box(d.types.moof,d.mfhd(t),d.traf(r,e))},d.moov=function(t){for(var e=t.length,r=[];e--;)r[e]=d.trak(t[e]);return d.box.apply(null,[d.types.moov,d.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(d.mvex(t)))},d.mvex=function(t){for(var e=t.length,r=[];e--;)r[e]=d.trex(t[e]);return d.box.apply(null,[d.types.mvex].concat(r))},d.mvhd=function(t,e){e*=t;var r=Math.floor(e/(1+s)),e=Math.floor(e%(1+s)),e=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,e>>24,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return d.box(d.types.mvhd,e)},d.sdtp=function(t){for(var e,r=t.samples||[],i=new Uint8Array(4+r.length),n=0;n<r.length;n++)e=r[n].flags,i[n+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return d.box(d.types.sdtp,i)},d.stbl=function(t){return d.box(d.types.stbl,d.stsd(t),d.box(d.types.stts,d.STTS),d.box(d.types.stsc,d.STSC),d.box(d.types.stsz,d.STSZ),d.box(d.types.stco,d.STCO))},d.avc1=function(t){for(var e,r,i=[],n=[],s=0;s<t.sps.length;s++)r=(e=t.sps[s]).byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(e));for(s=0;s<t.pps.length;s++)r=(e=t.pps[s]).byteLength,n.push(r>>>8&255),n.push(255&r),n=n.concat(Array.prototype.slice.call(e));var a=d.box(d.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(n))),o=t.width,l=t.height,u=t.pixelRatio[0],c=t.pixelRatio[1];return d.box(d.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,d.box(d.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),d.box(d.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c])))},d.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},d.mp4a=function(t){var e=t.samplerate;return d.box(d.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]),d.box(d.types.esds,d.esds(t)))},d.mp3=function(t){var e=t.samplerate;return d.box(d.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]))},d.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?d.box(d.types.stsd,d.STSD,d.mp4a(t)):d.box(d.types.stsd,d.STSD,d.mp3(t)):d.box(d.types.stsd,d.STSD,d.avc1(t))},d.tkhd=function(t){var e=t.id,r=t.duration*t.timescale,i=t.width,n=t.height,t=Math.floor(r/(1+s)),r=Math.floor(r%(1+s));return d.box(d.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,n>>8&255,255&n,0,0]))},d.traf=function(t,e){var r=d.sdtp(t),i=t.id,n=Math.floor(e/(1+s)),e=Math.floor(e%(1+s));return d.box(d.types.traf,d.box(d.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),d.box(d.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,e>>24,e>>16&255,e>>8&255,255&e])),d.trun(t,r.length+16+20+8+16+8+8),r)},d.trak=function(t){return t.duration=t.duration||4294967295,d.box(d.types.trak,d.tkhd(t),d.mdia(t))},d.trex=function(t){t=t.id;return d.box(d.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},d.trun=function(t,e){var r,i,n,s,a,o=t.samples||[],l=o.length,t=12+16*l,u=new Uint8Array(t);for(e+=8+t,u.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),r=0;r<l;r++)i=(a=o[r]).duration,n=a.size,s=a.flags,a=a.cts,u.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,a>>>24&255,a>>>16&255,a>>>8&255,255&a],12+16*r);return d.box(d.types.trun,u)},d.initSegment=function(t){d.types||d.init();var e=d.moov(t),t=new Uint8Array(d.FTYP.byteLength+e.byteLength);return t.set(d.FTYP),t.set(e,d.FTYP.byteLength),t},d}();r.types=void 0,r.HDLR_TYPES=void 0,r.STTS=void 0,r.STSC=void 0,r.STCO=void 0,r.STSZ=void 0,r.VMHD=void 0,r.SMHD=void 0,r.STSD=void 0,r.FTYP=void 0,r.DINF=void 0,e.default=r},"./src/remux/mp4-remuxer.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i}),r.d(e,"normalizePts",function(){return tt});var h=r("./src/polyfills/number.ts"),N=r("./src/remux/aac-helper.ts"),Y=r("./src/remux/mp4-generator.ts"),q=r("./src/events.ts"),X=r("./src/errors.ts"),z=r("./src/utils/logger.ts"),b=r("./src/types/loader.ts"),Q=r("./src/utils/timescale-conversion.ts");function $(){return($=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,i=arguments[e];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}var J=null,s=null,Z=!1,i=function(){function t(t,e,r,i){var n;void 0===i&&(i=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=e,this.typeSupported=r,this.ISGenerated=!1,null===J&&(n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),J=n?parseInt(n[1]):0),null===s&&(n=navigator.userAgent.match(/Safari\/(\d+)/i),s=n?parseInt(n[1]):0),Z=!!J&&J<75||!!s&&s<600}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){z.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},e.resetNextTimestamp=function(){z.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},e.resetInitSegment=function(){z.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},e.getVideoStartPts=function(t){var i=!1,t=t.reduce(function(t,e){var r=e.pts-t;return r<-4294967296?(i=!0,tt(t,e.pts)):0<r?t:e.pts},t[0].pts);return i&&z.logger.debug("PTS rollover detected"),t},e.remux=function(t,e,r,i,n,s,a,o){var l,u,c,d,h,f,g,v=n,p=n,m=-1<t.pid,y=-1<e.pid,E=e.samples.length,T=0<t.samples.length,S=1<E;return((!m||T)&&(!y||S)||this.ISGenerated||a)&&(this.ISGenerated||(u=this.generateIS(t,e,n)),h=this.isVideoContiguous,m=-1,S&&(m=function(t){for(var e=0;e<t.length;e++)if(t[e].key)return e;return-1}(e.samples),!h&&this.config.forceKeyFrameOnDiscontinuity&&(f=!0,0<m?(z.logger.warn("[mp4-remuxer]: Dropped "+m+" out of "+E+" video samples due to a missing keyframe"),a=this.getVideoStartPts(e.samples),e.samples=e.samples.slice(m),e.dropped+=m,p+=(e.samples[0].pts-a)/(e.timescale||9e4)):-1===m&&(z.logger.warn("[mp4-remuxer]: No keyframe found out of "+E+" video samples"),f=!1))),this.ISGenerated&&(T&&S&&(E=this.getVideoStartPts(e.samples),E=(tt(t.samples[0].pts,E)-E)/e.inputTimeScale,v+=Math.max(0,E),p+=Math.max(0,-E)),T?(t.samplerate||(z.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),u=this.generateIS(t,e,n)),l=this.remuxAudio(t,v,this.isAudioContiguous,s,y||S||o===b.PlaylistLevelType.AUDIO?p:void 0),S&&(g=l?l.endPTS-l.startPTS:0,e.inputTimeScale||(z.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),u=this.generateIS(t,e,n)),g=this.remuxVideo(e,p,h,g))):S&&(g=this.remuxVideo(e,p,h,0)),g&&(g.firstKeyFrame=m,g.independent=-1!==m))),this.ISGenerated&&(r.samples.length&&(d=this.remuxID3(r,n)),i.samples.length&&(c=this.remuxText(i,n))),{audio:l,video:g,initSegment:u,independent:f,text:c,id3:d}},e.generateIS=function(t,e,r){var i,n,s,a=t.samples,o=e.samples,l=this.typeSupported,u={},c=!Object(h.isFiniteNumber)(this._initPTS),d="audio/mp4";if(c&&(s=n=1/0),t.config&&a.length&&(t.timescale=t.samplerate,t.isAAC||(l.mpeg?(d="audio/mpeg",t.codec=""):l.mp3&&(t.codec="mp3")),u.audio={id:"audio",container:d,codec:t.codec,initSegment:!t.isAAC&&l.mpeg?new Uint8Array(0):Y.default.initSegment([t]),metadata:{channelCount:t.channelCount}},c&&(i=t.inputTimeScale,s=n=a[0].pts-Math.round(i*r))),e.sps&&e.pps&&o.length&&(e.timescale=e.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:Y.default.initSegment([e]),metadata:{width:e.width,height:e.height}},c&&(i=e.inputTimeScale,e=this.getVideoStartPts(o),r=Math.round(i*r),n=Math.min(n,tt(o[0].dts,e)-r),s=Math.min(s,e-r))),Object.keys(u).length)return this.ISGenerated=!0,c&&(this._initPTS=s,this._initDTS=n),{tracks:u,initPTS:s,timescale:i}},e.remuxVideo=function(t,e,r,i){var n,s,a=t.inputTimeScale,o=t.samples,l=[],u=o.length,c=this._initPTS,d=this.nextAvcDts,h=8,f=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,v=0,p=!1;r&&null!==d||(d=e*a-(o[0].pts-tt(o[0].dts,o[0].pts)));for(var m=0;m<u;m++){var y=o[m];y.pts=tt(y.pts-c,d),y.dts=tt(y.dts-c,d),y.dts>y.pts&&(v=Math.max(Math.min(v,y.pts-y.dts),-18e3)),y.dts<o[0<m?m-1:m].dts&&(p=!0)}p&&o.sort(function(t,e){var r=t.dts-e.dts,e=t.pts-e.pts;return r||e}),s=o[0].dts,e=o[o.length-1].dts;var E=Math.round((e-s)/(u-1));if(v<0){if(v<-2*E){z.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(Q.toMsFromMpegTsClock)(-E,!0)+" ms");for(var T=v,S=0;S<u;S++)o[S].dts=T=Math.max(T,o[S].pts-E),o[S].pts=Math.max(T,o[S].pts)}else{z.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(Q.toMsFromMpegTsClock)(v,!0)+" ms to overcome this issue");for(var b=0;b<u;b++)o[b].dts=o[b].dts+v}s=o[0].dts}!r||((r=E<(P=s-d))||P<-1)&&(r?z.logger.warn("AVC: "+Object(Q.toMsFromMpegTsClock)(P,!0)+" ms ("+P+"dts) hole between fragments detected, filling it"):z.logger.warn("AVC: "+Object(Q.toMsFromMpegTsClock)(-P,!0)+" ms ("+P+"dts) overlapping between fragments detected"),s=d,r=o[0].pts-P,o[0].dts=s,o[0].pts=r,z.logger.log("Video: First PTS/DTS adjusted: "+Object(Q.toMsFromMpegTsClock)(r,!0)+"/"+Object(Q.toMsFromMpegTsClock)(s,!0)+", delta: "+Object(Q.toMsFromMpegTsClock)(P,!0)+" ms")),Z&&(s=Math.max(0,s));for(var L=0,A=0,D=0;D<u;D++){for(var R=o[D],k=R.units,I=k.length,_=0,C=0;C<I;C++)_+=k[C].data.length;A+=_,L+=I,R.length=_,R.dts=Math.max(R.dts,s),R.pts=Math.max(R.pts,R.dts,0),f=Math.min(R.pts,f),g=Math.max(R.pts,g)}e=o[u-1].dts;var O,w=A+4*L+8;try{O=new Uint8Array(w)}catch(t){return void this.observer.emit(q.Events.ERROR,q.Events.ERROR,{type:X.ErrorTypes.MUX_ERROR,details:X.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:w,reason:"fail allocating video mdat "+w})}var x=new DataView(O.buffer);x.setUint32(0,w),O.set(Y.default.types.mdat,4);for(var P,F=0;F<u;F++){for(var M,N,U=o[F],B=U.units,G=0,j=0,K=B.length;j<K;j++){var H=B[j],V=H.data,H=H.data.byteLength;x.setUint32(h,H),h+=4,O.set(V,h),h+=H,G+=4+H}F<u-1?n=o[F+1].dts-U.dts:(M=this.config,W=U.dts-o[0<F?F-1:F].dts,M.stretchShortVideoTrack&&null!==this.nextAudioPts&&Math.floor(M.maxBufferHole*a)<(N=(i?f+i*a:this.nextAudioPts)-U.pts)?((n=N-W)<0&&(n=W),z.logger.log("[mp4-remuxer]: It is approximately "+N/90+" ms to the next segment; using duration "+n/90+" ms for the last video frame.")):n=W);var W=Math.round(U.pts-U.dts);l.push(new et(U.key,n,G,W))}l.length&&J&&J<70&&((P=l[0].flags).dependsOn=2,P.isNonSync=0),console.assert(void 0!==n,"mp4SampleDuration must be computed"),this.nextAvcDts=d=e+n,this.isVideoContiguous=!0;e={data1:Y.default.moof(t.sequenceNumber++,s,$({},t,{samples:l})),data2:O,startPTS:f/a,endPTS:(g+n)/a,startDTS:s/a,endDTS:d/a,type:"video",hasAudio:!1,hasVideo:!0,nb:l.length,dropped:t.dropped};return t.samples=[],t.dropped=0,console.assert(O.length,"MDAT length must not be zero"),e},e.remuxAudio=function(t,e,r,i,n){var s=t.inputTimeScale,a=s/(t.samplerate||s),o=t.isAAC?1024:1152,l=o*a,u=this._initPTS,c=!t.isAAC&&this.typeSupported.mpeg,d=[],h=t.samples,f=c?0:8,g=this.nextAudioPts||-1,v=e*s;if(this.isAudioContiguous=r=r||h.length&&0<g&&(i&&Math.abs(v-g)<9e3||Math.abs(tt(h[0].pts-u,v)-g)<20*l),h.forEach(function(t){t.pts=tt(t.pts-u,v)}),!r||g<0){if(!(h=h.filter(function(t){return 0<=t.pts})).length)return;g=0===n?0:i?Math.max(0,v):h[0].pts}if(t.isAAC)for(var p=void 0!==n,m=this.config.maxAudioFramesDrift,y=0,E=g;y<h.length;y++){var T=h[y],S=T.pts,b=S-E,L=Math.abs(1e3*b/s);if(b<=-m*l&&p)0===y&&(z.logger.warn("Audio frame @ "+(S/s).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*b/s)+" ms."),this.nextAudioPts=g=E=S);else if(m*l<=b&&L<1e4&&p){var A=Math.round(b/l);(E=S-A*l)<0&&(A--,E+=l),0===y&&(this.nextAudioPts=g=E),z.logger.warn("[mp4-remuxer]: Injecting "+A+" audio frame @ "+(E/s).toFixed(3)+"s due to "+Math.round(1e3*b/s)+" ms gap.");for(var D=0;D<A;D++){var R=Math.max(E,0),k=N.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);k||(z.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),k=T.unit.subarray()),h.splice(y,0,{unit:k,pts:R}),E+=l,y++}}T.pts=E,E+=l}for(var I,_=null,C=null,O=0,w=h.length;w--;)O+=h[w].unit.byteLength;for(var x=0,P=h.length;x<P;x++){var F=h[x],M=F.unit,F=F.pts;if(null!==C)d[x-1].duration=Math.round((F-C)/a);else{if(r&&t.isAAC&&(F=g),_=F,!(0<O))return;O+=f;try{I=new Uint8Array(O)}catch(t){return void this.observer.emit(q.Events.ERROR,q.Events.ERROR,{type:X.ErrorTypes.MUX_ERROR,details:X.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:O,reason:"fail allocating audio mdat "+O})}c||(new DataView(I.buffer).setUint32(0,O),I.set(Y.default.types.mdat,4))}I.set(M,f);M=M.byteLength;f+=M,d.push(new et(!0,o,M,0)),C=F}e=d.length;if(e){i=d[d.length-1];this.nextAudioPts=g=C+a*i.duration;n=_/s,i=g/s,e={data1:c?new Uint8Array(0):Y.default.moof(t.sequenceNumber++,_/a,$({},t,{samples:d})),data2:I,startPTS:n,endPTS:i,startDTS:n,endDTS:i,type:"audio",hasAudio:!0,hasVideo:!(t.samples=[]),nb:e};return this.isAudioContiguous=!0,console.assert(I.length,"MDAT length must not be zero"),e}},e.remuxEmptyAudio=function(t,e,r,i){var n=t.inputTimeScale,s=n/(t.samplerate||n),a=this.nextAudioPts,o=(null!==a?a:i.startDTS*n)+this._initDTS,n=i.endDTS*n+this._initDTS,l=1024*s,u=Math.ceil((n-o)/l),c=N.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(z.logger.warn("[mp4-remuxer]: remux empty Audio"),c){for(var d=[],h=0;h<u;h++){var f=o+h*l;d.push({unit:c,pts:f,dts:f})}return t.samples=d,this.remuxAudio(t,e,r,!1)}z.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},e.remuxID3=function(t,e){var r=t.samples.length;if(r){for(var i=t.inputTimeScale,n=this._initPTS,s=this._initDTS,a=0;a<r;a++){var o=t.samples[a];o.pts=tt(o.pts-n,e*i)/i,o.dts=tt(o.dts-s,e*i)/i}var l=t.samples;return t.samples=[],{samples:l}}},e.remuxText=function(t,e){var r=t.samples.length;if(r){for(var i=t.inputTimeScale,n=this._initPTS,s=0;s<r;s++){var a=t.samples[s];a.pts=tt(a.pts-n,e*i)/i}t.samples.sort(function(t,e){return t.pts-e.pts});var o=t.samples;return t.samples=[],{samples:o}}},t}();function tt(t,e){var r;if(null===e)return t;for(r=e<t?-8589934592:8589934592;4294967296<Math.abs(t-e);)t+=r;return t}var et=function(t,e,r,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=r,this.cts=i,this.flags=new n(t)},n=function(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}},"./src/remux/passthrough-remuxer.ts":function(t,e,r){"use strict";r.r(e);var d=r("./src/polyfills/number.ts"),h=r("./src/utils/mp4-tools.ts"),s=r("./src/loader/fragment.ts"),f=r("./src/utils/logger.ts"),r=function(){function t(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){this.initPTS=t,this.lastEndDTS=null},e.resetNextTimestamp=function(){this.lastEndDTS=null},e.resetInitSegment=function(t,e,r){this.audioCodec=e,this.videoCodec=r,this.generateInitSegment(t),this.emitInitSegment=!0},e.generateInitSegment=function(t){var e=this.audioCodec,r=this.videoCodec;if(!t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=Object(h.parseInitSegment)(t),e=e||a(i.audio,s.ElementaryStreamTypes.AUDIO),r=r||a(i.video,s.ElementaryStreamTypes.VIDEO),n={};i.audio&&i.video?n.audiovideo={container:"video/mp4",codec:e+","+r,initSegment:t,id:"main"}:i.audio?n.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:i.video?n.video={container:"video/mp4",codec:r,initSegment:t,id:"main"}:f.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n},e.remux=function(t,e,r,i,n){var s=this.initPTS,a=this.lastEndDTS,o={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};Object(d.isFiniteNumber)(a)||(a=this.lastEndDTS=n||0);var l=e.samples;if(!l||!l.length)return o;var u={initPTS:void 0,timescale:1},c=this.initData;if(c&&c.length||(this.generateInitSegment(l),c=this.initData),!c||!c.length)return f.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),o;this.emitInitSegment&&(u.tracks=this.initTracks,this.emitInitSegment=!1),Object(d.isFiniteNumber)(s)||(this.initPTS=u.initPTS=s=g(c,l,a));n=Object(h.getDuration)(l,c),e=a,a=n+e;Object(h.offsetStartDTS)(c,l,s),0<n?this.lastEndDTS=a:(f.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());s=!!c.audio,n=!!c.video,c="";s&&(c+="audio"),n&&(c+="video");n={data1:l,startPTS:e,startDTS:e,endPTS:a,endDTS:a,type:c,hasAudio:s,hasVideo:n,nb:1,dropped:0};return o.audio="audio"===n.type?n:void 0,o.video="audio"!==n.type?n:void 0,o.text=i,o.id3=r,o.initSegment=u,o},t}(),g=function(t,e,r){return Object(h.getStartDTS)(t,e)-r};function a(t,e){t=null==t?void 0:t.codec;return t&&4<t.length?t:"hvc1"===t?"hvc1.1.c.L120.90":"av01"===t?"av01.0.04M.08":"avc1"===t||e===s.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}e.default=r},"./src/task-loop.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var i=function(){function t(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var e=t.prototype;return e.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},e.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},e.onHandlerDestroyed=function(){},e.hasInterval=function(){return!!this._tickInterval},e.hasNextTick=function(){return!!this._tickTimer},e.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},e.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),!(this._tickInterval=null))},e.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),!(this._tickTimer=null))},e.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&this.tickImmediate(),this._tickCallCount=0)},e.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},e.doTick=function(){},t}()},"./src/types/cmcd.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"CMCDVersion",function(){return a}),r.d(e,"CMCDObjectType",function(){return i}),r.d(e,"CMCDStreamingFormat",function(){return n}),r.d(e,"CMCDStreamType",function(){return s});var i,n,s,a=1;(e=i=i||{}).MANIFEST="m",e.AUDIO="a",e.VIDEO="v",e.MUXED="av",e.INIT="i",e.CAPTION="c",e.TIMED_TEXT="tt",e.KEY="k",e.OTHER="o",(e=n=n||{}).DASH="d",e.HLS="h",e.SMOOTH="s",e.OTHER="o",(e=s=s||{}).VOD="v",e.LIVE="l"},"./src/types/level.ts":function(t,e,r){"use strict";function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var s;function i(t,e){var r=t.canSkipUntil,i=t.canSkipDateRanges,t=t.endSN;return r&&(void 0!==e?e-t:0)<r?i?s.v2:s.Yes:s.No}r.r(e),r.d(e,"HlsSkip",function(){return s}),r.d(e,"getSkipValue",function(){return i}),r.d(e,"HlsUrlParameters",function(){return a}),r.d(e,"Level",function(){return o}),(e=s=s||{}).No="",e.Yes="YES",e.v2="v2";var a=function(){function t(t,e,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=r}return t.prototype.addDirectives=function(t){t=new self.URL(t);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.toString()},t}(),o=function(){function t(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(function(t){return t}).join(",").replace(/\.[^.,]+/g,"")}var e,r,i;return e=t,(r=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){t%=this.url.length;this._urlId!==t&&(this.details=void 0,this._urlId=t)}}])&&n(e.prototype,r),i&&n(e,i),t}()},"./src/types/loader.ts":function(t,e,r){"use strict";var i,n;r.r(e),r.d(e,"PlaylistContextType",function(){return i}),r.d(e,"PlaylistLevelType",function(){return n}),(e=i=i||{}).MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack",(e=n=n||{}).MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"ChunkMetadata",function(){return i});var i=function(t,e,r,i,n,s){void 0===i&&(i=0),void 0===n&&(n=-1),void 0===s&&(s=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=a(),this.buffering={audio:a(),video:a(),audiovideo:a()},this.level=t,this.sn=e,this.id=r,this.size=i,this.part=n,this.partial=s};function a(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"AttrList",function(){return s});var i=/^(\d+)x(\d+)$/,n=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function r(t){for(var e in"string"==typeof t&&(t=r.parseAttrList(t)),t)t.hasOwnProperty(e)&&(this[e]=t[e])}var t=r.prototype;return t.decimalInteger=function(t){t=parseInt(this[t],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(t){if(this[t]){for(var e=(1&(e=(this[t]||"0x").slice(2)).length?"0":"")+e,r=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)r[i]=parseInt(e.slice(2*i,2*i+2),16);return r}return null},t.hexadecimalIntegerAsNumber=function(t){t=parseInt(this[t],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(t){return parseFloat(this[t])},t.optionalFloat=function(t,e){t=this[t];return t?parseFloat(t):e},t.enumeratedString=function(t){return this[t]},t.bool=function(t){return"YES"===this[t]},t.decimalResolution=function(t){t=i.exec(this[t]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},r.parseAttrList=function(t){var e,r={};for(n.lastIndex=0;null!==(e=n.exec(t));){var i=e[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[e[1]]=i}return r},r}()},"./src/utils/binary-search.ts":function(t,e,r){"use strict";r.r(e);e.default={search:function(t,e){for(var r,i,n=0,s=t.length-1;n<=s;){var a=e(i=t[r=(n+s)/2|0]);if(0<a)n=1+r;else{if(!(a<0))return i;s=r-1}}return null}}},"./src/utils/buffer-helper.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"BufferHelper",function(){return s});var i=r("./src/utils/logger.ts"),n={length:0,start:function(){return 0},end:function(){return 0}},s=function(){function a(){}return a.isBuffered=function(t,e){try{if(t)for(var r=a.getBuffered(t),i=0;i<r.length;i++)if(e>=r.start(i)&&e<=r.end(i))return!0}catch(t){}return!1},a.bufferInfo=function(t,e,r){try{if(t){for(var i=a.getBuffered(t),n=[],s=0;s<i.length;s++)n.push({start:i.start(s),end:i.end(s)});return this.bufferedInfo(n,e,r)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},a.bufferedInfo=function(t,e,r){e=Math.max(0,e),t.sort(function(t,e){var r=t.start-e.start;return r||e.end-t.end});var i=[];if(r)for(var n=0;n<t.length;n++){var s,a=i.length;a?(s=i[a-1].end,t[n].start-s<r?t[n].end>s&&(i[a-1].end=t[n].end):i.push(t[n])):i.push(t[n])}else i=t;for(var o,l=0,u=e,c=e,d=0;d<i.length;d++){var h=i[d].start,f=i[d].end;if(h<=e+r&&e<f)u=h,l=(c=f)-e;else if(e+r<h){o=h;break}}return{len:l,start:u||0,end:c||0,nextStart:o}},a.getBuffered=function(t){try{return t.buffered}catch(t){return i.logger.log("failed to get media.buffered",t),n}},a}()},"./src/utils/cea-608-parser.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"Row",function(){return p}),r.d(e,"CaptionScreen",function(){return m});function a(t){var e=t;return n.hasOwnProperty(t)&&(e=n[t]),String.fromCharCode(e)}var l,i=r("./src/utils/logger.ts"),n={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},o={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},u={17:2,18:4,21:6,22:8,23:10,19:13,20:15},c={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},d={25:2,26:4,29:6,30:8,31:10,27:13,28:15},s=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(r=l=l||{})[r.ERROR=0]="ERROR",r[r.TEXT=1]="TEXT",r[r.WARNING=2]="WARNING",r[r.INFO=2]="INFO",r[r.DEBUG=3]="DEBUG",r[r.DATA=3]="DATA";function h(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].toString(16));return e}var f=function(){function t(){this.time=null,this.verboseLevel=l.ERROR}return t.prototype.log=function(t,e){this.verboseLevel>=t&&i.logger.log(this.time+" ["+t+"] "+e)},t}(),g=function(){function t(t,e,r,i,n){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=r||!1,this.background=i||"black",this.flash=n||!1}var e=t.prototype;return e.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],r=0;r<e.length;r++){var i=e[r];t.hasOwnProperty(i)&&(this[i]=t[i])}},e.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},e.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},e.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),v=function(){function t(t,e,r,i,n,s){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new g(e,r,i,n,s)}var e=t.prototype;return e.reset=function(){this.uchar=" ",this.penState.reset()},e.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},e.setPenState=function(t){this.penState.copy(t)},e.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},e.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},e.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),p=function(){function t(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<100;e++)this.chars.push(new v);this.logger=t,this.pos=0,this.currPenState=new g}var e=t.prototype;return e.equals=function(t){for(var e=!0,r=0;r<100;r++)if(!this.chars[r].equals(t.chars[r])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<100;e++)this.chars[e].copy(t.chars[e])},e.isEmpty=function(){for(var t=!0,e=0;e<100;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},e.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(l.DEBUG,"Negative cursor position "+this.pos),this.pos=0):100<this.pos&&(this.logger.log(l.DEBUG,"Too large cursor position "+this.pos),this.pos=100)},e.moveCursor=function(t){var e=this.pos+t;if(1<t)for(var r=this.pos+1;r<e+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(e)},e.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.insertChar=function(t){144<=t&&this.backSpace();var e=a(t);100<=this.pos?this.logger.log(l.ERROR,"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},e.clearFromPos=function(t){for(var e=t;e<100;e++)this.chars[e].reset()},e.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.getTextString=function(){for(var t=[],e=!0,r=0;r<100;r++){var i=this.chars[r].uchar;" "!==i&&(e=!1),t.push(i)}return e?"":t.join("")},e.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),m=function(){function t(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<15;e++)this.rows.push(new p(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var e=t.prototype;return e.reset=function(){for(var t=0;t<15;t++)this.rows[t].clear();this.currRow=14},e.equals=function(t){for(var e=!0,r=0;r<15;r++)if(!this.rows[r].equals(t.rows[r])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<15;e++)this.rows[e].copy(t.rows[e])},e.isEmpty=function(){for(var t=!0,e=0;e<15;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},e.backSpace=function(){this.rows[this.currRow].backSpace()},e.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.insertChar=function(t){this.rows[this.currRow].insertChar(t)},e.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},e.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},e.setCursor=function(t){this.logger.log(l.INFO,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},e.setPAC=function(t){this.logger.log(l.INFO,"pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var r=0;r<15;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var s=n.rows[i].cueStartTime,a=this.logger.time;if(s&&null!==a&&s<a)for(var o=0;o<this.nrRollUpRows;o++)this.rows[e-this.nrRollUpRows+o+1].copy(n.rows[i+o])}}this.currRow=e;s=this.rows[this.currRow];null!==t.indent&&(a=t.indent,a=Math.max(a-1,0),s.setCursor(t.indent),t.color=s.chars[a].penState.foreground);t={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(t)},e.setBkgData=function(t){this.logger.log(l.INFO,"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},e.setRollUpRows=function(t){this.nrRollUpRows=t},e.rollUp=function(){var t;null!==this.nrRollUpRows?(this.logger.log(l.TEXT,this.getDisplayText()),t=this.currRow+1-this.nrRollUpRows,(t=this.rows.splice(t,1)[0]).clear(),this.rows.splice(this.currRow,0,t),this.logger.log(l.INFO,"Rolling up")):this.logger.log(l.DEBUG,"roll_up but nrRollUpRows not set yet")},e.getDisplayText=function(t){t=t||!1;for(var e,r=[],i="",n=0;n<15;n++){var s=this.rows[n].getTextString();s&&(e=n+1,t?r.push("Row "+e+": '"+s+"'"):r.push(s.trim()))}return 0<r.length&&(i=t?"["+r.join(" | ")+"]":r.join("\n")),i},e.getTextAndFormat=function(){return this.rows},t}(),y=function(){function t(t,e,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new m(r),this.nonDisplayedMemory=new m(r),this.lastOutputScreen=new m(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var e=t.prototype;return e.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},e.getHandler=function(){return this.outputFilter},e.setHandler=function(t){this.outputFilter=t},e.setPAC=function(t){this.writeScreen.setPAC(t)},e.setBkgData=function(t){this.writeScreen.setBkgData(t)},e.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(l.INFO,"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},e.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(l.INFO,r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(l.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.ccRCL=function(){this.logger.log(l.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.ccBS=function(){this.logger.log(l.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.ccAOF=function(){},e.ccAON=function(){},e.ccDER=function(){this.logger.log(l.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.ccRU=function(t){this.logger.log(l.INFO,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},e.ccFON=function(){this.logger.log(l.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.ccRDC=function(){this.logger.log(l.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.ccTR=function(){this.logger.log(l.INFO,"TR"),this.setMode("MODE_TEXT")},e.ccRTD=function(){this.logger.log(l.INFO,"RTD"),this.setMode("MODE_TEXT")},e.ccEDM=function(){this.logger.log(l.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.ccCR=function(){this.logger.log(l.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.ccENM=function(){this.logger.log(l.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.ccEOC=function(){var t;this.logger.log(l.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode&&(t=this.displayedMemory,this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(l.TEXT,"DISP: "+this.displayedMemory.getDisplayText())),this.outputDataUpdate(!0)},e.ccTO=function(t){this.logger.log(l.INFO,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},e.ccMIDROW=function(t){var e={flash:!1};e.underline=t%2==1,e.italics=46<=t,e.italics?e.foreground="white":(t=Math.floor(t/2)-16,e.foreground=["white","green","blue","cyan","red","yellow","magenta"][t]),this.logger.log(l.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},e.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},e.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}(),r=function(){function t(t,e,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var i=new f;this.channels=[null,new y(t,e,i),new y(t+1,r,i)],this.cmdHistory=S(),this.logger=i}var e=t.prototype;return e.getHandler=function(t){return this.channels[t].getHandler()},e.setHandler=function(t,e){this.channels[t].setHandler(e)},e.addData=function(t,e){var r,i=!1;this.logger.time=t;for(var n=0;n<e.length;n+=2){var s,a=127&e[n],o=127&e[n+1];0==a&&0==o||(this.logger.log(l.DATA,"["+h([e[n],e[n+1]])+"] -> ("+h([a,o])+")"),(r=(r=(r=(r=this.parseCmd(a,o))||this.parseMidrow(a,o))||this.parsePAC(a,o))||this.parseBackgroundAttributes(a,o))||(i=this.parseChars(a,o))&&((s=this.currentChannel)&&0<s?this.channels[s].insertChars(i):this.logger.log(l.WARNING,"No channel found yet. TEXT-MODE?")),r||i||this.logger.log(l.WARNING,"Couldn't parse cleaned data "+h([a,o])+" orig: "+h([e[n],e[n+1]])))}},e.parseCmd=function(t,e){var r=this.cmdHistory;if(!((20===t||28===t||21===t||29===t)&&32<=e&&e<=47)&&!((23===t||31===t)&&33<=e&&e<=35))return!1;if(T(t,e,r))return E(null,null,r),this.logger.log(l.DEBUG,"Repeated command ("+h([t,e])+") is dropped"),!0;var i=20===t||21===t||23===t?1:2,n=this.channels[i];return 20===t||21===t||28===t||29===t?32===e?n.ccRCL():33===e?n.ccBS():34===e?n.ccAOF():35===e?n.ccAON():36===e?n.ccDER():37===e?n.ccRU(2):38===e?n.ccRU(3):39===e?n.ccRU(4):40===e?n.ccFON():41===e?n.ccRDC():42===e?n.ccTR():43===e?n.ccRTD():44===e?n.ccEDM():45===e?n.ccCR():46===e?n.ccENM():47===e&&n.ccEOC():n.ccTO(e-32),E(t,e,r),this.currentChannel=i,!0},e.parseMidrow=function(t,e){var r=0;if((17===t||25===t)&&32<=e&&e<=47){if((r=17===t?1:2)!==this.currentChannel)return this.logger.log(l.ERROR,"Mismatch channel in midrow parsing"),!1;r=this.channels[r];return r?(r.ccMIDROW(e),this.logger.log(l.DEBUG,"MIDROW ("+h([t,e])+")"),!0):!1}return!1},e.parsePAC=function(t,e){var r=this.cmdHistory;if(!((17<=t&&t<=23||25<=t&&t<=31)&&64<=e&&e<=127)&&!((16===t||24===t)&&64<=e&&e<=95))return!1;if(T(t,e,r))return E(null,null,r),!0;var i=t<=23?1:2,n=(64<=e&&e<=95?1==i?o:c:1==i?u:d)[t],s=this.channels[i];return!!s&&(s.setPAC(this.interpretPAC(n,e)),E(t,e,r),this.currentChannel=i,!0)},e.interpretPAC=function(t,e){t={color:null,italics:!1,indent:null,underline:!1,row:t},e=95<e?e-96:e-64;return t.underline=1==(1&e),e<=13?t.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(e/2)]:e<=15?(t.italics=!0,t.color="white"):t.indent=4*Math.floor((e-16)/2),t},e.parseChars=function(t,e){var r,i,n=null,s=null;return 17<=(s=25<=t?(r=2,t-8):(r=1,t))&&s<=19?(i=17===s?e+80:18===s?e+112:e+144,this.logger.log(l.INFO,"Special char '"+a(i)+"' in channel "+r),n=[i]):32<=t&&t<=127&&(n=0===e?[t]:[t,e]),n&&(i=h(n),this.logger.log(l.DEBUG,"Char codes =  "+i.join(",")),E(t,e,this.cmdHistory)),n},e.parseBackgroundAttributes=function(t,e){if(!((16===t||24===t)&&32<=e&&e<=47)&&!((23===t||31===t)&&45<=e&&e<=47))return!1;var r={};16===t||24===t?(i=Math.floor((e-32)/2),r.background=s[i],e%2==1&&(r.background=r.background+"_semi")):45===e?r.background="transparent":(r.foreground="black",47===e&&(r.underline=!0));var i=t<=23?1:2;return this.channels[i].setBkgData(r),E(t,e,this.cmdHistory),!0},e.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var e=this.channels[t];e&&e.reset()}this.cmdHistory=S()},e.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++){var r=this.channels[e];r&&r.cueSplitAtTime(t)}},t}();function E(t,e,r){r.a=t,r.b=e}function T(t,e,r){return r.a===t&&r.b===e}function S(){return{a:null,b:null}}e.default=r},"./src/utils/codecs.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"isCodecType",function(){return n}),r.d(e,"isCodecSupportedInMp4",function(){return s});var i={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function n(t,e){e=i[e];return!!e&&!0===e[t.slice(0,4)]}function s(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}},"./src/utils/cues.ts":function(t,e,r){"use strict";r.r(e);var g=r("./src/utils/vttparser.ts"),v=r("./src/utils/webvtt-parser.ts"),p=r("./src/utils/texttrack-utils.ts"),m=/\s/,r={newCue:function(e,t,r,i){for(var n,s,a,o,l=[],u=self.VTTCue||self.TextTrackCue,c=0;c<i.rows.length;c++)if(s=!0,a=0,o="",!(n=i.rows[c]).isEmpty()){for(var d=0;d<n.chars.length;d++)m.test(n.chars[d].uchar)&&s?a++:(o+=n.chars[d].uchar,s=!1);(n.cueStartTime=t)===r&&(r+=1e-4),16<=a?a--:a++;var h=Object(g.fixLineBreaks)(o.trim()),f=Object(v.generateCueId)(t,r,h);e&&e.cues&&e.cues.getCueById(f)||((h=new u(t,r,h)).id=f,h.line=c+1,h.align="left",h.position=10+Math.min(80,10*Math.floor(8*a/32)),l.push(h))}return e&&l.length&&(l.sort(function(t,e){return"auto"===t.line||"auto"===e.line?0:8<t.line&&8<e.line?e.line-t.line:t.line-e.line}),l.forEach(function(t){return Object(p.addCueToTrack)(e,t)})),l}};e.default=r},"./src/utils/discontinuities.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"findFirstFragWithCC",function(){return i}),r.d(e,"shouldAlignOnDiscontinuities",function(){return o}),r.d(e,"findDiscontinuousReferenceFrag",function(){return l}),r.d(e,"adjustSlidingStart",function(){return c}),r.d(e,"alignStream",function(){return d}),r.d(e,"alignPDT",function(){return h}),r.d(e,"alignFragmentByPDTDelta",function(){return f}),r.d(e,"alignMediaPlaylistByPDT",function(){return g});var n=r("./src/polyfills/number.ts"),s=r("./src/utils/logger.ts"),a=r("./src/controller/level-helper.ts");function i(t,e){for(var r=null,i=0,n=t.length;i<n;i++){var s=t[i];if(s&&s.cc===e){r=s;break}}return r}function o(t,e,r){return!(!e.details||!(r.endCC>r.startCC||t&&t.cc<r.startCC))}function l(t,e){t=t.fragments,e=e.fragments;if(e.length&&t.length){e=i(t,e[0].cc);if(e&&(!e||e.startPTS))return e;s.logger.log("No frag in previous level to align on")}else s.logger.log("No fragments to align")}function u(t,e){t&&(e=t.start+e,t.start=t.startPTS=e,t.endPTS=e+t.duration)}function c(t,e){for(var r=e.fragments,i=0,n=r.length;i<n;i++)u(r[i],t);e.fragmentHint&&u(e.fragmentHint,t),e.alignedSliding=!0}function d(t,e,r){var i;e&&(!o(t,i=e,t=r)||(i=l(i.details,t))&&Object(n.isFiniteNumber)(i.start)&&(s.logger.log("Adjusting PTS using last level due to CC increase within current level "+t.url),c(i.start,t)),!r.alignedSliding&&e.details&&h(r,e.details),r.alignedSliding||!e.details||r.skippedSegments||Object(a.adjustSliding)(e.details,r))}function h(t,e){var r,i;e.fragments.length&&t.hasProgramDateTime&&e.hasProgramDateTime&&(r=e.fragments[0].programDateTime,(e=((i=t.fragments[0].programDateTime)-r)/1e3+e.fragments[0].start)&&Object(n.isFiniteNumber)(e)&&(s.logger.log("Adjusting PTS using programDateTime delta "+(i-r)+"ms, sliding:"+e.toFixed(3)+" "+t.url+" "),c(e,t)))}function f(t,e){var r=t.programDateTime;r&&(e=(r-e)/1e3,t.start=t.startPTS=e,t.endPTS=e+t.duration)}function g(t,e){var r;e.fragments.length&&t.hasProgramDateTime&&e.hasProgramDateTime&&(r=e.fragments[0].programDateTime-1e3*e.fragments[0].start,t.fragments.forEach(function(t){f(t,r)}),t.fragmentHint&&f(t.fragmentHint,r),t.alignedSliding=!0)}},"./src/utils/ewma-bandwidth-estimator.ts":function(t,e,r){"use strict";r.r(e);var n=r("./src/utils/ewma.ts"),r=function(){function t(t,e,r){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new n.default(t),this.fast_=new n.default(e)}var e=t.prototype;return e.update=function(t,e){var r=this.slow_,i=this.fast_;this.slow_.halfLife!==t&&(this.slow_=new n.default(t,r.getEstimate(),r.getTotalWeight())),this.fast_.halfLife!==e&&(this.fast_=new n.default(e,i.getEstimate(),i.getTotalWeight()))},e.sample=function(t,e){t=(t=Math.max(t,this.minDelayMs_))/1e3,e=8*e/t;this.fast_.sample(t,e),this.slow_.sample(t,e)},e.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},e.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.destroy=function(){},t}();e.default=r},"./src/utils/ewma.ts":function(t,e,r){"use strict";r.r(e);r=function(){function t(t,e,r){void 0===e&&(e=0),void 0===r&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=r}var e=t.prototype;return e.sample=function(t,e){var r=Math.pow(this.alpha_,t);this.estimate_=e*(1-r)+r*this.estimate_,this.totalWeight_+=t},e.getTotalWeight=function(){return this.totalWeight_},e.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},t}();e.default=r},"./src/utils/fetch-loader.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"fetchSupported",function(){return l});var d=r("./src/polyfills/number.ts"),i=r("./src/loader/load-stats.ts"),u=r("./src/demux/chunk-cache.ts");function n(t){var i="function"==typeof Map?new Map:void 0;return(n=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,r)}function r(){return s(t,arguments,o(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a(r,t)})(t)}function s(t,e,r){return(s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var i=[null];i.push.apply(i,e);i=new(Function.bind.apply(t,i));return r&&a(i,r.prototype),i}).apply(null,arguments)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(){return(h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,i=arguments[e];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}function l(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1}r=function(){function t(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||c,this.controller=new self.AbortController,this.stats=new i.LoadStats}var e=t.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var t=this.response;t&&t.ok||(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(i,n,s){var a=this,o=this.stats;if(o.loading.start)throw new Error("Loader can only be used once.");o.loading.start=self.performance.now();var t=function(t,e){e={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(h({},t.headers))};t.rangeEnd&&e.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1));return e}(i,this.controller.signal),l=s.onProgress,u="arraybuffer"===i.responseType,c=u?"byteLength":"length";this.context=i,this.config=n,this.callbacks=s,this.request=this.fetchSetup(i,t),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){a.abortInternal(),s.onTimeout(o,i,a.response)},n.timeout),self.fetch(this.request).then(function(t){if((a.response=a.loader=t).ok)return o.loading.first=Math.max(self.performance.now(),o.loading.start),o.total=parseInt(t.headers.get("Content-Length")||"0"),l&&Object(d.isFiniteNumber)(n.highWaterMark)?a.loadProgressively(t,o,i,n.highWaterMark,l):u?t.arrayBuffer():t.text();var e=t.status,r=t.statusText;throw new f(r||"fetch, bad network response",e,t)}).then(function(t){var e=a.response;self.clearTimeout(a.requestTimeout),o.loading.end=Math.max(self.performance.now(),o.loading.first),o.loaded=o.total=t[c];var r={url:e.url,data:t};l&&!Object(d.isFiniteNumber)(n.highWaterMark)&&l(o,i,t,e),s.onSuccess(r,o,i,e)}).catch(function(t){var e;self.clearTimeout(a.requestTimeout),o.aborted||(e=t.code||0,s.onError({code:e,text:t.message},i,t.details))})},e.getCacheAge=function(){var t,e=null;return this.response&&(e=(t=this.response.headers.get("age"))?parseFloat(t):null),e},e.loadProgressively=function(i,n,s,a,o){void 0===a&&(a=0);var l=new u.default,t=i.body.getReader();return function r(){return t.read().then(function(t){if(t.done)return l.dataLength&&o(n,s,l.flush(),i),Promise.resolve(new ArrayBuffer(0));var e=t.value,t=e.length;return n.loaded+=t,t<a||l.dataLength?(l.push(e),l.dataLength>=a&&o(n,s,l.flush(),i)):o(n,s,e,i),r()}).catch(function(){return Promise.reject()})}()},t}();function c(t,e){return new self.Request(t.url,e)}var f=function(i){var t,e;function r(t,e,r){t=i.call(this,t)||this;return t.code=void 0,t.details=void 0,t.code=e,t.details=r,t}return e=i,(t=r).prototype=Object.create(e.prototype),a(t.prototype.constructor=t,e),r}(n(Error));e.default=r},"./src/utils/imsc1-ttml-parser.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"IMSC1_CODEC",function(){return i}),r.d(e,"parseIMSC1",function(){return n});var l=r("./src/utils/mp4-tools.ts"),a=r("./src/utils/vttparser.ts"),f=r("./src/utils/vttcue.ts"),u=r("./src/demux/id3.ts"),c=r("./src/utils/timescale-conversion.ts"),g=r("./src/utils/webvtt-parser.ts");function v(){return(v=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,i=arguments[e];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}var i="stpp.ttml.im1t",o=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,d=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,p={left:"start",center:"center",right:"end",start:"start",end:"end"};function n(t,e,r,i,n){var s=Object(l.findBox)(new Uint8Array(t),["mdat"]);if(0!==s.length){var s=s[0],a=Object(u.utf8ArrayToStr)(new Uint8Array(t,s.start,s.end-s.start)),o=Object(c.toTimescaleFromScale)(e,1,r);try{i(function(t,l){var r=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");var i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},u=Object.keys(i).reduce(function(t,e){return t[e]=r.getAttribute("ttp:"+e)||i[e],t},{}),c="preserve"!==r.getAttribute("xml:space"),d=y(m(r,"styling","style")),h=y(m(r,"layout","region")),t=m(r,"body","[begin]");return[].map.call(t,function(t){var e=function i(t,n){return[].slice.call(t.childNodes).reduce(function(t,e,r){return"br"===e.nodeName&&r?t+"\n":null!==(r=e.childNodes)&&void 0!==r&&r.length?i(e,n):n?t+e.textContent.trim().replace(/\s+/g," "):t+e.textContent},"")}(t,c);if(!e||!t.hasAttribute("begin"))return null;var r=S(t.getAttribute("begin"),u),i=S(t.getAttribute("dur"),u),n=S(t.getAttribute("end"),u);if(null===r)throw T(t);if(null===n){if(null===i)throw T(t);n=r+i}r=new f.default(r-l,n-l,e);r.id=Object(g.generateCueId)(r.startTime,r.endTime,r.text);n=h[t.getAttribute("region")],e=d[t.getAttribute("style")];r.position=10,r.size=80;var s,a,o,t=(s=n,a=e,o="http://www.w3.org/ns/ttml#styling",["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(t,e){var r=E(a,o,e)||E(s,o,e);return r&&(t[e]=r),t},{})),n=t.textAlign;return n&&((e=p[n])&&(r.lineAlign=e),r.align=n),v(r,t),r}).filter(function(t){return null!==t})}(a,o))}catch(t){n(t)}}else n(new Error("Could not parse IMSC1 mdat"))}function m(t,e,r){e=t.getElementsByTagName(e)[0];return e?[].slice.call(e.querySelectorAll(r)):[]}function y(t){return t.reduce(function(t,e){var r=e.getAttribute("xml:id");return r&&(t[r]=e),t},{})}function E(t,e,r){return t.hasAttributeNS(e,r)?t.getAttributeNS(e,r):null}function T(t){return new Error("Could not parse ttml timestamp "+t)}function S(t,e){if(!t)return null;var r,i,n,s=Object(a.parseTimeStamp)(t);return null===s&&(o.test(t)?(r=t,i=e,n=o.exec(r),r=(0|n[4])+(0|n[5])/i.subFrameRate,s=3600*(0|n[1])+60*(0|n[2])+(0|n[3])+r/i.frameRate):d.test(t)&&(s=function(t,e){var t=d.exec(t),r=Number(t[1]);switch(t[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}(t,e))),s}},"./src/utils/logger.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"enableLogs",function(){return o}),r.d(e,"logger",function(){return l});var n=function(){},i={trace:n,debug:n,log:n,warn:n,info:n,error:n},s=i;function a(r){for(var t=arguments.length,e=new Array(1<t?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];e.forEach(function(t){var e;s[t]=r[t]?r[t].bind(r):(e=t,(t=self.console[e])?t.bind(self.console,"["+e+"] >"):n)})}function o(t){if(self.console&&!0===t||"object"==typeof t){a(t,"debug","log","info","warn","error");try{s.log()}catch(t){s=i}}else s=i}var l=s},"./src/utils/mediakeys-helper.ts":function(t,e,r){"use strict";var i;r.r(e),r.d(e,"KeySystems",function(){return i}),r.d(e,"requestMediaKeySystemAccess",function(){return n}),(e=i=i||{}).WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready";var n="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(t,e,r){"use strict";function i(){return self.MediaSource||self.WebKitMediaSource}r.r(e),r.d(e,"getMediaSource",function(){return i})},"./src/utils/mp4-tools.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"bin2str",function(){return c}),r.d(e,"readUint16",function(){return h}),r.d(e,"readUint32",function(){return m}),r.d(e,"writeUint32",function(){return a}),r.d(e,"findBox",function(){return y}),r.d(e,"parseSegmentIndex",function(){return E}),r.d(e,"parseInitSegment",function(){return n}),r.d(e,"getStartDTS",function(){return o}),r.d(e,"getDuration",function(){return l}),r.d(e,"computeRawDurationFromSamples",function(){return T}),r.d(e,"offsetStartDTS",function(){return d}),r.d(e,"segmentValidRange",function(){return f}),r.d(e,"appendUint8Array",function(){return g});var i=r("./src/utils/typed-array.ts"),p=r("./src/loader/fragment.ts"),s=Math.pow(2,32)-1,u=[].push;function c(t){return String.fromCharCode.apply(null,t)}function h(t,e){"data"in t&&(e+=t.start,t=t.data);e=t[e]<<8|t[e+1];return e<0?65536+e:e}function m(t,e){"data"in t&&(e+=t.start,t=t.data);e=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return e<0?4294967296+e:e}function a(t,e,r){"data"in t&&(e+=t.start,t=t.data),t[e]=r>>24,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=255&r}function y(t,e){var r,i,n,s=[];if(!e.length)return s;n="data"in t?(r=t.data,i=t.start,t.end):(i=0,(r=t).byteLength);for(var a=i;a<n;){var o=m(r,a),l=1<o?a+o:n;c(r.subarray(a+4,a+8))===e[0]&&(1===e.length?s.push({data:r,start:a+8,end:l}):(o=y({data:r,start:a+8,end:l},e.slice(1))).length&&u.apply(s,o)),a=l}return s}function E(t){var e=y(t,["moov"])[0],e=e?e.end:null,t=y(t,["sidx"]);if(!t||!t[0])return null;var r=[],i=t[0],t=i.data[0],n=0===t?8:16,s=m(i,n);n+=4;n+=0===t?8:16,n+=2;var a=i.end+0,o=h(i,n);n+=2;for(var l=0;l<o;l++){var u=n,c=m(i,u);u+=4;var d=2147483647&c;if(1==(2147483648&c)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;c=m(i,u);u+=4,r.push({referenceSize:d,subsegmentDuration:c,info:{duration:c/s,start:a,end:a+d-1}}),a+=d,n=u+=4}return{earliestPresentationTime:0,timescale:s,version:t,referencesCount:o,references:r,moovEndOffset:e}}function n(t){for(var r=[],e=y(t,["moov","trak"]),i=0;i<e.length;i++){var n,s,a,o=e[i],l=y(o,["tkhd"])[0];l&&(n=m(l,0===l.data[l.start]?12:20),(a=y(o,["mdia","mdhd"])[0])&&(s=m(a,0===a.data[a.start]?12:20),(l=y(o,["mdia","hdlr"])[0])&&(a=c(l.data.subarray(l.start+8,l.start+12)),(l={soun:p.ElementaryStreamTypes.AUDIO,vide:p.ElementaryStreamTypes.VIDEO}[a])&&(a=void 0,(o=y(o,["mdia","minf","stbl","stsd"])[0])&&(a=c(o.data.subarray(o.start+12,o.start+16))),r[n]={timescale:s,type:l},r[l]={timescale:s,id:n,codec:a}))))}return y(t,["moov","mvex","trex"]).forEach(function(t){var e=m(t,4),e=r[e];e&&(e.default={duration:m(t,12),flags:m(t,20)})}),r}function o(s,t){return y(t,["moof","traf"]).reduce(function(t,e){var i=y(e,["tfdt"])[0],n=i.data[i.start],e=y(e,["tfhd"]).reduce(function(t,e){var r=m(e,4),e=s[r];if(e){r=m(i,4);1===n&&(r*=Math.pow(2,32),r+=m(i,8));e=r/(e.timescale||9e4);if(isFinite(e)&&(null===t||e<t))return e}return t},null);return null!==e&&isFinite(e)&&(null===t||e<t)?e:t},null)||0}function l(t,e){for(var r=0,i=0,n=0,s=y(t,["moof","traf"]),a=0;a<s.length;a++){var o=s[a],l=y(o,["tfhd"])[0],u=e[m(l,4)];if(u){var c=u.default,d=m(l,0)|(null==c?void 0:c.flags),h=null==c?void 0:c.duration;8&d&&(h=m(l,2&d?12:8));for(var f=u.timescale||9e4,g=y(o,["trun"]),v=0;v<g.length;v++)r=h?h*m(g[v],4):T(g[v]),u.type===p.ElementaryStreamTypes.VIDEO?i+=r/f:u.type===p.ElementaryStreamTypes.AUDIO&&(n+=r/f)}}if(0===i&&0===n){t=E(t);if(null!=t&&t.references)return t.references.reduce(function(t,e){return t+e.info.duration||0},0)}return i||n}function T(t){var e=m(t,0),r=8;1&e&&(r+=4),4&e&&(r+=4);for(var i=0,n=m(t,4),s=0;s<n;s++)256&e&&(i+=m(t,r),r+=4),512&e&&(r+=4),1024&e&&(r+=4),2048&e&&(r+=4);return i}function d(r,t,n){y(t,["moof","traf"]).forEach(function(e){y(e,["tfhd"]).forEach(function(t){var i,t=m(t,4),t=r[t];t&&(i=t.timescale||9e4,y(e,["tfdt"]).forEach(function(t){var e=t.data[t.start],r=m(t,4);0===e?a(t,4,r-n*i):(r*=Math.pow(2,32),r+=m(t,8),r-=n*i,r=Math.max(r,0),e=Math.floor(r/(s+1)),r=Math.floor(r%(s+1)),a(t,4,e),a(t,8,r))}))})})}function f(t){var e={valid:null,remainder:null},r=y(t,["moof"]);if(!r)return e;if(r.length<2)return e.remainder=t,e;r=r[r.length-1];return e.valid=Object(i.sliceUint8)(t,0,r.start-8),e.remainder=Object(i.sliceUint8)(t,r.start-8),e}function g(t,e){var r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}},"./src/utils/output-filter.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var i=function(){function t(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}var e=t.prototype;return e.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},e.newCue=function(t,e,r){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},e.reset=function(){this.cueRanges=[]},t}()},"./src/utils/texttrack-utils.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"sendAddTrackEvent",function(){return i}),r.d(e,"addCueToTrack",function(){return s}),r.d(e,"clearCurrentCues",function(){return a}),r.d(e,"removeCuesInRange",function(){return o}),r.d(e,"getCuesInRange",function(){return l});var n=r("./src/utils/logger.ts");function i(t,e){var r;try{r=new Event("addtrack")}catch(t){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=t,e.dispatchEvent(r)}function s(e,r){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(r.id))try{if(e.addCue(r),!e.cues.getCueById(r.id))throw new Error("addCue is failed for: "+r)}catch(t){n.logger.debug("[texttrack-utils]: "+t);var i=new self.TextTrackCue(r.startTime,r.endTime,r.text);i.id=r.id,e.addCue(i)}"disabled"===t&&(e.mode=t)}function a(t){var e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues)for(var r=t.cues.length;r--;)t.removeCue(t.cues[r]);"disabled"===e&&(t.mode=e)}function o(t,e,r){var i=t.mode;if("disabled"===i&&(t.mode="hidden"),t.cues&&0<t.cues.length)for(var n=l(t.cues,e,r),s=0;s<n.length;s++)t.removeCue(n[s]);"disabled"===i&&(t.mode=i)}function l(t,e,r){var i=[],n=function(t,e){if(e<t[0].startTime)return 0;var r=t.length-1;if(e>t[r].endTime)return-1;for(var i=0,n=r;i<=n;){var s=Math.floor((n+i)/2);if(e<t[s].startTime)n=s-1;else{if(!(e>t[s].startTime&&i<r))return s;i=s+1}}return t[i].startTime-e<e-t[n].startTime?i:n}(t,e);if(-1<n)for(var s=n,a=t.length;s<a;s++){var o=t[s];if(o.startTime>=e&&o.endTime<=r)i.push(o);else if(o.startTime>r)return i}return i}},"./src/utils/time-ranges.ts":function(t,e,r){"use strict";r.r(e);e.default={toString:function(t){for(var e="",r=t.length,i=0;i<r;i++)e+="["+t.start(i).toFixed(3)+","+t.end(i).toFixed(3)+"]";return e}}},"./src/utils/timescale-conversion.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"toTimescaleFromBase",function(){return n}),r.d(e,"toTimescaleFromScale",function(){return s}),r.d(e,"toMsFromMpegTsClock",function(){return a}),r.d(e,"toMpegTsClockFromTimescale",function(){return o});var i=9e4;function n(t,e,r,i){void 0===r&&(r=1),void 0===i&&(i=!1);r*=t*e;return i?Math.round(r):r}function s(t,e,r,i){return void 0===r&&(r=1),void 0===i&&(i=!1),n(t,e,1/r,i)}function a(t,e){return void 0===e&&(e=!1),n(t,1e3,1/i,e)}function o(t,e){return void 0===e&&(e=1),n(t,i,1/e)}},"./src/utils/typed-array.ts":function(t,e,r){"use strict";function i(t,e,r){return Uint8Array.prototype.slice?t.slice(e,r):new Uint8Array(Array.prototype.slice.call(t,e,r))}r.r(e),r.d(e,"sliceUint8",function(){return i})},"./src/utils/vttcue.ts":function(t,e,r){"use strict";r.r(e),e.default=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var E=["","lr","rl"],e=["start","middle","end","left","right"];function T(t,e){if("string"!=typeof e)return!1;if(!Array.isArray(t))return!1;e=e.toLowerCase();return!!~t.indexOf(e)&&e}function S(t){return T(e,t)}function b(t){for(var e=arguments.length,r=new Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];for(var n=1;n<arguments.length;n++){var s,a=arguments[n];for(s in a)t[s]=a[s]}return t}function t(t,e,r){var i=this,n={enumerable:!0};i.hasBeenReset=!1;var s="",a=!1,o=t,l=e,u=r,c=null,d="",h=!0,f="auto",g="start",v=50,p="middle",m=50,y="middle";Object.defineProperty(i,"id",b({},n,{get:function(){return s},set:function(t){s=""+t}})),Object.defineProperty(i,"pauseOnExit",b({},n,{get:function(){return a},set:function(t){a=!!t}})),Object.defineProperty(i,"startTime",b({},n,{get:function(){return o},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");o=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"endTime",b({},n,{get:function(){return l},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");l=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"text",b({},n,{get:function(){return u},set:function(t){u=""+t,this.hasBeenReset=!0}})),Object.defineProperty(i,"region",b({},n,{get:function(){return c},set:function(t){c=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"vertical",b({},n,{get:function(){return d},set:function(t){t=T(E,t);if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"snapToLines",b({},n,{get:function(){return h},set:function(t){h=!!t,this.hasBeenReset=!0}})),Object.defineProperty(i,"line",b({},n,{get:function(){return f},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");f=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"lineAlign",b({},n,{get:function(){return g},set:function(t){t=S(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");g=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"position",b({},n,{get:function(){return v},set:function(t){if(t<0||100<t)throw new Error("Position must be between 0 and 100.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"positionAlign",b({},n,{get:function(){return p},set:function(t){t=S(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"size",b({},n,{get:function(){return m},set:function(t){if(t<0||100<t)throw new Error("Size must be between 0 and 100.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"align",b({},n,{get:function(){return y},set:function(t){t=S(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),i.displayState=void 0}return t.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},t}()},"./src/utils/vttparser.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"parseTimeStamp",function(){return l}),r.d(e,"fixLineBreaks",function(){return f}),r.d(e,"VTTParser",function(){return n});var o=r("./src/utils/vttcue.ts"),i=function(){function t(){}return t.prototype.decode=function(t,e){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))},t}();function l(t){function e(t,e,r,i){return 3600*(0|t)+60*(0|e)+(0|r)+parseFloat(i||0)}t=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?59<parseFloat(t[2])?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}var u=function(){function t(){this.values=Object.create(null)}var e=t.prototype;return e.set=function(t,e){this.get(t)||""===e||(this.values[t]=e)},e.get=function(t,e,r){return r?this.has(t)?this.values[t]:e[r]:this.has(t)?this.values[t]:e},e.has=function(t){return t in this.values},e.alt=function(t,e,r){for(var i=0;i<r.length;++i)if(e===r[i]){this.set(t,e);break}},e.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},e.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var r=parseFloat(e);if(0<=r&&r<=100)return this.set(t,r),!0}return!1},t}();function c(t,e,r,i){var n,s,a=i?t.split(i):[t];for(n in a)"string"==typeof a[n]&&(2===(s=a[n].split(r)).length&&e(s[0],s[1]))}var d=new o.default(0,0,""),h="middle"===d.align?"middle":"center";function f(t){return t.replace(/<br(?: \/)?>/gi,"\n")}var n=function(){function t(){this.state="INITIAL",this.buffer="",this.decoder=new i,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var e=t.prototype;return e.parse=function(t){var i=this;function e(){for(var t=0,e=f(e=i.buffer);t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var r=e.substr(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,i.buffer=e.substr(t),r}t&&(i.buffer+=i.decoder.decode(t,{stream:!0}));try{var r="";if("INITIAL"===i.state){if(!/\r\n|\n/.test(i.buffer))return this;var n=(r=e()).match(/^()?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var s=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(s?s=!1:r=e(),i.state){case"HEADER":/:/.test(r)?c(r,function(t,e){},/:/):r||(i.state="ID");continue;case"NOTE":r||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){i.state="NOTE";break}if(!r)continue;if(i.cue=new o.default(0,0,""),i.state="CUE",-1===r.indexOf("--\x3e")){i.cue.id=r;continue}case"CUE":if(!i.cue){i.state="BADCUE";continue}try{!function(e,t,n){var r,s,i=e;function a(){var t=l(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function o(){e=e.replace(/^\s+/,"")}if(o(),t.startTime=a(),o(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.substr(3),o(),t.endTime=a(),o(),r=e,t=t,s=new u,c(r,function(t,e){var r;switch(t){case"region":for(var i=n.length-1;0<=i;i--)if(n[i].id===e){s.set(t,n[i].region);break}break;case"vertical":s.alt(t,e,["rl","lr"]);break;case"line":r=e.split(","),s.integer(t,r[0]),s.percent(t,r[0])&&s.set("snapToLines",!1),s.alt(t,r[0],["auto"]),2===r.length&&s.alt("lineAlign",r[1],["start",h,"end"]);break;case"position":r=e.split(","),s.percent(t,r[0]),2===r.length&&s.alt("positionAlign",r[1],["start",h,"end","line-left","line-right","auto"]);break;case"size":s.percent(t,e);break;case"align":s.alt(t,e,["start",h,"end","left","right"])}},/:/,/\s/),t.region=s.get("region",null),t.vertical=s.get("vertical",""),"auto"===(r=s.get("line","auto"))&&-1===d.line&&(r=-1),t.line=r,t.lineAlign=s.get("lineAlign","start"),t.snapToLines=s.get("snapToLines",!0),t.size=s.get("size",100),t.align=s.get("align",h),"auto"===(r=s.get("position","auto"))&&50===d.position&&(r="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=r}(r,i.cue,i.regionList)}catch(t){i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":var a=-1!==r.indexOf("--\x3e");if(!r||a&&(s=!0)){i.oncue&&i.cue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}if(null===i.cue)continue;i.cue.text&&(i.cue.text+="\n"),i.cue.text+=r;continue;case"BADCUE":r||(i.state="ID")}}}catch(t){"CUETEXT"===i.state&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state="INITIAL"===i.state?"BADWEBVTT":"BADCUE"}return this},e.flush=function(){var e=this;try{if(!e.cue&&"HEADER"!==e.state||(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},t}()},"./src/utils/webvtt-parser.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"generateCueId",function(){return A}),r.d(e,"parseWebVTT",function(){return n});var s=r("./src/polyfills/number.ts"),m=r("./src/utils/vttparser.ts"),y=r("./src/demux/id3.ts"),E=r("./src/utils/timescale-conversion.ts"),T=r("./src/remux/mp4-remuxer.ts"),S=/\r\n|\n\r|\n|\r/g,b=function(t,e,r){return void 0===r&&(r=0),t.substr(r,e.length)===e},L=function(t){var e=parseInt(t.substr(-3)),r=parseInt(t.substr(-6,2)),i=parseInt(t.substr(-9,2)),n=9<t.length?parseInt(t.substr(0,t.indexOf(":"))):0;if(!(Object(s.isFiniteNumber)(e)&&Object(s.isFiniteNumber)(r)&&Object(s.isFiniteNumber)(i)&&Object(s.isFiniteNumber)(n)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return e+=1e3*r,e+=6e4*i,e+=36e5*n},i=function(t){for(var e=5381,r=t.length;r;)e=33*e^t.charCodeAt(--r);return(e>>>0).toString()};function A(t,e,r){return i(t.toString())+i(e.toString())+i(r)}var D=function(t,e,r){var i=t[e],n=t[i.prevCC];if(!n||!n.new&&i.new)return t.ccOffset=t.presentationOffset=i.start,void(i.new=!1);for(;null!==n&&void 0!==n&&n.new;)t.ccOffset+=i.start-n.start,i.new=!1,n=t[(i=n).prevCC];t.presentationOffset=r};function n(t,e,r,s,a,o,i,n){var l,u=new m.VTTParser,t=Object(y.utf8ArrayToStr)(new Uint8Array(t)).trim().replace(S,"\n").split("\n"),c=[],d=Object(E.toMpegTsClockFromTimescale)(e,r),h="00:00.000",f=0,g=0,v=!0,p=!1;u.oncue=function(t){var e=s[a],r=s.ccOffset,i=(f-d)/9e4;null!=e&&e.new&&(void 0!==g?r=s.ccOffset=e.start:D(s,a,i)),i&&(r=i-s.presentationOffset),p&&(n=t.endTime-t.startTime,r=Object(T.normalizePts)(9e4*(t.startTime+r-g),9e4*o)/9e4,t.startTime=r,t.endTime=r+n);var n=t.text.trim();t.text=decodeURIComponent(encodeURIComponent(n)),t.id||(t.id=A(t.startTime,t.endTime,n)),0<t.endTime&&c.push(t)},u.onparsingerror=function(t){l=t},u.onflush=function(){l?n(l):i(c)},t.forEach(function(t){if(v){if(b(t,"X-TIMESTAMP-MAP=")){p=!(v=!1),t.substr(16).split(",").forEach(function(t){b(t,"LOCAL:")?h=t.substr(6):b(t,"MPEGTS:")&&(f=parseInt(t.substr(7)))});try{g=L(h)/1e3}catch(t){p=!1,l=t}return}""===t&&(v=!1)}u.parse(t+"\n")}),u.flush()}},"./src/utils/xhr-loader.ts":function(t,e,r){"use strict";r.r(e);var o=r("./src/utils/logger.ts"),i=r("./src/loader/load-stats.ts"),n=/^age:\s*[\d.]+\s*$/m,r=function(){function t(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t?t.xhrSetup:null,this.stats=new i.LoadStats,this.retryDelay=0}var e=t.prototype;return e.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},e.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))},e.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},e.load=function(t,e,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=r,this.retryDelay=e.retryDelay,this.loadInternal()},e.loadInternal=function(){var t=this.config,e=this.context;if(t){var r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0;var n=this.xhrSetup;try{var s=this.context.headers;if(s)for(var a in s)r.setRequestHeader(a,s[a]);if(n)try{n(r,e.url)}catch(t){r.open("GET",e.url,!0),n(r,e.url)}r.readyState||r.open("GET",e.url,!0)}catch(t){return void this.callbacks.onError({code:r.status,text:t.message},e,r)}e.rangeEnd&&r.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=e.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),r.send()}},e.readystatechange=function(){var t,e,r,i,n=this.context,s=this.loader,a=this.stats;n&&s&&(r=s.readyState,t=this.config,a.aborted||2<=r&&(self.clearTimeout(this.requestTimeout),0===a.loading.first&&(a.loading.first=Math.max(self.performance.now(),a.loading.start)),4===r?(s.onreadystatechange=null,s.onprogress=null,200<=(e=s.status)&&e<300?(a.loading.end=Math.max(self.performance.now(),a.loading.first),r="arraybuffer"===n.responseType?(i=s.response).byteLength:(i=s.responseText).length,a.loaded=a.total=r,this.callbacks&&(i={url:s.responseURL,data:i},this.callbacks.onSuccess(i,a,n,s))):a.retry>=t.maxRetry||400<=e&&e<499?(o.logger.error(e+" while loading "+n.url),this.callbacks.onError({code:e,text:s.statusText},n,s)):(o.logger.warn(e+" while loading "+n.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,t.maxRetryDelay),a.retry++)):(self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout))))},e.loadtimeout=function(){o.logger.warn("timeout while loading "+this.context.url);var t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))},e.loadprogress=function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)},e.getCacheAge=function(){var t,e=null;return this.loader&&n.test(this.loader.getAllResponseHeaders())&&(e=(t=this.loader.getResponseHeader("age"))?parseFloat(t):null),e},t}();e.default=r}},n.c=i,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s="./src/hls.ts").default;function n(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}var r,i});
/* exception2 //rtcdn.cincopa.com/fpskins/mediaelement/1/js/hls.min.js - err missing name after . operator */
// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/js/kaleidoscope.js  D:\WebSites\tmpCincopaAppsV2\_cms/fpskins/mediaelement/1/js/kaleidoscope.js   3/21/2022 9:13:17 AM 
_cp_preloaded_files["/fpskins/mediaelement/1/js/kaleidoscope.js"] = true;
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("kaleidoscope",["exports"],e):e(t.Kaleidoscope={})}(this,function(t){"use strict";var e={isiOS:function(){return/(ipad|iphone|ipod)/gi.test(navigator.userAgent)},shouldUseAudioDriver:function(){var t=/iphone.*(7|8|9)_[0-9]/i.test(navigator.userAgent),e=/(iPhone|iPod).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return t||e},shouldUseCanvasInBetween:function(){return/trident|edge/i.test(navigator.userAgent)}},i=function(t){return t&&"object"==typeof t&&"default"in t?t.default:t}(function(t,e){return e={exports:{}},t(e,e.exports),e.exports}(function(t){var e=Math.atan,i=Math.tan,r=Math.acos,n=Math.sin,a=Math.cos,o=Math.atan2,s=Math.abs,h=Math.ceil,u=Math.sqrt,l=Math.pow,c=Math.round,p=Math.LN2,d=Math.log,f=Math.PI,m=Math.floor,v=Math.max,g=Math.min,y=Math.sign,x=Number.EPSILON,M={REVISION:"75"};t.exports=M,void 0===x&&(x=2.220446049250313e-16),void 0===y&&(y=function(t){return 0>t?-1:0<t?1:+t}),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),void 0===Object.assign&&Object.defineProperty(Object,"assign",{writable:!0,configurable:!0,value:function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert first argument to object");for(var e,i=Object(t),r=1,n=arguments.length;r!==n;++r)if(void 0!==(e=arguments[r])&&null!==e){e=Object(e);for(var a=Object.keys(e),o=0,s=a.length;o!==s;++o){var h=a[o],u=Object.getOwnPropertyDescriptor(e,h);void 0!==u&&u.enumerable&&(i[h]=e[h])}}return i}}),M.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},M.CullFaceNone=0,M.CullFaceBack=1,M.CullFaceFront=2,M.CullFaceFrontBack=3,M.FrontFaceDirectionCW=0,M.FrontFaceDirectionCCW=1,M.BasicShadowMap=0,M.PCFShadowMap=1,M.PCFSoftShadowMap=2,M.FrontSide=0,M.BackSide=1,M.DoubleSide=2,M.FlatShading=1,M.SmoothShading=2,M.NoColors=0,M.FaceColors=1,M.VertexColors=2,M.NoBlending=0,M.NormalBlending=1,M.AdditiveBlending=2,M.SubtractiveBlending=3,M.MultiplyBlending=4,M.CustomBlending=5,M.AddEquation=100,M.SubtractEquation=101,M.ReverseSubtractEquation=102,M.MinEquation=103,M.MaxEquation=104,M.ZeroFactor=200,M.OneFactor=201,M.SrcColorFactor=202,M.OneMinusSrcColorFactor=203,M.SrcAlphaFactor=204,M.OneMinusSrcAlphaFactor=205,M.DstAlphaFactor=206,M.OneMinusDstAlphaFactor=207,M.DstColorFactor=208,M.OneMinusDstColorFactor=209,M.SrcAlphaSaturateFactor=210,M.NeverDepth=0,M.AlwaysDepth=1,M.LessDepth=2,M.LessEqualDepth=3,M.EqualDepth=4,M.GreaterEqualDepth=5,M.GreaterDepth=6,M.NotEqualDepth=7,M.MultiplyOperation=0,M.MixOperation=1,M.AddOperation=2,M.NoToneMapping=0,M.LinearToneMapping=1,M.ReinhardToneMapping=2,M.Uncharted2ToneMapping=3,M.CineonToneMapping=4,M.UVMapping=300,M.CubeReflectionMapping=301,M.CubeRefractionMapping=302,M.EquirectangularReflectionMapping=303,M.EquirectangularRefractionMapping=304,M.SphericalReflectionMapping=305,M.CubeUVReflectionMapping=306,M.CubeUVRefractionMapping=307,M.RepeatWrapping=1e3,M.ClampToEdgeWrapping=1001,M.MirroredRepeatWrapping=1002,M.NearestFilter=1003,M.NearestMipMapNearestFilter=1004,M.NearestMipMapLinearFilter=1005,M.LinearFilter=1006,M.LinearMipMapNearestFilter=1007,M.LinearMipMapLinearFilter=1008,M.UnsignedByteType=1009,M.ByteType=1010,M.ShortType=1011,M.UnsignedShortType=1012,M.IntType=1013,M.UnsignedIntType=1014,M.FloatType=1015,M.HalfFloatType=1025,M.UnsignedShort4444Type=1016,M.UnsignedShort5551Type=1017,M.UnsignedShort565Type=1018,M.AlphaFormat=1019,M.RGBFormat=1020,M.RGBAFormat=1021,M.LuminanceFormat=1022,M.LuminanceAlphaFormat=1023,M.RGBEFormat=M.RGBAFormat,M.RGB_S3TC_DXT1_Format=2001,M.RGBA_S3TC_DXT1_Format=2002,M.RGBA_S3TC_DXT3_Format=2003,M.RGBA_S3TC_DXT5_Format=2004,M.RGB_PVRTC_4BPPV1_Format=2100,M.RGB_PVRTC_2BPPV1_Format=2101,M.RGBA_PVRTC_4BPPV1_Format=2102,M.RGBA_PVRTC_2BPPV1_Format=2103,M.RGB_ETC1_Format=2151,M.LoopOnce=2200,M.LoopRepeat=2201,M.LoopPingPong=2202,M.InterpolateDiscrete=2300,M.InterpolateLinear=2301,M.InterpolateSmooth=2302,M.ZeroCurvatureEnding=2400,M.ZeroSlopeEnding=2401,M.WrapAroundEnding=2402,M.TrianglesDrawMode=0,M.TriangleStripDrawMode=1,M.TriangleFanDrawMode=2,M.LinearEncoding=3e3,M.sRGBEncoding=3001,M.GammaEncoding=3007,M.RGBEEncoding=3002,M.LogLuvEncoding=3003,M.RGBM7Encoding=3004,M.RGBM16Encoding=3005,M.RGBDEncoding=3006,M.Math={generateUUID:function(){var t,e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],i=Array(36),r=0;return function(){for(var n=0;36>n;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(2>=r&&(r=0|33554432+16777216*Math.random()),t=15&r,r>>=4,i[n]=e[19===n?8|3&t:t]);return i.join("")}}(),clamp:function(t,e,i){return v(e,g(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,r,n){return r+(t-e)*(n-r)/(i-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},random16:function(){return Math.random()},randInt:function(t,e){return t+m(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*(f/180)},radToDeg:function(t){return t*(180/f)},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},nearestPowerOfTwo:function(t){return l(2,c(d(t)/p))},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}},M.Color=function(t){return 3===arguments.length?this.fromArray(arguments):this.set(t)},M.Color.prototype={constructor:M.Color,r:1,g:1,b:1,set:function(t){return t instanceof M.Color?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){this.r=t,this.g=t,this.b=t},setHex:function(t){return t=m(t),this.r=(255&t>>16)/255,this.g=(255&t>>8)/255,this.b=(255&t)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},setHSL:function(){function t(t,e,i){return 0>i&&(i+=1),1<i&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}return function(e,i,r){if(e=M.Math.euclideanModulo(e,1),i=M.Math.clamp(i,0,1),r=M.Math.clamp(r,0,1),0===i)this.r=this.g=this.b=r;else{var n=.5>=r?r*(1+i):r+i-r*i,a=2*r-n;this.r=t(a,n,e+1/3),this.g=t(a,n,e),this.b=t(a,n,e-1/3)}return this}}(),setStyle:function(t){function e(t){void 0===t||parseFloat(t)}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var r,n=i[1],a=i[2];switch(n){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=g(255,parseInt(r[1],10))/255,this.g=g(255,parseInt(r[2],10))/255,this.b=g(255,parseInt(r[3],10))/255,e(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=g(100,parseInt(r[1],10))/100,this.g=g(100,parseInt(r[2],10))/100,this.b=g(100,parseInt(r[3],10))/100,e(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,h=parseInt(r[3],10)/100;return e(r[5]),this.setHSL(o,s,h)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(t)){var u=(l=i[1]).length;if(3===u)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}if(t&&0<t.length){var l=M.ColorKeywords[t];void 0!==l&&this.setHex(l)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=l(t.r,e),this.g=l(t.g,e),this.b=l(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var i=0<e?1/e:1;return this.r=l(t.r,i),this.g=l(t.g,i),this.b=l(t.b,i),this},convertGammaToLinear:function(){var t=this.r,e=this.g,i=this.b;return this.r=t*t,this.g=e*e,this.b=i*i,this},convertLinearToGamma:function(){return this.r=u(this.r),this.g=u(this.g),this.b=u(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){var e,i,r=t||{h:0,s:0,l:0},n=this.r,a=this.g,o=this.b,s=v(n,a,o),h=g(n,a,o),u=(h+s)/2;if(h===s)e=0,i=0;else{var l=s-h;i=.5>=u?l/(s+h):l/(2-s-h),s===n?e=(a-o)/l+(a<o?6:0):s===a?e=(o-n)/l+2:s===o&&(e=(n-a)/l+4),e/=6}return r.h=e,r.s=i,r.l=u,r},getStyle:function(){return"rgb("+(0|255*this.r)+","+(0|255*this.g)+","+(0|255*this.b)+")"},offsetHSL:function(t,e,i){var r=this.getHSL();return r.h+=t,r.s+=e,r.l+=i,this.setHSL(r.h,r.s,r.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}},M.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},M.Vector2=function(t,e){this.x=t||0,this.y=e||0},M.Vector2.prototype={constructor:M.Vector2,get width(){return this.x},set width(t){this.x=t},get height(){return this.y},set height(t){this.y=t},set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0===e?(this.x+=t.x,this.y+=t.y,this):this.addVectors(t,e)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0===e?(this.x-=t.x,this.y-=t.y,this):this.subVectors(t,e)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t):(this.x=0,this.y=0),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=g(this.x,t.x),this.y=g(this.y,t.y),this},max:function(t){return this.x=v(this.x,t.x),this.y=v(this.y,t.y),this},clamp:function(t,e){return this.x=v(t.x,g(e.x,this.x)),this.y=v(t.y,g(e.y,this.y)),this},clampScalar:function(){var t,e;return function(i,r){return void 0==t&&(t=new M.Vector2,e=new M.Vector2),t.set(i,i),e.set(r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.multiplyScalar(v(t,g(e,i))/i),this},floor:function(){return this.x=m(this.x),this.y=m(this.y),this},ceil:function(){return this.x=h(this.x),this.y=h(this.y),this},round:function(){return this.x=c(this.x),this.y=c(this.y),this},roundToZero:function(){return this.x=0>this.x?h(this.x):m(this.x),this.y=0>this.y?h(this.y):m(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return u(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return s(this.x)+s(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var t=o(this.y,this.x);return 0>t&&(t+=2*f),t},distanceTo:function(t){return u(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t),this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromAttribute:function(t,e,i){return void 0===i&&(i=0),e=e*t.itemSize+i,this.x=t.array[e],this.y=t.array[e+1],this},rotateAround:function(t,e){var i=a(e),r=n(e),o=this.x-t.x,s=this.y-t.y;return this.x=o*i-s*r+t.x,this.y=o*r+s*i+t.y,this}},M.Vector3=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0},M.Vector3.prototype={constructor:M.Vector3,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0===e?(this.x+=t.x,this.y+=t.y,this.z+=t.z,this):this.addVectors(t,e)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0===e?(this.x-=t.x,this.y-=t.y,this.z-=t.z,this):this.subVectors(t,e)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0===e?(this.x*=t.x,this.y*=t.y,this.z*=t.z,this):this.multiplyVectors(t,e)},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(){var t;return function(e){return M.Euler,void 0==t&&(t=new M.Quaternion),this.applyQuaternion(t.setFromEuler(e)),this}}(),applyAxisAngle:function(){var t;return function(e,i){return void 0==t&&(t=new M.Quaternion),this.applyQuaternion(t.setFromAxisAngle(e,i)),this}}(),applyMatrix3:function(t){var e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6]*r,this.y=n[1]*e+n[4]*i+n[7]*r,this.z=n[2]*e+n[5]*i+n[8]*r,this},applyMatrix4:function(t){var e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*r+n[12],this.y=n[1]*e+n[5]*i+n[9]*r+n[13],this.z=n[2]*e+n[6]*i+n[10]*r+n[14],this},applyProjection:function(t){var e=this.x,i=this.y,r=this.z,n=t.elements,a=1/(n[3]*e+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*e+n[4]*i+n[8]*r+n[12])*a,this.y=(n[1]*e+n[5]*i+n[9]*r+n[13])*a,this.z=(n[2]*e+n[6]*i+n[10]*r+n[14])*a,this},applyQuaternion:function(t){var e=this.x,i=this.y,r=this.z,n=t.x,a=t.y,o=t.z,s=t.w,h=s*e+a*r-o*i,u=s*i+o*e-n*r,l=s*r+n*i-a*e,c=-n*e-a*i-o*r;return this.x=h*s+c*-n+u*-o-l*-a,this.y=u*s+c*-a+l*-n-h*-o,this.z=l*s+c*-o+h*-a-u*-n,this},project:function(){var t;return function(e){return void 0==t&&(t=new M.Matrix4),t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld)),this.applyProjection(t)}}(),unproject:function(){var t;return function(e){return void 0==t&&(t=new M.Matrix4),t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyProjection(t)}}(),transformDirection:function(t){var e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*r,this.y=n[1]*e+n[5]*i+n[9]*r,this.z=n[2]*e+n[6]*i+n[10]*r,this.normalize(),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=g(this.x,t.x),this.y=g(this.y,t.y),this.z=g(this.z,t.z),this},max:function(t){return this.x=v(this.x,t.x),this.y=v(this.y,t.y),this.z=v(this.z,t.z),this},clamp:function(t,e){return this.x=v(t.x,g(e.x,this.x)),this.y=v(t.y,g(e.y,this.y)),this.z=v(t.z,g(e.z,this.z)),this},clampScalar:function(){var t,e;return function(i,r){return void 0==t&&(t=new M.Vector3,e=new M.Vector3),t.set(i,i,i),e.set(r,r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.multiplyScalar(v(t,g(e,i))/i),this},floor:function(){return this.x=m(this.x),this.y=m(this.y),this.z=m(this.z),this},ceil:function(){return this.x=h(this.x),this.y=h(this.y),this.z=h(this.z),this},round:function(){return this.x=c(this.x),this.y=c(this.y),this.z=c(this.z),this},roundToZero:function(){return this.x=0>this.x?h(this.x):m(this.x),this.y=0>this.y?h(this.y):m(this.y),this.z=0>this.z?h(this.z):m(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return u(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return s(this.x)+s(this.y)+s(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t),this},cross:function(t,e){if(void 0!==e)return this.crossVectors(t,e);var i=this.x,r=this.y,n=this.z;return this.x=r*t.z-n*t.y,this.y=n*t.x-i*t.z,this.z=i*t.y-r*t.x,this},crossVectors:function(t,e){var i=t.x,r=t.y,n=t.z,a=e.x,o=e.y,s=e.z;return this.x=r*s-n*o,this.y=n*a-i*s,this.z=i*o-r*a,this},projectOnVector:function(){var t,e;return function(i){return void 0==t&&(t=new M.Vector3),t.copy(i).normalize(),e=this.dot(t),this.copy(t).multiplyScalar(e)}}(),projectOnPlane:function(){var t;return function(e){return void 0==t&&(t=new M.Vector3),t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t;return function(e){return void 0==t&&(t=new M.Vector3),this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/u(this.lengthSq()*t.lengthSq());return r(M.Math.clamp(e,-1,1))},distanceTo:function(t){return u(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r},setFromSpherical:function(t){var e=n(t.phi)*t.radius;return this.x=e*n(t.theta),this.y=a(t.phi)*t.radius,this.z=e*a(t.theta),this},setFromMatrixPosition:function(t){return this.setFromMatrixColumn(t,3)},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=r,this},setFromMatrixColumn:function(t,e){return"number"==typeof t&&(t=arguments[1],e=arguments[0]),this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromAttribute:function(t,e,i){return void 0===i&&(i=0),e=e*t.itemSize+i,this.x=t.array[e],this.y=t.array[e+1],this.z=t.array[e+2],this}},M.Vector4=function(t,e,i,r){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0===r?1:r},M.Vector4.prototype={constructor:M.Vector4,set:function(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0===t.w?1:t.w,this},add:function(t,e){return void 0===e?(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this):this.addVectors(t,e)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0===e?(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this):this.subVectors(t,e)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t,this.w*=t):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(t){var e=this.x,i=this.y,r=this.z,n=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*r+a[12]*n,this.y=a[1]*e+a[5]*i+a[9]*r+a[13]*n,this.z=a[2]*e+a[6]*i+a[10]*r+a[14]*n,this.w=a[3]*e+a[7]*i+a[11]*r+a[15]*n,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*r(t.w);var e=u(1-t.w*t.w);return 1e-4>e?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,i,n,a,o=.01,h=t.elements,l=h[0],c=h[4],p=h[8],d=h[1],m=h[5],v=h[9],g=h[2],y=h[6],x=h[10];if(s(c-d)<o&&s(p-g)<o&&s(v-y)<o){if(s(c+d)<.1&&s(p+g)<.1&&s(v+y)<.1&&s(l+m+x-3)<.1)return this.set(1,0,0,0),this;e=f;var M=(l+1)/2,_=(m+1)/2,b=(x+1)/2,S=(c+d)/4,w=(p+g)/4,E=(v+y)/4;return M>_&&M>b?M<o?(i=0,n=.707106781,a=.707106781):(i=u(M),n=S/i,a=w/i):_>b?_<o?(i=.707106781,n=0,a=.707106781):(n=u(_),i=S/n,a=E/n):b<o?(i=.707106781,n=.707106781,a=0):(a=u(b),i=w/a,n=E/a),this.set(i,n,a,e),this}var T=u((y-v)*(y-v)+(p-g)*(p-g)+(d-c)*(d-c));return.001>s(T)&&(T=1),this.x=(y-v)/T,this.y=(p-g)/T,this.z=(d-c)/T,this.w=r((l+m+x-1)/2),this},min:function(t){return this.x=g(this.x,t.x),this.y=g(this.y,t.y),this.z=g(this.z,t.z),this.w=g(this.w,t.w),this},max:function(t){return this.x=v(this.x,t.x),this.y=v(this.y,t.y),this.z=v(this.z,t.z),this.w=v(this.w,t.w),this},clamp:function(t,e){return this.x=v(t.x,g(e.x,this.x)),this.y=v(t.y,g(e.y,this.y)),this.z=v(t.z,g(e.z,this.z)),this.w=v(t.w,g(e.w,this.w)),this},clampScalar:function(){var t,e;return function(i,r){return void 0==t&&(t=new M.Vector4,e=new M.Vector4),t.set(i,i,i,i),e.set(r,r,r,r),this.clamp(t,e)}}(),floor:function(){return this.x=m(this.x),this.y=m(this.y),this.z=m(this.z),this.w=m(this.w),this},ceil:function(){return this.x=h(this.x),this.y=h(this.y),this.z=h(this.z),this.w=h(this.w),this},round:function(){return this.x=c(this.x),this.y=c(this.y),this.z=c(this.z),this.w=c(this.w),this},roundToZero:function(){return this.x=0>this.x?h(this.x):m(this.x),this.y=0>this.y?h(this.y):m(this.y),this.z=0>this.z?h(this.z):m(this.z),this.w=0>this.w?h(this.w):m(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return u(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return s(this.x)+s(this.y)+s(this.z)+s(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t),this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromAttribute:function(t,e,i){return void 0===i&&(i=0),e=e*t.itemSize+i,this.x=t.array[e],this.y=t.array[e+1],this.z=t.array[e+2],this.w=t.array[e+3],this}},M.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length},M.Matrix3.prototype={constructor:M.Matrix3,set:function(t,e,i,r,n,a,o,s,h){var u=this.elements;return u[0]=t,u[1]=r,u[2]=o,u[3]=e,u[4]=n,u[5]=s,u[6]=i,u[7]=a,u[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=t.elements;return this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToVector3Array:function(){var t;return function(e,i,r){void 0==t&&(t=new M.Vector3),void 0===i&&(i=0),void 0===r&&(r=e.length);for(var n=0,a=i;n<r;n+=3,a+=3)t.fromArray(e,a),t.applyMatrix3(this),t.toArray(e,a);return e}}(),applyToBuffer:function(){var t;return function(e,i,r){void 0==t&&(t=new M.Vector3),void 0===i&&(i=0),void 0===r&&(r=e.length/e.itemSize);for(var n=0,a=i;n<r;n++,a++)t.x=e.getX(a),t.y=e.getY(a),t.z=e.getZ(a),t.applyMatrix3(this),e.setXYZ(t.x,t.y,t.z);return e}}(),multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],s=t[6],h=t[7],u=t[8];return e*a*u-e*o*h-i*n*u+i*o*s+r*n*h-r*a*s},getInverse:function(t,e){M.Matrix4;var i=t.elements,r=this.elements,n=i[0],a=i[1],o=i[2],s=i[3],h=i[4],u=i[5],l=i[6],c=i[7],p=i[8],d=p*h-u*c,f=u*l-p*s,m=c*s-h*l,v=n*d+a*f+o*m;if(0==v){if(e)throw new Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}return r[0]=d,r[1]=o*c-p*a,r[2]=u*a-o*h,r[3]=f,r[4]=p*n-o*l,r[5]=o*s-u*n,r[6]=m,r[7]=a*l-c*n,r[8]=h*n-a*s,this.multiplyScalar(1/v)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},flattenToArrayOffset:function(t,e){var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}},M.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length},M.Matrix4.prototype={constructor:M.Matrix4,set:function(t,e,i,r,n,a,o,s,h,u,l,c,p,d,f,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=i,v[12]=r,v[1]=n,v[5]=a,v[9]=o,v[13]=s,v[2]=h,v[6]=u,v[10]=l,v[14]=c,v[3]=p,v[7]=d,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new M.Matrix4).fromArray(this.elements)},copy:function(t){return this.elements.set(t.elements),this},copyPosition:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},extractBasis:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this},extractRotation:function(){var t;return function(e){void 0==t&&(t=new M.Vector3);var i=this.elements,r=e.elements,n=1/t.setFromMatrixColumn(e,0).length(),a=1/t.setFromMatrixColumn(e,1).length(),o=1/t.setFromMatrixColumn(e,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[4]=r[4]*a,i[5]=r[5]*a,i[6]=r[6]*a,i[8]=r[8]*o,i[9]=r[9]*o,i[10]=r[10]*o,this}}(),makeRotationFromEuler:function(t){M.Euler;var e=this.elements,i=t.x,r=t.y,o=t.z,s=a(i),h=n(i),u=a(r),l=n(r),c=a(o),p=n(o);if("XYZ"===t.order){var d=s*c,f=s*p,m=h*c,v=h*p;e[0]=u*c,e[4]=-u*p,e[8]=l,e[1]=f+m*l,e[5]=d-v*l,e[9]=-h*u,e[2]=v-d*l,e[6]=m+f*l,e[10]=s*u}else if("YXZ"===t.order){var g=u*c,y=u*p,x=l*c,_=l*p;e[0]=g+_*h,e[4]=x*h-y,e[8]=s*l,e[1]=s*p,e[5]=s*c,e[9]=-h,e[2]=y*h-x,e[6]=_+g*h,e[10]=s*u}else if("ZXY"===t.order){var g=u*c,y=u*p,x=l*c,_=l*p;e[0]=g-_*h,e[4]=-s*p,e[8]=x+y*h,e[1]=y+x*h,e[5]=s*c,e[9]=_-g*h,e[2]=-s*l,e[6]=h,e[10]=s*u}else if("ZYX"===t.order){var d=s*c,f=s*p,m=h*c,v=h*p;e[0]=u*c,e[4]=m*l-f,e[8]=d*l+v,e[1]=u*p,e[5]=v*l+d,e[9]=f*l-m,e[2]=-l,e[6]=h*u,e[10]=s*u}else if("YZX"===t.order){var b=s*u,S=s*l,w=h*u,E=h*l;e[0]=u*c,e[4]=E-b*p,e[8]=w*p+S,e[1]=p,e[5]=s*c,e[9]=-h*c,e[2]=-l*c,e[6]=S*p+w,e[10]=b-E*p}else if("XZY"===t.order){var b=s*u,S=s*l,w=h*u,E=h*l;e[0]=u*c,e[4]=-p,e[8]=l*c,e[1]=b*p+E,e[5]=s*c,e[9]=S*p-w,e[2]=w*p-S,e[6]=h*c,e[10]=E*p+b}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,i=t.x,r=t.y,n=t.z,a=t.w,o=i+i,s=r+r,h=n+n,u=i*o,l=i*s,c=i*h,p=r*s,d=r*h,f=n*h,m=a*o,v=a*s,g=a*h;return e[0]=1-(p+f),e[4]=l-g,e[8]=c+v,e[1]=l+g,e[5]=1-(u+f),e[9]=d-m,e[2]=c-v,e[6]=d+m,e[10]=1-(u+p),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(){var t,e,i;return function(r,n,a){void 0==t&&(t=new M.Vector3),void 0==e&&(e=new M.Vector3),void 0==i&&(i=new M.Vector3);var o=this.elements;return i.subVectors(r,n).normalize(),0===i.lengthSq()&&(i.z=1),t.crossVectors(a,i).normalize(),0===t.lengthSq()&&(i.x+=1e-4,t.crossVectors(a,i).normalize()),e.crossVectors(i,t),o[0]=t.x,o[4]=e.x,o[8]=i.x,o[1]=t.y,o[5]=e.y,o[9]=i.y,o[2]=t.z,o[6]=e.z,o[10]=i.z,this}}(),multiply:function(t,e){return void 0===e?this.multiplyMatrices(this,t):this.multiplyMatrices(t,e)},multiplyMatrices:function(t,e){var i=t.elements,r=e.elements,n=this.elements,a=i[0],o=i[4],s=i[8],h=i[12],u=i[1],l=i[5],c=i[9],p=i[13],d=i[2],f=i[6],m=i[10],v=i[14],g=i[3],y=i[7],x=i[11],M=i[15],_=r[0],b=r[4],S=r[8],w=r[12],E=r[1],T=r[5],A=r[9],L=r[13],R=r[2],C=r[6],U=r[10],F=r[14],P=r[3],D=r[7],N=r[11],B=r[15];return n[0]=a*_+o*E+s*R+h*P,n[4]=a*b+o*T+s*C+h*D,n[8]=a*S+o*A+s*U+h*N,n[12]=a*w+o*L+s*F+h*B,n[1]=u*_+l*E+c*R+p*P,n[5]=u*b+l*T+c*C+p*D,n[9]=u*S+l*A+c*U+p*N,n[13]=u*w+l*L+c*F+p*B,n[2]=d*_+f*E+m*R+v*P,n[6]=d*b+f*T+m*C+v*D,n[10]=d*S+f*A+m*U+v*N,n[14]=d*w+f*L+m*F+v*B,n[3]=g*_+y*E+x*R+M*P,n[7]=g*b+y*T+x*C+M*D,n[11]=g*S+y*A+x*U+M*N,n[15]=g*w+y*L+x*F+M*B,this},multiplyToArray:function(t,e,i){var r=this.elements;return this.multiplyMatrices(t,e),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToVector3Array:function(){var t;return function(e,i,r){void 0==t&&(t=new M.Vector3),void 0===i&&(i=0),void 0===r&&(r=e.length);for(var n=0,a=i;n<r;n+=3,a+=3)t.fromArray(e,a),t.applyMatrix4(this),t.toArray(e,a);return e}}(),applyToBuffer:function(){var t;return function(e,i,r){void 0==t&&(t=new M.Vector3),void 0===i&&(i=0),void 0===r&&(r=e.length/e.itemSize);for(var n=0,a=i;n<r;n++,a++)t.x=e.getX(a),t.y=e.getY(a),t.z=e.getZ(a),t.applyMatrix4(this),e.setXYZ(t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],i=t[4],r=t[8],n=t[12],a=t[1],o=t[5],s=t[9],h=t[13],u=t[2],l=t[6],c=t[10],p=t[14];return t[3]*(+n*s*l-r*h*l-n*o*c+i*h*c+r*o*p-i*s*p)+t[7]*(+e*s*p-e*h*c+n*a*c-r*a*p+r*h*u-n*s*u)+t[11]*(+e*h*l-e*o*p-n*a*l+i*a*p+n*o*u-i*h*u)+t[15]*(-r*o*u-e*s*l+e*o*c+r*a*l-i*a*c+i*s*u)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArrayOffset:function(t,e){var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t},getPosition:function(){var t;return function(){return void 0==t&&(t=new M.Vector3),t.setFromMatrixColumn(this,3)}}(),setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var i=this.elements,r=t.elements,n=r[0],a=r[1],o=r[2],s=r[3],h=r[4],u=r[5],l=r[6],c=r[7],p=r[8],d=r[9],f=r[10],m=r[11],v=r[12],g=r[13],y=r[14],x=r[15],M=d*y*c-g*f*c+g*l*m-u*y*m-d*l*x+u*f*x,_=v*f*c-p*y*c-v*l*m+h*y*m+p*l*x-h*f*x,b=p*g*c-v*d*c+v*u*m-h*g*m-p*u*x+h*d*x,S=v*d*l-p*g*l-v*u*f+h*g*f+p*u*y-h*d*y,w=n*M+a*_+o*b+s*S;if(0==w){if(e)throw new Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");return this.identity()}return i[0]=M,i[1]=g*f*s-d*y*s-g*o*m+a*y*m+d*o*x-a*f*x,i[2]=u*y*s-g*l*s+g*o*c-a*y*c-u*o*x+a*l*x,i[3]=d*l*s-u*f*s-d*o*c+a*f*c+u*o*m-a*l*m,i[4]=_,i[5]=p*y*s-v*f*s+v*o*m-n*y*m-p*o*x+n*f*x,i[6]=v*l*s-h*y*s-v*o*c+n*y*c+h*o*x-n*l*x,i[7]=h*f*s-p*l*s+p*o*c-n*f*c-h*o*m+n*l*m,i[8]=b,i[9]=v*d*s-p*g*s-v*a*m+n*g*m+p*a*x-n*d*x,i[10]=h*g*s-v*u*s+v*a*c-n*g*c-h*a*x+n*u*x,i[11]=p*u*s-h*d*s-p*a*c+n*d*c+h*a*m-n*u*m,i[12]=S,i[13]=p*g*o-v*d*o+v*a*f-n*g*f-p*a*y+n*d*y,i[14]=v*u*o-h*g*o-v*a*l+n*g*l+h*a*y-n*u*y,i[15]=h*d*o-p*u*o+p*a*l-n*d*l-h*a*f+n*u*f,this.multiplyScalar(1/w)},scale:function(t){var e=this.elements,i=t.x,r=t.y,n=t.z;return e[0]*=i,e[4]*=r,e[8]*=n,e[1]*=i,e[5]*=r,e[9]*=n,e[2]*=i,e[6]*=r,e[10]*=n,e[3]*=i,e[7]*=r,e[11]*=n,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return u(v(e,i,r))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=a(t),i=n(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this},makeRotationY:function(t){var e=a(t),i=n(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=a(t),i=n(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=a(e),r=n(e),o=1-i,s=t.x,h=t.y,u=t.z,l=o*s,c=o*h;return this.set(l*s+i,l*h-r*u,l*u+r*h,0,l*h+r*u,c*h+i,c*u-r*s,0,l*u-r*h,c*u+r*s,o*u*u+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},compose:function(t,e,i){return this.makeRotationFromQuaternion(e),this.scale(i),this.setPosition(t),this},decompose:function(){var t,e;return function(i,r,n){void 0==t&&(t=new M.Vector3),void 0==e&&(e=new M.Matrix4);var a=this.elements,o=t.set(a[0],a[1],a[2]).length(),s=t.set(a[4],a[5],a[6]).length(),h=t.set(a[8],a[9],a[10]).length();0>this.determinant()&&(o=-o),i.x=a[12],i.y=a[13],i.z=a[14],e.elements.set(this.elements);var u=1/o,l=1/s,c=1/h;return e.elements[0]*=u,e.elements[1]*=u,e.elements[2]*=u,e.elements[4]*=l,e.elements[5]*=l,e.elements[6]*=l,e.elements[8]*=c,e.elements[9]*=c,e.elements[10]*=c,r.setFromRotationMatrix(e),n.x=o,n.y=s,n.z=h,this}}(),makeFrustum:function(t,e,i,r,n,a){var o=this.elements;return o[0]=2*n/(e-t),o[4]=0,o[8]=(e+t)/(e-t),o[12]=0,o[1]=0,o[5]=2*n/(r-i),o[9]=(r+i)/(r-i),o[13]=0,o[2]=0,o[6]=0,o[10]=-(a+n)/(a-n),o[14]=-2*a*n/(a-n),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(t,e,r,n){var a=r*i(M.Math.degToRad(.5*t)),o=-a;return this.makeFrustum(o*e,a*e,o,a,r,n)},makeOrthographic:function(t,e,i,r,n,a){var o=this.elements,s=1/(e-t),h=1/(i-r),u=1/(a-n);return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-(e+t)*s,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-(i+r)*h,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-(a+n)*u,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,i=t.elements,r=0;16>r;r++)if(e[r]!==i[r])return!1;return!0},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}},M.Plane=function(t,e){this.normal=void 0===t?new M.Vector3(1,0,0):t,this.constant=void 0===e?0:e},M.Plane.prototype={constructor:M.Plane,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new M.Vector3,e=new M.Vector3;return function(i,r,n){var a=t.subVectors(n,r).cross(e.subVectors(i,r)).normalize();return this.setFromNormalAndCoplanarPoint(a,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(t,e){var i=this.distanceToPoint(t);return(e||new M.Vector3).copy(this.normal).multiplyScalar(i)},intersectLine:function(){var t=new M.Vector3;return function(e,i){var r=i||new M.Vector3,n=e.delta(t),a=this.normal.dot(n);if(0===a)return 0===this.distanceToPoint(e.start)?r.copy(e.start):void 0;var o=-(e.start.dot(this.normal)+this.constant)/a;return 0>o||1<o?void 0:r.copy(n).multiplyScalar(o).add(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return 0>e&&0<i||0>i&&0<e},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return(t||new M.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new M.Vector3,e=new M.Vector3,i=new M.Matrix3;return function(r,n){var a=n||i.getNormalMatrix(r),o=t.copy(this.normal).applyMatrix3(a),s=this.coplanarPoint(e);return s.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(o,s),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}},M.Quaternion=function(t,e,i,r){this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0===r?1:r},M.Quaternion.prototype={constructor:M.Quaternion,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t,this.onChangeCallback()},set:function(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(0==t instanceof M.Euler)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var i=a(t._x/2),r=a(t._y/2),o=a(t._z/2),s=n(t._x/2),h=n(t._y/2),u=n(t._z/2),l=t.order;return"XYZ"===l?(this._x=s*r*o+i*h*u,this._y=i*h*o-s*r*u,this._z=i*r*u+s*h*o,this._w=i*r*o-s*h*u):"YXZ"===l?(this._x=s*r*o+i*h*u,this._y=i*h*o-s*r*u,this._z=i*r*u-s*h*o,this._w=i*r*o+s*h*u):"ZXY"===l?(this._x=s*r*o-i*h*u,this._y=i*h*o+s*r*u,this._z=i*r*u+s*h*o,this._w=i*r*o-s*h*u):"ZYX"===l?(this._x=s*r*o-i*h*u,this._y=i*h*o+s*r*u,this._z=i*r*u-s*h*o,this._w=i*r*o+s*h*u):"YZX"===l?(this._x=s*r*o+i*h*u,this._y=i*h*o+s*r*u,this._z=i*r*u-s*h*o,this._w=i*r*o-s*h*u):"XZY"===l&&(this._x=s*r*o-i*h*u,this._y=i*h*o-s*r*u,this._z=i*r*u+s*h*o,this._w=i*r*o+s*h*u),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var i=e/2,r=n(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=a(i),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,i=t.elements,r=i[0],n=i[4],a=i[8],o=i[1],s=i[5],h=i[9],l=i[2],c=i[6],p=i[10],d=r+s+p;return 0<d?(e=.5/u(d+1),this._w=.25/e,this._x=(c-h)*e,this._y=(a-l)*e,this._z=(o-n)*e):r>s&&r>p?(e=2*u(1+r-s-p),this._w=(c-h)/e,this._x=.25*e,this._y=(n+o)/e,this._z=(a+l)/e):s>p?(e=2*u(1+s-r-p),this._w=(a-l)/e,this._x=(n+o)/e,this._y=.25*e,this._z=(h+c)/e):(e=2*u(1+p-r-s),this._w=(o-n)/e,this._x=(a+l)/e,this._y=(h+c)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e;return function(i,r){return void 0==t&&(t=new M.Vector3),(e=i.dot(r)+1)<1e-6?(e=0,s(i.x)>s(i.z)?t.set(-i.y,i.x,0):t.set(0,-i.z,i.y)):t.crossVectors(i,r),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return u(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x*=t,this._y*=t,this._z*=t,this._w*=t),this.onChangeCallback(),this},multiply:function(t,e){return void 0===e?this.multiplyQuaternions(this,t):this.multiplyQuaternions(t,e)},multiplyQuaternions:function(t,e){var i=t._x,r=t._y,n=t._z,a=t._w,o=e._x,s=e._y,h=e._z,u=e._w;return this._x=i*u+a*o+r*h-n*s,this._y=r*u+a*s+n*o-i*h,this._z=n*u+a*h+i*s-r*o,this._w=a*u-i*o-r*s-n*h,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,r=this._y,a=this._z,h=this._w,l=h*t._w+i*t._x+r*t._y+a*t._z;if(0>l?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,l=-l):this.copy(t),1<=l)return this._w=h,this._x=i,this._y=r,this._z=a,this;var c=u(1-l*l);if(.001>s(c))return this._w=.5*(h+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(a+this._z),this;var p=o(c,l),d=n((1-e)*p)/c,f=n(e*p)/c;return this._w=h*d+this._w*f,this._x=i*d+this._x*f,this._y=r*d+this._y*f,this._z=a*d+this._z*f,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}},Object.assign(M.Quaternion,{slerp:function(t,e,i,r){return i.copy(t).slerp(e,r)},slerpFlat:function(t,e,i,r,a,s,h){var l=i[r+0],c=i[r+1],p=i[r+2],d=i[r+3],f=a[s+0],m=a[s+1],v=a[s+2],g=a[s+3];if(d!==g||l!==f||c!==m||p!==v){var y=1-h,M=l*f+c*m+p*v+d*g,_=0<=M?1:-1,b=1-M*M;if(b>x){var S=u(b),w=o(S,M*_);y=n(y*w)/S,h=n(h*w)/S}var E=h*_;if(l=l*y+f*E,c=c*y+m*E,p=p*y+v*E,d=d*y+g*E,y==1-h){var T=1/u(l*l+c*c+p*p+d*d);l*=T,c*=T,p*=T,d*=T}}t[e]=l,t[e+1]=c,t[e+2]=p,t[e+3]=d}}),M.Triangle=function(t,e,i){this.a=void 0===t?new M.Vector3:t,this.b=void 0===e?new M.Vector3:e,this.c=void 0===i?new M.Vector3:i},M.Triangle.normal=function(){var t=new M.Vector3;return function(e,i,r,n){var a=n||new M.Vector3;a.subVectors(r,i),t.subVectors(e,i),a.cross(t);var o=a.lengthSq();return 0<o?a.multiplyScalar(1/u(o)):a.set(0,0,0)}}(),M.Triangle.barycoordFromPoint=function(){var t=new M.Vector3,e=new M.Vector3,i=new M.Vector3;return function(r,n,a,o,s){t.subVectors(o,n),e.subVectors(a,n),i.subVectors(r,n);var h=t.dot(t),u=t.dot(e),l=t.dot(i),c=e.dot(e),p=e.dot(i),d=h*c-u*u,f=s||new M.Vector3;if(0==d)return f.set(-2,-1,-1);var m=1/d,v=(c*l-u*p)*m,g=(h*p-u*l)*m;return f.set(1-v-g,g,v)}}(),M.Triangle.containsPoint=function(){var t=new M.Vector3;return function(e,i,r,n){var a=M.Triangle.barycoordFromPoint(e,i,r,n,t);return 0<=a.x&&0<=a.y&&1>=a.x+a.y}}(),M.Triangle.prototype={constructor:M.Triangle,set:function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this},setFromPointsAndIndices:function(t,e,i,r){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:function(){var t=new M.Vector3,e=new M.Vector3;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),midpoint:function(t){return(t||new M.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return M.Triangle.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new M.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return M.Triangle.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return M.Triangle.containsPoint(t,this.a,this.b,this.c)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},M.Box3=function(t,e){this.min=void 0===t?new M.Vector3(1/0,1/0,1/0):t,this.max=void 0===e?new M.Vector3(-1/0,-1/0,-1/0):e},M.Box3.prototype={constructor:M.Box3,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){this.makeEmpty();for(var e=1/0,i=1/0,r=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,h=t.length;s<h;s+=3){var u=t[s],l=t[s+1],c=t[s+2];u<e&&(e=u),l<i&&(i=l),c<r&&(r=c),u>n&&(n=u),l>a&&(a=l),c>o&&(o=c)}this.min.set(e,i,r),this.max.set(n,a,o)},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new M.Vector3;return function(e,i){var r=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),setFromObject:function(){var t;return function(e){void 0==t&&(t=new M.Box3);var i=this;return this.makeEmpty(),e.updateMatrixWorld(!0),e.traverse(function(e){var r=e.geometry;void 0!==r&&(null===r.boundingBox&&r.computeBoundingBox(),!1===r.boundingBox.isEmpty()&&(t.copy(r.boundingBox),t.applyMatrix4(e.matrixWorld),i.union(t)))}),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){return(t||new M.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new M.Vector3).subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return(e||new M.Vector3).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(){var t;return function(e){return void 0==t&&(t=new M.Vector3),this.clampPoint(e.center,t),t.distanceToSquared(e.center)<=e.radius*e.radius}}(),intersectsPlane:function(t){var e,i;return 0<t.normal.x?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),0<t.normal.y?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),0<t.normal.z?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=t.constant&&i>=t.constant},clampPoint:function(t,e){return(e||new M.Vector3).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new M.Vector3;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new M.Vector3;return function(e){var i=e||new M.Sphere;return i.center=this.center(),i.radius=.5*this.size(t).length(),i}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(){var t=[new M.Vector3,new M.Vector3,new M.Vector3,new M.Vector3,new M.Vector3,new M.Vector3,new M.Vector3,new M.Vector3];return function(e){return t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(t),this}}(),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},M.Euler=function(t,e,i,r){this._x=t||0,this._y=e||0,this._z=i||0,this._order=r||M.Euler.DefaultOrder},M.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],M.Euler.DefaultOrder="XYZ",M.Euler.prototype={constructor:M.Euler,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t,this.onChangeCallback()},set:function(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,i){var r=Math.asin,n=M.Math.clamp,a=t.elements,h=a[0],u=a[4],l=a[8],c=a[1],p=a[5],d=a[9],f=a[2],m=a[6],v=a[10];return"XYZ"===(e=e||this._order)?(this._y=r(n(l,-1,1)),.99999>s(l)?(this._x=o(-d,v),this._z=o(-u,h)):(this._x=o(m,p),this._z=0)):"YXZ"===e?(this._x=r(-n(d,-1,1)),.99999>s(d)?(this._y=o(l,v),this._z=o(c,p)):(this._y=o(-f,h),this._z=0)):"ZXY"===e?(this._x=r(n(m,-1,1)),.99999>s(m)?(this._y=o(-f,v),this._z=o(-u,p)):(this._y=0,this._z=o(c,h))):"ZYX"===e?(this._y=r(-n(f,-1,1)),.99999>s(f)?(this._x=o(m,v),this._z=o(c,h)):(this._x=0,this._z=o(-u,p))):"YZX"===e?(this._z=r(n(c,-1,1)),.99999>s(c)?(this._x=o(-d,p),this._y=o(-f,h)):(this._x=0,this._y=o(l,v))):"XZY"===e&&(this._z=r(-n(u,-1,1)),.99999>s(u)?(this._x=o(m,p),this._y=o(l,h)):(this._x=o(-d,v),this._y=0)),this._order=e,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var t;return function(e,i,r){return void 0==t&&(t=new M.Matrix4),t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,i,r),this}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var t=new M.Quaternion;return function(e){t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new M.Vector3(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}},M.Ray=function(t,e){this.origin=void 0===t?new M.Vector3:t,this.direction=void 0===e?new M.Vector3:e},M.Ray.prototype={constructor:M.Ray,set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return(e||new M.Vector3).copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){this.direction.copy(t).sub(this.origin).normalize()},recast:function(){var t=new M.Vector3;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){var i=e||new M.Vector3;i.subVectors(t,this.origin);var r=i.dot(this.direction);return 0>r?i.copy(this.origin):i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){return u(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new M.Vector3;return function(e){var i=t.subVectors(e,this.origin).dot(this.direction);return 0>i?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(i).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:function(){var t=new M.Vector3,e=new M.Vector3,i=new M.Vector3;return function(r,n,a,o){t.copy(r).add(n).multiplyScalar(.5),e.copy(n).sub(r).normalize(),i.copy(this.origin).sub(t);var h,u,l,c,p=.5*r.distanceTo(n),d=-this.direction.dot(e),f=i.dot(this.direction),m=-i.dot(e),y=i.lengthSq(),x=s(1-d*d);if(0<x)if(h=d*m-f,u=d*f-m,c=p*x,0<=h)if(u>=-c)if(u<=c){var M=1/x;l=(h*=M)*(h+d*(u*=M)+2*f)+u*(d*h+u+2*m)+y}else u=p,h=v(0,-(d*u+f)),l=-h*h+u*(u+2*m)+y;else u=-p,h=v(0,-(d*u+f)),l=-h*h+u*(u+2*m)+y;else u<=-c?(h=v(0,-(-d*p+f)),u=0<h?-p:g(v(-p,-m),p),l=-h*h+u*(u+2*m)+y):u<=c?(h=0,u=g(v(-p,-m),p),l=u*(u+2*m)+y):(h=v(0,-(d*p+f)),u=0<h?p:g(v(-p,-m),p),l=-h*h+u*(u+2*m)+y);else u=0<d?-p:p,h=v(0,-(d*u+f)),l=-h*h+u*(u+2*m)+y;return a&&a.copy(this.direction).multiplyScalar(h).add(this.origin),o&&o.copy(e).multiplyScalar(u).add(t),l}}(),intersectSphere:function(){var t=new M.Vector3;return function(e,i){t.subVectors(e.center,this.origin);var r=t.dot(this.direction),n=t.dot(t)-r*r,a=e.radius*e.radius;if(n>a)return null;var o=u(a-n),s=r-o,h=r+o;return 0>s&&0>h?null:0>s?this.at(h,i):this.at(s,i)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(t.normal)+t.constant)/e;return 0<=i?i:null},intersectPlane:function(t,e){var i=this.distanceToPlane(t);return null===i?null:this.at(i,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||!!(0>t.normal.dot(this.direction)*e)},intersectBox:function(t,e){var i,r,n,a,o,s,h=1/this.direction.x,u=1/this.direction.y,l=1/this.direction.z,c=this.origin;return 0<=h?(i=(t.min.x-c.x)*h,r=(t.max.x-c.x)*h):(i=(t.max.x-c.x)*h,r=(t.min.x-c.x)*h),0<=u?(n=(t.min.y-c.y)*u,a=(t.max.y-c.y)*u):(n=(t.max.y-c.y)*u,a=(t.min.y-c.y)*u),i>a||n>r?null:((n>i||i!==i)&&(i=n),(a<r||r!==r)&&(r=a),0<=l?(o=(t.min.z-c.z)*l,s=(t.max.z-c.z)*l):(o=(t.max.z-c.z)*l,s=(t.min.z-c.z)*l),i>s||o>r?null:((o>i||i!==i)&&(i=o),(s<r||r!==r)&&(r=s),0>r?null:this.at(0<=i?i:r,e)))},intersectsBox:function(){var t=new M.Vector3;return function(e){return null!==this.intersectBox(e,t)}}(),intersectTriangle:function(){var t=new M.Vector3,e=new M.Vector3,i=new M.Vector3,r=new M.Vector3;return function(n,a,o,s,h){e.subVectors(a,n),i.subVectors(o,n),r.crossVectors(e,i);var u,l=this.direction.dot(r);if(0<l){if(s)return null;u=1}else{if(!(0>l))return null;u=-1,l=-l}t.subVectors(this.origin,n);var c=u*this.direction.dot(i.crossVectors(t,i));if(0>c)return null;var p=u*this.direction.dot(e.cross(t));if(0>p)return null;if(c+p>l)return null;var d=-u*t.dot(r);return 0>d?null:this.at(d/l,h)}}(),applyMatrix4:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}},M.Sphere=function(t,e){this.center=void 0===t?new M.Vector3:t,this.radius=void 0===e?0:e},M.Sphere.prototype={constructor:M.Sphere,set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t=new M.Box3;return function(e,i){var r=this.center;void 0===i?t.setFromPoints(e).center(r):r.copy(i);for(var n=0,a=0,o=e.length;a<o;a++)n=v(n,r.distanceToSquared(e[a]));return this.radius=u(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return s(this.center.dot(t.normal)-t.constant)<=this.radius},clampPoint:function(t,e){var i=this.center.distanceToSquared(t),r=e||new M.Vector3;return r.copy(t),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(t){var e=t||new M.Box3;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius*=t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}},M.Frustum=function(t,e,i,r,n,a){this.planes=[void 0===t?new M.Plane:t,void 0===e?new M.Plane:e,void 0===i?new M.Plane:i,void 0===r?new M.Plane:r,void 0===n?new M.Plane:n,void 0===a?new M.Plane:a]},M.Frustum.prototype={constructor:M.Frustum,set:function(t,e,i,r,n,a){var o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(r),o[4].copy(n),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,i=0;6>i;i++)e[i].copy(t.planes[i]);return this},setFromMatrix:function(t){var e=this.planes,i=t.elements,r=i[0],n=i[1],a=i[2],o=i[3],s=i[4],h=i[5],u=i[6],l=i[7],c=i[8],p=i[9],d=i[10],f=i[11],m=i[12],v=i[13],g=i[14],y=i[15];return e[0].setComponents(o-r,l-s,f-c,y-m).normalize(),e[1].setComponents(o+r,l+s,f+c,y+m).normalize(),e[2].setComponents(o+n,l+h,f+p,y+v).normalize(),e[3].setComponents(o-n,l-h,f-p,y-v).normalize(),e[4].setComponents(o-a,l-u,f-d,y-g).normalize(),e[5].setComponents(o+a,l+u,f+d,y+g).normalize(),this},intersectsObject:function(){var t=new M.Sphere;return function(e){var i=e.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),t.copy(i.boundingSphere),t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,i=t.center,r=-t.radius,n=0;6>n;n++)if(e[n].distanceToPoint(i)<r)return!1;return!0},intersectsBox:function(){var t=new M.Vector3,e=new M.Vector3;return function(i){for(var r,n=this.planes,a=0;6>a;a++){r=n[a],t.x=0<r.normal.x?i.min.x:i.max.x,e.x=0<r.normal.x?i.max.x:i.min.x,t.y=0<r.normal.y?i.min.y:i.max.y,e.y=0<r.normal.y?i.max.y:i.min.y,t.z=0<r.normal.z?i.min.z:i.max.z,e.z=0<r.normal.z?i.max.z:i.min.z;var o=r.distanceToPoint(t),s=r.distanceToPoint(e);if(0>o&&0>s)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,i=0;6>i;i++)if(0>e[i].distanceToPoint(t))return!1;return!0}},M.EventDispatcher=function(){},M.EventDispatcher.prototype={constructor:M.EventDispatcher,apply:function(t){t.addEventListener=M.EventDispatcher.prototype.addEventListener,t.hasEventListener=M.EventDispatcher.prototype.hasEventListener,t.removeEventListener=M.EventDispatcher.prototype.removeEventListener,t.dispatchEvent=M.EventDispatcher.prototype.dispatchEvent},addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i){var r=i.indexOf(e);-1!==r&&i.splice(r,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=[],r=e.length,n=0;n<r;n++)i[n]=e[n];for(n=0;n<r;n++)i[n].call(this,t)}}}},M.Layers=function(){this.mask=1},M.Layers.prototype={constructor:M.Layers,set:function(t){this.mask=1<<t},enable:function(t){this.mask|=1<<t},toggle:function(t){this.mask^=1<<t},disable:function(t){this.mask&=~(1<<t)},test:function(t){return 0!=(this.mask&t.mask)}},M.Object3D=function(){Object.defineProperty(this,"id",{value:M.Object3DIdCount++}),this.uuid=M.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=M.Object3D.DefaultUp.clone();var t=new M.Vector3,e=new M.Euler,i=new M.Quaternion,r=new M.Vector3(1,1,1);e.onChange(function(){i.setFromEuler(e,!1)}),i.onChange(function(){e.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:r},modelViewMatrix:{value:new M.Matrix4},normalMatrix:{value:new M.Matrix3}}),this.rotationAutoUpdate=!0,this.matrix=new M.Matrix4,this.matrixWorld=new M.Matrix4,this.matrixAutoUpdate=M.Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new M.Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},M.Object3D.DefaultUp=new M.Vector3(0,1,0),M.Object3D.DefaultMatrixAutoUpdate=!0,M.Object3D.prototype={constructor:M.Object3D,applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new M.Quaternion;return function(e,i){return t.setFromAxisAngle(e,i),this.quaternion.multiply(t),this}}(),rotateX:function(){var t=new M.Vector3(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new M.Vector3(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new M.Vector3(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new M.Vector3;return function(e,i){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(i)),this}}(),translateX:function(){var t=new M.Vector3(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new M.Vector3(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new M.Vector3(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new M.Matrix4;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new M.Matrix4;return function(e){t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?this:(t instanceof M.Object3D&&(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)),this)},remove:function(t){if(1<arguments.length)for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);var i=this.children.indexOf(t);-1!==i&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(i,1))},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}},getWorldPosition:function(t){var e=t||new M.Vector3;return this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new M.Vector3,e=new M.Vector3;return function(i){var r=i||new M.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,r,e),r}}(),getWorldRotation:function(){var t=new M.Quaternion;return function(e){var i=e||new M.Euler;return this.getWorldQuaternion(t),i.setFromQuaternion(t,this.rotation.order,!1)}}(),getWorldScale:function(){var t=new M.Vector3,e=new M.Quaternion;return function(i){var r=i||new M.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,r),r}}(),getWorldDirection:function(){var t=new M.Quaternion;return function(e){var i=e||new M.Vector3;return this.getWorldQuaternion(t),i.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,i=0,r=e.length;i<r;i++)e[i].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,i=0,r=e.length;i<r;i++)e[i].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){!0===this.matrixAutoUpdate&&this.updateMatrix(),(!0===this.matrixWorldNeedsUpdate||!0===t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=0,i=this.children.length;e<i;e++)this.children[e].updateMatrixWorld(t)},toJSON:function(t){function e(t){var e=[];for(var i in t){var r=t[i];delete r.metadata,e.push(r)}return e}var i=void 0===t,r={};i&&(t={geometries:{},materials:{},textures:{},images:{}},r.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var n={};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),n.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===t.geometries[this.geometry.uuid]&&(t.geometries[this.geometry.uuid]=this.geometry.toJSON(t)),n.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===t.materials[this.material.uuid]&&(t.materials[this.material.uuid]=this.material.toJSON(t)),n.material=this.material.uuid),0<this.children.length){n.children=[];for(var a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(t).object)}if(i){var o=e(t.geometries),s=e(t.materials),h=e(t.textures),u=e(t.images);0<o.length&&(r.geometries=o),0<s.length&&(r.materials=s),0<h.length&&(r.textures=h),0<u.length&&(r.images=u)}return r.object=n,r},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.rotationAutoUpdate=t.rotationAutoUpdate,this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var i,r=0;r<t.children.length;r++)i=t.children[r],this.add(i.clone());return this}},M.EventDispatcher.prototype.apply(M.Object3D.prototype),M.Object3DIdCount=0,M.Face3=function(t,e,i,r,n,a){this.a=t,this.b=e,this.c=i,this.normal=r instanceof M.Vector3?r:new M.Vector3,this.vertexNormals=Array.isArray(r)?r:[],this.color=n instanceof M.Color?n:new M.Color,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0===a?0:a},M.Face3.prototype={constructor:M.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(var e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}},M.BufferAttribute=function(t,e){this.uuid=M.Math.generateUUID(),this.array=t,this.itemSize=e,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},M.BufferAttribute.prototype={constructor:M.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(t){!0===t&&this.version++},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.dynamic=t.dynamic,this},copyAt:function(t,e,i){t*=this.itemSize,i*=e.itemSize;for(var r=0,n=this.itemSize;r<n;r++)this.array[t+r]=e.array[i+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e,i=this.array,r=0,n=0,a=t.length;n<a;n++)void 0===(e=t[n])&&(e=new M.Color),i[r++]=e.r,i[r++]=e.g,i[r++]=e.b;return this},copyIndicesArray:function(t){for(var e,i=this.array,r=0,n=0,a=t.length;n<a;n++)e=t[n],i[r++]=e.a,i[r++]=e.b,i[r++]=e.c;return this},copyVector2sArray:function(t){for(var e,i=this.array,r=0,n=0,a=t.length;n<a;n++)void 0===(e=t[n])&&(e=new M.Vector2),i[r++]=e.x,i[r++]=e.y;return this},copyVector3sArray:function(t){for(var e,i=this.array,r=0,n=0,a=t.length;n<a;n++)void 0===(e=t[n])&&(e=new M.Vector3),i[r++]=e.x,i[r++]=e.y,i[r++]=e.z;return this},copyVector4sArray:function(t){for(var e,i=this.array,r=0,n=0,a=t.length;n<a;n++)void 0===(e=t[n])&&(e=new M.Vector4),i[r++]=e.x,i[r++]=e.y,i[r++]=e.z,i[r++]=e.w;return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this},setXYZ:function(t,e,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this},setXYZW:function(t,e,i,r,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this.array[t+3]=n,this},clone:function(){return(new this.constructor).copy(this)}},M.Int8Attribute=function(t,e){return new M.BufferAttribute(new Int8Array(t),e)},M.Uint8Attribute=function(t,e){return new M.BufferAttribute(new Uint8Array(t),e)},M.Uint8ClampedAttribute=function(t,e){return new M.BufferAttribute(new Uint8ClampedArray(t),e)},M.Int16Attribute=function(t,e){return new M.BufferAttribute(new Int16Array(t),e)},M.Uint16Attribute=function(t,e){return new M.BufferAttribute(new Uint16Array(t),e)},M.Int32Attribute=function(t,e){return new M.BufferAttribute(new Int32Array(t),e)},M.Uint32Attribute=function(t,e){return new M.BufferAttribute(new Uint32Array(t),e)},M.Float32Attribute=function(t,e){return new M.BufferAttribute(new Float32Array(t),e)},M.Float64Attribute=function(t,e){return new M.BufferAttribute(new Float64Array(t),e)},M.DynamicBufferAttribute=function(t,e){return new M.BufferAttribute(t,e).setDynamic(!0)},M.InstancedBufferAttribute=function(t,e,i){M.BufferAttribute.call(this,t,e),this.meshPerAttribute=i||1},M.InstancedBufferAttribute.prototype=Object.create(M.BufferAttribute.prototype),M.InstancedBufferAttribute.prototype.constructor=M.InstancedBufferAttribute,M.InstancedBufferAttribute.prototype.copy=function(t){return M.BufferAttribute.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},M.BufferGeometry=function(){Object.defineProperty(this,"id",{value:M.GeometryIdCount++}),this.uuid=M.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}},M.BufferGeometry.prototype={constructor:M.BufferGeometry,getIndex:function(){return this.index},setIndex:function(t){this.index=t},addAttribute:function(t,e){return 0==e instanceof M.BufferAttribute&&0==e instanceof M.InterleavedBufferAttribute?void this.addAttribute(t,new M.BufferAttribute(arguments[1],arguments[2])):"index"===t?void this.setIndex(e):(this.attributes[t]=e,this)},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:void 0===i?0:i})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToVector3Array(e.array),e.needsUpdate=!0);var i=this.attributes.normal;return void 0!==i&&((new M.Matrix3).getNormalMatrix(t).applyToVector3Array(i.array),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t;return function(e){return void 0==t&&(t=new M.Matrix4),t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t;return function(e){return void 0==t&&(t=new M.Matrix4),t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t;return function(e){return void 0==t&&(t=new M.Matrix4),t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t;return function(e,i,r){return void 0==t&&(t=new M.Matrix4),t.makeTranslation(e,i,r),this.applyMatrix(t),this}}(),scale:function(){var t;return function(e,i,r){return void 0==t&&(t=new M.Matrix4),t.makeScale(e,i,r),this.applyMatrix(t),this}}(),lookAt:function(){var t;return function(e){void 0==t&&(t=new M.Object3D),t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){this.computeBoundingBox();var t=this.boundingBox.center().negate();return this.translate(t.x,t.y,t.z),t},setFromObject:function(t){var e=t.geometry;if(t instanceof M.Points||t instanceof M.Line){var i=new M.Float32Attribute(3*e.vertices.length,3),r=new M.Float32Attribute(3*e.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(e.vertices)),this.addAttribute("color",r.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var n=new M.Float32Attribute(e.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t instanceof M.Mesh&&e instanceof M.Geometry&&this.fromGeometry(e);return this},updateFromObject:function(t){var e=t.geometry;if(t instanceof M.Mesh){var i=e.__directGeometry;if(void 0===i)return this.fromGeometry(e);i.verticesNeedUpdate=e.verticesNeedUpdate,i.normalsNeedUpdate=e.normalsNeedUpdate,i.colorsNeedUpdate=e.colorsNeedUpdate,i.uvsNeedUpdate=e.uvsNeedUpdate,i.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=i}if(!0===e.verticesNeedUpdate&&(void 0!==(r=this.attributes.position)&&(r.copyVector3sArray(e.vertices),r.needsUpdate=!0),e.verticesNeedUpdate=!1),!0===e.normalsNeedUpdate&&(void 0!==(r=this.attributes.normal)&&(r.copyVector3sArray(e.normals),r.needsUpdate=!0),e.normalsNeedUpdate=!1),!0===e.colorsNeedUpdate&&(void 0!==(r=this.attributes.color)&&(r.copyColorsArray(e.colors),r.needsUpdate=!0),e.colorsNeedUpdate=!1),e.uvsNeedUpdate&&(void 0!==(r=this.attributes.uv)&&(r.copyVector2sArray(e.uvs),r.needsUpdate=!0),e.uvsNeedUpdate=!1),e.lineDistancesNeedUpdate){var r=this.attributes.lineDistance;void 0!==r&&(r.copyArray(e.lineDistances),r.needsUpdate=!0),e.lineDistancesNeedUpdate=!1}return e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new M.DirectGeometry).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new M.BufferAttribute(e,3).copyVector3sArray(t.vertices)),0<t.normals.length){var i=new Float32Array(3*t.normals.length);this.addAttribute("normal",new M.BufferAttribute(i,3).copyVector3sArray(t.normals))}if(0<t.colors.length){var r=new Float32Array(3*t.colors.length);this.addAttribute("color",new M.BufferAttribute(r,3).copyColorsArray(t.colors))}if(0<t.uvs.length){var n=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new M.BufferAttribute(n,2).copyVector2sArray(t.uvs))}if(0<t.uvs2.length){var a=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new M.BufferAttribute(a,2).copyVector2sArray(t.uvs2))}if(0<t.indices.length){var o=new(65535<t.vertices.length?Uint32Array:Uint16Array)(3*t.indices.length);this.setIndex(new M.BufferAttribute(o,1).copyIndicesArray(t.indices))}for(var s in this.groups=t.groups,t.morphTargets){for(var h=[],u=t.morphTargets[s],l=0,c=u.length;l<c;l++){var p=u[l],d=new M.Float32Attribute(3*p.length,3);h.push(d.copyVector3sArray(p))}this.morphAttributes[s]=h}if(0<t.skinIndices.length){var f=new M.Float32Attribute(4*t.skinIndices.length,4);this.addAttribute("skinIndex",f.copyVector4sArray(t.skinIndices))}if(0<t.skinWeights.length){var m=new M.Float32Attribute(4*t.skinWeights.length,4);this.addAttribute("skinWeight",m.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:(new M.Vector3,function(){null===this.boundingBox&&(this.boundingBox=new M.Box3);var t=this.attributes.position.array;t&&this.boundingBox.setFromArray(t),(void 0===t||0===t.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}),computeBoundingSphere:function(){var t=new M.Box3,e=new M.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new M.Sphere);var i=this.attributes.position.array;if(i){var r=this.boundingSphere.center;t.setFromArray(i),t.center(r);for(var n=0,a=0,o=i.length;a<o;a+=3)e.fromArray(i,a),n=v(n,r.distanceToSquared(e));this.boundingSphere.radius=u(n),isNaN(this.boundingSphere.radius)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,i=this.groups;if(e.position){var r=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new M.BufferAttribute(new Float32Array(r.length),3));else for(var n=e.normal.array,a=0,o=n.length;a<o;a++)n[a]=0;var s,h,u,l=e.normal.array,c=new M.Vector3,p=new M.Vector3,d=new M.Vector3,f=new M.Vector3,m=new M.Vector3;if(t){var v=t.array;0===i.length&&this.addGroup(0,v.length);for(var g=0,y=i.length;g<y;++g)for(var x=i[g],_=x.start,b=x.count,a=_,o=_+b;a<o;a+=3)s=3*v[a+0],h=3*v[a+1],u=3*v[a+2],c.fromArray(r,s),p.fromArray(r,h),d.fromArray(r,u),f.subVectors(d,p),m.subVectors(c,p),f.cross(m),l[s]+=f.x,l[s+1]+=f.y,l[s+2]+=f.z,l[h]+=f.x,l[h+1]+=f.y,l[h+2]+=f.z,l[u]+=f.x,l[u+1]+=f.y,l[u+2]+=f.z}else for(var a=0,o=r.length;a<o;a+=9)c.fromArray(r,a),p.fromArray(r,a+3),d.fromArray(r,a+6),f.subVectors(d,p),m.subVectors(c,p),f.cross(m),l[a]=f.x,l[a+1]=f.y,l[a+2]=f.z,l[a+3]=f.x,l[a+4]=f.y,l[a+5]=f.z,l[a+6]=f.x,l[a+7]=f.y,l[a+8]=f.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(0!=t instanceof M.BufferGeometry){void 0===e&&(e=0);var i=this.attributes;for(var r in i)if(void 0!==t.attributes[r])for(var n=i[r],a=n.array,o=t.attributes[r],s=o.array,h=o.itemSize,u=0,l=h*e;u<s.length;u++,l++)a[l]=s[u];return this}},normalizeNormals:function(){for(var t,e,i,r,n=this.attributes.normal.array,a=0,o=n.length;a<o;a+=3)t=n[a],e=n[a+1],i=n[a+2],r=1/u(t*t+e*e+i*i),n[a]*=r,n[a+1]*=r,n[a+2]*=r},toNonIndexed:function(){if(null===this.index)return this;var t=new M.BufferGeometry,e=this.index.array,i=this.attributes;for(var r in i){for(var n=i[r],a=n.array,o=n.itemSize,s=new a.constructor(e.length*o),h=0,u=0,l=0,c=e.length;l<c;l++){h=e[l]*o;for(var p=0;p<o;p++)s[u++]=a[h++]}t.addAttribute(r,new M.BufferAttribute(s,o))}return t},toJSON:function(){var t={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};var r=this.index;if(null!==r){o=Array.prototype.slice.call(r.array);t.data.index={type:r.array.constructor.name,array:o}}var n=this.attributes;for(var i in n){var a=n[i],o=Array.prototype.slice.call(a.array);t.data.attributes[i]={itemSize:a.itemSize,type:a.array.constructor.name,array:o}}var s=this.groups;0<s.length&&(t.data.groups=JSON.parse(JSON.stringify(s)));var h=this.boundingSphere;return null!==h&&(t.data.boundingSphere={center:h.center.toArray(),radius:h.radius}),t},clone:function(){return(new M.BufferGeometry).copy(this)},copy:function(t){var e=t.index;null!==e&&this.setIndex(e.clone());var i=t.attributes;for(var r in i){var n=i[r];this.addAttribute(r,n.clone())}for(var a,o=t.groups,s=0,h=o.length;s<h;s++)a=o[s],this.addGroup(a.start,a.count);return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},M.EventDispatcher.prototype.apply(M.BufferGeometry.prototype),M.BufferGeometry.MaxIndex=65535,M.InterleavedBufferAttribute=function(t,e,i){this.uuid=M.Math.generateUUID(),this.data=t,this.itemSize=e,this.offset=i},M.InterleavedBufferAttribute.prototype={constructor:M.InterleavedBufferAttribute,get length(){return this.array.length},get count(){return this.data.count},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this},setXYZ:function(t,e,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this},setXYZW:function(t,e,i,r,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this.data.array[t+3]=n,this}},M.InstancedBufferGeometry=function(){M.BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0},M.InstancedBufferGeometry.prototype=Object.create(M.BufferGeometry.prototype),M.InstancedBufferGeometry.prototype.constructor=M.InstancedBufferGeometry,M.InstancedBufferGeometry.prototype.addGroup=function(t,e,i){this.groups.push({start:t,count:e,instances:i})},M.InstancedBufferGeometry.prototype.copy=function(t){var e=t.index;null!==e&&this.setIndex(e.clone());var i=t.attributes;for(var r in i){var n=i[r];this.addAttribute(r,n.clone())}for(var a,o=t.groups,s=0,h=o.length;s<h;s++)a=o[s],this.addGroup(a.start,a.count,a.instances);return this},M.EventDispatcher.prototype.apply(M.InstancedBufferGeometry.prototype),M.Geometry=function(){Object.defineProperty(this,"id",{value:M.GeometryIdCount++}),this.uuid=M.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},M.Geometry.prototype={constructor:M.Geometry,applyMatrix:function(t){for(var e=(new M.Matrix3).getNormalMatrix(t),i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(t);for(var n,i=0,r=this.faces.length;i<r;i++){(n=this.faces[i]).normal.applyMatrix3(e).normalize();for(var a=0,o=n.vertexNormals.length;a<o;a++)n.vertexNormals[a].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t;return function(e){return void 0==t&&(t=new M.Matrix4),t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t;return function(e){return void 0==t&&(t=new M.Matrix4),t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t;return function(e){return void 0==t&&(t=new M.Matrix4),t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t;return function(e,i,r){return void 0==t&&(t=new M.Matrix4),t.makeTranslation(e,i,r),this.applyMatrix(t),this}}(),scale:function(){var t;return function(e,i,r){return void 0==t&&(t=new M.Matrix4),t.makeScale(e,i,r),this.applyMatrix(t),this}}(),lookAt:function(){var t;return function(e){void 0==t&&(t=new M.Object3D),t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(t){function e(t,e,r,n){var a=void 0===o?[]:[l[t].clone(),l[e].clone(),l[r].clone()],d=void 0===s?[]:[i.colors[t].clone(),i.colors[e].clone(),i.colors[r].clone()],f=new M.Face3(t,e,r,a,d,n);i.faces.push(f),void 0!==h&&i.faceVertexUvs[0].push([c[t].clone(),c[e].clone(),c[r].clone()]),void 0!==u&&i.faceVertexUvs[1].push([p[t].clone(),p[e].clone(),p[r].clone()])}var i=this,r=null===t.index?void 0:t.index.array,n=t.attributes,a=n.position.array,o=void 0===n.normal?void 0:n.normal.array,s=void 0===n.color?void 0:n.color.array,h=void 0===n.uv?void 0:n.uv.array,u=void 0===n.uv2?void 0:n.uv2.array;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var l=[],c=[],p=[],d=0,f=0;d<a.length;d+=3,f+=2)i.vertices.push(new M.Vector3(a[d],a[d+1],a[d+2])),void 0!==o&&l.push(new M.Vector3(o[d],o[d+1],o[d+2])),void 0!==s&&i.colors.push(new M.Color(s[d],s[d+1],s[d+2])),void 0!==h&&c.push(new M.Vector2(h[f],h[f+1])),void 0!==u&&p.push(new M.Vector2(u[f],u[f+1]));if(void 0!==r){var m=t.groups;if(0<m.length)for(d=0;d<m.length;d++)for(var v=m[d],g=v.start,y=v.count,f=g;f<g+y;f+=3)e(r[f],r[f+1],r[f+2],v.materialIndex);else for(d=0;d<r.length;d+=3)e(r[d],r[d+1],r[d+2])}else for(d=0;d<a.length/3;d+=3)e(d,d+1,d+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var t=this.boundingBox.center().negate();return this.translate(t.x,t.y,t.z),t},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,i=0===e?1:1/e,r=new M.Matrix4;return r.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var t=new M.Vector3,e=new M.Vector3,i=0,r=this.faces.length;i<r;i++){var n=this.faces[i],a=this.vertices[n.a],o=this.vertices[n.b],s=this.vertices[n.c];t.subVectors(s,o),e.subVectors(a,o),t.cross(e),t.normalize(),n.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);var e,i,r,n,a,o;for(o=Array(this.vertices.length),e=0,i=this.vertices.length;e<i;e++)o[e]=new M.Vector3;if(t){var s,h,u,l=new M.Vector3,c=new M.Vector3;for(r=0,n=this.faces.length;r<n;r++)a=this.faces[r],s=this.vertices[a.a],h=this.vertices[a.b],u=this.vertices[a.c],l.subVectors(u,h),c.subVectors(s,h),l.cross(c),o[a.a].add(l),o[a.b].add(l),o[a.c].add(l)}else for(r=0,n=this.faces.length;r<n;r++)a=this.faces[r],o[a.a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(e=0,i=this.vertices.length;e<i;e++)o[e].normalize();for(r=0,n=this.faces.length;r<n;r++){var p=(a=this.faces[r]).vertexNormals;3===p.length?(p[0].copy(o[a.a]),p[1].copy(o[a.b]),p[2].copy(o[a.c])):(p[0]=o[a.a].clone(),p[1]=o[a.b].clone(),p[2]=o[a.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,i,r,n;for(i=0,r=this.faces.length;i<r;i++)for((n=this.faces[i]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),t=0,e=n.vertexNormals.length;t<e;t++)n.__originalVertexNormals[t]?n.__originalVertexNormals[t].copy(n.vertexNormals[t]):n.__originalVertexNormals[t]=n.vertexNormals[t].clone();var a=new M.Geometry;for(a.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var o=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(i=0,r=this.faces.length;i<r;i++)u=new M.Vector3,l={a:new M.Vector3,b:new M.Vector3,c:new M.Vector3},o.push(u),s.push(l)}var h=this.morphNormals[t];a.vertices=this.morphTargets[t].vertices,a.computeFaceNormals(),a.computeVertexNormals();var u,l;for(i=0,r=this.faces.length;i<r;i++)n=this.faces[i],u=h.faceNormals[i],l=h.vertexNormals[i],u.copy(n.normal),l.a.copy(n.vertexNormals[0]),l.b.copy(n.vertexNormals[1]),l.c.copy(n.vertexNormals[2])}for(i=0,r=this.faces.length;i<r;i++)n=this.faces[i],n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeTangents:function(){},computeLineDistances:function(){for(var t=0,e=this.vertices,i=0,r=e.length;i<r;i++)0<i&&(t+=e[i].distanceTo(e[i-1])),this.lineDistances[i]=t},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new M.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new M.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,i){if(0!=t instanceof M.Geometry){var r,n=this.vertices.length,a=this.vertices,o=t.vertices,s=this.faces,h=t.faces,u=this.faceVertexUvs[0],l=t.faceVertexUvs[0];void 0===i&&(i=0),void 0!==e&&(r=(new M.Matrix3).getNormalMatrix(e));for(var c=0,p=o.length;c<p;c++){var d=o[c].clone();void 0!==e&&d.applyMatrix4(e),a.push(d)}for(c=0,p=h.length;c<p;c++){var f,m,v,g=h[c],y=g.vertexNormals,x=g.vertexColors;(f=new M.Face3(g.a+n,g.b+n,g.c+n)).normal.copy(g.normal),void 0!==r&&f.normal.applyMatrix3(r).normalize();for(var _=0,b=y.length;_<b;_++)m=y[_].clone(),void 0!==r&&m.applyMatrix3(r).normalize(),f.vertexNormals.push(m);f.color.copy(g.color);for(var _=0,b=x.length;_<b;_++)v=x[_],f.vertexColors.push(v.clone());f.materialIndex=g.materialIndex+i,s.push(f)}for(c=0,p=l.length;c<p;c++){var S=l[c],w=[];if(void 0!==S){for(var _=0,b=S.length;_<b;_++)w.push(S[_].clone());u.push(w)}}}},mergeMesh:function(t){0==t instanceof M.Mesh||(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix))},mergeVertices:function(){var t,e,i,r,n,a,o,s,h={},u=[],l=[];for(i=0,r=this.vertices.length;i<r;i++)t=this.vertices[i],e=c(1e4*t.x)+"_"+c(1e4*t.y)+"_"+c(1e4*t.z),void 0===h[e]?(h[e]=i,u.push(this.vertices[i]),l[i]=u.length-1):l[i]=l[h[e]];var p=[];for(i=0,r=this.faces.length;i<r;i++){(n=this.faces[i]).a=l[n.a],n.b=l[n.b],n.c=l[n.c],a=[n.a,n.b,n.c];for(var d=0;3>d;d++)if(a[d]===a[(d+1)%3]){d,p.push(i);break}}for(i=p.length-1;0<=i;i--){var f=p[i];for(this.faces.splice(f,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(f,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,i=0;i<e;i++)t[i]._id=i;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var r,n,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===e&&(r=[]),o&&o.length===e&&(n=[]);for(var s,i=0;i<e;i++)s=t[i]._id,r&&r.push(a[s]),n&&n.push(o[s]);r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){function t(t,e,i){return i?t|1<<e:t&~(1<<e)}function e(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0===p[e]?(p[e]=c.length/3,c.push(t.x,t.y,t.z),p[e]):p[e]}function i(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0===f[e]?(f[e]=d.length,d.push(t.getHex()),f[e]):f[e]}function r(t){var e=t.x.toString()+t.y.toString();return void 0===v[e]?(v[e]=m.length/2,m.push(t.x,t.y),v[e]):v[e]}var n={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),void 0!==this.parameters){var a=this.parameters;for(var o in a)void 0!==a[o]&&(n[o]=a[o]);return n}for(var s,h=[],u=0;u<this.vertices.length;u++)s=this.vertices[u],h.push(s.x,s.y,s.z);for(var l=[],c=[],p={},d=[],f={},m=[],v={},u=0;u<this.faces.length;u++){var g=this.faces[u],y=void 0!==this.faceVertexUvs[0][u],x=0<g.normal.length(),M=0<g.vertexNormals.length,_=1!==g.color.r||1!==g.color.g||1!==g.color.b,b=0<g.vertexColors.length,S=0;if(S=t(S,0,0),S=t(S,1,!0),S=t(S,2,!1),S=t(S,3,y),S=t(S,4,x),S=t(S,5,M),S=t(S,6,_),S=t(S,7,b),l.push(S),l.push(g.a,g.b,g.c),l.push(g.materialIndex),y){var w=this.faceVertexUvs[0][u];l.push(r(w[0]),r(w[1]),r(w[2]))}if(x&&l.push(e(g.normal)),M){var E=g.vertexNormals;l.push(e(E[0]),e(E[1]),e(E[2]))}if(_&&l.push(i(g.color)),b){var T=g.vertexColors;l.push(i(T[0]),i(T[1]),i(T[2]))}}return n.data={},n.data.vertices=h,n.data.normals=c,0<d.length&&(n.data.colors=d),0<m.length&&(n.data.uvs=[m]),n.data.faces=l,n},clone:function(){return(new M.Geometry).copy(this)},copy:function(t){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]];for(var e=t.vertices,i=0,r=e.length;i<r;i++)this.vertices.push(e[i].clone());for(var n=t.faces,i=0,r=n.length;i<r;i++)this.faces.push(n[i].clone());for(var a,i=0,r=t.faceVertexUvs.length;i<r;i++){a=t.faceVertexUvs[i],void 0===this.faceVertexUvs[i]&&(this.faceVertexUvs[i]=[]);for(var o=0,s=a.length;o<s;o++){for(var h,u=a[o],l=[],c=0,p=u.length;c<p;c++)h=u[c],l.push(h.clone());this.faceVertexUvs[i].push(l)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},M.EventDispatcher.prototype.apply(M.Geometry.prototype),M.GeometryIdCount=0,M.DirectGeometry=function(){Object.defineProperty(this,"id",{value:M.GeometryIdCount++}),this.uuid=M.Math.generateUUID(),this.name="",this.type="DirectGeometry",this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1},M.DirectGeometry.prototype={constructor:M.DirectGeometry,computeBoundingBox:M.Geometry.prototype.computeBoundingBox,computeBoundingSphere:M.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){},computeVertexNormals:function(){},computeGroups:function(t){for(var e,i,r,n=[],a=t.faces,o=0;o<a.length;o++)(r=a[o]).materialIndex!==i&&(i=r.materialIndex,void 0!=e&&(e.count=3*o-e.start,n.push(e)),e={start:3*o,materialIndex:i});void 0!==e&&(e.count=3*o-e.start,n.push(e)),this.groups=n},fromGeometry:function(t){var e,i=t.faces,r=t.vertices,n=t.faceVertexUvs,a=n[0]&&0<n[0].length,o=n[1]&&0<n[1].length,s=t.morphTargets,h=s.length;if(0<h){e=[];for(g=0;g<h;g++)e[g]=[];this.morphTargets.position=e}var u,l=t.morphNormals,c=l.length;if(0<c){u=[];for(g=0;g<c;g++)u[g]=[];this.morphTargets.normal=u}for(var p,d=t.skinIndices,f=t.skinWeights,m=d.length===r.length,v=f.length===r.length,g=0;g<i.length;g++){p=i[g],this.vertices.push(r[p.a],r[p.b],r[p.c]);var y=p.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var x=p.normal;this.normals.push(x,x,x)}var _=p.vertexColors;if(3===_.length)this.colors.push(_[0],_[1],_[2]);else{var b=p.color;this.colors.push(b,b,b)}if(!0===a&&(void 0===(S=n[0][g])?this.uvs.push(new M.Vector2,new M.Vector2,new M.Vector2):this.uvs.push(S[0],S[1],S[2])),!0===o){var S=n[1][g];void 0===S?this.uvs2.push(new M.Vector2,new M.Vector2,new M.Vector2):this.uvs2.push(S[0],S[1],S[2])}for(var w,E=0;E<h;E++)w=s[E].vertices,e[E].push(w[p.a],w[p.b],w[p.c]);for(var T,E=0;E<c;E++)T=l[E].vertexNormals[g],u[E].push(T.a,T.b,T.c);m&&this.skinIndices.push(d[p.a],d[p.b],d[p.c]),v&&this.skinWeights.push(f[p.a],f[p.b],f[p.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},M.EventDispatcher.prototype.apply(M.DirectGeometry.prototype),M.Camera=function(){M.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new M.Matrix4,this.projectionMatrix=new M.Matrix4},M.Camera.prototype=Object.create(M.Object3D.prototype),M.Camera.prototype.constructor=M.Camera,M.Camera.prototype.getWorldDirection=function(){var t=new M.Quaternion;return function(e){var i=e||new M.Vector3;return this.getWorldQuaternion(t),i.set(0,0,-1).applyQuaternion(t)}}(),M.Camera.prototype.lookAt=function(){var t=new M.Matrix4;return function(e){t.lookAt(this.position,e,this.up),this.quaternion.setFromRotationMatrix(t)}}(),M.Camera.prototype.clone=function(){return(new this.constructor).copy(this)},M.Camera.prototype.copy=function(t){return M.Object3D.prototype.copy.call(this,t),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},M.PerspectiveCamera=function(t,e,i,r){M.Camera.call(this),this.type="PerspectiveCamera",this.focalLength=10,this.zoom=1,this.fov=void 0===t?50:t,this.aspect=void 0===e?1:e,this.near=void 0===i?.1:i,this.far=void 0===r?2e3:r,this.updateProjectionMatrix()},M.PerspectiveCamera.prototype=Object.create(M.Camera.prototype),M.PerspectiveCamera.prototype.constructor=M.PerspectiveCamera,M.PerspectiveCamera.prototype.setLens=function(t,i){void 0===i&&(i=24),this.fov=2*M.Math.radToDeg(e(i/(2*t))),this.updateProjectionMatrix()},M.PerspectiveCamera.prototype.setViewOffset=function(t,e,i,r,n,a){this.fullWidth=t,this.fullHeight=e,this.x=i,this.y=r,this.width=n,this.height=a,this.updateProjectionMatrix()},M.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var t=M.Math.radToDeg(2*e(i(.5*M.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var r=this.fullWidth/this.fullHeight,n=i(M.Math.degToRad(.5*t))*this.near,a=-n,o=r*a,h=s(r*n-o),u=s(n-a);this.projectionMatrix.makeFrustum(o+this.x*h/this.fullWidth,o+(this.x+this.width)*h/this.fullWidth,n-(this.y+this.height)*u/this.fullHeight,n-this.y*u/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(t,this.aspect,this.near,this.far)},M.PerspectiveCamera.prototype.copy=function(t){return M.Camera.prototype.copy.call(this,t),this.focalLength=t.focalLength,this.zoom=t.zoom,this.fov=t.fov,this.aspect=t.aspect,this.near=t.near,this.far=t.far,this},M.PerspectiveCamera.prototype.toJSON=function(t){var e=M.Object3D.prototype.toJSON.call(this,t);return e.object.focalLength=this.focalLength,e.object.zoom=this.zoom,e.object.fov=this.fov,e.object.aspect=this.aspect,e.object.near=this.near,e.object.far=this.far,e},M.Light=function(t,e){M.Object3D.call(this),this.type="Light",this.color=new M.Color(t),this.intensity=void 0===e?1:e,this.receiveShadow=void 0},M.Light.prototype=Object.create(M.Object3D.prototype),M.Light.prototype.constructor=M.Light,M.Light.prototype.copy=function(t){return M.Object3D.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},M.Light.prototype.toJSON=function(t){var e=M.Object3D.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),e},M.Scene=function(){M.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},M.Scene.prototype=Object.create(M.Object3D.prototype),M.Scene.prototype.constructor=M.Scene,M.Scene.prototype.copy=function(t,e){return M.Object3D.prototype.copy.call(this,t,e),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},M.FogExp2=function(t,e){this.name="",this.color=new M.Color(t),this.density=void 0===e?25e-5:e},M.FogExp2.prototype.clone=function(){return new M.FogExp2(this.color.getHex(),this.density)},M.ImmediateRenderObject=function(t){M.Object3D.call(this),this.material=t,this.render=function(){}},M.ImmediateRenderObject.prototype=Object.create(M.Object3D.prototype),M.ImmediateRenderObject.prototype.constructor=M.ImmediateRenderObject,M.SphereBufferGeometry=function(t,e,i,r,o,s,h){M.BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:r,phiLength:o,thetaStart:s,thetaLength:h},t=t||50,e=v(3,m(e)||8),i=v(2,m(i)||6),r=void 0===r?0:r,o=void 0===o?2*f:o;for(var u=(s=void 0===s?0:s)+(h=void 0===h?f:h),l=(e+1)*(i+1),c=new M.BufferAttribute(new Float32Array(3*l),3),p=new M.BufferAttribute(new Float32Array(3*l),3),d=new M.BufferAttribute(new Float32Array(2*l),2),g=0,y=[],x=new M.Vector3,_=0;_<=i;_++){for(var b=[],S=_/i,w=0;w<=e;w++){var E=w/e,T=-t*a(r+E*o)*n(s+S*h),A=t*a(s+S*h),L=t*n(r+E*o)*n(s+S*h);x.set(T,A,L).normalize(),c.setXYZ(g,T,A,L),p.setXYZ(g,x.x,x.y,x.z),d.setXY(g,E,1-S),b.push(g),g++}y.push(b)}for(var R=[],_=0;_<i;_++)for(w=0;w<e;w++){var C=y[_][w+1],U=y[_][w],F=y[_+1][w],P=y[_+1][w+1];(0!==_||0<s)&&R.push(C,U,P),(_!==i-1||u<f)&&R.push(U,F,P)}this.setIndex(new(65535<c.count?M.Uint32Attribute:M.Uint16Attribute)(R,1)),this.addAttribute("position",c),this.addAttribute("normal",p),this.addAttribute("uv",d),this.boundingSphere=new M.Sphere(new M.Vector3,t)},M.SphereBufferGeometry.prototype=Object.create(M.BufferGeometry.prototype),M.SphereBufferGeometry.prototype.constructor=M.SphereBufferGeometry,M.SphereGeometry=function(t,e,i,r,n,a,o){M.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:r,phiLength:n,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new M.SphereBufferGeometry(t,e,i,r,n,a,o))},M.SphereGeometry.prototype=Object.create(M.Geometry.prototype),M.SphereGeometry.prototype.constructor=M.SphereGeometry,M.Material=function(){Object.defineProperty(this,"id",{value:M.MaterialIdCount++}),this.uuid=M.Math.generateUUID(),this.name="",this.type="Material",this.side=M.FrontSide,this.opacity=1,this.transparent=!1,this.blending=M.NormalBlending,this.blendSrc=M.SrcAlphaFactor,this.blendDst=M.OneMinusSrcAlphaFactor,this.blendEquation=M.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=M.LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},M.Material.prototype={constructor:M.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(t){!0===t&&this.update(),this._needsUpdate=t},setValues:function(t){if(void 0!==t)for(var e in t){var i=t[e];if(void 0!==i){var r=this[e];void 0!==r&&(r instanceof M.Color?r.set(i):r instanceof M.Vector3&&i instanceof M.Vector3?r.copy(i):this[e]="overdraw"==e?+i:i)}}},toJSON:function(t){function e(t){var e=[];for(var i in t){var r=t[i];delete r.metadata,e.push(r)}return e}var i=void 0===t;i&&(t={textures:{},images:{}});var r={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color instanceof M.Color&&(r.color=this.color.getHex()),.5!==this.roughness&&(r.roughness=this.roughness),.5!==this.metalness&&(r.metalness=this.metalness),this.emissive instanceof M.Color&&(r.emissive=this.emissive.getHex()),this.specular instanceof M.Color&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),this.map instanceof M.Texture&&(r.map=this.map.toJSON(t).uuid),this.alphaMap instanceof M.Texture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap instanceof M.Texture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap instanceof M.Texture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap instanceof M.Texture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalScale=this.normalScale.toArray()),this.displacementMap instanceof M.Texture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap instanceof M.Texture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap instanceof M.Texture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap instanceof M.Texture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap instanceof M.Texture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap instanceof M.Texture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),void 0!==this.vertexColors&&this.vertexColors!==M.NoColors&&(r.vertexColors=this.vertexColors),void 0!==this.shading&&this.shading!==M.SmoothShading&&(r.shading=this.shading),void 0!==this.blending&&this.blending!==M.NormalBlending&&(r.blending=this.blending),void 0!==this.side&&this.side!==M.FrontSide&&(r.side=this.side),1>this.opacity&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),0<this.alphaTest&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),1<this.wireframeLinewidth&&(r.wireframeLinewidth=this.wireframeLinewidth),i){var n=e(t.textures),a=e(t.images);0<n.length&&(r.textures=n),0<a.length&&(r.images=a)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.side=t.side,this.opacity=t.opacity,this.transparent=t.transparent,this.blending=t.blending,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},M.EventDispatcher.prototype.apply(M.Material.prototype),M.MaterialIdCount=0,M.LineBasicMaterial=function(t){M.Material.call(this),this.type="LineBasicMaterial",this.color=new M.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.blending=M.NormalBlending,this.vertexColors=M.NoColors,this.fog=!0,this.setValues(t)},M.LineBasicMaterial.prototype=Object.create(M.Material.prototype),M.LineBasicMaterial.prototype.constructor=M.LineBasicMaterial,M.LineBasicMaterial.prototype.copy=function(t){return M.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.vertexColors=t.vertexColors,this.fog=t.fog,this},M.LineDashedMaterial=function(t){M.Material.call(this),this.type="LineDashedMaterial",this.color=new M.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.blending=M.NormalBlending,this.vertexColors=M.NoColors,this.fog=!0,this.setValues(t)},M.LineDashedMaterial.prototype=Object.create(M.Material.prototype),M.LineDashedMaterial.prototype.constructor=M.LineDashedMaterial,M.LineDashedMaterial.prototype.copy=function(t){return M.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this.vertexColors=t.vertexColors,this.fog=t.fog,this},M.PointsMaterial=function(t){M.Material.call(this),this.type="PointsMaterial",this.color=new M.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.blending=M.NormalBlending,this.vertexColors=M.NoColors,this.fog=!0,this.setValues(t)},M.PointsMaterial.prototype=Object.create(M.Material.prototype),M.PointsMaterial.prototype.constructor=M.PointsMaterial,M.PointsMaterial.prototype.copy=function(t){return M.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.vertexColors=t.vertexColors,this.fog=t.fog,this},M.MeshDepthMaterial=function(t){M.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)},M.MeshDepthMaterial.prototype=Object.create(M.Material.prototype),M.MeshDepthMaterial.prototype.constructor=M.MeshDepthMaterial,M.MeshDepthMaterial.prototype.copy=function(t){return M.Material.prototype.copy.call(this,t),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},M.MeshNormalMaterial=function(t){M.Material.call(this,t),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(t)},M.MeshNormalMaterial.prototype=Object.create(M.Material.prototype),M.MeshNormalMaterial.prototype.constructor=M.MeshNormalMaterial,M.MeshNormalMaterial.prototype.copy=function(t){return M.Material.prototype.copy.call(this,t),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},M.ShaderMaterial=function(t){M.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=M.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=M.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==t&&(t.attributes,this.setValues(t))},M.ShaderMaterial.prototype=Object.create(M.Material.prototype),M.ShaderMaterial.prototype.constructor=M.ShaderMaterial,M.ShaderMaterial.prototype.copy=function(t){return M.Material.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=M.UniformsUtils.clone(t.uniforms),this.defines=t.defines,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},M.ShaderMaterial.prototype.toJSON=function(t){var e=M.Material.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},M.MeshBasicMaterial=function(t){M.Material.call(this),this.type="MeshBasicMaterial",this.color=new M.Color(16777215),this.map=null,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=M.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=M.SmoothShading,this.blending=M.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=M.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(t)},M.MeshBasicMaterial.prototype=Object.create(M.Material.prototype),M.MeshBasicMaterial.prototype.constructor=M.MeshBasicMaterial,M.MeshBasicMaterial.prototype.copy=function(t){return M.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},M.MeshLambertMaterial=function(t){M.Material.call(this),this.type="MeshLambertMaterial",this.color=new M.Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new M.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=M.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.blending=M.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=M.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},M.MeshLambertMaterial.prototype=Object.create(M.Material.prototype),M.MeshLambertMaterial.prototype.constructor=M.MeshLambertMaterial,M.MeshLambertMaterial.prototype.copy=function(t){return M.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},M.MeshStandardMaterial=function(t){M.Material.call(this),this.type="MeshStandardMaterial",this.color=new M.Color(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new M.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new M.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.fog=!0,this.shading=M.SmoothShading,this.blending=M.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=M.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},M.MeshStandardMaterial.prototype=Object.create(M.Material.prototype),M.MeshStandardMaterial.prototype.constructor=M.MeshStandardMaterial,M.MeshStandardMaterial.prototype.copy=function(t){return M.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},M.MeshPhongMaterial=function(t){M.Material.call(this),this.type="MeshPhongMaterial",this.color=new M.Color(16777215),this.specular=new M.Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new M.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new M.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=M.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=M.SmoothShading,this.blending=M.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=M.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},M.MeshPhongMaterial.prototype=Object.create(M.Material.prototype),M.MeshPhongMaterial.prototype.constructor=M.MeshPhongMaterial,M.MeshPhongMaterial.prototype.copy=function(t){return M.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},M.MultiMaterial=function(t){this.uuid=M.Math.generateUUID(),this.type="MultiMaterial",this.materials=t instanceof Array?t:[],this.visible=!0},M.MultiMaterial.prototype={constructor:M.MultiMaterial,toJSON:function(t){for(var e,i={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},r=this.materials,n=0,a=r.length;n<a;n++)e=r[n].toJSON(t),delete e.metadata,i.materials.push(e);return i.visible=this.visible,i},clone:function(){for(var t=new this.constructor,e=0;e<this.materials.length;e++)t.materials.push(this.materials[e].clone());return t.visible=this.visible,t}},M.RawShaderMaterial=function(t){M.ShaderMaterial.call(this,t),this.type="RawShaderMaterial"},M.RawShaderMaterial.prototype=Object.create(M.ShaderMaterial.prototype),M.RawShaderMaterial.prototype.constructor=M.RawShaderMaterial,M.Texture=function(t,e,i,r,n,a,o,s,h){Object.defineProperty(this,"id",{value:M.TextureIdCount++}),this.uuid=M.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0===t?M.Texture.DEFAULT_IMAGE:t,this.mipmaps=[],this.mapping=void 0===e?M.Texture.DEFAULT_MAPPING:e,this.wrapS=void 0===i?M.ClampToEdgeWrapping:i,this.wrapT=void 0===r?M.ClampToEdgeWrapping:r,this.magFilter=void 0===n?M.LinearFilter:n,this.minFilter=void 0===a?M.LinearMipMapLinearFilter:a,this.anisotropy=void 0===h?1:h,this.format=void 0===o?M.RGBAFormat:o,this.type=void 0===s?M.UnsignedByteType:s,this.offset=new M.Vector2(0,0),this.repeat=new M.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=M.LinearEncoding,this.version=0,this.onUpdate=null},M.Texture.DEFAULT_IMAGE=void 0,M.Texture.DEFAULT_MAPPING=M.UVMapping,M.Texture.prototype={constructor:M.Texture,set needsUpdate(t){!0===t&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){if(void 0!==t.textures[this.uuid])return t.textures[this.uuid];var e={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(void 0!==this.image){var i=this.image;void 0===i.uuid&&(i.uuid=M.Math.generateUUID()),void 0===t.images[i.uuid]&&(t.images[i.uuid]={uuid:i.uuid,url:function(t){var e;return void 0===t.toDataURL?(e=document.createElement("canvas"),e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0,t.width,t.height)):e=t,2048<e.width||2048<e.height?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}(i)}),e.image=i.uuid}return t.textures[this.uuid]=e,e},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping===M.UVMapping){if(t.multiply(this.repeat),t.add(this.offset),0>t.x||1<t.x)switch(this.wrapS){case M.RepeatWrapping:t.x-=m(t.x);break;case M.ClampToEdgeWrapping:t.x=0>t.x?0:1;break;case M.MirroredRepeatWrapping:1===s(m(t.x)%2)?t.x=h(t.x)-t.x:t.x-=m(t.x)}if(0>t.y||1<t.y)switch(this.wrapT){case M.RepeatWrapping:t.y-=m(t.y);break;case M.ClampToEdgeWrapping:t.y=0>t.y?0:1;break;case M.MirroredRepeatWrapping:1===s(m(t.y)%2)?t.y=h(t.y)-t.y:t.y-=m(t.y)}this.flipY&&(t.y=1-t.y)}}},M.EventDispatcher.prototype.apply(M.Texture.prototype),M.TextureIdCount=0,M.DataTexture=function(t,e,i,r,n,a,o,s,h,u,l){M.Texture.call(this,null,a,o,s,h,u,r,n,l),this.image={data:t,width:e,height:i},this.magFilter=void 0===h?M.NearestFilter:h,this.minFilter=void 0===u?M.NearestFilter:u,this.flipY=!1,this.generateMipmaps=!1},M.DataTexture.prototype=Object.create(M.Texture.prototype),M.DataTexture.prototype.constructor=M.DataTexture,M.CompressedTexture=function(t,e,i,r,n,a,o,s,h,u,l){M.Texture.call(this,null,a,o,s,h,u,r,n,l),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1},M.CompressedTexture.prototype=Object.create(M.Texture.prototype),M.CompressedTexture.prototype.constructor=M.CompressedTexture,M.CubeTexture=function(t,e,i,r,n,a,o,s,h){t=void 0===t?[]:t,e=void 0===e?M.CubeReflectionMapping:e,M.Texture.call(this,t,e,i,r,n,a,o,s,h),this.flipY=!1},M.CubeTexture.prototype=Object.create(M.Texture.prototype),M.CubeTexture.prototype.constructor=M.CubeTexture,Object.defineProperty(M.CubeTexture.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),M.VideoTexture=function(t,e,i,r,n,a,o,s,h){function u(){requestAnimationFrame(u),t.readyState>=t.HAVE_CURRENT_DATA&&(l.needsUpdate=!0)}M.Texture.call(this,t,e,i,r,n,a,o,s,h),this.generateMipmaps=!1;var l=this;u()},M.VideoTexture.prototype=Object.create(M.Texture.prototype),M.VideoTexture.prototype.constructor=M.VideoTexture,M.Sprite=function(){var t=new Uint16Array([0,1,2,0,2,3]),e=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),i=new Float32Array([0,0,1,0,1,1,0,1]),r=new M.BufferGeometry;return r.setIndex(new M.BufferAttribute(t,1)),r.addAttribute("position",new M.BufferAttribute(e,3)),r.addAttribute("uv",new M.BufferAttribute(i,2)),function(t){M.Object3D.call(this),this.type="Sprite",this.geometry=r,this.material=void 0===t?new M.SpriteMaterial:t}}(),M.Sprite.prototype=Object.create(M.Object3D.prototype),M.Sprite.prototype.constructor=M.Sprite,M.Sprite.prototype.raycast=function(){var t=new M.Vector3;return function(e,i){t.setFromMatrixPosition(this.matrixWorld);var r=e.ray.distanceSqToPoint(t);r>this.scale.x*this.scale.y||i.push({distance:u(r),point:this.position,face:null,object:this})}}(),M.Sprite.prototype.clone=function(){return new this.constructor(this.material).copy(this)},M.Particle=M.Sprite,M.LensFlare=function(t,e,i,r,n){M.Object3D.call(this),this.lensFlares=[],this.positionScreen=new M.Vector3,this.customUpdateCallback=void 0,void 0!==t&&this.add(t,e,i,r,n)},M.LensFlare.prototype=Object.create(M.Object3D.prototype),M.LensFlare.prototype.constructor=M.LensFlare,M.LensFlare.prototype.add=function(t,e,i,r,n,a){void 0===e&&(e=-1),void 0===i&&(i=0),void 0===a&&(a=1),void 0===n&&(n=new M.Color(16777215)),void 0===r&&(r=M.NormalBlending),i=g(i,v(0,i)),this.lensFlares.push({texture:t,size:e,distance:i,x:0,y:0,z:0,scale:1,rotation:0,opacity:a,color:n,blending:r})},M.LensFlare.prototype.updateLensFlares=function(){var t,e,i=this.lensFlares.length,r=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(t=0;t<i;t++)e=this.lensFlares[t],e.x=this.positionScreen.x+r*e.distance,e.y=this.positionScreen.y+n*e.distance,e.wantedRotation=e.x*f*.25,e.rotation+=.25*(e.wantedRotation-e.rotation)},M.LensFlare.prototype.copy=function(t){M.Object3D.prototype.copy.call(this,t),this.positionScreen.copy(t.positionScreen),this.customUpdateCallback=t.customUpdateCallback;for(var e=0,i=t.lensFlares.length;e<i;e++)this.lensFlares.push(t.lensFlares[e]);return this},M.Line=function(t,e,i){return 1===i?new M.LineSegments(t,e):(M.Object3D.call(this),this.type="Line",this.geometry=void 0===t?new M.Geometry:t,void(this.material=void 0===e?new M.LineBasicMaterial({color:16777215*Math.random()}):e))},M.Line.prototype=Object.create(M.Object3D.prototype),M.Line.prototype.constructor=M.Line,M.Line.prototype.raycast=function(){var t=new M.Matrix4,e=new M.Ray,i=new M.Sphere;return function(r,n){var a=r.linePrecision,o=a*a,s=this.geometry,h=this.matrixWorld;if(null===s.boundingSphere&&s.computeBoundingSphere(),i.copy(s.boundingSphere),i.applyMatrix4(h),!1!==r.ray.intersectsSphere(i)){t.getInverse(h),e.copy(r.ray).applyMatrix4(t);var u=new M.Vector3,l=new M.Vector3,c=new M.Vector3,p=new M.Vector3,d=this instanceof M.LineSegments?2:1;if(s instanceof M.BufferGeometry){var f=s.index,m=s.attributes.position.array;if(null!==f)for(var v=f.array,g=0,y=v.length-1;g<y;g+=d){var x=v[g],_=v[g+1];u.fromArray(m,3*x),l.fromArray(m,3*_),e.distanceSqToSegment(u,l,p,c)>o||(p.applyMatrix4(this.matrixWorld),(w=r.ray.origin.distanceTo(p))<r.near||w>r.far||n.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(var g=0,y=m.length/3-1;g<y;g+=d)u.fromArray(m,3*g),l.fromArray(m,3*g+3),e.distanceSqToSegment(u,l,p,c)>o||(p.applyMatrix4(this.matrixWorld),(w=r.ray.origin.distanceTo(p))<r.near||w>r.far||n.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(s instanceof M.Geometry)for(var b=s.vertices,S=b.length,g=0;g<S-1;g+=d)if(!(e.distanceSqToSegment(b[g],b[g+1],p,c)>o)){p.applyMatrix4(this.matrixWorld);var w=r.ray.origin.distanceTo(p);w<r.near||w>r.far||n.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}}}(),M.Line.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},M.LineStrip=0,M.LinePieces=1,M.LineSegments=function(t,e){M.Line.call(this,t,e),this.type="LineSegments"},M.LineSegments.prototype=Object.create(M.Line.prototype),M.LineSegments.prototype.constructor=M.LineSegments,M.Mesh=function(t,e){M.Object3D.call(this),this.type="Mesh",this.geometry=void 0===t?new M.Geometry:t,this.material=void 0===e?new M.MeshBasicMaterial({color:16777215*Math.random()}):e,this.drawMode=M.TrianglesDrawMode,this.updateMorphTargets()},M.Mesh.prototype=Object.create(M.Object3D.prototype),M.Mesh.prototype.constructor=M.Mesh,M.Mesh.prototype.setDrawMode=function(t){this.drawMode=t},M.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var t=0,e=this.geometry.morphTargets.length;t<e;t++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[t].name]=t}},M.Mesh.prototype.getMorphTargetIndexByName=function(t){return void 0===this.morphTargetDictionary[t]?0:this.morphTargetDictionary[t]},M.Mesh.prototype.raycast=function(){function t(t,e,i,r,n,a,o){return M.Triangle.barycoordFromPoint(t,e,i,r,v),n.multiplyScalar(v.x),a.multiplyScalar(v.y),o.multiplyScalar(v.z),n.add(a).add(o),n.clone()}function e(t,e,i,r,n,a,o){var s=t.material;if(null===(s.side===M.BackSide?i.intersectTriangle(a,n,r,!0,o):i.intersectTriangle(r,n,a,s.side!==M.DoubleSide,o)))return null;y.copy(o),y.applyMatrix4(t.matrixWorld);var h=e.ray.origin.distanceTo(y);return h<e.near||h>e.far?null:{distance:h,point:y.clone(),object:t}}function i(i,r,n,a,u,l,c,m){o.fromArray(a,3*l),s.fromArray(a,3*c),h.fromArray(a,3*m);var v=e(i,r,n,o,s,h,g);return v&&(u&&(p.fromArray(u,2*l),d.fromArray(u,2*c),f.fromArray(u,2*m),v.uv=t(g,o,s,h,p,d,f)),v.face=new M.Face3(l,c,m,M.Triangle.normal(o,s,h)),v.faceIndex=l),v}var r=new M.Matrix4,n=new M.Ray,a=new M.Sphere,o=new M.Vector3,s=new M.Vector3,h=new M.Vector3,u=new M.Vector3,l=new M.Vector3,c=new M.Vector3,p=new M.Vector2,d=new M.Vector2,f=new M.Vector2,v=new M.Vector3,g=new M.Vector3,y=new M.Vector3;return function(v,y){var x=this.geometry,_=this.material,b=this.matrixWorld;if(void 0!==_&&(null===x.boundingSphere&&x.computeBoundingSphere(),a.copy(x.boundingSphere),a.applyMatrix4(b),!1!==v.ray.intersectsSphere(a))&&(r.getInverse(b),n.copy(v.ray).applyMatrix4(r),null===x.boundingBox||!1!==n.intersectsBox(x.boundingBox))){var S,w;if(x instanceof M.BufferGeometry){var E,T,A,L=x.index,R=x.attributes,C=R.position.array;if(void 0!==R.uv&&(S=R.uv.array),null!==L)for(var U=L.array,F=0,P=U.length;F<P;F+=3)E=U[F],T=U[F+1],A=U[F+2],(w=i(this,v,n,C,S,E,T,A))&&(w.faceIndex=m(F/3),y.push(w));else for(var F=0,P=C.length;F<P;F+=9)E=F/3,T=E+1,A=E+2,(w=i(this,v,n,C,S,E,T,A))&&(w.index=E,y.push(w))}else if(x instanceof M.Geometry){var D,N,B,I=_ instanceof M.MultiMaterial,O=1==I?_.materials:null,V=x.vertices,z=x.faces,G=x.faceVertexUvs[0];0<G.length&&(S=G);for(var k=0,W=z.length;k<W;k++){var j=z[k],X=1==I?O[j.materialIndex]:_;if(void 0!==X){if(D=V[j.a],N=V[j.b],B=V[j.c],!0===X.morphTargets){var H=x.morphTargets,Y=this.morphTargetInfluences;o.set(0,0,0),s.set(0,0,0),h.set(0,0,0);for(var q,Z=0,Q=H.length;Z<Q;Z++)if(0!==(q=Y[Z])){var J=H[Z].vertices;o.addScaledVector(u.subVectors(J[j.a],D),q),s.addScaledVector(l.subVectors(J[j.b],N),q),h.addScaledVector(c.subVectors(J[j.c],B),q)}o.add(D),s.add(N),h.add(B),D=o,N=s,B=h}if(w=e(this,v,n,D,N,B,g)){if(S){var K=S[k];p.copy(K[0]),d.copy(K[1]),f.copy(K[2]),w.uv=t(g,D,N,B,p,d,f)}w.face=j,w.faceIndex=k,y.push(w)}}}}}}}(),M.Mesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},M.SkinnedMesh=function(t,e,i){M.Mesh.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new M.Matrix4,this.bindMatrixInverse=new M.Matrix4;var r=[];if(this.geometry&&void 0!==this.geometry.bones){for(var n,a,o=0,s=this.geometry.bones.length;o<s;++o)a=this.geometry.bones[o],n=new M.Bone(this),r.push(n),n.name=a.name,n.position.fromArray(a.pos),n.quaternion.fromArray(a.rotq),void 0!==a.scl&&n.scale.fromArray(a.scl);for(var o=0,s=this.geometry.bones.length;o<s;++o)-1!==(a=this.geometry.bones[o]).parent&&null!==a.parent?r[a.parent].add(r[o]):this.add(r[o])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new M.Skeleton(r,void 0,i),this.matrixWorld)},M.SkinnedMesh.prototype=Object.create(M.Mesh.prototype),M.SkinnedMesh.prototype.constructor=M.SkinnedMesh,M.SkinnedMesh.prototype.bind=function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},M.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},M.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof M.Geometry)for(r=0;r<this.geometry.skinWeights.length;r++){var t=this.geometry.skinWeights[r];(n=1/t.lengthManhattan())==1/0?t.set(1,0,0,0):t.multiplyScalar(n)}else if(this.geometry instanceof M.BufferGeometry)for(var e=new M.Vector4,i=this.geometry.attributes.skinWeight,r=0;r<i.count;r++){e.x=i.getX(r),e.y=i.getY(r),e.z=i.getZ(r),e.w=i.getW(r);var n=1/e.lengthManhattan();n==1/0?e.set(1,0,0,0):e.multiplyScalar(n),i.setXYZW(r,e.x,e.y,e.z,e.w)}},M.SkinnedMesh.prototype.updateMatrixWorld=function(){M.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode&&this.bindMatrixInverse.getInverse(this.bindMatrix)},M.SkinnedMesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)},M.Points=function(t,e){M.Object3D.call(this),this.type="Points",this.geometry=void 0===t?new M.Geometry:t,this.material=void 0===e?new M.PointsMaterial({color:16777215*Math.random()}):e},M.Points.prototype=Object.create(M.Object3D.prototype),M.Points.prototype.constructor=M.Points,M.Points.prototype.raycast=function(){var t=new M.Matrix4,e=new M.Ray,i=new M.Sphere;return function(r,n){function a(t,i){var a=e.distanceSqToPoint(t);if(a<p){var s=e.closestPointToPoint(t);s.applyMatrix4(h);var l=r.ray.origin.distanceTo(s);if(l<r.near||l>r.far)return;n.push({distance:l,distanceToRay:u(a),point:s.clone(),index:i,face:null,object:o})}}var o=this,s=this.geometry,h=this.matrixWorld,l=r.params.Points.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),i.copy(s.boundingSphere),i.applyMatrix4(h),!1!==r.ray.intersectsSphere(i)){t.getInverse(h),e.copy(r.ray).applyMatrix4(t);var c=l/((this.scale.x+this.scale.y+this.scale.z)/3),p=c*c,d=new M.Vector3;if(s instanceof M.BufferGeometry){var f=s.index,m=s.attributes.position.array;if(null!==f)for(var v,g=f.array,y=0,x=g.length;y<x;y++)v=g[y],d.fromArray(m,3*v),a(d,v);else for(var y=0,_=m.length/3;y<_;y++)d.fromArray(m,3*y),a(d,y)}else for(var b=s.vertices,y=0,_=b.length;y<_;y++)a(b[y],y)}}}(),M.Points.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},M.Light=function(t,e){M.Object3D.call(this),this.type="Light",this.color=new M.Color(t),this.intensity=void 0===e?1:e,this.receiveShadow=void 0},M.Light.prototype=Object.create(M.Object3D.prototype),M.Light.prototype.constructor=M.Light,M.Light.prototype.copy=function(t){return M.Object3D.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},M.Light.prototype.toJSON=function(t){var e=M.Object3D.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),e},M.ShaderChunk={},M.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",M.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",M.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",M.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n",M.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif",M.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n",M.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n",M.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif",M.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",M.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif",M.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\tvColor.xyz = color.xyz;\n\n#endif",M.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\n\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n",M.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",M.ShaderChunk.encodings_fragment="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",M.ShaderChunk.encodings_pars_fragment="// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\n\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n//  return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\n\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\n\n// M matrix, for encoding\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\n\n// Inverse M matrix, for decoding\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n",M.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\n\t#endif\n\n\tenvColor = envMapTexelToLinear( envColor );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",M.ShaderChunk.envmap_pars_fragment="#if defined( USE_ENVMAP ) || defined( STANDARD )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n\n#ifdef USE_ENVMAP\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( STANDARD )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n",M.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG ) && ! defined( STANDARD )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n",M.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG ) && ! defined( STANDARD )\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n",M.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",M.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif",M.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",M.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif\n",M.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif",M.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n\t#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif\n",M.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n",M.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",M.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n",M.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif",M.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",M.ShaderChunk.premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",M.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",M.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",M.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",M.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n",M.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n#endif\n",M.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif",M.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif",M.ShaderChunk.tonemapping_fragment="#if defined( TONE_MAPPING )\n\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",M.ShaderChunk.tonemapping_pars_fragment="#define saturate(a) clamp( a, 0.0, 1.0 )\n\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n  return toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping( vec3 color ) {\n\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicgames.com/archives/75\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\n  // John Hable's filmic operator from Uncharted 2 video game\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n\n}\n\n// source: http://filmicgames.com/archives/75\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n  // optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n",M.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif",M.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n#endif",M.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = uv2;\n\n#endif",M.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvarying vec2 vUv;\n\n#endif",M.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n",M.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",M.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( STANDARD ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n\t#endif\n\n#endif\n",M.ShaderChunk.meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",M.ShaderChunk.meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\n}\n",M.UniformsUtils={merge:function(t){for(var e,i={},r=0;r<t.length;r++)for(var n in e=this.clone(t[r]))i[n]=e[n];return i},clone:function(t){var e={};for(var i in t)for(var r in e[i]={},t[i]){var n=t[i][r];e[i][r]=n instanceof M.Color||n instanceof M.Vector2||n instanceof M.Vector3||n instanceof M.Vector4||n instanceof M.Matrix3||n instanceof M.Matrix4||n instanceof M.Texture?n.clone():Array.isArray(n)?n.slice():n}return e}},M.UniformsLib={common:{diffuse:{type:"c",value:new M.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new M.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new M.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},roughnessmap:{roughnessMap:{type:"t",value:null}},metalnessmap:{metalnessMap:{type:"t",value:null}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new M.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLights:{type:"sa",value:[],properties:{direction:{type:"v3"},color:{type:"c"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},directionalShadowMap:{type:"tv",value:[]},directionalShadowMatrix:{type:"m4v",value:[]},spotLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},direction:{type:"v3"},distance:{type:"f"},coneCos:{type:"f"},penumbraCos:{type:"f"},decay:{type:"f"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},spotShadowMap:{type:"tv",value:[]},spotShadowMatrix:{type:"m4v",value:[]},pointLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},decay:{type:"f"},distance:{type:"f"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},pointShadowMap:{type:"tv",value:[]},pointShadowMatrix:{type:"m4v",value:[]},hemisphereLights:{type:"sa",value:[],properties:{direction:{type:"v3"},skyColor:{type:"c"},groundColor:{type:"c"}}}},points:{diffuse:{type:"c",value:new M.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new M.Vector4(0,0,1,1)}}},M.ShaderLib={basic:{uniforms:M.UniformsUtils.merge([M.UniformsLib.common,M.UniformsLib.aomap,M.UniformsLib.fog]),vertexShader:M.ShaderChunk.meshbasic_vert,fragmentShader:M.ShaderChunk.meshbasic_frag},lambert:{uniforms:M.UniformsUtils.merge([M.UniformsLib.common,M.UniformsLib.aomap,M.UniformsLib.lightmap,M.UniformsLib.emissivemap,M.UniformsLib.fog,M.UniformsLib.lights,{emissive:{type:"c",value:new M.Color(0)}}]),vertexShader:M.ShaderChunk.meshlambert_vert,fragmentShader:M.ShaderChunk.meshlambert_frag},phong:{uniforms:M.UniformsUtils.merge([M.UniformsLib.common,M.UniformsLib.aomap,M.UniformsLib.lightmap,M.UniformsLib.emissivemap,M.UniformsLib.bumpmap,M.UniformsLib.normalmap,M.UniformsLib.displacementmap,M.UniformsLib.fog,M.UniformsLib.lights,{emissive:{type:"c",value:new M.Color(0)},specular:{type:"c",value:new M.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:M.ShaderChunk.meshphong_vert,fragmentShader:M.ShaderChunk.meshphong_frag},standard:{uniforms:M.UniformsUtils.merge([M.UniformsLib.common,M.UniformsLib.aomap,M.UniformsLib.lightmap,M.UniformsLib.emissivemap,M.UniformsLib.bumpmap,M.UniformsLib.normalmap,M.UniformsLib.displacementmap,M.UniformsLib.roughnessmap,M.UniformsLib.metalnessmap,M.UniformsLib.fog,M.UniformsLib.lights,{emissive:{type:"c",value:new M.Color(0)},roughness:{type:"f",value:.5},metalness:{type:"f",value:0},envMapIntensity:{type:"f",value:1}}]),vertexShader:M.ShaderChunk.meshstandard_vert,fragmentShader:M.ShaderChunk.meshstandard_frag},points:{uniforms:M.UniformsUtils.merge([M.UniformsLib.points,M.UniformsLib.fog]),vertexShader:M.ShaderChunk.points_vert,fragmentShader:M.ShaderChunk.points_frag},dashed:{uniforms:M.UniformsUtils.merge([M.UniformsLib.common,M.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:M.ShaderChunk.linedashed_vert,fragmentShader:M.ShaderChunk.linedashed_frag},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:M.ShaderChunk.depth_vert,fragmentShader:M.ShaderChunk.depth_frag},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:M.ShaderChunk.normal_vert,fragmentShader:M.ShaderChunk.normal_frag},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:M.ShaderChunk.cube_vert,fragmentShader:M.ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:M.ShaderChunk.equirect_vert,fragmentShader:M.ShaderChunk.equirect_frag},depthRGBA:{uniforms:{},vertexShader:M.ShaderChunk.depthRGBA_vert,fragmentShader:M.ShaderChunk.depthRGBA_frag},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new M.Vector3(0,0,0)}},vertexShader:M.ShaderChunk.distanceRGBA_vert,fragmentShader:M.ShaderChunk.distanceRGBA_frag}},M.WebGLRenderer=function(t){function e(){return null==Tt?Vt:1}function i(t,e,i,r){!0===ft&&(t*=r,e*=r,i*=r),$t.clearColor(t,e,i,r)}function r(){$t.init(),$t.scissor(Ut.copy(zt).multiplyScalar(Vt)),$t.viewport(Pt.copy(kt).multiplyScalar(Vt)),i(Nt.r,Nt.g,Nt.b,Bt)}function n(){Et=null,Ct=null,Rt="",Lt=-1,$t.reset()}function o(t){t.preventDefault(),n(),r(),te.clear()}function h(t){var e=t.target;e.removeEventListener("dispose",h),c(e),Yt.textures--}function u(t){var e=t.target;e.removeEventListener("dispose",u),f(e),Yt.textures--}function l(t){var e=t.target;e.removeEventListener("dispose",l),y(e)}function c(t){var e=te.get(t);if(t.image&&e.__image__webglTextureCube)Zt.deleteTexture(e.__image__webglTextureCube);else{if(void 0===e.__webglInit)return;Zt.deleteTexture(e.__webglTexture)}te.delete(t)}function f(t){var e=te.get(t),i=te.get(t.texture);if(t&&void 0!==i.__webglTexture){if(Zt.deleteTexture(i.__webglTexture),t instanceof M.WebGLRenderTargetCube)for(var r=0;6>r;r++)Zt.deleteFramebuffer(e.__webglFramebuffer[r]),Zt.deleteRenderbuffer(e.__webglDepthbuffer[r]);else Zt.deleteFramebuffer(e.__webglFramebuffer),Zt.deleteRenderbuffer(e.__webglDepthbuffer);te.delete(t.texture),te.delete(t)}}function y(t){x(t),te.delete(t)}function x(t){var e=te.get(t).program;t.program=void 0,void 0!==e&&ie.releaseProgram(e)}function _(t,e,i,r){var n;if(!(i instanceof M.InstancedBufferGeometry&&null===(n=Jt.get("ANGLE_instanced_arrays")))){void 0===r&&(r=0),$t.initAttributes();var a=i.attributes,o=e.getAttributes(),s=t.defaultAttributeValues;for(var h in o){var u=o[h];if(0<=u){var l=a[h];if(void 0!==l){var c=l.itemSize,p=ee.getAttributeBuffer(l);if(l instanceof M.InterleavedBufferAttribute){var d=l.data,f=d.stride,m=l.offset;d instanceof M.InstancedInterleavedBuffer?($t.enableAttributeAndDivisor(u,d.meshPerAttribute,n),void 0===i.maxInstancedCount&&(i.maxInstancedCount=d.meshPerAttribute*d.count)):$t.enableAttribute(u),Zt.bindBuffer(Zt.ARRAY_BUFFER,p),Zt.vertexAttribPointer(u,c,Zt.FLOAT,!1,f*d.array.BYTES_PER_ELEMENT,(r*f+m)*d.array.BYTES_PER_ELEMENT)}else l instanceof M.InstancedBufferAttribute?($t.enableAttributeAndDivisor(u,l.meshPerAttribute,n),void 0===i.maxInstancedCount&&(i.maxInstancedCount=l.meshPerAttribute*l.count)):$t.enableAttribute(u),Zt.bindBuffer(Zt.ARRAY_BUFFER,p),Zt.vertexAttribPointer(u,c,Zt.FLOAT,!1,0,r*c*4)}else if(void 0!==s){var v=s[h];if(void 0!==v)switch(v.length){case 2:Zt.vertexAttrib2fv(u,v);break;case 3:Zt.vertexAttrib3fv(u,v);break;case 4:Zt.vertexAttrib4fv(u,v);break;default:Zt.vertexAttrib1fv(u,v)}}}}$t.disableUnusedAttributes()}}function b(t,e){return s(e[0])-s(t[0])}function S(t,e){return t.object.renderOrder===e.object.renderOrder?t.material.id===e.material.id?t.z===e.z?t.id-e.id:t.z-e.z:t.material.id-e.material.id:t.object.renderOrder-e.object.renderOrder}function w(t,e){return t.object.renderOrder===e.object.renderOrder?t.z===e.z?t.id-e.id:e.z-t.z:t.object.renderOrder-e.object.renderOrder}function E(t,e,i,r,n){var a,o;i.transparent?(a=xt,o=++Mt):(a=gt,o=++yt);var s=a[o];void 0===s?(s={id:t.id,object:t,geometry:e,material:i,z:Xt.z,group:n},a.push(s)):(s.id=t.id,s.object=t,s.geometry=e,s.material=i,s.z=Xt.z,s.group=n)}function T(t,e){if(!1!==t.visible){if(t.layers.test(e.layers))if(t instanceof M.Light)vt.push(t);else if(t instanceof M.Sprite)(!1===t.frustumCulled||!0===Wt.intersectsObject(t))&&bt.push(t);else if(t instanceof M.LensFlare)St.push(t);else if(t instanceof M.ImmediateRenderObject)!0===wt.sortObjects&&(Xt.setFromMatrixPosition(t.matrixWorld),Xt.applyProjection(jt)),E(t,null,t.material,Xt.z,null);else if((t instanceof M.Mesh||t instanceof M.Line||t instanceof M.Points)&&(t instanceof M.SkinnedMesh&&t.skeleton.update(),!1===t.frustumCulled||!0===Wt.intersectsObject(t))){var i=t.material;if(!0===i.visible){!0===wt.sortObjects&&(Xt.setFromMatrixPosition(t.matrixWorld),Xt.applyProjection(jt));var r=ee.update(t);if(i instanceof M.MultiMaterial)for(var n=r.groups,a=i.materials,o=0,s=n.length;o<s;o++){var h=n[o],u=a[h.materialIndex];!0===u.visible&&E(t,r,u,Xt.z,h)}else E(t,r,i,Xt.z,null)}}for(var l=t.children,o=0,s=l.length;o<s;o++)T(l[o],e)}}function A(t,e,i,r){for(var n=0,a=t.length;n<a;n++){var o=t[n],s=o.object,h=o.geometry,u=void 0===r?o.material:r,l=o.group;if(s.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,s.matrixWorld),s.normalMatrix.getNormalMatrix(s.modelViewMatrix),s instanceof M.ImmediateRenderObject){R(u);var c=U(e,i,u,s);Rt="",s.render(function(t){wt.renderBufferImmediate(t,c,u)})}else wt.renderBufferDirect(e,i,h,u,s,l)}}function L(t,e,i){var r=te.get(t),n=ie.getParameters(t,Ht,e,i),a=ie.getProgramCode(t,n),o=r.program,s=!0;if(void 0===o)t.cincopaAddEventListener("dispose",l);else if(o.code!==a)x(t);else{if(void 0!==n.shaderID)return;s=!1}if(s){if(n.shaderID){var h=M.ShaderLib[n.shaderID];r.__webglShader={name:t.type,uniforms:M.UniformsUtils.clone(h.uniforms),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}}else r.__webglShader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.__webglShader=r.__webglShader,o=ie.acquireProgram(t,n,a),r.program=o,t.program=o}var u=o.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(c=0;c<wt.maxMorphTargets;c++)0<=u["morphTarget"+c]&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(var c=0;c<wt.maxMorphNormals;c++)0<=u["morphNormal"+c]&&t.numSupportedMorphNormals++}r.uniformsList=[];var p=r.__webglShader.uniforms,d=r.program.getUniforms();for(var f in p){var m=d[f];m&&r.uniformsList.push([r.__webglShader.uniforms[f],m])}(t instanceof M.MeshPhongMaterial||t instanceof M.MeshLambertMaterial||t instanceof M.MeshStandardMaterial||t.lights)&&(r.lightsHash=Ht.hash,p.ambientLightColor.value=Ht.ambient,p.directionalLights.value=Ht.directional,p.spotLights.value=Ht.spot,p.pointLights.value=Ht.point,p.hemisphereLights.value=Ht.hemi,p.directionalShadowMap.value=Ht.directionalShadowMap,p.directionalShadowMatrix.value=Ht.directionalShadowMatrix,p.spotShadowMap.value=Ht.spotShadowMap,p.spotShadowMatrix.value=Ht.spotShadowMatrix,p.pointShadowMap.value=Ht.pointShadowMap,p.pointShadowMatrix.value=Ht.pointShadowMatrix),r.hasDynamicUniforms=!1;for(var v=0,g=r.uniformsList.length;v<g;v++)if(!0===r.uniformsList[v][0].dynamic){r.hasDynamicUniforms=!0;break}}function R(t){C(t),!0===t.transparent?$t.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):$t.setBlending(M.NoBlending),$t.setDepthFunc(t.depthFunc),$t.setDepthTest(t.depthTest),$t.setDepthWrite(t.depthWrite),$t.setColorWrite(t.colorWrite),$t.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)}function C(t){t.side===M.DoubleSide?$t.disable(Zt.CULL_FACE):$t.enable(Zt.CULL_FACE),$t.setFlipSided(t.side===M.BackSide)}function U(t,e,i,r){Dt=0;var n=te.get(i);void 0===n.program&&(i.needsUpdate=!0),void 0!==n.lightsHash&&n.lightsHash!==Ht.hash&&(i.needsUpdate=!0),i.needsUpdate&&(L(i,e,r),i.needsUpdate=!1);var a=!1,o=!1,s=!1,h=n.program,u=h.getUniforms(),l=n.__webglShader.uniforms;if(h.id!==Et&&(Zt.useProgram(h.program),Et=h.id,a=!0,o=!0,s=!0),i.id!==Lt&&(Lt=i.id,o=!0),(a||t!==Ct)&&(Zt.uniformMatrix4fv(u.projectionMatrix,!1,t.projectionMatrix.elements),Kt.logarithmicDepthBuffer&&Zt.uniform1f(u.logDepthBufFC,2/(d(t.far+1)/p)),t!==Ct&&(Ct=t,o=!0,s=!0),(i instanceof M.ShaderMaterial||i instanceof M.MeshPhongMaterial||i instanceof M.MeshStandardMaterial||i.envMap)&&void 0!==u.cameraPosition&&(Xt.setFromMatrixPosition(t.matrixWorld),Zt.uniform3f(u.cameraPosition,Xt.x,Xt.y,Xt.z)),(i instanceof M.MeshPhongMaterial||i instanceof M.MeshLambertMaterial||i instanceof M.MeshBasicMaterial||i instanceof M.MeshStandardMaterial||i instanceof M.ShaderMaterial||i.skinning)&&void 0!==u.viewMatrix&&Zt.uniformMatrix4fv(u.viewMatrix,!1,t.matrixWorldInverse.elements),void 0!==u.toneMappingExposure&&Zt.uniform1f(u.toneMappingExposure,wt.toneMappingExposure),void 0!==u.toneMappingWhitePoint&&Zt.uniform1f(u.toneMappingWhitePoint,wt.toneMappingWhitePoint)),i.skinning)if(r.bindMatrix&&void 0!==u.bindMatrix&&Zt.uniformMatrix4fv(u.bindMatrix,!1,r.bindMatrix.elements),r.bindMatrixInverse&&void 0!==u.bindMatrixInverse&&Zt.uniformMatrix4fv(u.bindMatrixInverse,!1,r.bindMatrixInverse.elements),Kt.floatVertexTextures&&r.skeleton&&r.skeleton.useVertexTexture){if(void 0!==u.boneTexture){var c=W();Zt.uniform1i(u.boneTexture,c),wt.setTexture(r.skeleton.boneTexture,c)}void 0!==u.boneTextureWidth&&Zt.uniform1i(u.boneTextureWidth,r.skeleton.boneTextureWidth),void 0!==u.boneTextureHeight&&Zt.uniform1i(u.boneTextureHeight,r.skeleton.boneTextureHeight)}else r.skeleton&&r.skeleton.boneMatrices&&void 0!==u.boneGlobalMatrices&&Zt.uniformMatrix4fv(u.boneGlobalMatrices,!1,r.skeleton.boneMatrices);return o&&((i instanceof M.MeshPhongMaterial||i instanceof M.MeshLambertMaterial||i instanceof M.MeshStandardMaterial||i.lights)&&G(l,s),e&&i.fog&&I(l,e),(i instanceof M.MeshBasicMaterial||i instanceof M.MeshLambertMaterial||i instanceof M.MeshPhongMaterial||i instanceof M.MeshStandardMaterial)&&P(l,i),i instanceof M.LineBasicMaterial?D(l,i):i instanceof M.LineDashedMaterial?(D(l,i),N(l,i)):i instanceof M.PointsMaterial?B(l,i):i instanceof M.MeshLambertMaterial?O(l,i):i instanceof M.MeshPhongMaterial?V(l,i):i instanceof M.MeshStandardMaterial?z(l,i):i instanceof M.MeshDepthMaterial?(l.mNear.value=t.near,l.mFar.value=t.far,l.opacity.value=i.opacity):i instanceof M.MeshNormalMaterial&&(l.opacity.value=i.opacity),X(n.uniformsList)),k(u,r),void 0!==u.modelMatrix&&Zt.uniformMatrix4fv(u.modelMatrix,!1,r.matrixWorld.elements),!0===n.hasDynamicUniforms&&F(n.uniformsList,r,t),h}function F(t,e,i){for(var r=[],n=0,a=t.length;n<a;n++){var o=t[n][0],s=o.onUpdateCallback;void 0!==s&&(s.bind(o)(e,i),r.push(t[n]))}X(r)}function P(t,e){t.opacity.value=e.opacity,t.diffuse.value=e.color,e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),t.map.value=e.map,t.specularMap.value=e.specularMap,t.alphaMap.value=e.alphaMap,e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity);var i;if(e.map?i=e.map:e.specularMap?i=e.specularMap:e.displacementMap?i=e.displacementMap:e.normalMap?i=e.normalMap:e.bumpMap?i=e.bumpMap:e.roughnessMap?i=e.roughnessMap:e.metalnessMap?i=e.metalnessMap:e.alphaMap?i=e.alphaMap:e.emissiveMap&&(i=e.emissiveMap),void 0!==i){i instanceof M.WebGLRenderTarget&&(i=i.texture);var r=i.offset,n=i.repeat;t.offsetRepeat.value.set(r.x,r.y,n.x,n.y)}t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap instanceof M.WebGLRenderTargetCube?1:-1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio}function D(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}function N(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}function B(t,e){if(t.diffuse.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size*Vt,t.scale.value=ht.clientHeight/2,t.map.value=e.map,null!==e.map){var i=e.map.offset,r=e.map.repeat;t.offsetRepeat.value.set(i.x,i.y,r.x,r.y)}}function I(t,e){t.fogColor.value=e.color,e instanceof M.Fog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e instanceof M.FogExp2&&(t.fogDensity.value=e.density)}function O(t,e){e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}function V(t,e){t.specular.value=e.specular,t.shininess.value=v(e.shininess,1e-4),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function z(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}function G(t,e){t.ambientLightColor.needsUpdate=e,t.directionalLights.needsUpdate=e,t.pointLights.needsUpdate=e,t.spotLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}function k(t,e){Zt.uniformMatrix4fv(t.modelViewMatrix,!1,e.modelViewMatrix.elements),t.normalMatrix&&Zt.uniformMatrix3fv(t.normalMatrix,!1,e.normalMatrix.elements)}function W(){var t=Dt;return Kt.maxTextures,Dt+=1,t}function j(t,e,i,r){var n,a;if("1i"===e)Zt.uniform1i(i,r);else if("1f"===e)Zt.uniform1f(i,r);else if("2f"===e)Zt.uniform2f(i,r[0],r[1]);else if("3f"===e)Zt.uniform3f(i,r[0],r[1],r[2]);else if("4f"===e)Zt.uniform4f(i,r[0],r[1],r[2],r[3]);else if("1iv"===e)Zt.uniform1iv(i,r);else if("3iv"===e)Zt.uniform3iv(i,r);else if("1fv"===e)Zt.uniform1fv(i,r);else if("2fv"===e)Zt.uniform2fv(i,r);else if("3fv"===e)Zt.uniform3fv(i,r);else if("4fv"===e)Zt.uniform4fv(i,r);else if("Matrix2fv"===e)Zt.uniformMatrix2fv(i,!1,r);else if("Matrix3fv"===e)Zt.uniformMatrix3fv(i,!1,r);else if("Matrix4fv"===e)Zt.uniformMatrix4fv(i,!1,r);else if("i"===e)Zt.uniform1i(i,r);else if("f"===e)Zt.uniform1f(i,r);else if("v2"===e)Zt.uniform2f(i,r.x,r.y);else if("v3"===e)Zt.uniform3f(i,r.x,r.y,r.z);else if("v4"===e)Zt.uniform4f(i,r.x,r.y,r.z,r.w);else if("c"===e)Zt.uniform3f(i,r.r,r.g,r.b);else if("s"===e){l=t.properties;for(var o in l){var s=l[o],h=i[o],u=r[o];j(s,s.type,h,u)}}else if("sa"===e)for(var l=t.properties,c=0,p=r.length;c<p;c++)for(var o in l){var s=l[o],h=i[c][o],u=r[c][o];j(s,s.type,h,u)}else if("iv1"===e)Zt.uniform1iv(i,r);else if("iv"===e)Zt.uniform3iv(i,r);else if("fv1"===e)Zt.uniform1fv(i,r);else if("fv"===e)Zt.uniform3fv(i,r);else if("v2v"===e){void 0===t._array&&(t._array=new Float32Array(2*r.length));for(var c=0,d=0,f=r.length;c<f;c++,d+=2)t._array[d+0]=r[c].x,t._array[d+1]=r[c].y;Zt.uniform2fv(i,t._array)}else if("v3v"===e){void 0===t._array&&(t._array=new Float32Array(3*r.length));for(var c=0,m=0,f=r.length;c<f;c++,m+=3)t._array[m+0]=r[c].x,t._array[m+1]=r[c].y,t._array[m+2]=r[c].z;Zt.uniform3fv(i,t._array)}else if("v4v"===e){void 0===t._array&&(t._array=new Float32Array(4*r.length));for(var c=0,v=0,f=r.length;c<f;c++,v+=4)t._array[v+0]=r[c].x,t._array[v+1]=r[c].y,t._array[v+2]=r[c].z,t._array[v+3]=r[c].w;Zt.uniform4fv(i,t._array)}else if("m2"===e)Zt.uniformMatrix2fv(i,!1,r.elements);else if("m3"===e)Zt.uniformMatrix3fv(i,!1,r.elements);else if("m3v"===e){void 0===t._array&&(t._array=new Float32Array(9*r.length));for(var c=0,f=r.length;c<f;c++)r[c].flattenToArrayOffset(t._array,9*c);Zt.uniformMatrix3fv(i,!1,t._array)}else if("m4"===e)Zt.uniformMatrix4fv(i,!1,r.elements);else if("m4v"===e){void 0===t._array&&(t._array=new Float32Array(16*r.length));for(var c=0,f=r.length;c<f;c++)r[c].flattenToArrayOffset(t._array,16*c);Zt.uniformMatrix4fv(i,!1,t._array)}else if("t"===e){if(n=r,a=W(),Zt.uniform1i(i,a),!n)return;n instanceof M.CubeTexture||Array.isArray(n.image)&&6===n.image.length?$(n,a):n instanceof M.WebGLRenderTargetCube?tt(n.texture,a):n instanceof M.WebGLRenderTarget?wt.setTexture(n.texture,a):wt.setTexture(n,a)}else if("tv"===e){void 0===t._array&&(t._array=[]);for(var c=0,f=t.value.length;c<f;c++)t._array[c]=W();Zt.uniform1iv(i,t._array);for(var c=0,f=t.value.length;c<f;c++)n=t.value[c],a=t._array[c],n&&(n instanceof M.CubeTexture||n.image instanceof Array&&6===n.image.length?$(n,a):n instanceof M.WebGLRenderTarget?wt.setTexture(n.texture,a):n instanceof M.WebGLRenderTargetCube?tt(n.texture,a):wt.setTexture(n,a))}}function X(t){for(var e,i=0,r=t.length;i<r;i++)!1!==(e=t[i][0]).needsUpdate&&j(e,e.type,t[i][1],e.value)}function H(t,e){var i,r,n,o,s,h,u=0,l=0,c=0,p=e.matrixWorldInverse,d=0,f=0,m=0,v=0,g=0;for(Ht.shadowsPointLight=0,i=0,r=t.length;i<r;i++)if(n=t[i],o=n.color,s=n.intensity,h=n.distance,n instanceof M.AmbientLight)u+=o.r*s,l+=o.g*s,c+=o.b*s;else if(n instanceof M.DirectionalLight)(y=re.get(n)).color.copy(n.color).multiplyScalar(n.intensity),y.direction.setFromMatrixPosition(n.matrixWorld),Xt.setFromMatrixPosition(n.target.matrixWorld),y.direction.sub(Xt),y.direction.transformDirection(p),y.shadow=n.castShadow,n.castShadow&&(y.shadowBias=n.shadow.bias,y.shadowRadius=n.shadow.radius,y.shadowMapSize=n.shadow.mapSize,Ht.shadows[g++]=n),Ht.directionalShadowMap[d]=n.shadow.map,Ht.directionalShadowMatrix[d]=n.shadow.matrix,Ht.directional[d++]=y;else if(n instanceof M.SpotLight)(y=re.get(n)).position.setFromMatrixPosition(n.matrixWorld),y.position.applyMatrix4(p),y.color.copy(o).multiplyScalar(s),y.distance=h,y.direction.setFromMatrixPosition(n.matrixWorld),Xt.setFromMatrixPosition(n.target.matrixWorld),y.direction.sub(Xt),y.direction.transformDirection(p),y.coneCos=a(n.angle),y.penumbraCos=a(n.angle*(1-n.penumbra)),y.decay=0===n.distance?0:n.decay,y.shadow=n.castShadow,n.castShadow&&(y.shadowBias=n.shadow.bias,y.shadowRadius=n.shadow.radius,y.shadowMapSize=n.shadow.mapSize,Ht.shadows[g++]=n),Ht.spotShadowMap[m]=n.shadow.map,Ht.spotShadowMatrix[m]=n.shadow.matrix,Ht.spot[m++]=y;else if(n instanceof M.PointLight)(y=re.get(n)).position.setFromMatrixPosition(n.matrixWorld),y.position.applyMatrix4(p),y.color.copy(n.color).multiplyScalar(n.intensity),y.distance=n.distance,y.decay=0===n.distance?0:n.decay,y.shadow=n.castShadow,n.castShadow&&(y.shadowBias=n.shadow.bias,y.shadowRadius=n.shadow.radius,y.shadowMapSize=n.shadow.mapSize,Ht.shadows[g++]=n),Ht.pointShadowMap[f]=n.shadow.map,void 0===Ht.pointShadowMatrix[f]&&(Ht.pointShadowMatrix[f]=new M.Matrix4),Xt.setFromMatrixPosition(n.matrixWorld).negate(),Ht.pointShadowMatrix[f].identity().setPosition(Xt),Ht.point[f++]=y;else if(n instanceof M.HemisphereLight){var y=re.get(n);y.direction.setFromMatrixPosition(n.matrixWorld),y.direction.transformDirection(p),y.direction.normalize(),y.skyColor.copy(n.color).multiplyScalar(s),y.groundColor.copy(n.groundColor).multiplyScalar(s),Ht.hemi[v++]=y}Ht.ambient[0]=u,Ht.ambient[1]=l,Ht.ambient[2]=c,Ht.directional.length=d,Ht.spot.length=m,Ht.point.length=f,Ht.hemi.length=v,Ht.shadows.length=g,Ht.hash=d+","+f+","+m+","+v+","+g}function Y(t,e,i){var r;if(i?(Zt.texParameteri(t,Zt.TEXTURE_WRAP_S,st(e.wrapS)),Zt.texParameteri(t,Zt.TEXTURE_WRAP_T,st(e.wrapT)),Zt.texParameteri(t,Zt.TEXTURE_MAG_FILTER,st(e.magFilter)),Zt.texParameteri(t,Zt.TEXTURE_MIN_FILTER,st(e.minFilter))):(Zt.texParameteri(t,Zt.TEXTURE_WRAP_S,Zt.CLAMP_TO_EDGE),Zt.texParameteri(t,Zt.TEXTURE_WRAP_T,Zt.CLAMP_TO_EDGE),e.wrapS!==M.ClampToEdgeWrapping||(e.wrapT,M.ClampToEdgeWrapping),Zt.texParameteri(t,Zt.TEXTURE_MAG_FILTER,ot(e.magFilter)),Zt.texParameteri(t,Zt.TEXTURE_MIN_FILTER,ot(e.minFilter)),e.minFilter!==M.NearestFilter&&(e.minFilter,M.LinearFilter)),r=Jt.get("EXT_texture_filter_anisotropic")){if(e.type===M.FloatType&&null===Jt.get("OES_texture_float_linear"))return;if(e.type===M.HalfFloatType&&null===Jt.get("OES_texture_half_float_linear"))return;(1<e.anisotropy||te.get(e).__currentAnisotropy)&&(Zt.texParameterf(t,r.TEXTURE_MAX_ANISOTROPY_EXT,g(e.anisotropy,wt.getMaxAnisotropy())),te.get(e).__currentAnisotropy=e.anisotropy)}}function q(t,e,i){void 0===t.__webglInit&&(t.__webglInit=!0,e.cincopaAddEventListener("dispose",h),t.__webglTexture=Zt.createTexture(),Yt.textures++),$t.activeTexture(Zt.TEXTURE0+i),$t.bindTexture(Zt.TEXTURE_2D,t.__webglTexture),Zt.pixelStorei(Zt.UNPACK_FLIP_Y_WEBGL,e.flipY),Zt.pixelStorei(Zt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Zt.pixelStorei(Zt.UNPACK_ALIGNMENT,e.unpackAlignment);var r=Z(e.image,Kt.maxTextureSize);J(e)&&!1===Q(r)&&(r=K(r));var n=Q(r),a=st(e.format),o=st(e.type);Y(Zt.TEXTURE_2D,e,n);var s,u=e.mipmaps;if(e instanceof M.DataTexture)if(0<u.length&&n){for(var l=0,c=u.length;l<c;l++)s=u[l],$t.texImage2D(Zt.TEXTURE_2D,l,a,s.width,s.height,0,a,o,s.data);e.generateMipmaps=!1}else $t.texImage2D(Zt.TEXTURE_2D,0,a,r.width,r.height,0,a,o,r.data);else if(e instanceof M.CompressedTexture)for(var l=0,c=u.length;l<c;l++)s=u[l],e.format!==M.RGBAFormat&&e.format!==M.RGBFormat?-1<$t.getCompressedTextureFormats().indexOf(a)&&$t.compressedTexImage2D(Zt.TEXTURE_2D,l,a,s.width,s.height,0,s.data):$t.texImage2D(Zt.TEXTURE_2D,l,a,s.width,s.height,0,a,o,s.data);else if(0<u.length&&n){for(var l=0,c=u.length;l<c;l++)s=u[l],$t.texImage2D(Zt.TEXTURE_2D,l,a,a,o,s);e.generateMipmaps=!1}else $t.texImage2D(Zt.TEXTURE_2D,0,a,a,o,r);e.generateMipmaps&&n&&Zt.generateMipmap(Zt.TEXTURE_2D),t.__version=e.version,e.onUpdate&&e.onUpdate(e)}function Z(t,e){if(t.width>e||t.height>e){var i=e/v(t.width,t.height),r=document.createElement("canvas");return r.width=m(t.width*i),r.height=m(t.height*i),r.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,r.width,r.height),r}return t}function Q(t){return M.Math.isPowerOfTwo(t.width)&&M.Math.isPowerOfTwo(t.height)}function J(t){return t.wrapS!==M.ClampToEdgeWrapping||t.wrapT!==M.ClampToEdgeWrapping||t.minFilter!==M.NearestFilter&&t.minFilter!==M.LinearFilter}function K(t){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var e=document.createElement("canvas");return e.width=M.Math.nearestPowerOfTwo(t.width),e.height=M.Math.nearestPowerOfTwo(t.height),e.getContext("2d").drawImage(t,0,0,e.width,e.height),e}return t}function $(t,e){var i=te.get(t);if(6===t.image.length)if(0<t.version&&i.__version!==t.version){i.__image__webglTextureCube||(t.cincopaAddEventListener("dispose",h),i.__image__webglTextureCube=Zt.createTexture(),Yt.textures++),$t.activeTexture(Zt.TEXTURE0+e),$t.bindTexture(Zt.TEXTURE_CUBE_MAP,i.__image__webglTextureCube),Zt.pixelStorei(Zt.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var r=t instanceof M.CompressedTexture,n=t.image[0]instanceof M.DataTexture,a=[],o=0;6>o;o++)a[o]=!wt.autoScaleCubemaps||r||n?n?t.image[o].image:t.image[o]:Z(t.image[o],Kt.maxCubemapSize);var s=Q(a[0]),u=st(t.format),l=st(t.type);Y(Zt.TEXTURE_CUBE_MAP,t,s);for(o=0;6>o;o++)if(r)for(var c,p=a[o].mipmaps,d=0,f=p.length;d<f;d++)c=p[d],t.format!==M.RGBAFormat&&t.format!==M.RGBFormat?-1<$t.getCompressedTextureFormats().indexOf(u)&&$t.compressedTexImage2D(Zt.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,u,c.width,c.height,0,c.data):$t.texImage2D(Zt.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,u,c.width,c.height,0,u,l,c.data);else n?$t.texImage2D(Zt.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,u,a[o].width,a[o].height,0,u,l,a[o].data):$t.texImage2D(Zt.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,u,u,l,a[o]);t.generateMipmaps&&s&&Zt.generateMipmap(Zt.TEXTURE_CUBE_MAP),i.__version=t.version,t.onUpdate&&t.onUpdate(t)}else $t.activeTexture(Zt.TEXTURE0+e),$t.bindTexture(Zt.TEXTURE_CUBE_MAP,i.__image__webglTextureCube)}function tt(t,e){$t.activeTexture(Zt.TEXTURE0+e),$t.bindTexture(Zt.TEXTURE_CUBE_MAP,te.get(t).__webglTexture)}function et(t,e,i,r){var n=st(e.texture.format),a=st(e.texture.type);$t.texImage2D(r,0,n,e.width,e.height,0,n,a,null),Zt.bindFramebuffer(Zt.FRAMEBUFFER,t),Zt.framebufferTexture2D(Zt.FRAMEBUFFER,i,r,te.get(e.texture).__webglTexture,0),Zt.bindFramebuffer(Zt.FRAMEBUFFER,null)}function it(t,e){Zt.bindRenderbuffer(Zt.RENDERBUFFER,t),e.depthBuffer&&!e.stencilBuffer?(Zt.renderbufferStorage(Zt.RENDERBUFFER,Zt.DEPTH_COMPONENT16,e.width,e.height),Zt.framebufferRenderbuffer(Zt.FRAMEBUFFER,Zt.DEPTH_ATTACHMENT,Zt.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(Zt.renderbufferStorage(Zt.RENDERBUFFER,Zt.DEPTH_STENCIL,e.width,e.height),Zt.framebufferRenderbuffer(Zt.FRAMEBUFFER,Zt.DEPTH_STENCIL_ATTACHMENT,Zt.RENDERBUFFER,t)):Zt.renderbufferStorage(Zt.RENDERBUFFER,Zt.RGBA4,e.width,e.height),Zt.bindRenderbuffer(Zt.RENDERBUFFER,null)}function rt(t){var e=te.get(t);if(t instanceof M.WebGLRenderTargetCube){e.__webglDepthbuffer=[];for(var i=0;6>i;i++)Zt.bindFramebuffer(Zt.FRAMEBUFFER,e.__webglFramebuffer[i]),e.__webglDepthbuffer[i]=Zt.createRenderbuffer(),it(e.__webglDepthbuffer[i],t)}else Zt.bindFramebuffer(Zt.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=Zt.createRenderbuffer(),it(e.__webglDepthbuffer,t);Zt.bindFramebuffer(Zt.FRAMEBUFFER,null)}function nt(t){var e=te.get(t),i=te.get(t.texture);t.cincopaAddEventListener("dispose",u),i.__webglTexture=Zt.createTexture(),Yt.textures++;var r=t instanceof M.WebGLRenderTargetCube,n=M.Math.isPowerOfTwo(t.width)&&M.Math.isPowerOfTwo(t.height);if(r){e.__webglFramebuffer=[];for(a=0;6>a;a++)e.__webglFramebuffer[a]=Zt.createFramebuffer()}else e.__webglFramebuffer=Zt.createFramebuffer();if(r){$t.bindTexture(Zt.TEXTURE_CUBE_MAP,i.__webglTexture),Y(Zt.TEXTURE_CUBE_MAP,t.texture,n);for(var a=0;6>a;a++)et(e.__webglFramebuffer[a],t,Zt.COLOR_ATTACHMENT0,Zt.TEXTURE_CUBE_MAP_POSITIVE_X+a);t.texture.generateMipmaps&&n&&Zt.generateMipmap(Zt.TEXTURE_CUBE_MAP),$t.bindTexture(Zt.TEXTURE_CUBE_MAP,null)}else $t.bindTexture(Zt.TEXTURE_2D,i.__webglTexture),Y(Zt.TEXTURE_2D,t.texture,n),et(e.__webglFramebuffer,t,Zt.COLOR_ATTACHMENT0,Zt.TEXTURE_2D),t.texture.generateMipmaps&&n&&Zt.generateMipmap(Zt.TEXTURE_2D),$t.bindTexture(Zt.TEXTURE_2D,null);t.depthBuffer&&rt(t)}function at(t){var e=t instanceof M.WebGLRenderTargetCube?Zt.TEXTURE_CUBE_MAP:Zt.TEXTURE_2D,i=te.get(t.texture).__webglTexture;$t.bindTexture(e,i),Zt.generateMipmap(e),$t.bindTexture(e,null)}function ot(t){return t===M.NearestFilter||t===M.NearestMipMapNearestFilter||t===M.NearestMipMapLinearFilter?Zt.NEAREST:Zt.LINEAR}function st(t){var e;if(t===M.RepeatWrapping)return Zt.REPEAT;if(t===M.ClampToEdgeWrapping)return Zt.CLAMP_TO_EDGE;if(t===M.MirroredRepeatWrapping)return Zt.MIRRORED_REPEAT;if(t===M.NearestFilter)return Zt.NEAREST;if(t===M.NearestMipMapNearestFilter)return Zt.NEAREST_MIPMAP_NEAREST;if(t===M.NearestMipMapLinearFilter)return Zt.NEAREST_MIPMAP_LINEAR;if(t===M.LinearFilter)return Zt.LINEAR;if(t===M.LinearMipMapNearestFilter)return Zt.LINEAR_MIPMAP_NEAREST;if(t===M.LinearMipMapLinearFilter)return Zt.LINEAR_MIPMAP_LINEAR;if(t===M.UnsignedByteType)return Zt.UNSIGNED_BYTE;if(t===M.UnsignedShort4444Type)return Zt.UNSIGNED_SHORT_4_4_4_4;if(t===M.UnsignedShort5551Type)return Zt.UNSIGNED_SHORT_5_5_5_1;if(t===M.UnsignedShort565Type)return Zt.UNSIGNED_SHORT_5_6_5;if(t===M.ByteType)return Zt.BYTE;if(t===M.ShortType)return Zt.SHORT;if(t===M.UnsignedShortType)return Zt.UNSIGNED_SHORT;if(t===M.IntType)return Zt.INT;if(t===M.UnsignedIntType)return Zt.UNSIGNED_INT;if(t===M.FloatType)return Zt.FLOAT;if(null!==(e=Jt.get("OES_texture_half_float"))&&t===M.HalfFloatType)return e.HALF_FLOAT_OES;if(t===M.AlphaFormat)return Zt.ALPHA;if(t===M.RGBFormat)return Zt.RGB;if(t===M.RGBAFormat)return Zt.RGBA;if(t===M.LuminanceFormat)return Zt.LUMINANCE;if(t===M.LuminanceAlphaFormat)return Zt.LUMINANCE_ALPHA;if(t===M.AddEquation)return Zt.FUNC_ADD;if(t===M.SubtractEquation)return Zt.FUNC_SUBTRACT;if(t===M.ReverseSubtractEquation)return Zt.FUNC_REVERSE_SUBTRACT;if(t===M.ZeroFactor)return Zt.ZERO;if(t===M.OneFactor)return Zt.ONE;if(t===M.SrcColorFactor)return Zt.SRC_COLOR;if(t===M.OneMinusSrcColorFactor)return Zt.ONE_MINUS_SRC_COLOR;if(t===M.SrcAlphaFactor)return Zt.SRC_ALPHA;if(t===M.OneMinusSrcAlphaFactor)return Zt.ONE_MINUS_SRC_ALPHA;if(t===M.DstAlphaFactor)return Zt.DST_ALPHA;if(t===M.OneMinusDstAlphaFactor)return Zt.ONE_MINUS_DST_ALPHA;if(t===M.DstColorFactor)return Zt.DST_COLOR;if(t===M.OneMinusDstColorFactor)return Zt.ONE_MINUS_DST_COLOR;if(t===M.SrcAlphaSaturateFactor)return Zt.SRC_ALPHA_SATURATE;if(null!==(e=Jt.get("WEBGL_compressed_texture_s3tc"))){if(t===M.RGB_S3TC_DXT1_Format)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===M.RGBA_S3TC_DXT1_Format)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===M.RGBA_S3TC_DXT3_Format)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===M.RGBA_S3TC_DXT5_Format)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(e=Jt.get("WEBGL_compressed_texture_pvrtc"))){if(t===M.RGB_PVRTC_4BPPV1_Format)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===M.RGB_PVRTC_2BPPV1_Format)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===M.RGBA_PVRTC_4BPPV1_Format)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===M.RGBA_PVRTC_2BPPV1_Format)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(e=Jt.get("WEBGL_compressed_texture_etc1"))&&t===M.RGB_ETC1_Format)return e.COMPRESSED_RGB_ETC1_WEBGL;if(null!==(e=Jt.get("EXT_blend_minmax"))){if(t===M.MinEquation)return e.MIN_EXT;if(t===M.MaxEquation)return e.MAX_EXT}return 0}var ht=void 0===(t=t||{}).canvas?document.createElement("canvas"):t.canvas,ut=void 0===t.context?null:t.context,lt=void 0!==t.alpha&&t.alpha,ct=!(void 0!==t.depth)||t.depth,pt=!(void 0!==t.stencil)||t.stencil,dt=void 0!==t.antialias&&t.antialias,ft=!(void 0!==t.premultipliedAlpha)||t.premultipliedAlpha,mt=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,vt=[],gt=[],yt=-1,xt=[],Mt=-1,_t=new Float32Array(8),bt=[],St=[];this.domElement=ht,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=M.LinearToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0;var wt=this,Et=null,Tt=null,At=null,Lt=-1,Rt="",Ct=null,Ut=new M.Vector4,Ft=null,Pt=new M.Vector4,Dt=0,Nt=new M.Color(0),Bt=0,It=ht.width,Ot=ht.height,Vt=1,zt=new M.Vector4(0,0,It,Ot),Gt=!1,kt=new M.Vector4(0,0,It,Ot),Wt=new M.Frustum,jt=new M.Matrix4,Xt=new M.Vector3,Ht={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[],shadowsPointLight:0},Yt={geometries:0,textures:0},qt={calls:0,vertices:0,faces:0,points:0};this.info={render:qt,memory:Yt,programs:null};var Zt;try{var Qt={alpha:lt,depth:ct,stencil:pt,antialias:dt,premultipliedAlpha:ft,preserveDrawingBuffer:mt};if(null===(Zt=ut||ht.getContext("webgl",Qt)||ht.getContext("experimental-webgl",Qt)))throw null!==ht.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===Zt.getShaderPrecisionFormat&&(Zt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),ht.cincopaAddEventListener("webglcontextlost",o,!1)}catch(t){}var Jt=new M.WebGLExtensions(Zt);Jt.get("OES_texture_float"),Jt.get("OES_texture_float_linear"),Jt.get("OES_texture_half_float"),Jt.get("OES_texture_half_float_linear"),Jt.get("OES_standard_derivatives"),Jt.get("ANGLE_instanced_arrays"),Jt.get("OES_element_index_uint")&&(M.BufferGeometry.MaxIndex=4294967296);var Kt=new M.WebGLCapabilities(Zt,Jt,t),$t=new M.WebGLState(Zt,Jt,st),te=new M.WebGLProperties,ee=new M.WebGLObjects(Zt,te,this.info),ie=new M.WebGLPrograms(this,Kt),re=new M.WebGLLights;this.info.programs=ie.programs;var ne=new M.WebGLBufferRenderer(Zt,Jt,qt),ae=new M.WebGLIndexedBufferRenderer(Zt,Jt,qt);r(),this.context=Zt,this.capabilities=Kt,this.extensions=Jt,this.properties=te,this.state=$t;var oe=new M.WebGLShadowMap(this,Ht,ee);this.shadowMap=oe;var se=new M.SpritePlugin(this,bt),he=new M.LensFlarePlugin(this,St);this.getContext=function(){return Zt},this.getContextAttributes=function(){return Zt.getContextAttributes()},this.forceContextLoss=function(){Jt.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){var t;return function(){if(void 0!=t)return t;var e=Jt.get("EXT_texture_filter_anisotropic");return t=null===e?0:Zt.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}}(),this.getPrecision=function(){return Kt.precision},this.getPixelRatio=function(){return Vt},this.setPixelRatio=function(t){void 0===t||(Vt=t,this.setSize(kt.z,kt.w,!1))},this.getSize=function(){return{width:It,height:Ot}},this.setSize=function(t,e,i){It=t,Ot=e,ht.width=t*Vt,ht.height=e*Vt,!1!==i&&(ht.style.width=t+"px",ht.style.height=e+"px"),this.setViewport(0,0,t,e)},this.setViewport=function(t,e,i,r){$t.viewport(kt.set(t,e,i,r))},this.setScissor=function(t,e,i,r){$t.scissor(zt.set(t,e,i,r))},this.setScissorTest=function(t){$t.setScissorTest(Gt=t)},this.getClearColor=function(){return Nt},this.setClearColor=function(t,e){Nt.set(t),Bt=void 0===e?1:e,i(Nt.r,Nt.g,Nt.b,Bt)},this.getClearAlpha=function(){return Bt},this.setClearAlpha=function(t){Bt=t,i(Nt.r,Nt.g,Nt.b,Bt)},this.clear=function(t,e,i){var r=0;(void 0===t||t)&&(r|=Zt.COLOR_BUFFER_BIT),(void 0===e||e)&&(r|=Zt.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=Zt.STENCIL_BUFFER_BIT),Zt.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(t,e,i,r){this.setRenderTarget(t),this.clear(e,i,r)},this.resetGLState=n,this.dispose=function(){ht.removeEventListener("webglcontextlost",o,!1)},this.renderBufferImmediate=function(t,e,i){$t.initAttributes();var r=te.get(t);t.hasPositions&&!r.position&&(r.position=Zt.createBuffer()),t.hasNormals&&!r.normal&&(r.normal=Zt.createBuffer()),t.hasUvs&&!r.uv&&(r.uv=Zt.createBuffer()),t.hasColors&&!r.color&&(r.color=Zt.createBuffer());var n=e.getAttributes();if(t.hasPositions&&(Zt.bindBuffer(Zt.ARRAY_BUFFER,r.position),Zt.bufferData(Zt.ARRAY_BUFFER,t.positionArray,Zt.DYNAMIC_DRAW),$t.enableAttribute(n.position),Zt.vertexAttribPointer(n.position,3,Zt.FLOAT,!1,0,0)),t.hasNormals){if(Zt.bindBuffer(Zt.ARRAY_BUFFER,r.normal),"MeshPhongMaterial"!==i.type&&"MeshStandardMaterial"!==i.type&&i.shading===M.FlatShading)for(var a=0,o=3*t.count;a<o;a+=9){var s=t.normalArray,h=(s[a+0]+s[a+3]+s[a+6])/3,u=(s[a+1]+s[a+4]+s[a+7])/3,l=(s[a+2]+s[a+5]+s[a+8])/3;s[a+0]=h,s[a+1]=u,s[a+2]=l,s[a+3]=h,s[a+4]=u,s[a+5]=l,s[a+6]=h,s[a+7]=u,s[a+8]=l}Zt.bufferData(Zt.ARRAY_BUFFER,t.normalArray,Zt.DYNAMIC_DRAW),$t.enableAttribute(n.normal),Zt.vertexAttribPointer(n.normal,3,Zt.FLOAT,!1,0,0)}t.hasUvs&&i.map&&(Zt.bindBuffer(Zt.ARRAY_BUFFER,r.uv),Zt.bufferData(Zt.ARRAY_BUFFER,t.uvArray,Zt.DYNAMIC_DRAW),$t.enableAttribute(n.uv),Zt.vertexAttribPointer(n.uv,2,Zt.FLOAT,!1,0,0)),t.hasColors&&i.vertexColors!==M.NoColors&&(Zt.bindBuffer(Zt.ARRAY_BUFFER,r.color),Zt.bufferData(Zt.ARRAY_BUFFER,t.colorArray,Zt.DYNAMIC_DRAW),$t.enableAttribute(n.color),Zt.vertexAttribPointer(n.color,3,Zt.FLOAT,!1,0,0)),$t.disableUnusedAttributes(),Zt.drawArrays(Zt.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,i,r,n,a,o){R(n);var s=U(t,i,n,a),h=!1,u=r.id+"_"+s.id+"_"+n.wireframe;u!=Rt&&(Rt=u,h=!0);var l=a.morphTargetInfluences;if(void 0!==l){for(var c=[],p=0,d=l.length;p<d;p++)f=l[p],c.push([f,p]);c.sort(b),8<c.length&&(c.length=8);for(var f,m=r.morphAttributes,p=0,d=c.length;p<d;p++)if(f=c[p],_t[p]=f[0],0!==f[0]){x=f[1];!0===n.morphTargets&&m.position&&r.addAttribute("morphTarget"+p,m.position[x]),!0===n.morphNormals&&m.normal&&r.addAttribute("morphNormal"+p,m.normal[x])}else!0===n.morphTargets&&r.removeAttribute("morphTarget"+p),!0===n.morphNormals&&r.removeAttribute("morphNormal"+p);var y=s.getUniforms();null!==y.morphTargetInfluences&&Zt.uniform1fv(y.morphTargetInfluences,_t),h=!0}var x=r.index,S=r.attributes.position;!0===n.wireframe&&(x=ee.getWireframeAttribute(r));var w;null===x?w=ne:(w=ae).setIndex(x),h&&(_(n,s,r),null!==x&&Zt.bindBuffer(Zt.ELEMENT_ARRAY_BUFFER,ee.getAttributeBuffer(x)));var E=1/0;null===x?void 0!==S&&(E=S.count):E=x.count;var T=r.drawRange.start,A=r.drawRange.count,L=null===o?0:o.start,C=null===o?1/0:o.count,F=v(0,T,L),P=g(0+E,T+A,L+C)-1,D=v(0,P-F+1);if(a instanceof M.Mesh)if(!0===n.wireframe)$t.setLineWidth(n.wireframeLinewidth*e()),w.setMode(Zt.LINES);else switch(a.drawMode){case M.TrianglesDrawMode:w.setMode(Zt.TRIANGLES);break;case M.TriangleStripDrawMode:w.setMode(Zt.TRIANGLE_STRIP);break;case M.TriangleFanDrawMode:w.setMode(Zt.TRIANGLE_FAN)}else if(a instanceof M.Line){var N=n.linewidth;void 0===N&&(N=1),$t.setLineWidth(N*e()),a instanceof M.LineSegments?w.setMode(Zt.LINES):w.setMode(Zt.LINE_STRIP)}else a instanceof M.Points&&w.setMode(Zt.POINTS);r instanceof M.InstancedBufferGeometry?0<r.maxInstancedCount&&w.renderInstances(r,F,D):w.render(F,D)},this.render=function(t,e,i,r){if(0!=e instanceof M.Camera){var n=t.fog;if(Rt="",Lt=-1,Ct=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),e.matrixWorldInverse.getInverse(e.matrixWorld),jt.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),Wt.setFromMatrix(jt),vt.length=0,yt=-1,Mt=-1,bt.length=0,St.length=0,T(t,e),gt.length=yt+1,xt.length=Mt+1,!0===wt.sortObjects&&(gt.sort(S),xt.sort(w)),H(vt,e),oe.render(t,e),qt.calls=0,qt.vertices=0,qt.faces=0,qt.points=0,void 0===i&&(i=null),this.setRenderTarget(i),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),t.overrideMaterial){var a=t.overrideMaterial;A(gt,e,n,a),A(xt,e,n,a)}else $t.setBlending(M.NoBlending),A(gt,e,n),A(xt,e,n);if(se.render(t,e),he.render(t,e,Pt),i){var o=i.texture;o.generateMipmaps&&Q(i)&&o.minFilter!==M.NearestFilter&&o.minFilter!==M.LinearFilter&&at(i)}$t.setDepthTest(!0),$t.setDepthWrite(!0),$t.setColorWrite(!0)}},this.setFaceCulling=function(t,e){t===M.CullFaceNone?$t.disable(Zt.CULL_FACE):(e===M.FrontFaceDirectionCW?Zt.frontFace(Zt.CW):Zt.frontFace(Zt.CCW),t===M.CullFaceBack?Zt.cullFace(Zt.BACK):t===M.CullFaceFront?Zt.cullFace(Zt.FRONT):Zt.cullFace(Zt.FRONT_AND_BACK),$t.enable(Zt.CULL_FACE))},this.setTexture=function(t,e){var i=te.get(t);if(0<t.version&&i.__version!==t.version){var r=t.image;return void 0===r||!1===r.complete?void 0:void q(i,t,e)}$t.activeTexture(Zt.TEXTURE0+e),$t.bindTexture(Zt.TEXTURE_2D,i.__webglTexture)},this.getCurrentRenderTarget=function(){return Tt},this.setRenderTarget=function(t){Tt=t,t&&void 0===te.get(t).__webglFramebuffer&&nt(t);var e,i=t instanceof M.WebGLRenderTargetCube;if(t){var r=te.get(t);e=i?r.__webglFramebuffer[t.activeCubeFace]:r.__webglFramebuffer,Ut.copy(t.scissor),Ft=t.scissorTest,Pt.copy(t.viewport)}else e=null,Ut.copy(zt).multiplyScalar(Vt),Ft=Gt,Pt.copy(kt).multiplyScalar(Vt);if(At!==e&&(Zt.bindFramebuffer(Zt.FRAMEBUFFER,e),At=e),$t.scissor(Ut),$t.setScissorTest(Ft),$t.viewport(Pt),i){var n=te.get(t.texture);Zt.framebufferTexture2D(Zt.FRAMEBUFFER,Zt.COLOR_ATTACHMENT0,Zt.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,n.__webglTexture,t.activeMipMapLevel)}},this.readRenderTargetPixels=function(t,e,i,r,n,a){if(0!=t instanceof M.WebGLRenderTarget){var o=te.get(t).__webglFramebuffer;if(o){var s=!1;o!==At&&(Zt.bindFramebuffer(Zt.FRAMEBUFFER,o),s=!0);try{var h=t.texture;if(h.format!==M.RGBAFormat&&st(h.format)!==Zt.getParameter(Zt.IMPLEMENTATION_COLOR_READ_FORMAT))return;if(!(h.type===M.UnsignedByteType||st(h.type)===Zt.getParameter(Zt.IMPLEMENTATION_COLOR_READ_TYPE)||h.type===M.FloatType&&Jt.get("WEBGL_color_buffer_float")||h.type===M.HalfFloatType&&Jt.get("EXT_color_buffer_half_float")))return;Zt.checkFramebufferStatus(Zt.FRAMEBUFFER)===Zt.FRAMEBUFFER_COMPLETE&&Zt.readPixels(e,i,r,n,st(h.format),st(h.type),a)}finally{s&&Zt.bindFramebuffer(Zt.FRAMEBUFFER,At)}}}}},M.WebGLExtensions=function(t){var e={};this.get=function(i){if(void 0!==e[i])return e[i];var r;return r="EXT_texture_filter_anisotropic"===i?t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"):"WEBGL_compressed_texture_s3tc"===i?t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"):"WEBGL_compressed_texture_pvrtc"===i?t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"):"WEBGL_compressed_texture_etc1"===i?t.getExtension("WEBGL_compressed_texture_etc1"):t.getExtension(i),e[i]=r,r}},M.WebGLCapabilities=function(t,e,i){function r(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision&&0<t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision&&0<t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision?"mediump":"lowp"}this.getMaxPrecision=r,this.precision=void 0===i.precision?"highp":i.precision,this.logarithmicDepthBuffer=void 0!==i.logarithmicDepthBuffer&&i.logarithmicDepthBuffer,this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxCubemapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=t.getParameter(t.MAX_VARYING_VECTORS),this.maxFragmentUniforms=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=0<this.maxVertexTextures,this.floatFragmentTextures=!!e.get("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var n=r(this.precision);n!==this.precision&&(this.precision=n),this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!e.get("EXT_frag_depth"))},M.WebGLProperties=function(){var t={};this.get=function(e){var i=e.uuid,r=t[i];return void 0===r&&(r={},t[i]=r),r},this.delete=function(e){delete t[e.uuid]},this.clear=function(){t={}}},M.WebGLLights=function(){var t={};this.get=function(e){if(void 0!==t[e.id])return t[e.id];var i;switch(e.type){case"DirectionalLight":i={direction:new M.Vector3,color:new M.Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new M.Vector2};break;case"SpotLight":i={position:new M.Vector3,direction:new M.Vector3,color:new M.Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new M.Vector2};break;case"PointLight":i={position:new M.Vector3,color:new M.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new M.Vector2};break;case"HemisphereLight":i={direction:new M.Vector3,skyColor:new M.Color,groundColor:new M.Color}}return t[e.id]=i,i}},M.WebGLState=function(t,e,i){var r,n=this,a=new M.Vector4,o=new Uint8Array(16),s=new Uint8Array(16),h=new Uint8Array(16),u={},l=null,c=null,p=null,d=null,f=null,m=null,v=null,g=null,y=!1,x=null,_=null,b=null,S=null,w=null,E=null,T=null,A=null,L=null,R=null,C=null,U=null,F=null,P=null,D=null,N=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),B={},I=new M.Vector4,O=null,V=null,z=new M.Vector4,G=new M.Vector4,k=t.createTexture();t.bindTexture(t.TEXTURE_2D,k),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGB,1,1,0,t.RGB,t.UNSIGNED_BYTE,new Uint8Array(3)),this.init=function(){this.clearColor(0,0,0,1),this.clearDepth(1),this.clearStencil(0),this.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.frontFace(t.CCW),t.cullFace(t.BACK),this.enable(t.CULL_FACE),this.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)},this.initAttributes=function(){for(var t=0,e=o.length;t<e;t++)o[t]=0},this.enableAttribute=function(i){o[i]=1,0===s[i]&&(t.enableVertexAttribArray(i),s[i]=1),0!==h[i]&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,0),h[i]=0)},this.enableAttributeAndDivisor=function(e,i,r){o[e]=1,0===s[e]&&(t.enableVertexAttribArray(e),s[e]=1),h[e]!==i&&(r.vertexAttribDivisorANGLE(e,i),h[e]=i)},this.disableUnusedAttributes=function(){for(var e=0,i=s.length;e<i;e++)s[e]!==o[e]&&(t.disableVertexAttribArray(e),s[e]=0)},this.enable=function(e){!0!==u[e]&&(t.enable(e),u[e]=!0)},this.disable=function(e){!1!==u[e]&&(t.disable(e),u[e]=!1)},this.getCompressedTextureFormats=function(){if(null==l&&(l=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")))for(var i=t.getParameter(t.COMPRESSED_TEXTURE_FORMATS),r=0;r<i.length;r++)l.push(i[r]);return l},this.setBlending=function(e,r,n,a,o,s,h,u){e===M.NoBlending?this.disable(t.BLEND):this.enable(t.BLEND),(e!==c||u!==y)&&(e===M.AdditiveBlending?u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE)):e===M.SubtractiveBlending?u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR)):e===M.MultiplyBlending?u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.SRC_COLOR,t.SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR)):u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)),c=e,y=u),e===M.CustomBlending?(o=o||r,s=s||n,h=h||a,(r!==p||o!==m)&&(t.blendEquationSeparate(i(r),i(o)),p=r,m=o),(n!==d||a!==f||s!==v||h!==g)&&(t.blendFuncSeparate(i(n),i(a),i(s),i(h)),d=n,f=a,v=s,g=h)):(p=null,d=null,f=null,m=null,v=null,g=null)},this.setDepthFunc=function(e){x!==e&&(e?e===M.NeverDepth?t.depthFunc(t.NEVER):e===M.AlwaysDepth?t.depthFunc(t.ALWAYS):e===M.LessDepth?t.depthFunc(t.LESS):e===M.LessEqualDepth?t.depthFunc(t.LEQUAL):e===M.EqualDepth?t.depthFunc(t.EQUAL):e===M.GreaterEqualDepth?t.depthFunc(t.GEQUAL):e===M.GreaterDepth?t.depthFunc(t.GREATER):e===M.NotEqualDepth?t.depthFunc(t.NOTEQUAL):t.depthFunc(t.LEQUAL):t.depthFunc(t.LEQUAL),x=e)},this.setDepthTest=function(e){e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)},this.setDepthWrite=function(e){_!==e&&(t.depthMask(e),_=e)},this.setColorWrite=function(e){b!==e&&(t.colorMask(e,e,e,e),b=e)},this.setStencilFunc=function(e,i,r){(w!==e||E!==i||T!==r)&&(t.stencilFunc(e,i,r),w=e,E=i,T=r)},this.setStencilOp=function(e,i,r){(A!==e||L!==i||R!==r)&&(t.stencilOp(e,i,r),A=e,L=i,R=r)},this.setStencilTest=function(e){e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)},this.setStencilWrite=function(e){S!==e&&(t.stencilMask(e),S=e)},this.setFlipSided=function(e){C!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),C=e)},this.setLineWidth=function(e){e!==U&&(t.lineWidth(e),U=e)},this.setPolygonOffset=function(e,i,r){e?this.enable(t.POLYGON_OFFSET_FILL):this.disable(t.POLYGON_OFFSET_FILL),e&&(F!==i||P!==r)&&(t.polygonOffset(i,r),F=i,P=r)},this.getScissorTest=function(){return D},this.setScissorTest=function(e){D=e,e?this.enable(t.SCISSOR_TEST):this.disable(t.SCISSOR_TEST)},this.activeTexture=function(e){void 0===e&&(e=t.TEXTURE0+N-1),r!==e&&(t.activeTexture(e),r=e)},this.bindTexture=function(e,i){void 0===r&&n.activeTexture();var a=B[r];void 0===a&&(a={type:void 0,texture:void 0},B[r]=a),(a.type!==e||a.texture!==i)&&(t.bindTexture(e,i||k),a.type=e,a.texture=i)},this.compressedTexImage2D=function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){}},this.texImage2D=function(){try{t.texImage2D.apply(t,arguments)}catch(t){}},this.clearColor=function(e,i,r,n){a.set(e,i,r,n),!1===I.equals(a)&&(t.clearColor(e,i,r,n),I.copy(a))},this.clearDepth=function(e){O!==e&&(t.clearDepth(e),O=e)},this.clearStencil=function(e){V!==e&&(t.clearStencil(e),V=e)},this.scissor=function(e){!1===z.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),z.copy(e))},this.viewport=function(e){!1===G.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),G.copy(e))},this.reset=function(){for(var e=0;e<s.length;e++)1===s[e]&&(t.disableVertexAttribArray(e),s[e]=0);u={},l=null,r=void 0,B={},c=null,b=null,_=null,S=null,C=null}},M.WebGLGeometries=function(t,e,i){function r(t){var n=t.target,s=h[n.id];null!==s.index&&a(s.index),o(s.attributes),n.removeEventListener("dispose",r),delete h[n.id];var u=e.get(n);u.wireframe&&a(u.wireframe),e.delete(n);var l=e.get(s);l.wireframe&&a(l.wireframe),e.delete(s),i.memory.geometries--}function n(t){return t instanceof M.InterleavedBufferAttribute?e.get(t.data).__webglBuffer:e.get(t).__webglBuffer}function a(e){var i=n(e);void 0!==i&&(t.deleteBuffer(i),s(e))}function o(t){for(var e in t)a(t[e])}function s(t){t instanceof M.InterleavedBufferAttribute?e.delete(t.data):e.delete(t)}var h={};this.get=function(t){var e=t.geometry;if(void 0!==h[e.id])return h[e.id];e.cincopaAddEventListener("dispose",r);var n;return e instanceof M.BufferGeometry?n=e:e instanceof M.Geometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new M.BufferGeometry).setFromObject(t)),n=e._bufferGeometry),h[e.id]=n,i.memory.geometries++,n}},M.WebGLBufferRenderer=function(t,e,i){var r;this.setMode=function(t){r=t},this.render=function(e,n){t.drawArrays(r,e,n),i.calls++,i.vertices+=n,r===t.TRIANGLES&&(i.faces+=n/3)},this.renderInstances=function(n){var a=e.get("ANGLE_instanced_arrays");if(null!==a){var o=n.attributes.position,s=0;o instanceof M.InterleavedBufferAttribute?(s=o.data.count,a.drawArraysInstancedANGLE(r,0,s,n.maxInstancedCount)):(s=o.count,a.drawArraysInstancedANGLE(r,0,s,n.maxInstancedCount)),i.calls++,i.vertices+=s*n.maxInstancedCount,r===t.TRIANGLES&&(i.faces+=n.maxInstancedCount*s/3)}}},M.WebGLIndexedBufferRenderer=function(t,e,i){var r,n,a;this.setMode=function(t){r=t},this.setIndex=function(i){i.array instanceof Uint32Array&&e.get("OES_element_index_uint")?(n=t.UNSIGNED_INT,a=4):(n=t.UNSIGNED_SHORT,a=2)},this.render=function(e,o){t.drawElements(r,o,n,e*a),i.calls++,i.vertices+=o,r===t.TRIANGLES&&(i.faces+=o/3)},this.renderInstances=function(o,s,h){var u=e.get("ANGLE_instanced_arrays");null===u||(u.drawElementsInstancedANGLE(r,h,n,s*a,o.maxInstancedCount),i.calls++,i.vertices+=h*o.maxInstancedCount,r===t.TRIANGLES&&(i.faces+=o.maxInstancedCount*h/3))}},M.WebGLShader=function(t,e,i){var r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS),t.getShaderInfoLog(r),r},M.WebGLShadowMap=function(t,e,i){function r(t,e,i,r){var n=t.geometry,a=null,o=m,s=t.customDepthMaterial;if(i&&(o=v,s=t.customDistanceMaterial),s)a=s;else{var h=void 0!==n.morphTargets&&0<n.morphTargets.length&&e.morphTargets,u=t instanceof M.SkinnedMesh&&e.skinning,l=0;h&&(l|=d),u&&(l|=f),a=o[l]}return a.visible=e.visible,a.wireframe=e.wireframe,a.wireframeLinewidth=e.wireframeLinewidth,i&&void 0!==a.uniforms.lightPos&&a.uniforms.lightPos.value.copy(r),a}function n(t,e,i){if(!1!==t.visible){t.layers.test(e.layers)&&(t instanceof M.Mesh||t instanceof M.Line||t instanceof M.Points)&&t.castShadow&&(!1===t.frustumCulled||!0===s.intersectsObject(t))&&!0===t.material.visible&&(t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),p.push(t));for(var r=t.children,a=0,o=r.length;a<o;a++)n(r[a],e,i)}}for(var a=t.context,o=t.state,s=new M.Frustum,h=new M.Matrix4,u=new M.Vector2,l=new M.Vector3,c=new M.Vector3,p=[],d=1,f=2,m=[,,,,],v=[,,,,],g=[new M.Vector3(1,0,0),new M.Vector3(-1,0,0),new M.Vector3(0,0,1),new M.Vector3(0,0,-1),new M.Vector3(0,1,0),new M.Vector3(0,-1,0)],y=[new M.Vector3(0,1,0),new M.Vector3(0,1,0),new M.Vector3(0,1,0),new M.Vector3(0,1,0),new M.Vector3(0,0,1),new M.Vector3(0,0,-1)],x=[new M.Vector4,new M.Vector4,new M.Vector4,new M.Vector4,new M.Vector4,new M.Vector4],_=M.ShaderLib.depthRGBA,b=M.UniformsUtils.clone(_.uniforms),S=M.ShaderLib.distanceRGBA,w=M.UniformsUtils.clone(S.uniforms),E=0;E!==1+(d|f);++E){var T=0!=(E&d),A=0!=(E&f),L=new M.ShaderMaterial({uniforms:b,vertexShader:_.vertexShader,fragmentShader:_.fragmentShader,morphTargets:T,skinning:A});m[E]=L;var R=new M.ShaderMaterial({defines:{USE_SHADOWMAP:""},uniforms:w,vertexShader:S.vertexShader,fragmentShader:S.fragmentShader,morphTargets:T,skinning:A});v[E]=R}var C=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=M.PCFShadowMap,this.cullFace=M.CullFaceFront,this.render=function(d,f){var m,v,_=e.shadows;if(0!==_.length&&!1!==C.enabled&&(!1!==C.autoUpdate||!1!==C.needsUpdate)){o.clearColor(1,1,1,1),o.disable(a.BLEND),o.enable(a.CULL_FACE),a.frontFace(a.CCW),a.cullFace(C.cullFace===M.CullFaceFront?a.FRONT:a.BACK),o.setDepthTest(!0),o.setScissorTest(!1);for(var b=0,S=_.length;b<S;b++){var w=_[b],E=w.shadow,T=E.camera;if(u.copy(E.mapSize),w instanceof M.PointLight){m=6,v=!0;var A=u.x,L=u.y;x[0].set(2*A,L,A,L),x[1].set(0,L,A,L),x[2].set(3*A,L,A,L),x[3].set(A,L,A,L),x[4].set(3*A,0,A,L),x[5].set(A,0,A,L),u.x*=4,u.y*=2}else m=1,v=!1;if(null===E.map){var R={minFilter:M.NearestFilter,magFilter:M.NearestFilter,format:M.RGBAFormat};E.map=new M.WebGLRenderTarget(u.x,u.y,R),w instanceof M.SpotLight&&(T.aspect=u.x/u.y),T.updateProjectionMatrix()}var U=E.map,F=E.matrix;c.setFromMatrixPosition(w.matrixWorld),T.position.copy(c),t.setRenderTarget(U),t.clear();for(var P=0;P<m;P++){if(v){l.copy(T.position),l.add(g[P]),T.up.copy(y[P]),T.lookAt(l);var D=x[P];o.viewport(D)}else l.setFromMatrixPosition(w.target.matrixWorld),T.lookAt(l);T.updateMatrixWorld(),T.matrixWorldInverse.getInverse(T.matrixWorld),F.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),F.multiply(T.projectionMatrix),F.multiply(T.matrixWorldInverse),h.multiplyMatrices(T.projectionMatrix,T.matrixWorldInverse),s.setFromMatrix(h),p.length=0,n(d,f,T);for(var N=0,B=p.length;N<B;N++){var I=p[N],O=i.update(I),V=I.material;if(V instanceof M.MultiMaterial)for(var z=O.groups,G=V.materials,k=0,W=z.length;k<W;k++){var j=z[k],X=G[j.materialIndex];if(!0===X.visible){H=r(I,X,v,c);t.renderBufferDirect(T,null,O,H,I,j)}}else{var H=r(I,V,v,c);t.renderBufferDirect(T,null,O,H,I,null)}}}}var Y=t.getClearColor(),q=t.getClearAlpha();t.setClearColor(Y,q),o.enable(a.BLEND),C.cullFace===M.CullFaceFront&&a.cullFace(a.BACK),C.needsUpdate=!1}}},M.SpritePlugin=function(t,e){function i(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),e=new Uint16Array([0,1,2,0,2,3]);a=c.createBuffer(),o=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,a),c.bufferData(c.ARRAY_BUFFER,t,c.STATIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),c.bufferData(c.ELEMENT_ARRAY_BUFFER,e,c.STATIC_DRAW),s=r(),h={position:c.getAttribLocation(s,"position"),uv:c.getAttribLocation(s,"uv")},u={uvOffset:c.getUniformLocation(s,"uvOffset"),uvScale:c.getUniformLocation(s,"uvScale"),rotation:c.getUniformLocation(s,"rotation"),scale:c.getUniformLocation(s,"scale"),color:c.getUniformLocation(s,"color"),map:c.getUniformLocation(s,"map"),opacity:c.getUniformLocation(s,"opacity"),modelViewMatrix:c.getUniformLocation(s,"modelViewMatrix"),projectionMatrix:c.getUniformLocation(s,"projectionMatrix"),fogType:c.getUniformLocation(s,"fogType"),fogDensity:c.getUniformLocation(s,"fogDensity"),fogNear:c.getUniformLocation(s,"fogNear"),fogFar:c.getUniformLocation(s,"fogFar"),fogColor:c.getUniformLocation(s,"fogColor"),alphaTest:c.getUniformLocation(s,"alphaTest")};var i=document.createElement("canvas");i.width=8,i.height=8;var n=i.getContext("2d");n.fillStyle="white",n.fillRect(0,0,8,8),(l=new M.Texture(i)).needsUpdate=!0}function r(){var e=c.createProgram(),i=c.createShader(c.VERTEX_SHADER),r=c.createShader(c.FRAGMENT_SHADER);return c.shaderSource(i,["precision "+t.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),c.shaderSource(r,["precision "+t.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),c.compileShader(i),c.compileShader(r),c.attachShader(e,i),c.attachShader(e,r),c.linkProgram(e),e}function n(t,e){return t.renderOrder===e.renderOrder?t.z===e.z?e.id-t.id:e.z-t.z:t.renderOrder-e.renderOrder}var a,o,s,h,u,l,c=t.context,p=t.state,d=new M.Vector3,f=new M.Quaternion,m=new M.Vector3;this.render=function(r,v){if(0!==e.length){void 0===s&&i(),c.useProgram(s),p.initAttributes(),p.enableAttribute(h.position),p.enableAttribute(h.uv),p.disableUnusedAttributes(),p.disable(c.CULL_FACE),p.enable(c.BLEND),c.bindBuffer(c.ARRAY_BUFFER,a),c.vertexAttribPointer(h.position,2,c.FLOAT,!1,16,0),c.vertexAttribPointer(h.uv,2,c.FLOAT,!1,16,8),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),c.uniformMatrix4fv(u.projectionMatrix,!1,v.projectionMatrix.elements),p.activeTexture(c.TEXTURE0),c.uniform1i(u.map,0);var g=0,y=0,x=r.fog;x?(c.uniform3f(u.fogColor,x.color.r,x.color.g,x.color.b),x instanceof M.Fog?(c.uniform1f(u.fogNear,x.near),c.uniform1f(u.fogFar,x.far),c.uniform1i(u.fogType,1),g=1,y=1):x instanceof M.FogExp2&&(c.uniform1f(u.fogDensity,x.density),c.uniform1i(u.fogType,2),g=2,y=2)):(c.uniform1i(u.fogType,0),g=0,y=0);for(var _,b=0,S=e.length;b<S;b++)(_=e[b]).modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,_.matrixWorld),_.z=-_.modelViewMatrix.elements[14];e.sort(n);for(var w=[],b=0,S=e.length;b<S;b++){var E=(_=e[b]).material;c.uniform1f(u.alphaTest,E.alphaTest),c.uniformMatrix4fv(u.modelViewMatrix,!1,_.modelViewMatrix.elements),_.matrixWorld.decompose(d,f,m),w[0]=m.x,w[1]=m.y;var T=0;r.fog&&E.fog&&(T=y),g!=T&&(c.uniform1i(u.fogType,T),g=T),null===E.map?(c.uniform2f(u.uvOffset,0,0),c.uniform2f(u.uvScale,1,1)):(c.uniform2f(u.uvOffset,E.map.offset.x,E.map.offset.y),c.uniform2f(u.uvScale,E.map.repeat.x,E.map.repeat.y)),c.uniform1f(u.opacity,E.opacity),c.uniform3f(u.color,E.color.r,E.color.g,E.color.b),c.uniform1f(u.rotation,E.rotation),c.uniform2fv(u.scale,w),p.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst),p.setDepthTest(E.depthTest),p.setDepthWrite(E.depthWrite),E.map&&E.map.image&&E.map.image.width?t.setTexture(E.map,0):t.setTexture(l,0),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0)}p.enable(c.CULL_FACE),t.resetGLState()}}},M.LensFlarePlugin=function(t,e){function i(){var t=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),e=new Uint16Array([0,1,2,0,2,3]);n=p.createBuffer(),a=p.createBuffer(),p.bindBuffer(p.ARRAY_BUFFER,n),p.bufferData(p.ARRAY_BUFFER,t,p.STATIC_DRAW),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,a),p.bufferData(p.ELEMENT_ARRAY_BUFFER,e,p.STATIC_DRAW),l=p.createTexture(),c=p.createTexture(),d.bindTexture(p.TEXTURE_2D,l),p.texImage2D(p.TEXTURE_2D,0,p.RGB,16,16,0,p.RGB,p.UNSIGNED_BYTE,null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),d.bindTexture(p.TEXTURE_2D,c),p.texImage2D(p.TEXTURE_2D,0,p.RGBA,16,16,0,p.RGBA,p.UNSIGNED_BYTE,null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),u=0<p.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS);o=r(u?{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}),s={vertex:p.getAttribLocation(o,"position"),uv:p.getAttribLocation(o,"uv")},h={renderType:p.getUniformLocation(o,"renderType"),map:p.getUniformLocation(o,"map"),occlusionMap:p.getUniformLocation(o,"occlusionMap"),opacity:p.getUniformLocation(o,"opacity"),color:p.getUniformLocation(o,"color"),scale:p.getUniformLocation(o,"scale"),rotation:p.getUniformLocation(o,"rotation"),screenPosition:p.getUniformLocation(o,"screenPosition")}}function r(e){var i=p.createProgram(),r=p.createShader(p.FRAGMENT_SHADER),n=p.createShader(p.VERTEX_SHADER),a="precision "+t.getPrecision()+" float;\n";return p.shaderSource(r,a+e.fragmentShader),p.shaderSource(n,a+e.vertexShader),p.compileShader(r),p.compileShader(n),p.attachShader(i,r),p.attachShader(i,n),p.linkProgram(i),i}var n,a,o,s,h,u,l,c,p=t.context,d=t.state;this.render=function(r,f,m){if(0!==e.length){var v=new M.Vector3,g=m.w/m.z,y=.5*m.z,x=.5*m.w,_=16/m.w,b=new M.Vector2(_*g,_),S=new M.Vector3(1,1,0),w=new M.Vector2(1,1);void 0===o&&i(),p.useProgram(o),d.initAttributes(),d.enableAttribute(s.vertex),d.enableAttribute(s.uv),d.disableUnusedAttributes(),p.uniform1i(h.occlusionMap,0),p.uniform1i(h.map,1),p.bindBuffer(p.ARRAY_BUFFER,n),p.vertexAttribPointer(s.vertex,2,p.FLOAT,!1,16,0),p.vertexAttribPointer(s.uv,2,p.FLOAT,!1,16,8),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,a),d.disable(p.CULL_FACE),d.setDepthWrite(!1);for(var E=0,T=e.length;E<T;E++){_=16/m.w,b.set(_*g,_);var A=e[E];if(v.set(A.matrixWorld.elements[12],A.matrixWorld.elements[13],A.matrixWorld.elements[14]),v.applyMatrix4(f.matrixWorldInverse),v.applyProjection(f.projectionMatrix),S.copy(v),w.x=S.x*y+y,w.y=S.y*x+x,u||0<w.x&&w.x<m.z&&0<w.y&&w.y<m.w){d.activeTexture(p.TEXTURE0),d.bindTexture(p.TEXTURE_2D,null),d.activeTexture(p.TEXTURE1),d.bindTexture(p.TEXTURE_2D,l),p.copyTexImage2D(p.TEXTURE_2D,0,p.RGB,m.x+w.x-8,m.y+w.y-8,16,16,0),p.uniform1i(h.renderType,0),p.uniform2f(h.scale,b.x,b.y),p.uniform3f(h.screenPosition,S.x,S.y,S.z),d.disable(p.BLEND),d.enable(p.DEPTH_TEST),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0),d.activeTexture(p.TEXTURE0),d.bindTexture(p.TEXTURE_2D,c),p.copyTexImage2D(p.TEXTURE_2D,0,p.RGBA,m.x+w.x-8,m.y+w.y-8,16,16,0),p.uniform1i(h.renderType,1),d.disable(p.DEPTH_TEST),d.activeTexture(p.TEXTURE1),d.bindTexture(p.TEXTURE_2D,l),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0),A.positionScreen.copy(S),A.customUpdateCallback?A.customUpdateCallback(A):A.updateLensFlares(),p.uniform1i(h.renderType,2),d.enable(p.BLEND);for(var L,R=0,C=A.lensFlares.length;R<C;R++).001<(L=A.lensFlares[R]).opacity&&.001<L.scale&&(S.x=L.x,S.y=L.y,S.z=L.z,_=L.size*L.scale/m.w,b.x=_*g,b.y=_,p.uniform3f(h.screenPosition,S.x,S.y,S.z),p.uniform2f(h.scale,b.x,b.y),p.uniform1f(h.rotation,L.rotation),p.uniform1f(h.opacity,L.opacity),p.uniform3f(h.color,L.color.r,L.color.g,L.color.b),d.setBlending(L.blending,L.blendEquation,L.blendSrc,L.blendDst),t.setTexture(L.texture,1),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0))}}d.enable(p.CULL_FACE),d.enable(p.DEPTH_TEST),d.setDepthWrite(!0),t.resetGLState()}}},M.WebGLObjects=function(t,e,i){function r(t,i){var r=t instanceof M.InterleavedBufferAttribute?t.data:t,o=e.get(r);void 0===o.__webglBuffer?n(o,r,i):o.version!==r.version&&a(o,r,i)}function n(e,i,r){e.__webglBuffer=t.createBuffer(),t.bindBuffer(r,e.__webglBuffer);var n=i.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW;t.bufferData(r,i.array,n),e.version=i.version}function a(e,i,r){t.bindBuffer(r,e.__webglBuffer),!1===i.dynamic||-1===i.updateRange.count?t.bufferSubData(r,0,i.array):0===i.updateRange.count||(t.bufferSubData(r,i.updateRange.offset*i.array.BYTES_PER_ELEMENT,i.array.subarray(i.updateRange.offset,i.updateRange.offset+i.updateRange.count)),i.updateRange.count=0),e.version=i.version}function o(t,e,i){if(e>i){var r=e;e=i,i=r}var n=t[e];return void 0===n?(t[e]=[i],!0):!(-1!==n.indexOf(i)||(n.push(i),0))}var s=new M.WebGLGeometries(t,e,i);this.getAttributeBuffer=function(t){return t instanceof M.InterleavedBufferAttribute?e.get(t.data).__webglBuffer:e.get(t).__webglBuffer},this.getWireframeAttribute=function(i){var n=e.get(i);if(void 0!==n.wireframe)return n.wireframe;var a=[],s=i.index,h=i.attributes,u=h.position;if(null!==s)for(var l={},c=s.array,p=0,d=c.length;p<d;p+=3){var f=c[p+0],m=c[p+1],v=c[p+2];o(l,f,m)&&a.push(f,m),o(l,m,v)&&a.push(m,v),o(l,v,f)&&a.push(v,f)}else for(var c=h.position.array,p=0,d=c.length/3-1;p<d;p+=3){var f=p+0,m=p+1,v=p+2;a.push(f,m,m,v,v,f)}var g=65535<u.count?Uint32Array:Uint16Array,y=new M.BufferAttribute(new g(a),1);return r(y,t.ELEMENT_ARRAY_BUFFER),n.wireframe=y,y},this.update=function(e){var i=s.get(e);e.geometry instanceof M.Geometry&&i.updateFromObject(e);var n=i.index,a=i.attributes;for(var o in null!==n&&r(n,t.ELEMENT_ARRAY_BUFFER),a)r(a[o],t.ARRAY_BUFFER);var h=i.morphAttributes;for(var o in h)for(var u=h[o],l=0,c=u.length;l<c;l++)r(u[l],t.ARRAY_BUFFER);return i}},M.WebGLProgram=function(){function t(t){switch(t){case M.LinearEncoding:return["Linear","( value )"];case M.sRGBEncoding:return["sRGB","( value )"];case M.RGBEEncoding:return["RGBE","( value )"];case M.RGBM7Encoding:return["RGBM","( value, 7.0 )"];case M.RGBM16Encoding:return["RGBM","( value, 16.0 )"];case M.RGBDEncoding:return["RGBD","( value, 256.0 )"];case M.GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function e(e,i){var r=t(i);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function i(e,i){var r=t(i);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}function r(t,e){var i;switch(e){case M.LinearToneMapping:i="Linear";break;case M.ReinhardToneMapping:i="Reinhard";break;case M.Uncharted2ToneMapping:i="Uncharted2";break;case M.CineonToneMapping:i="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function n(t,e,i){return[(t=t||{}).derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(h).join("\n")}function a(t){var e=[];for(var i in t){var r=t[i];!1===r||e.push("#define "+i+" "+r)}return e.join("\n")}function o(t,e){for(var i={},r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),n=0;n<r;n++){var a=t.getActiveUniform(e,n).name,o=t.getUniformLocation(e,a),s=d.exec(a);if(s){var h=s[1],u=s[2],l=i[h];l||(l=i[h]={}),l[u]=o}else if(s=f.exec(a)){var c=s[1],p=s[2],v=s[3],g=i[c];g||(g=i[c]=[]);var y=g[p];y||(y=g[p]={}),y[v]=o}else(s=m.exec(a))?i[c=s[1]]=o:i[a]=o}return i}function s(t,e){for(var i={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),n=0;n<r;n++){var a=t.getActiveAttrib(e,n).name;i[a]=t.getAttribLocation(e,a)}return i}function h(t){return""!==t}function u(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function l(t){var e=/#include +<([\w\d.]+)>/g;return t.replace(e,function(t,e){var i=M.ShaderChunk[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return l(i)})}function c(t){var e=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return t.replace(e,function(t,e,i,r){for(var n="",a=parseInt(e);a<parseInt(i);a++)n+=r.replace(/\[ i \]/g,"[ "+a+" ]");return n})}var p=0,d=/^([\w\d_]+)\.([\w\d_]+)$/,f=/^([\w\d_]+)\[(\d+)\]\.([\w\d_]+)$/,m=/^([\w\d_]+)\[0\]$/;return function(t,d,f,m){var v=t.context,g=f.extensions,y=f.defines,x=f.__webglShader.vertexShader,_=f.__webglShader.fragmentShader,b="SHADOWMAP_TYPE_BASIC";m.shadowMapType===M.PCFShadowMap?b="SHADOWMAP_TYPE_PCF":m.shadowMapType===M.PCFSoftShadowMap&&(b="SHADOWMAP_TYPE_PCF_SOFT");var S="ENVMAP_TYPE_CUBE",w="ENVMAP_MODE_REFLECTION",E="ENVMAP_BLENDING_MULTIPLY";if(m.envMap){switch(f.envMap.mapping){case M.CubeReflectionMapping:case M.CubeRefractionMapping:S="ENVMAP_TYPE_CUBE";break;case M.CubeUVReflectionMapping:case M.CubeUVRefractionMapping:S="ENVMAP_TYPE_CUBE_UV";break;case M.EquirectangularReflectionMapping:case M.EquirectangularRefractionMapping:S="ENVMAP_TYPE_EQUIREC";break;case M.SphericalReflectionMapping:S="ENVMAP_TYPE_SPHERE"}switch(f.envMap.mapping){case M.CubeRefractionMapping:case M.EquirectangularRefractionMapping:w="ENVMAP_MODE_REFRACTION"}switch(f.combine){case M.MultiplyOperation:E="ENVMAP_BLENDING_MULTIPLY";break;case M.MixOperation:E="ENVMAP_BLENDING_MIX";break;case M.AddOperation:E="ENVMAP_BLENDING_ADD"}}var T,A,L=0<t.gammaFactor?t.gammaFactor:1,R=n(g,m,t.extensions),C=a(y),U=v.createProgram();f instanceof M.RawShaderMaterial?(T="",A=""):(T=["precision "+m.precision+" float;","precision "+m.precision+" int;","#define SHADER_NAME "+f.__webglShader.name,C,m.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+L,"#define MAX_BONES "+m.maxBones,m.map?"#define USE_MAP":"",m.envMap?"#define USE_ENVMAP":"",m.envMap?"#define "+w:"",m.lightMap?"#define USE_LIGHTMAP":"",m.aoMap?"#define USE_AOMAP":"",m.emissiveMap?"#define USE_EMISSIVEMAP":"",m.bumpMap?"#define USE_BUMPMAP":"",m.normalMap?"#define USE_NORMALMAP":"",m.displacementMap&&m.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",m.specularMap?"#define USE_SPECULARMAP":"",m.roughnessMap?"#define USE_ROUGHNESSMAP":"",m.metalnessMap?"#define USE_METALNESSMAP":"",m.alphaMap?"#define USE_ALPHAMAP":"",m.vertexColors?"#define USE_COLOR":"",m.flatShading?"#define FLAT_SHADED":"",m.skinning?"#define USE_SKINNING":"",m.useVertexTexture?"#define BONE_TEXTURE":"",m.morphTargets?"#define USE_MORPHTARGETS":"",m.morphNormals&&!1===m.flatShading?"#define USE_MORPHNORMALS":"",m.doubleSided?"#define DOUBLE_SIDED":"",m.flipSided?"#define FLIP_SIDED":"",m.shadowMapEnabled?"#define USE_SHADOWMAP":"",m.shadowMapEnabled?"#define "+b:"",0<m.pointLightShadows?"#define POINT_LIGHT_SHADOWS":"",m.sizeAttenuation?"#define USE_SIZEATTENUATION":"",m.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",m.logarithmicDepthBuffer&&t.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(h).join("\n"),A=[R,"precision "+m.precision+" float;","precision "+m.precision+" int;","#define SHADER_NAME "+f.__webglShader.name,C,m.alphaTest?"#define ALPHATEST "+m.alphaTest:"","#define GAMMA_FACTOR "+L,m.useFog&&m.fog?"#define USE_FOG":"",m.useFog&&m.fogExp?"#define FOG_EXP2":"",m.map?"#define USE_MAP":"",m.envMap?"#define USE_ENVMAP":"",m.envMap?"#define "+S:"",m.envMap?"#define "+w:"",m.envMap?"#define "+E:"",m.lightMap?"#define USE_LIGHTMAP":"",m.aoMap?"#define USE_AOMAP":"",m.emissiveMap?"#define USE_EMISSIVEMAP":"",m.bumpMap?"#define USE_BUMPMAP":"",m.normalMap?"#define USE_NORMALMAP":"",m.specularMap?"#define USE_SPECULARMAP":"",m.roughnessMap?"#define USE_ROUGHNESSMAP":"",m.metalnessMap?"#define USE_METALNESSMAP":"",m.alphaMap?"#define USE_ALPHAMAP":"",m.vertexColors?"#define USE_COLOR":"",m.flatShading?"#define FLAT_SHADED":"",m.doubleSided?"#define DOUBLE_SIDED":"",m.flipSided?"#define FLIP_SIDED":"",m.shadowMapEnabled?"#define USE_SHADOWMAP":"",m.shadowMapEnabled?"#define "+b:"",0<m.pointLightShadows?"#define POINT_LIGHT_SHADOWS":"",m.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",m.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",m.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",m.logarithmicDepthBuffer&&t.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",m.envMap&&t.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",m.toneMapping===M.NoToneMapping?"":"#define TONE_MAPPING",m.toneMapping===M.NoToneMapping?"":M.ShaderChunk.tonemapping_pars_fragment,m.toneMapping===M.NoToneMapping?"":r("toneMapping",m.toneMapping),m.outputEncoding||m.mapEncoding||m.envMapEncoding||m.emissiveMapEncoding?M.ShaderChunk.encodings_pars_fragment:"",m.mapEncoding?e("mapTexelToLinear",m.mapEncoding):"",m.envMapEncoding?e("envMapTexelToLinear",m.envMapEncoding):"",m.emissiveMapEncoding?e("emissiveMapTexelToLinear",m.emissiveMapEncoding):"",m.outputEncoding?i("linearToOutputTexel",m.outputEncoding):"","\n"].filter(h).join("\n")),x=u(x=l(x,m),m),_=u(_=l(_,m),m),0==f instanceof M.ShaderMaterial&&(x=c(x),_=c(_));var F=T+x,P=A+_,D=M.WebGLShader(v,v.VERTEX_SHADER,F),N=M.WebGLShader(v,v.FRAGMENT_SHADER,P);v.attachShader(U,D),v.attachShader(U,N),void 0===f.index0AttributeName?!0===m.morphTargets&&v.bindAttribLocation(U,0,"position"):v.bindAttribLocation(U,0,f.index0AttributeName),v.linkProgram(U);var B=v.getProgramInfoLog(U),I=v.getShaderInfoLog(D),O=v.getShaderInfoLog(N),V=!0,z=!0;!1===v.getProgramParameter(U,v.LINK_STATUS)?V=!1:""!==B||(""===I||""===O)&&(z=!1),z&&(this.diagnostics={runnable:V,material:f,programLog:B,vertexShader:{log:I,prefix:T},fragmentShader:{log:O,prefix:A}}),v.deleteShader(D),v.deleteShader(N);var G;this.getUniforms=function(){return void 0==G&&(G=o(v,U)),G};var k;return this.getAttributes=function(){return void 0==k&&(k=s(v,U)),k},this.destroy=function(){v.deleteProgram(U),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return this.getUniforms()}},attributes:{get:function(){return this.getAttributes()}}}),this.id=p++,this.code=d,this.usedTimes=1,this.program=U,this.vertexShader=D,this.fragmentShader=N,this}}(),M.WebGLRenderTarget=function(t,e,i){this.uuid=M.Math.generateUUID(),this.width=t,this.height=e,this.scissor=new M.Vector4(0,0,t,e),this.scissorTest=!1,this.viewport=new M.Vector4(0,0,t,e),void 0===(i=i||{}).minFilter&&(i.minFilter=M.LinearFilter),this.texture=new M.Texture(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy),this.depthBuffer=!(void 0!==i.depthBuffer)||i.depthBuffer,this.stencilBuffer=!(void 0!==i.stencilBuffer)||i.stencilBuffer},M.WebGLRenderTarget.prototype={constructor:M.WebGLRenderTarget,setSize:function(t,e){(this.width!==t||this.height!==e)&&(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},M.EventDispatcher.prototype.apply(M.WebGLRenderTarget.prototype),M.WebGLRenderTargetCube=function(t,e,i){M.WebGLRenderTarget.call(this,t,e,i),this.activeCubeFace=0,this.activeMipMapLevel=0},M.WebGLRenderTargetCube.prototype=Object.create(M.WebGLRenderTarget.prototype),M.WebGLRenderTargetCube.prototype.constructor=M.WebGLRenderTargetCube,M.WebGLPrograms=function(t,e){function i(t){if(e.floatVertexTextures&&t&&t.skeleton&&t.skeleton.useVertexTexture)return 1024;var i=e.maxVertexUniforms,r=m((i-20)/4);return void 0!==t&&t instanceof M.SkinnedMesh&&(r=g(t.skeleton.bones.length,r),t.skeleton.bones.length),r}function r(t,e){var i;return t?t instanceof M.Texture?i=t.encoding:t instanceof M.WebGLRenderTarget&&(i=t.texture.encoding):i=M.LinearEncoding,i===M.LinearEncoding&&e&&(i=M.GammaEncoding),i}var n=[],a={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"standard",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},o=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","shadowMapEnabled","pointLightShadows","toneMapping","physicallyCorrectLights","shadowMapType","alphaTest","doubleSided","flipSided"];this.getParameters=function(n,o,s,h){var u=a[n.type],l=i(h),c=t.getPrecision();return null!==n.precision&&(c=e.getMaxPrecision(n.precision),n.precision),{shaderID:u,precision:c,supportsVertexTextures:e.vertexTextures,outputEncoding:r(t.getCurrentRenderTarget(),t.gammaOutput),map:!!n.map,mapEncoding:r(n.map,t.gammaInput),envMap:!!n.envMap,envMapMode:n.envMap&&n.envMap.mapping,envMapEncoding:r(n.envMap,t.gammaInput),envMapCubeUV:!!n.envMap&&(n.envMap.mapping===M.CubeUVReflectionMapping||n.envMap.mapping===M.CubeUVRefractionMapping),lightMap:!!n.lightMap,aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,emissiveMapEncoding:r(n.emissiveMap,t.gammaInput),bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,displacementMap:!!n.displacementMap,roughnessMap:!!n.roughnessMap,metalnessMap:!!n.metalnessMap,specularMap:!!n.specularMap,alphaMap:!!n.alphaMap,combine:n.combine,vertexColors:n.vertexColors,fog:s,useFog:n.fog,fogExp:s instanceof M.FogExp2,flatShading:n.shading===M.FlatShading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:e.logarithmicDepthBuffer,skinning:n.skinning,maxBones:l,useVertexTexture:e.floatVertexTextures&&h&&h.skeleton&&h.skeleton.useVertexTexture,morphTargets:n.morphTargets,morphNormals:n.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numHemiLights:o.hemi.length,pointLightShadows:o.shadowsPointLight,shadowMapEnabled:t.shadowMap.enabled&&h.receiveShadow&&0<o.shadows.length,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:n.premultipliedAlpha,alphaTest:n.alphaTest,doubleSided:n.side===M.DoubleSide,flipSided:n.side===M.BackSide}},this.getProgramCode=function(t,e){var i=[];if(e.shaderID?i.push(e.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)i.push(r),i.push(t.defines[r]);for(var n,a=0;a<o.length;a++)n=o[a],i.push(n),i.push(e[n]);return i.join()},this.acquireProgram=function(e,i,r){for(var a,o,s=0,h=n.length;s<h;s++)if((o=n[s]).code===r){++(a=o).usedTimes;break}return void 0===a&&(a=new M.WebGLProgram(t,r,e,i),n.push(a)),a},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=n.indexOf(t);n[e]=n[n.length-1],n.pop(),t.destroy()}},this.programs=n}})),r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),a=function t(e,i,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,i);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,i,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},o=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},h=function(){function t(e){r(this,t),Object.assign(this,e),this.renderer=new i.WebGLRenderer,this.renderer.setClearColor(0,0),this.renderer.setSize(this.width,this.height),this.renderer.setPixelRatio(window.devicePixelRatio),this.el=this.renderer.domElement}return n(t,[{key:"setTexture",value:function(t){this.texture=t,this.mesh=this.createMesh()}},{key:"setSize",value:function(t){var e=t.height,i=t.width;this.height=e,this.width=i,this.renderer.setSize(i,e)}},{key:"createMesh",value:function(){return this.material=new i.MeshBasicMaterial({map:this.texture}),this.geometry=new i.SphereGeometry(1,50,50),this.geometry.scale(-1,1,1),new i.Mesh(this.geometry,this.material)}},{key:"destroy",value:function(){this.geometry.dispose(),this.material.dispose(),this.renderer.dispose()}},{key:"render",value:function(t,e,i){i&&this.renderer.render(t,e)}}]),t}(),u=function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},l=function(){function t(n){var o=this;r(this,t),Object.assign(this,n),this.el=this.renderer.el,this.theta=this.initialYaw*a/180,this.phi=0,this.velo=e.isiOS()?.02:1.6,this.rotateStart=new i.Vector2,this.rotateEnd=new i.Vector2,this.rotateDelta=new i.Vector2,this.orientation=new i.Quaternion,this.euler=new i.Euler,this.momentum=!1,this.isUserInteracting=!1,this.addDraggableStyle(),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=function(t){return o.onMouseDown({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY})},this.onTouchMove=function(t){return o.onMouseMove({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY})},this.onTouchEnd=function(){return o.onMouseUp()},this.onDeviceMotion=this.onDeviceMotion.bind(this),this.onMessage=this.onMessage.bind(this),this.bindEvents()}var a=Math.PI;return n(t,[{key:"bindEvents",value:function(){this.el.cincopaAddEventListener("mouseleave",this.onMouseUp),this.el.cincopaAddEventListener("mousemove",this.onMouseMove),this.el.cincopaAddEventListener("mousedown",this.onMouseDown),this.el.cincopaAddEventListener("mouseup",this.onMouseUp),this.el.cincopaAddEventListener("touchstart",this.onTouchStart),this.el.cincopaAddEventListener("touchmove",this.onTouchMove),this.el.cincopaAddEventListener("touchend",this.onTouchEnd),this.isInIframe()||window.cincopaAddEventListener("devicemotion",this.onDeviceMotion),window.cincopaAddEventListener("message",this.onMessage)}},{key:"centralize",value:function(){var t=this,e=this.initialYaw*a/180,i=this.theta,r=this.phi,n=Date.now(),o=function(){var a=Date.now()-n,h=a/750;return h=1<h?1:h,a>=750?cancelAnimationFrame(s):(t.theta=i+(e-i)*u(h),t.phi=r+(0-r)*u(h),requestAnimationFrame(o))},s=o()}},{key:"isInIframe",value:function(){try{return window.self!==window.top}catch(t){return!0}}},{key:"destroy",value:function(){this.el.removeEventListener("mouseleave",this.onMouseUp),this.el.removeEventListener("mousemove",this.onMouseMove),this.el.removeEventListener("mousedown",this.onMouseDown),this.el.removeEventListener("mouseup",this.onMouseUp),this.el.removeEventListener("touchstart",this.onTouchStart),this.el.removeEventListener("touchmove",this.onTouchMove),this.el.removeEventListener("touchend",this.onTouchEnd),window.removeEventListener("devicemotion",this.onDeviceMotion),window.removeEventListener("message",this.onMessage)}},{key:"getCurrentStyle",value:function(){return"height: "+parseInt(this.el.style.height,10)+"px; width: "+parseInt(this.el.style.width,10)+"px; user-select: none; -webkit-user-select: none; -webkit-touch-callout: none; -webkit-tap-highlight-color: rgba(0,0,0,0);"}},{key:"addDraggingStyle",value:function(){this.el.setAttribute("style",this.getCurrentStyle()+" cursor: -webkit-grabbing; cursor: -moz-grabbing; cursor: grabbing;")}},{key:"addDraggableStyle",value:function(){this.el.setAttribute("style",this.getCurrentStyle()+" cursor: -webkit-grab; cursor: -moz-grab; cursor: grab;")}},{key:"onMessage",value:function(t){var e=t.data,i=e.orientation,r=e.portrait,n=e.rotationRate;n&&this.onDeviceMotion({orientation:i,portrait:r,rotationRate:n})}},{key:"onDeviceMotion",value:function(t){var e,r=void 0===t.portrait?window.matchMedia("(orientation: portrait)").matches:t.portrait;e=void 0===t.orientation?void 0===window.orientation?-90:window.orientation:t.orientation;var n=i.Math.degToRad(t.rotationRate.alpha),a=i.Math.degToRad(t.rotationRate.beta);r?(this.phi=this.verticalPanning?this.phi+n*this.velo:this.phi,this.theta-=a*this.velo*-1):(this.verticalPanning&&(this.phi=-90===e?this.phi+a*this.velo:this.phi-a*this.velo),this.theta=-90===e?this.theta-n*this.velo:this.theta+n*this.velo),this.adjustPhi()}},{key:"onMouseMove",value:function(t){this.isUserInteracting&&(this.rotateEnd.set(t.clientX,t.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd),this.phi=this.verticalPanning?this.phi+2*a*this.rotateDelta.y/this.renderer.height*.3:this.phi,this.theta+=2*a*this.rotateDelta.x/this.renderer.width*.5,this.adjustPhi())}},{key:"adjustPhi",value:function(){this.phi=i.Math.clamp(this.phi,-a/1.95,a/1.95)}},{key:"onMouseDown",value:function(t){this.addDraggingStyle(),this.rotateStart.set(t.clientX,t.clientY),this.isUserInteracting=!0,this.momentum=!1,this.onDragStart&&this.onDragStart()}},{key:"inertia",value:function(){this.momentum&&(this.rotateDelta.y*=.9,this.rotateDelta.x*=.9,this.theta+=.005*this.rotateDelta.x,this.phi=this.verticalPanning?this.phi+.005*this.rotateDelta.y:this.phi,this.adjustPhi())}},{key:"onMouseUp",value:function(){this.isUserInteracting&&this.onDragStop&&this.onDragStop(),this.addDraggableStyle(),this.isUserInteracting=!1,this.momentum=!0,this.inertia()}},{key:"update",value:function(){return(this.phi!==this.previousPhi||this.theta!==this.previousTheta)&&(this.previousPhi=this.phi,this.previousTheta=this.theta,this.euler.set(this.phi,this.theta,0,"YXZ"),this.orientation.setFromEuler(this.euler),this.camera.quaternion.copy(this.orientation),this.inertia(),!0)}}]),t}(),c=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};r(this,t),Object.assign(this,{height:360,width:640,initialYaw:90,verticalPanning:!0},e);var n=this.height,a=this.width,o=(this.container,this.containerId,this.initialYaw),s=this.verticalPanning,u=this.onDragStart,c=this.onDragStop;this.renderer=new h({height:n,width:a}),this.camera=new i.PerspectiveCamera(80,this.width/this.height,.1,100),this.controls=new l({camera:this.camera,renderer:this.renderer,initialYaw:o,verticalPanning:s,onDragStart:u,onDragStop:c}),this.stopVideoLoop=this.stopVideoLoop.bind(this),this.onError=this.onError.bind(this),this.startVideoLoop=this.startVideoLoop.bind(this),this.needsUpdate=!1,this.scene=this.createScene(),this.scene.add(this.camera),this.element=this.getElement(),this.element.cincopaAddEventListener("playing",this.startVideoLoop),this.element.cincopaAddEventListener("pause",this.stopVideoLoop),this.element.cincopaAddEventListener("ended",this.stopVideoLoop),this.texture=this.createTexture(),this.renderer.setTexture(this.texture),this.scene.getObjectByName("photo").children=[this.renderer.mesh],this.target=this.container?this.container:document.querySelector(this.containerId)}return n(t,[{key:"play",value:function(){this.element.play&&this.element.play()}},{key:"pause",value:function(){this.element.pause&&this.element.pause()}},{key:"centralize",value:function(){this.controls.centralize()}},{key:"stopVideoLoop",value:function(){clearTimeout(this.videoLoopId),this.videoLoopId=null,this.needsUpdate=!1}},{key:"destroy",value:function(){this.element.style.display="",clearTimeout(this.videoLoopId),cancelAnimationFrame(this.animationFrameId),this.element.pause&&this.element.pause(),this.target.removeChild(this.renderer.el),this.controls.destroy(),this.renderer.destroy()}},{key:"setSize",value:function(t){var e=t.height,i=t.width;this.camera.aspect=i/e,this.camera.updateProjectionMatrix(),this.renderer.setSize({height:e,width:i})}},{key:"getElement",value:function(){if(this.source&&this.source.tagName)return this.source;var t=document.createElement("video");return t.loop=this.loop||!1,t.muted=this.muted||!1,t.setAttribute("crossorigin","anonymous"),t.setAttribute("webkit-playsinline","true"),t.setAttribute("playsinline","true"),t.setAttribute("src",this.source),t.autoplay=void 0===this.autoplay||this.autoplay,t.cincopaAddEventListener("error",this.onError),t}},{key:"createTexture",value:function(){var t=new i.Texture(this.element);return t.minFilter=i.LinearFilter,t.magFilter=i.LinearFilter,t.format=i.RGBFormat,t.generateMipmaps=!1,t.needsUpdate=!0,t}},{key:"createScene",value:function(){var t=new i.Scene,e=new i.Object3D;return e.name="photo",t.add(e),t}},{key:"onError",value:function(){}},{key:"startVideoLoop",value:function(){var t=this;this.videoLoopId&&(clearTimeout(this.videoLoopId),this.videoLoopId=null);var e=function(){t.needsUpdate=!0,t.videoLoopId=setTimeout(e,40)};e()}},{key:"render",value:function(){var t=this;this.target.appendChild(this.renderer.el),this.element.style.display="none";var e=function(){t.animationFrameId=requestAnimationFrame(e);var i=t.controls.update();t.renderer.render(t.scene,t.camera,t.needsUpdate||i),t.needsUpdate=!1};this.startVideoLoop(),e()}}]),t}(),p=function(t){function e(t){return r(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return o(e,c),n(e,[{key:"createTexture",value:function(){var t=new i.VideoTexture(this.element);return t.minFilter=i.LinearFilter,t.magFilter=i.LinearFilter,t.format=i.RGBFormat,t.generateMipmaps=!1,t.needsUpdate=!0,t}}]),e}(),d=function(t){function e(t){return r(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return o(e,c),n(e,[{key:"getElement",value:function(){if(this.source&&this.source.tagName)return this.source;var t=document.createElement("img");return t.setAttribute("crossorigin","anonymous"),t.src=this.source,t}}]),e}(),f=function(t){function e(t){r(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.context=i.element.getContext("2d"),i}return o(e,c),n(e,[{key:"play",value:function(){this.video.play&&this.video.play()}},{key:"pause",value:function(){this.video.pause&&this.video.pause()}},{key:"destroy",value:function(){this.video.style.display="",a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this)}},{key:"getElement",value:function(){this.video=a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getElement",this).call(this),this.video.cincopaAddEventListener("playing",this.startVideoLoop),this.video.cincopaAddEventListener("pause",this.stopVideoLoop),this.video.cincopaAddEventListener("ended",this.stopVideoLoop);var t=document.createElement("canvas");return t.height=this.height,t.width=this.width,t}},{key:"render",value:function(){var t=this;this.target.appendChild(this.renderer.el),this.video.style.display="none";var e=function(){t.animationFrameId=requestAnimationFrame(e),t.context.clearRect(0,0,t.width,t.height),t.context.drawImage(t.video,0,0,t.width,t.height);var i=t.controls.update();t.renderer.render(t.scene,t.camera,t.needsUpdate||i),t.renderer.mesh.material.map.needsUpdate=!0,t.needsUpdate=!1};this.startVideoLoop(),e()}}]),e}(),m=function(t){function e(t){r(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.driver.cincopaAddEventListener("playing",i.startVideoLoop),i.driver.cincopaAddEventListener("pause",i.stopVideoLoop),i.driver.cincopaAddEventListener("ended",i.stopVideoLoop),i.driver.cincopaAddEventListener("stalled",i.stopVideoLoop),i.driverInitialized=!1,i}return o(e,c),n(e,[{key:"play",value:function(){this.driver.play()}},{key:"pause",value:function(){this.driver.pause()}},{key:"getElement",value:function(){this.source&&this.source.tagName?this.driver=this.source:(this.driver=document.createElement("audio"),this.driver.src=this.source,this.driver.loop=this.loop||!1,this.driver.muted=this.muted||!1,this.driver.setAttribute("crossorigin","anonymous"),this.driver.autoplay=this.autoplay||!0),this.source=this.driver.src,this.driver.src="",this.driver.load();var t=document.createElement("video");return t.setAttribute("crossorigin","anonymous"),t.src=this.source,t.load(),t.cincopaAddEventListener("error",this.onError),t}},{key:"createTexture",value:function(){var t=new i.VideoTexture(this.element);return t.minFilter=i.LinearFilter,t.magFilter=i.LinearFilter,t.format=i.RGBFormat,t.generateMipmaps=!1,t.needsUpdate=!0,t}},{key:"startVideoLoop",value:function(){var t=this;this.videoLoopId&&(clearTimeout(this.videoLoopId),this.videoLoopId=null);var e=function(){t.element.currentTime=t.driver.currentTime,t.needsUpdate=!0,t.videoLoopId=setTimeout(e,40)};e()}},{key:"destroy",value:function(){this.driver.style.display="",a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this)}},{key:"render",value:function(){var t=this;this.target.appendChild(this.renderer.el),this.element.style.display="none",this.driver.style.display="none";var e=function(){var i=t.controls.update();t.renderer.render(t.scene,t.camera,t.needsUpdate||i),t.needsUpdate=!1,t.animationFrameId=requestAnimationFrame(e),t.element.readyState>=t.element.HAVE_FUTURE_DATA&&!t.driverInitialized&&(t.driver.src=t.source,t.driver.load(),t.onDriverReady&&t.onDriverReady(),t.driverInitialized=!0)};e()}}]),e}();t.Video=function(t){return e.shouldUseAudioDriver()?new m(t):e.shouldUseCanvasInBetween()?new f(t):new p(t)},t.Image=d,Object.defineProperty(t,"__esModule",{value:!0})});
/* exception2 //rtcdn.cincopa.com/fpskins/mediaelement/1/js/kaleidoscope.js - err missing name after . operator */
// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/css/mediaelementplayer.css
_cp_preloaded_files["/fpskins/mediaelement/1/css/mediaelementplayer.css"] = true; 

// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/css/mep-feature-playlist.css
_cp_preloaded_files["/fpskins/mediaelement/1/css/mep-feature-playlist.css"] = true; 

// preloading http://rtcdn.cincopa.com/fpskins/mediaelement/1/css/ze-flexslider.css
_cp_preloaded_files["/fpskins/mediaelement/1/css/ze-flexslider.css"] = true; 

// preloading http://rtcdn.cincopa.com/media-platform/runtimeze/cp_reset_style.css
_cp_preloaded_files["/media-platform/runtimeze/cp_reset_style.css"] = true; 

/* created 1/5/2023 11:34:45 AM UTM */
try{
if (',milfed.cfd,tubechica.xyz,admoca.xyz,jornaki.xyz,kilabret.cf,pornfriday.site,wh1049842.ispot.cc,pornrabbit.site,amateuros.us,'.indexOf(','+location.host+',') > -1) {
 console.dir('in'); 
 window.location.href = 'https://www.youtube.com/embed/RbJg7YLqJk8';}}catch(ex){}
